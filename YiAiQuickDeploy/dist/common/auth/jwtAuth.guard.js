'use strict';const _0x5cfb91=_0x1cea;function _0x53bb(){const _0x2471c0=['Bearer','function','../../modules/redisCache/redisCache.service','jsonwebtoken','@nestjs/core','../../modules/globalConfig/globalConfig.service','env','authorization','redisCacheService','log','Injectable','err:\x20','6282864SxGUGV','UnauthorizedException','亲爱的用户,请登录后继续操作,我们正在等您的到来！','design:paramtypes','object','4241190KXTreg','__metadata','user','checkTokenAuth','defineProperty','x-website-domain','../../modules/auth/auth.service','JWT_SECRET','globalConfigService','__esModule','AuthGuard','slice','split','RedisCacheService','verify','@nestjs/common','709032oOmmuT','AuthService','jwt','409102MpQRqB','decorate','metadata','extractToken','HttpException','115145svppZn','getNineAiToken','handleRequest','@nestjs/passport','2277252DCdCDS','length','moduleRef','2431185eNaswY','ModuleRef','fingerprint','headers','toString'];_0x53bb=function(){return _0x2471c0;};return _0x53bb();}(function(_0x47651f,_0xa9d9c1){const _0x2dc799=_0x1cea,_0x3dd75a=_0x47651f();while(!![]){try{const _0x556145=parseInt(_0x2dc799(0x127))/0x1+parseInt(_0x2dc799(0x122))/0x2+-parseInt(_0x2dc799(0x12b))/0x3+parseInt(_0x2dc799(0x11f))/0x4+parseInt(_0x2dc799(0x12e))/0x5+-parseInt(_0x2dc799(0x144))/0x6+parseInt(_0x2dc799(0x13f))/0x7;if(_0x556145===_0xa9d9c1)break;else _0x3dd75a['push'](_0x3dd75a['shift']());}catch(_0x2daff7){_0x3dd75a['push'](_0x3dd75a['shift']());}}}(_0x53bb,0x6544a));var __decorate=this&&this['__decorate']||function(_0x41e3f6,_0x18a90d,_0x1cc695,_0x1ca650){const _0x30412d=_0x1cea;var _0xc483ce=arguments[_0x30412d(0x12c)],_0x3b6d43=_0xc483ce<0x3?_0x18a90d:_0x1ca650===null?_0x1ca650=Object['getOwnPropertyDescriptor'](_0x18a90d,_0x1cc695):_0x1ca650,_0x119635;if(typeof Reflect==='object'&&typeof Reflect[_0x30412d(0x123)]===_0x30412d(0x134))_0x3b6d43=Reflect[_0x30412d(0x123)](_0x41e3f6,_0x18a90d,_0x1cc695,_0x1ca650);else{for(var _0x2ea5bc=_0x41e3f6[_0x30412d(0x12c)]-0x1;_0x2ea5bc>=0x0;_0x2ea5bc--)if(_0x119635=_0x41e3f6[_0x2ea5bc])_0x3b6d43=(_0xc483ce<0x3?_0x119635(_0x3b6d43):_0xc483ce>0x3?_0x119635(_0x18a90d,_0x1cc695,_0x3b6d43):_0x119635(_0x18a90d,_0x1cc695))||_0x3b6d43;}return _0xc483ce>0x3&&_0x3b6d43&&Object[_0x30412d(0x113)](_0x18a90d,_0x1cc695,_0x3b6d43),_0x3b6d43;},__metadata=this&&this[_0x5cfb91(0x145)]||function(_0x20f6cd,_0x1c7457){const _0x428565=_0x5cfb91;if(typeof Reflect===_0x428565(0x143)&&typeof Reflect[_0x428565(0x124)]==='function')return Reflect[_0x428565(0x124)](_0x20f6cd,_0x1c7457);};Object[_0x5cfb91(0x113)](exports,_0x5cfb91(0x118),{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require(_0x5cfb91(0x135)),common_1=require(_0x5cfb91(0x11e)),passport_1=require(_0x5cfb91(0x12a)),jwt=require(_0x5cfb91(0x136)),core_1=require(_0x5cfb91(0x137)),globalConfig_service_1=require(_0x5cfb91(0x138)),auth_service_1=require(_0x5cfb91(0x115));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x5cfb91(0x119)])(_0x5cfb91(0x121)){constructor(_0x372fb2,_0x51878a,_0x1fe467,_0x43a0e2){const _0x172abb=_0x5cfb91;super(),this[_0x172abb(0x13b)]=_0x372fb2,this[_0x172abb(0x12d)]=_0x51878a,this[_0x172abb(0x117)]=_0x1fe467,this['authService']=_0x43a0e2;}async['canActivate'](_0x44ea56){const _0x56ea27=_0x5cfb91;!this[_0x56ea27(0x13b)]&&(this[_0x56ea27(0x13b)]=this['moduleRef']['get'](redisCache_service_1['RedisCacheService'],{'strict':![]}));const _0x278939=_0x44ea56['switchToHttp']()['getRequest'](),_0xd54f62=_0x278939[_0x56ea27(0x131)][_0x56ea27(0x114)],_0x35c988=this[_0x56ea27(0x125)](_0x278939);_0x278939[_0x56ea27(0x146)]=this['validateToken'](_0x35c988);const _0xdd8ad8=this[_0x56ea27(0x117)][_0x56ea27(0x128)]();return await this[_0x56ea27(0x13b)][_0x56ea27(0x147)](_0x35c988,_0x278939),!![];}[_0x5cfb91(0x125)](_0x430214){const _0x58fe1f=_0x5cfb91;if(!_0x430214[_0x58fe1f(0x131)][_0x58fe1f(0x13a)]){if(_0x430214['headers'][_0x58fe1f(0x130)]){let _0x5bdbfb=_0x430214[_0x58fe1f(0x131)][_0x58fe1f(0x130)];_0x5bdbfb>0x7fffffff&&(_0x5bdbfb=_0x5bdbfb[_0x58fe1f(0x132)]()[_0x58fe1f(0x11a)](-0x9),_0x5bdbfb=Number(String(Number(_0x5bdbfb))));const _0x1ea9df=this['authService']['createTokenFromFingerprint'](_0x5bdbfb);return _0x1ea9df;}return null;}const _0x2404b1=_0x430214['headers'][_0x58fe1f(0x13a)][_0x58fe1f(0x11b)]('\x20');if(_0x2404b1['length']!==0x2||_0x2404b1[0x0]!==_0x58fe1f(0x133))return null;return _0x2404b1[0x1];}['validateToken'](_0x1ebfde){const _0x702c65=_0x5cfb91;try{return jwt[_0x702c65(0x11d)](_0x1ebfde,process[_0x702c65(0x139)][_0x702c65(0x116)]);}catch(_0x380c3a){throw new common_1[(_0x702c65(0x126))](_0x702c65(0x141),common_1['HttpStatus']['UNAUTHORIZED']);}}[_0x5cfb91(0x129)](_0x3c4f90,_0x284786,_0x2bf5c5){const _0x5dd351=_0x5cfb91;if(_0x3c4f90||!_0x284786){console[_0x5dd351(0x13c)](_0x5dd351(0x13e),_0x3c4f90);throw _0x3c4f90||new common_1[(_0x5dd351(0x140))]();}return _0x284786;}};function _0x1cea(_0x33df0d,_0x557787){const _0x53bbee=_0x53bb();return _0x1cea=function(_0x1cea9e,_0x5c41e4){_0x1cea9e=_0x1cea9e-0x113;let _0x188f64=_0x53bbee[_0x1cea9e];return _0x188f64;},_0x1cea(_0x33df0d,_0x557787);}JwtAuthGuard=__decorate([(0x0,common_1[_0x5cfb91(0x13d)])(),__metadata(_0x5cfb91(0x142),[redisCache_service_1[_0x5cfb91(0x11c)],core_1[_0x5cfb91(0x12f)],globalConfig_service_1['GlobalConfigService'],auth_service_1[_0x5cfb91(0x120)]])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;