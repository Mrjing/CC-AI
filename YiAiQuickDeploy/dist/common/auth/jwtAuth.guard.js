'use strict';const _0x453ce3=_0x4c2a;function _0x15e4(){const _0x5b536b=['UNAUTHORIZED','23101MnNhJF','亲爱的用户,请登录后继续操作,我们正在等您的到来！','canActivate','decorate','../../modules/auth/auth.service','env','__metadata','slice','object','JWT_SECRET','err:\x20','JwtAuthGuard','1FWNUXl','RedisCacheService','design:paramtypes','UnauthorizedException','function','getOwnPropertyDescriptor','Bearer','@nestjs/passport','../../modules/globalConfig/globalConfig.service','defineProperty','headers','10HcMnGp','@nestjs/common','user','266jLuFMG','HttpStatus','Injectable','2991243IrOLjG','length','log','verify','104988wfRhiw','fingerprint','x-website-domain','redisCacheService','HttpException','get','175085HWitfA','split','GlobalConfigService','metadata','getNineAiToken','ModuleRef','12FMiucK','authService','3648FmobOt','__decorate','handleRequest','18owZjxR','toString','extractToken','2419505tsFqDP','../../modules/redisCache/redisCache.service','@nestjs/core','moduleRef','createTokenFromFingerprint','691876oBhyFe','AuthGuard','jsonwebtoken','jwt','402224cwHWcQ'];_0x15e4=function(){return _0x5b536b;};return _0x15e4();}function _0x4c2a(_0x5bacdc,_0xef9164){const _0x15e400=_0x15e4();return _0x4c2a=function(_0x4c2a2f,_0x3c543c){_0x4c2a2f=_0x4c2a2f-0xfb;let _0x4ae24d=_0x15e400[_0x4c2a2f];return _0x4ae24d;},_0x4c2a(_0x5bacdc,_0xef9164);}(function(_0x5bc402,_0x465ab9){const _0x308564=_0x4c2a,_0x411085=_0x5bc402();while(!![]){try{const _0x407744=parseInt(_0x308564(0x12d))/0x1*(parseInt(_0x308564(0x11b))/0x2)+-parseInt(_0x308564(0xfe))/0x3+-parseInt(_0x308564(0x10e))/0x4*(-parseInt(_0x308564(0x108))/0x5)+-parseInt(_0x308564(0x102))/0x6*(-parseInt(_0x308564(0xfb))/0x7)+-parseInt(_0x308564(0x11f))/0x8*(-parseInt(_0x308564(0x113))/0x9)+parseInt(_0x308564(0x138))/0xa*(-parseInt(_0x308564(0x116))/0xb)+-parseInt(_0x308564(0x110))/0xc*(-parseInt(_0x308564(0x121))/0xd);if(_0x407744===_0x465ab9)break;else _0x411085['push'](_0x411085['shift']());}catch(_0x1c2d3e){_0x411085['push'](_0x411085['shift']());}}}(_0x15e4,0x83bf9));var __decorate=this&&this[_0x453ce3(0x111)]||function(_0x570cc9,_0x45b33f,_0x1ca9f1,_0x52ab32){const _0x3f702f=_0x453ce3;var _0x258bf9=arguments[_0x3f702f(0xff)],_0x162c7f=_0x258bf9<0x3?_0x45b33f:_0x52ab32===null?_0x52ab32=Object[_0x3f702f(0x132)](_0x45b33f,_0x1ca9f1):_0x52ab32,_0x206c11;if(typeof Reflect===_0x3f702f(0x129)&&typeof Reflect[_0x3f702f(0x124)]===_0x3f702f(0x131))_0x162c7f=Reflect[_0x3f702f(0x124)](_0x570cc9,_0x45b33f,_0x1ca9f1,_0x52ab32);else{for(var _0x4540f7=_0x570cc9[_0x3f702f(0xff)]-0x1;_0x4540f7>=0x0;_0x4540f7--)if(_0x206c11=_0x570cc9[_0x4540f7])_0x162c7f=(_0x258bf9<0x3?_0x206c11(_0x162c7f):_0x258bf9>0x3?_0x206c11(_0x45b33f,_0x1ca9f1,_0x162c7f):_0x206c11(_0x45b33f,_0x1ca9f1))||_0x162c7f;}return _0x258bf9>0x3&&_0x162c7f&&Object[_0x3f702f(0x136)](_0x45b33f,_0x1ca9f1,_0x162c7f),_0x162c7f;},__metadata=this&&this[_0x453ce3(0x127)]||function(_0x1b5694,_0x45a4e7){const _0x299a73=_0x453ce3;if(typeof Reflect===_0x299a73(0x129)&&typeof Reflect['metadata']===_0x299a73(0x131))return Reflect[_0x299a73(0x10b)](_0x1b5694,_0x45a4e7);};Object[_0x453ce3(0x136)](exports,'__esModule',{'value':!![]}),exports[_0x453ce3(0x12c)]=void 0x0;const redisCache_service_1=require(_0x453ce3(0x117)),common_1=require(_0x453ce3(0x139)),passport_1=require(_0x453ce3(0x134)),jwt=require(_0x453ce3(0x11d)),core_1=require(_0x453ce3(0x118)),globalConfig_service_1=require(_0x453ce3(0x135)),auth_service_1=require(_0x453ce3(0x125));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x453ce3(0x11c)])(_0x453ce3(0x11e)){constructor(_0x25242f,_0x231d88,_0x652c5,_0x3b5a35){const _0x9579e9=_0x453ce3;super(),this[_0x9579e9(0x105)]=_0x25242f,this[_0x9579e9(0x119)]=_0x231d88,this['globalConfigService']=_0x652c5,this['authService']=_0x3b5a35;}async[_0x453ce3(0x123)](_0x4e524c){const _0x13a7e0=_0x453ce3;!this[_0x13a7e0(0x105)]&&(this[_0x13a7e0(0x105)]=this['moduleRef'][_0x13a7e0(0x107)](redisCache_service_1[_0x13a7e0(0x12e)],{'strict':![]}));const _0x494d63=_0x4e524c['switchToHttp']()['getRequest'](),_0x13f8ef=_0x494d63['headers'][_0x13a7e0(0x104)],_0x19281f=this['extractToken'](_0x494d63);_0x494d63[_0x13a7e0(0x13a)]=this['validateToken'](_0x19281f);const _0x5bd5ff=this['globalConfigService'][_0x13a7e0(0x10c)]();return await this[_0x13a7e0(0x105)]['checkTokenAuth'](_0x19281f,_0x494d63),!![];}[_0x453ce3(0x115)](_0x5e5895){const _0x279044=_0x453ce3;if(!_0x5e5895[_0x279044(0x137)]['authorization']){if(_0x5e5895[_0x279044(0x137)][_0x279044(0x103)]){let _0x320b5e=_0x5e5895['headers']['fingerprint'];_0x320b5e>0x7fffffff&&(_0x320b5e=_0x320b5e[_0x279044(0x114)]()[_0x279044(0x128)](-0x9),_0x320b5e=Number(String(Number(_0x320b5e))));const _0x4b8d08=this[_0x279044(0x10f)][_0x279044(0x11a)](_0x320b5e);return _0x4b8d08;}return null;}const _0x20d67a=_0x5e5895[_0x279044(0x137)]['authorization'][_0x279044(0x109)]('\x20');if(_0x20d67a[_0x279044(0xff)]!==0x2||_0x20d67a[0x0]!==_0x279044(0x133))return null;return _0x20d67a[0x1];}['validateToken'](_0x7c9a14){const _0x536bce=_0x453ce3;try{return jwt[_0x536bce(0x101)](_0x7c9a14,process[_0x536bce(0x126)][_0x536bce(0x12a)]);}catch(_0x4145f9){throw new common_1[(_0x536bce(0x106))](_0x536bce(0x122),common_1[_0x536bce(0xfc)][_0x536bce(0x120)]);}}[_0x453ce3(0x112)](_0x1842b3,_0x40f916,_0x4cb61a){const _0x3ec500=_0x453ce3;if(_0x1842b3||!_0x40f916){console[_0x3ec500(0x100)](_0x3ec500(0x12b),_0x1842b3);throw _0x1842b3||new common_1[(_0x3ec500(0x130))]();}return _0x40f916;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x453ce3(0xfd)])(),__metadata(_0x453ce3(0x12f),[redisCache_service_1[_0x453ce3(0x12e)],core_1[_0x453ce3(0x10d)],globalConfig_service_1[_0x453ce3(0x10a)],auth_service_1['AuthService']])],JwtAuthGuard),exports[_0x453ce3(0x12c)]=JwtAuthGuard;