'use strict';function _0x2003(){const _0x394aa8=['function','__esModule','err:\x20','decorate','../../modules/auth/auth.service','59619DhsqEp','checkTokenAuth','redisCacheService','globalConfigService','@nestjs/core','Injectable','32hewTLO','switchToHttp','亲爱的用户,请登录后继续操作,我们正在等您的到来！','@nestjs/common','design:paramtypes','extractToken','defineProperty','AuthGuard','slice','metadata','GlobalConfigService','headers','128oANdrY','fingerprint','JwtAuthGuard','UNAUTHORIZED','x-website-domain','authService','10lipkPk','getNineAiToken','HttpException','user','AuthService','60kzODOi','Bearer','__decorate','validateToken','log','@nestjs/passport','length','getOwnPropertyDescriptor','get','5161oKbEev','../../modules/globalConfig/globalConfig.service','1821816smaupg','authorization','JWT_SECRET','68474oygHjH','jsonwebtoken','ModuleRef','6451CueNdD','object','84lOpZJk','3802227UpGFpS','3200286yYhFVy','canActivate','RedisCacheService','27420VToQMw','HttpStatus','toString','moduleRef','jwt'];_0x2003=function(){return _0x394aa8;};return _0x2003();}function _0x33c9(_0x3225e0,_0x185fb7){const _0x2003d1=_0x2003();return _0x33c9=function(_0x33c9ce,_0x3a3897){_0x33c9ce=_0x33c9ce-0xd7;let _0x2cc7db=_0x2003d1[_0x33c9ce];return _0x2cc7db;},_0x33c9(_0x3225e0,_0x185fb7);}const _0x1f4f08=_0x33c9;(function(_0xa012bc,_0x4e5673){const _0x26edd9=_0x33c9,_0x1c107d=_0xa012bc();while(!![]){try{const _0x20a039=-parseInt(_0x26edd9(0xe6))/0x1*(-parseInt(_0x26edd9(0xfd))/0x2)+parseInt(_0x26edd9(0xf7))/0x3*(-parseInt(_0x26edd9(0xe8))/0x4)+parseInt(_0x26edd9(0x10f))/0x5*(parseInt(_0x26edd9(0xea))/0x6)+parseInt(_0x26edd9(0xe3))/0x7*(-parseInt(_0x26edd9(0x109))/0x8)+parseInt(_0x26edd9(0xe0))/0x9*(-parseInt(_0x26edd9(0x114))/0xa)+parseInt(_0x26edd9(0xe9))/0xb+parseInt(_0x26edd9(0xed))/0xc*(parseInt(_0x26edd9(0xde))/0xd);if(_0x20a039===_0x4e5673)break;else _0x1c107d['push'](_0x1c107d['shift']());}catch(_0x499957){_0x1c107d['push'](_0x1c107d['shift']());}}}(_0x2003,0x9ae17));var __decorate=this&&this[_0x1f4f08(0xd7)]||function(_0x280971,_0xda13da,_0x5dee45,_0x2b806d){const _0x38b299=_0x1f4f08;var _0x3bc2e1=arguments['length'],_0x1673a7=_0x3bc2e1<0x3?_0xda13da:_0x2b806d===null?_0x2b806d=Object[_0x38b299(0xdc)](_0xda13da,_0x5dee45):_0x2b806d,_0x22af2a;if(typeof Reflect==='object'&&typeof Reflect[_0x38b299(0xf5)]===_0x38b299(0xf2))_0x1673a7=Reflect[_0x38b299(0xf5)](_0x280971,_0xda13da,_0x5dee45,_0x2b806d);else{for(var _0x3bd5c0=_0x280971[_0x38b299(0xdb)]-0x1;_0x3bd5c0>=0x0;_0x3bd5c0--)if(_0x22af2a=_0x280971[_0x3bd5c0])_0x1673a7=(_0x3bc2e1<0x3?_0x22af2a(_0x1673a7):_0x3bc2e1>0x3?_0x22af2a(_0xda13da,_0x5dee45,_0x1673a7):_0x22af2a(_0xda13da,_0x5dee45))||_0x1673a7;}return _0x3bc2e1>0x3&&_0x1673a7&&Object[_0x38b299(0x103)](_0xda13da,_0x5dee45,_0x1673a7),_0x1673a7;},__metadata=this&&this['__metadata']||function(_0x4952e3,_0x509302){const _0x1f5976=_0x1f4f08;if(typeof Reflect===_0x1f5976(0xe7)&&typeof Reflect['metadata']===_0x1f5976(0xf2))return Reflect[_0x1f5976(0x106)](_0x4952e3,_0x509302);};Object[_0x1f4f08(0x103)](exports,_0x1f4f08(0xf3),{'value':!![]}),exports[_0x1f4f08(0x10b)]=void 0x0;const redisCache_service_1=require('../../modules/redisCache/redisCache.service'),common_1=require(_0x1f4f08(0x100)),passport_1=require(_0x1f4f08(0xda)),jwt=require(_0x1f4f08(0xe4)),core_1=require(_0x1f4f08(0xfb)),globalConfig_service_1=require(_0x1f4f08(0xdf)),auth_service_1=require(_0x1f4f08(0xf6));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x1f4f08(0x104)])(_0x1f4f08(0xf1)){constructor(_0x4dbc43,_0x193de7,_0x44b4c5,_0x7ea2d3){const _0x411f77=_0x1f4f08;super(),this[_0x411f77(0xf9)]=_0x4dbc43,this['moduleRef']=_0x193de7,this[_0x411f77(0xfa)]=_0x44b4c5,this[_0x411f77(0x10e)]=_0x7ea2d3;}async[_0x1f4f08(0xeb)](_0x2ac6b1){const _0x1be6da=_0x1f4f08;!this['redisCacheService']&&(this[_0x1be6da(0xf9)]=this[_0x1be6da(0xf0)][_0x1be6da(0xdd)](redisCache_service_1[_0x1be6da(0xec)],{'strict':![]}));const _0x322583=_0x2ac6b1[_0x1be6da(0xfe)]()['getRequest'](),_0x3f4ec7=_0x322583['headers'][_0x1be6da(0x10d)],_0xade772=this[_0x1be6da(0x102)](_0x322583);_0x322583[_0x1be6da(0x112)]=this[_0x1be6da(0xd8)](_0xade772);const _0x1f0fdd=this[_0x1be6da(0xfa)][_0x1be6da(0x110)]();return await this['redisCacheService'][_0x1be6da(0xf8)](_0xade772,_0x322583),!![];}['extractToken'](_0x5d3a72){const _0x4ee6bf=_0x1f4f08;if(!_0x5d3a72[_0x4ee6bf(0x108)][_0x4ee6bf(0xe1)]){if(_0x5d3a72[_0x4ee6bf(0x108)][_0x4ee6bf(0x10a)]){let _0x816b99=_0x5d3a72[_0x4ee6bf(0x108)][_0x4ee6bf(0x10a)];_0x816b99>0x7fffffff&&(_0x816b99=_0x816b99[_0x4ee6bf(0xef)]()[_0x4ee6bf(0x105)](-0x9),_0x816b99=Number(String(Number(_0x816b99))));const _0x45e929=this[_0x4ee6bf(0x10e)]['createTokenFromFingerprint'](_0x816b99);return _0x45e929;}return null;}const _0x47207c=_0x5d3a72[_0x4ee6bf(0x108)]['authorization']['split']('\x20');if(_0x47207c[_0x4ee6bf(0xdb)]!==0x2||_0x47207c[0x0]!==_0x4ee6bf(0x115))return null;return _0x47207c[0x1];}[_0x1f4f08(0xd8)](_0x4bdb1c){const _0x36fc4d=_0x1f4f08;try{return jwt['verify'](_0x4bdb1c,process['env'][_0x36fc4d(0xe2)]);}catch(_0x396cfe){throw new common_1[(_0x36fc4d(0x111))](_0x36fc4d(0xff),common_1[_0x36fc4d(0xee)][_0x36fc4d(0x10c)]);}}['handleRequest'](_0x16a703,_0x3ee372,_0x2725bf){const _0x20ca26=_0x1f4f08;if(_0x16a703||!_0x3ee372){console[_0x20ca26(0xd9)](_0x20ca26(0xf4),_0x16a703);throw _0x16a703||new common_1['UnauthorizedException']();}return _0x3ee372;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x1f4f08(0xfc)])(),__metadata(_0x1f4f08(0x101),[redisCache_service_1['RedisCacheService'],core_1[_0x1f4f08(0xe5)],globalConfig_service_1[_0x1f4f08(0x107)],auth_service_1[_0x1f4f08(0x113)]])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;