'use strict';const _0x523b40=_0x3400;(function(_0x4dd6f0,_0x2eaa25){const _0x338c4b=_0x3400,_0x10a9a4=_0x4dd6f0();while(!![]){try{const _0x2afb18=-parseInt(_0x338c4b(0x124))/0x1*(parseInt(_0x338c4b(0x115))/0x2)+parseInt(_0x338c4b(0x10f))/0x3+-parseInt(_0x338c4b(0x123))/0x4+-parseInt(_0x338c4b(0x109))/0x5*(parseInt(_0x338c4b(0x12b))/0x6)+parseInt(_0x338c4b(0x120))/0x7+-parseInt(_0x338c4b(0x114))/0x8*(-parseInt(_0x338c4b(0x122))/0x9)+parseInt(_0x338c4b(0xfc))/0xa;if(_0x2afb18===_0x2eaa25)break;else _0x10a9a4['push'](_0x10a9a4['shift']());}catch(_0x22ffd6){_0x10a9a4['push'](_0x10a9a4['shift']());}}}(_0x19cb,0xf0e6d));function _0x3400(_0x52db03,_0x44e93d){const _0x19cbb9=_0x19cb();return _0x3400=function(_0x3400e7,_0x4a6f0f){_0x3400e7=_0x3400e7-0xfb;let _0x56e06b=_0x19cbb9[_0x3400e7];return _0x56e06b;},_0x3400(_0x52db03,_0x44e93d);}function _0x19cb(){const _0x4e0f57=['length','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','5FdJVHr','catch','CronExpression','../userBalance/userBalance.entity','定时任务异常','__decorate','3650424kddafE','then','design:returntype','@nestjs/common','EVERY_5_MINUTES','213472lWGObv','132062XmKyST','ModelsService','globalConfigService','TaskService','../models/models.service','./../globalConfig/globalConfig.service','object','__metadata','modelsService','userBalanceEntity','@nestjs/schedule','1889587DQoDvv','getOwnPropertyDescriptor','504vojuXa','7317392WTNMht','1dKxBgZ','function','update','debug','__param','checkUserMemerExpire','Cron','4119804DsaomK','typeorm','LessThanOrEqual','design:paramtypes','prototype','metadata','5876930GgnDGR','UserBalanceEntity','Repository','defineProperty','log','__esModule','Logger','design:type','InjectRepository','find','decorate'];_0x19cb=function(){return _0x4e0f57;};return _0x19cb();}var __decorate=this&&this[_0x523b40(0x10e)]||function(_0x48c385,_0xc4a281,_0x599fe5,_0x2fef20){const _0xe7204d=_0x523b40;var _0x559dc5=arguments[_0xe7204d(0x107)],_0x49bb2c=_0x559dc5<0x3?_0xc4a281:_0x2fef20===null?_0x2fef20=Object[_0xe7204d(0x121)](_0xc4a281,_0x599fe5):_0x2fef20,_0xd88795;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xe7204d(0x125))_0x49bb2c=Reflect[_0xe7204d(0x106)](_0x48c385,_0xc4a281,_0x599fe5,_0x2fef20);else{for(var _0x310de5=_0x48c385['length']-0x1;_0x310de5>=0x0;_0x310de5--)if(_0xd88795=_0x48c385[_0x310de5])_0x49bb2c=(_0x559dc5<0x3?_0xd88795(_0x49bb2c):_0x559dc5>0x3?_0xd88795(_0xc4a281,_0x599fe5,_0x49bb2c):_0xd88795(_0xc4a281,_0x599fe5))||_0x49bb2c;}return _0x559dc5>0x3&&_0x49bb2c&&Object[_0xe7204d(0xff)](_0xc4a281,_0x599fe5,_0x49bb2c),_0x49bb2c;},__metadata=this&&this[_0x523b40(0x11c)]||function(_0x5e4645,_0x37ccfe){const _0x448e66=_0x523b40;if(typeof Reflect===_0x448e66(0x11b)&&typeof Reflect['metadata']===_0x448e66(0x125))return Reflect[_0x448e66(0xfb)](_0x5e4645,_0x37ccfe);},__param=this&&this[_0x523b40(0x128)]||function(_0x29c036,_0xf77e5){return function(_0x1144f7,_0xeb279b){_0xf77e5(_0x1144f7,_0xeb279b,_0x29c036);};};Object[_0x523b40(0xff)](exports,_0x523b40(0x101),{'value':!![]}),exports[_0x523b40(0x118)]=void 0x0;const globalConfig_service_1=require(_0x523b40(0x11a)),common_1=require(_0x523b40(0x112)),schedule_1=require(_0x523b40(0x11f)),userBalance_entity_1=require(_0x523b40(0x10c)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x523b40(0x12c)),models_service_1=require(_0x523b40(0x119));let TaskService=class TaskService{constructor(_0x28f88,_0x32d654,_0x59dd23){const _0x595486=_0x523b40;this[_0x595486(0x11e)]=_0x28f88,this[_0x595486(0x117)]=_0x32d654,this[_0x595486(0x11d)]=_0x59dd23;}['handleCron'](){const _0x6e8d96=_0x523b40;common_1[_0x6e8d96(0x102)]['debug'](_0x6e8d96(0x108),_0x6e8d96(0x118)),this[_0x6e8d96(0x117)]['getWechatAccessToken']()[_0x6e8d96(0x10a)](_0x32383e=>console[_0x6e8d96(0x100)](_0x6e8d96(0x10d),_0x32383e));}async[_0x523b40(0x129)](){const _0x5ee1ba=_0x523b40,_0x4b142f=await this[_0x5ee1ba(0x11e)][_0x5ee1ba(0x105)]({'where':{'expirationTime':(0x0,typeorm_2[_0x5ee1ba(0x12d)])(new Date())}});if(!_0x4b142f||!_0x4b142f['length'])return;_0x4b142f['forEach'](_0x394c6f=>{const _0x295ee9=_0x5ee1ba;this[_0x295ee9(0x11e)][_0x295ee9(0x126)]({'id':_0x394c6f['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x295ee9(0x110)](_0x27b5c8=>{const _0x2c3a34=_0x295ee9;common_1[_0x2c3a34(0x102)][_0x2c3a34(0x127)](_0x394c6f['id']+'会员已到期、清空所有余额并移除会员身份！',_0x2c3a34(0x118));});});}};__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x523b40(0x10b)]['EVERY_HOUR']),__metadata(_0x523b40(0x103),Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',void 0x0)],TaskService[_0x523b40(0x12f)],'handleCron',null),__decorate([(0x0,schedule_1[_0x523b40(0x12a)])(schedule_1[_0x523b40(0x10b)][_0x523b40(0x113)]),__metadata(_0x523b40(0x103),Function),__metadata(_0x523b40(0x12e),[]),__metadata(_0x523b40(0x111),Promise)],TaskService[_0x523b40(0x12f)],_0x523b40(0x129),null),TaskService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x523b40(0x104)])(userBalance_entity_1[_0x523b40(0xfd)])),__metadata(_0x523b40(0x12e),[typeorm_2[_0x523b40(0xfe)],globalConfig_service_1['GlobalConfigService'],models_service_1[_0x523b40(0x116)]])],TaskService),exports['TaskService']=TaskService;