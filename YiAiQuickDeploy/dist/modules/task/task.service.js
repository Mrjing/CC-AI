'use strict';function _0x39fc(){const _0x343e4a=['83797BHpsYf','globalConfigService','__decorate','decorate','design:type','@nestjs/typeorm','LessThanOrEqual','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','length','__param','1MYlbZV','userBalanceEntity','503130BFgelh','ModelsService','Cron','find','metadata','87Ykzaxv','../userBalance/userBalance.entity','update','__esModule','8356YOgkgo','getWechatAccessToken','1314990xAYjPI','design:returntype','debug','Logger','getOwnPropertyDescriptor','会员已到期、清空所有余额并移除会员身份！','typeorm','defineProperty','function','../models/models.service','2253275sdygFI','5354253gCBOgm','TaskService','UserBalanceEntity','handleCron','modelsService','object','./../globalConfig/globalConfig.service','prototype','CronExpression','Repository','GlobalConfigService','104Htjvdv','design:paramtypes','22130800YQAtBG'];_0x39fc=function(){return _0x343e4a;};return _0x39fc();}const _0x4d4ad1=_0x20ed;(function(_0x2aaa8e,_0x156d61){const _0x12086c=_0x20ed,_0x4309a6=_0x2aaa8e();while(!![]){try{const _0x3cb045=-parseInt(_0x12086c(0x1d0))/0x1*(parseInt(_0x12086c(0x1dd))/0x2)+-parseInt(_0x12086c(0x1d7))/0x3*(-parseInt(_0x12086c(0x1db))/0x4)+-parseInt(_0x12086c(0x1b7))/0x5+-parseInt(_0x12086c(0x1d2))/0x6+parseInt(_0x12086c(0x1c6))/0x7*(-parseInt(_0x12086c(0x1c3))/0x8)+-parseInt(_0x12086c(0x1b8))/0x9+parseInt(_0x12086c(0x1c5))/0xa;if(_0x3cb045===_0x156d61)break;else _0x4309a6['push'](_0x4309a6['shift']());}catch(_0x12c917){_0x4309a6['push'](_0x4309a6['shift']());}}}(_0x39fc,0x50d6c));var __decorate=this&&this[_0x4d4ad1(0x1c8)]||function(_0x227412,_0x4d4292,_0x2c7f11,_0x2e3561){const _0x4266ed=_0x4d4ad1;var _0x406de1=arguments['length'],_0x5ee94c=_0x406de1<0x3?_0x4d4292:_0x2e3561===null?_0x2e3561=Object[_0x4266ed(0x1b1)](_0x4d4292,_0x2c7f11):_0x2e3561,_0x39be74;if(typeof Reflect===_0x4266ed(0x1bd)&&typeof Reflect[_0x4266ed(0x1c9)]===_0x4266ed(0x1b5))_0x5ee94c=Reflect[_0x4266ed(0x1c9)](_0x227412,_0x4d4292,_0x2c7f11,_0x2e3561);else{for(var _0x5b7579=_0x227412[_0x4266ed(0x1ce)]-0x1;_0x5b7579>=0x0;_0x5b7579--)if(_0x39be74=_0x227412[_0x5b7579])_0x5ee94c=(_0x406de1<0x3?_0x39be74(_0x5ee94c):_0x406de1>0x3?_0x39be74(_0x4d4292,_0x2c7f11,_0x5ee94c):_0x39be74(_0x4d4292,_0x2c7f11))||_0x5ee94c;}return _0x406de1>0x3&&_0x5ee94c&&Object[_0x4266ed(0x1b4)](_0x4d4292,_0x2c7f11,_0x5ee94c),_0x5ee94c;},__metadata=this&&this['__metadata']||function(_0x59f8b5,_0x1a876c){const _0x338998=_0x4d4ad1;if(typeof Reflect==='object'&&typeof Reflect[_0x338998(0x1d6)]==='function')return Reflect['metadata'](_0x59f8b5,_0x1a876c);},__param=this&&this[_0x4d4ad1(0x1cf)]||function(_0x2854c1,_0x1b68ce){return function(_0xecb2c6,_0x30c22b){_0x1b68ce(_0xecb2c6,_0x30c22b,_0x2854c1);};};Object[_0x4d4ad1(0x1b4)](exports,_0x4d4ad1(0x1da),{'value':!![]}),exports[_0x4d4ad1(0x1b9)]=void 0x0;const globalConfig_service_1=require(_0x4d4ad1(0x1be)),common_1=require('@nestjs/common'),schedule_1=require('@nestjs/schedule'),userBalance_entity_1=require(_0x4d4ad1(0x1d8)),typeorm_1=require(_0x4d4ad1(0x1cb)),typeorm_2=require(_0x4d4ad1(0x1b3)),models_service_1=require(_0x4d4ad1(0x1b6));function _0x20ed(_0x11000d,_0x415818){const _0x39fcb3=_0x39fc();return _0x20ed=function(_0x20ed48,_0x9ca170){_0x20ed48=_0x20ed48-0x1af;let _0x59562e=_0x39fcb3[_0x20ed48];return _0x59562e;},_0x20ed(_0x11000d,_0x415818);}let TaskService=class TaskService{constructor(_0x138d72,_0x55c18e,_0x330a41){const _0x227158=_0x4d4ad1;this['userBalanceEntity']=_0x138d72,this[_0x227158(0x1c7)]=_0x55c18e,this[_0x227158(0x1bc)]=_0x330a41;}[_0x4d4ad1(0x1bb)](){const _0x49d456=_0x4d4ad1;common_1['Logger'][_0x49d456(0x1af)](_0x49d456(0x1cd),_0x49d456(0x1b9)),this[_0x49d456(0x1c7)][_0x49d456(0x1dc)]();}async['checkUserMemerExpire'](){const _0x343742=_0x4d4ad1,_0x4c6233=await this['userBalanceEntity'][_0x343742(0x1d5)]({'where':{'expirationTime':(0x0,typeorm_2[_0x343742(0x1cc)])(new Date())}});if(!_0x4c6233||!_0x4c6233[_0x343742(0x1ce)])return;_0x4c6233['forEach'](_0x1974fa=>{const _0x896a03=_0x343742;this[_0x896a03(0x1d1)][_0x896a03(0x1d9)]({'id':_0x1974fa['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})['then'](_0xb7895=>{const _0x46bfa9=_0x896a03;common_1[_0x46bfa9(0x1b0)]['debug'](_0x1974fa['id']+_0x46bfa9(0x1b2),'TaskService');});});}};__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x4d4ad1(0x1c0)]['EVERY_HOUR']),__metadata(_0x4d4ad1(0x1ca),Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',void 0x0)],TaskService[_0x4d4ad1(0x1bf)],'handleCron',null),__decorate([(0x0,schedule_1[_0x4d4ad1(0x1d4)])(schedule_1[_0x4d4ad1(0x1c0)]['EVERY_5_MINUTES']),__metadata(_0x4d4ad1(0x1ca),Function),__metadata('design:paramtypes',[]),__metadata(_0x4d4ad1(0x1de),Promise)],TaskService[_0x4d4ad1(0x1bf)],'checkUserMemerExpire',null),TaskService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1[_0x4d4ad1(0x1ba)])),__metadata(_0x4d4ad1(0x1c4),[typeorm_2[_0x4d4ad1(0x1c1)],globalConfig_service_1[_0x4d4ad1(0x1c2)],models_service_1[_0x4d4ad1(0x1d3)]])],TaskService),exports[_0x4d4ad1(0x1b9)]=TaskService;