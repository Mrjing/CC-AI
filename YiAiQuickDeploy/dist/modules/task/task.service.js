'use strict';const _0x57d96b=_0x4687;(function(_0x4cc709,_0x4473fa){const _0x15fb0f=_0x4687,_0x56f9e8=_0x4cc709();while(!![]){try{const _0x5a5dec=-parseInt(_0x15fb0f(0xed))/0x1*(parseInt(_0x15fb0f(0xe7))/0x2)+-parseInt(_0x15fb0f(0xec))/0x3+parseInt(_0x15fb0f(0xe1))/0x4+parseInt(_0x15fb0f(0xcb))/0x5*(-parseInt(_0x15fb0f(0xde))/0x6)+parseInt(_0x15fb0f(0xd6))/0x7+parseInt(_0x15fb0f(0xc7))/0x8+-parseInt(_0x15fb0f(0xe5))/0x9*(-parseInt(_0x15fb0f(0xd4))/0xa);if(_0x5a5dec===_0x4473fa)break;else _0x56f9e8['push'](_0x56f9e8['shift']());}catch(_0x3240a7){_0x56f9e8['push'](_0x56f9e8['shift']());}}}(_0x1759,0xee6a1));function _0x4687(_0x13d185,_0x5303d4){const _0x1759fc=_0x1759();return _0x4687=function(_0x4687a2,_0x316e2f){_0x4687a2=_0x4687a2-0xc6;let _0x33379b=_0x1759fc[_0x4687a2];return _0x33379b;},_0x4687(_0x13d185,_0x5303d4);}var __decorate=this&&this[_0x57d96b(0xe3)]||function(_0x4d7e89,_0x35576c,_0x1650da,_0x4dc1bf){const _0x445b36=_0x57d96b;var _0x3c998c=arguments[_0x445b36(0xe8)],_0x504023=_0x3c998c<0x3?_0x35576c:_0x4dc1bf===null?_0x4dc1bf=Object[_0x445b36(0xf0)](_0x35576c,_0x1650da):_0x4dc1bf,_0x52382d;if(typeof Reflect==='object'&&typeof Reflect[_0x445b36(0xd9)]===_0x445b36(0xd5))_0x504023=Reflect['decorate'](_0x4d7e89,_0x35576c,_0x1650da,_0x4dc1bf);else{for(var _0x13d629=_0x4d7e89[_0x445b36(0xe8)]-0x1;_0x13d629>=0x0;_0x13d629--)if(_0x52382d=_0x4d7e89[_0x13d629])_0x504023=(_0x3c998c<0x3?_0x52382d(_0x504023):_0x3c998c>0x3?_0x52382d(_0x35576c,_0x1650da,_0x504023):_0x52382d(_0x35576c,_0x1650da))||_0x504023;}return _0x3c998c>0x3&&_0x504023&&Object[_0x445b36(0xd0)](_0x35576c,_0x1650da,_0x504023),_0x504023;},__metadata=this&&this['__metadata']||function(_0x14d0a5,_0x3f7cc4){const _0x18fde2=_0x57d96b;if(typeof Reflect===_0x18fde2(0xdf)&&typeof Reflect['metadata']===_0x18fde2(0xd5))return Reflect['metadata'](_0x14d0a5,_0x3f7cc4);},__param=this&&this[_0x57d96b(0xd7)]||function(_0x4044e4,_0x426ad5){return function(_0x44a88a,_0x1c2c10){_0x426ad5(_0x44a88a,_0x1c2c10,_0x4044e4);};};function _0x1759(){const _0x4db150=['update','../models/models.service','4090mxuJux','LessThanOrEqual','Injectable','prototype','@nestjs/common','defineProperty','UserBalanceEntity','debug','checkUserMemerExpire','9891230JjSvNo','function','851522OFhxvT','__param','ModelsService','decorate','Logger','会员已到期、清空所有余额并移除会员身份！','Cron','@nestjs/schedule','8898mOLijW','object','userBalanceEntity','1603712YYqUTG','__esModule','__decorate','@nestjs/typeorm','27ZyjuTU','TaskService','2199488HdToKH','length','globalConfigService','design:paramtypes','design:type','4665609whvrHs','1zbyfMR','Repository','handleCron','getOwnPropertyDescriptor','design:returntype','10837144lVVJFL','forEach'];_0x1759=function(){return _0x4db150;};return _0x1759();}Object[_0x57d96b(0xd0)](exports,_0x57d96b(0xe2),{'value':!![]}),exports[_0x57d96b(0xe6)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x57d96b(0xcf)),schedule_1=require(_0x57d96b(0xdd)),userBalance_entity_1=require('../userBalance/userBalance.entity'),typeorm_1=require(_0x57d96b(0xe4)),typeorm_2=require('typeorm'),models_service_1=require(_0x57d96b(0xca));let TaskService=class TaskService{constructor(_0x459946,_0x33b27a,_0x450837){const _0x56da43=_0x57d96b;this[_0x56da43(0xe0)]=_0x459946,this[_0x56da43(0xe9)]=_0x33b27a,this['modelsService']=_0x450837;}[_0x57d96b(0xef)](){const _0x4e0ee2=_0x57d96b;common_1['Logger'][_0x4e0ee2(0xd2)]('Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token',_0x4e0ee2(0xe6)),this[_0x4e0ee2(0xe9)]['getWechatAccessToken']();}async[_0x57d96b(0xd3)](){const _0x187294=_0x57d96b,_0x18ccfb=await this[_0x187294(0xe0)]['find']({'where':{'expirationTime':(0x0,typeorm_2[_0x187294(0xcc)])(new Date())}});if(!_0x18ccfb||!_0x18ccfb[_0x187294(0xe8)])return;_0x18ccfb[_0x187294(0xc8)](_0x372404=>{const _0x33dbc6=_0x187294;this['userBalanceEntity'][_0x33dbc6(0xc9)]({'id':_0x372404['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})['then'](_0x362174=>{const _0x25ecb5=_0x33dbc6;common_1[_0x25ecb5(0xda)][_0x25ecb5(0xd2)](_0x372404['id']+_0x25ecb5(0xdb),_0x25ecb5(0xe6));});});}};__decorate([(0x0,schedule_1[_0x57d96b(0xdc)])(schedule_1['CronExpression']['EVERY_HOUR']),__metadata('design:type',Function),__metadata(_0x57d96b(0xea),[]),__metadata(_0x57d96b(0xc6),void 0x0)],TaskService['prototype'],_0x57d96b(0xef),null),__decorate([(0x0,schedule_1[_0x57d96b(0xdc)])(schedule_1['CronExpression']['EVERY_5_MINUTES']),__metadata(_0x57d96b(0xeb),Function),__metadata(_0x57d96b(0xea),[]),__metadata(_0x57d96b(0xc6),Promise)],TaskService[_0x57d96b(0xce)],_0x57d96b(0xd3),null),TaskService=__decorate([(0x0,common_1[_0x57d96b(0xcd)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1[_0x57d96b(0xd1)])),__metadata('design:paramtypes',[typeorm_2[_0x57d96b(0xee)],globalConfig_service_1['GlobalConfigService'],models_service_1[_0x57d96b(0xd8)]])],TaskService),exports[_0x57d96b(0xe6)]=TaskService;