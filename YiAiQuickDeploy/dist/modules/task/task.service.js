'use strict';const _0x2656bb=_0x1466;(function(_0x402358,_0x4544bd){const _0x5b84f7=_0x1466,_0x50e5c9=_0x402358();while(!![]){try{const _0x210bb3=-parseInt(_0x5b84f7(0x102))/0x1+-parseInt(_0x5b84f7(0xee))/0x2+parseInt(_0x5b84f7(0xe4))/0x3+-parseInt(_0x5b84f7(0xd4))/0x4+parseInt(_0x5b84f7(0xdf))/0x5+-parseInt(_0x5b84f7(0xf1))/0x6+parseInt(_0x5b84f7(0xe3))/0x7*(parseInt(_0x5b84f7(0xed))/0x8);if(_0x210bb3===_0x4544bd)break;else _0x50e5c9['push'](_0x50e5c9['shift']());}catch(_0x228d1f){_0x50e5c9['push'](_0x50e5c9['shift']());}}}(_0x51d7,0x41879));var __decorate=this&&this[_0x2656bb(0xf2)]||function(_0x53f992,_0x118515,_0x1ce05e,_0x38d4a5){const _0x2de66b=_0x2656bb;var _0x343035=arguments[_0x2de66b(0xd8)],_0x47629d=_0x343035<0x3?_0x118515:_0x38d4a5===null?_0x38d4a5=Object[_0x2de66b(0xf7)](_0x118515,_0x1ce05e):_0x38d4a5,_0x4b7e65;if(typeof Reflect===_0x2de66b(0xe0)&&typeof Reflect[_0x2de66b(0xf0)]===_0x2de66b(0xf8))_0x47629d=Reflect[_0x2de66b(0xf0)](_0x53f992,_0x118515,_0x1ce05e,_0x38d4a5);else{for(var _0x5a1027=_0x53f992[_0x2de66b(0xd8)]-0x1;_0x5a1027>=0x0;_0x5a1027--)if(_0x4b7e65=_0x53f992[_0x5a1027])_0x47629d=(_0x343035<0x3?_0x4b7e65(_0x47629d):_0x343035>0x3?_0x4b7e65(_0x118515,_0x1ce05e,_0x47629d):_0x4b7e65(_0x118515,_0x1ce05e))||_0x47629d;}return _0x343035>0x3&&_0x47629d&&Object[_0x2de66b(0xde)](_0x118515,_0x1ce05e,_0x47629d),_0x47629d;},__metadata=this&&this[_0x2656bb(0x103)]||function(_0x5d3fcd,_0x21df79){const _0x153108=_0x2656bb;if(typeof Reflect===_0x153108(0xe0)&&typeof Reflect[_0x153108(0xff)]==='function')return Reflect[_0x153108(0xff)](_0x5d3fcd,_0x21df79);},__param=this&&this[_0x2656bb(0x101)]||function(_0x267f0a,_0x5b1cc7){return function(_0x3cf602,_0x33c6e0){_0x5b1cc7(_0x3cf602,_0x33c6e0,_0x267f0a);};};function _0x1466(_0x1ecb89,_0x48db5f){const _0x51d733=_0x51d7();return _0x1466=function(_0x14662b,_0x18b96d){_0x14662b=_0x14662b-0xd3;let _0x2ba258=_0x51d733[_0x14662b];return _0x2ba258;},_0x1466(_0x1ecb89,_0x48db5f);}Object['defineProperty'](exports,_0x2656bb(0xea),{'value':!![]}),exports[_0x2656bb(0xfa)]=void 0x0;const globalConfig_service_1=require(_0x2656bb(0xe5)),common_1=require(_0x2656bb(0xeb)),schedule_1=require(_0x2656bb(0xda)),userBalance_entity_1=require(_0x2656bb(0x100)),typeorm_1=require(_0x2656bb(0xdb)),typeorm_2=require('typeorm'),models_service_1=require(_0x2656bb(0xe8));function _0x51d7(){const _0x40a56e=['Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','length','prototype','@nestjs/schedule','@nestjs/typeorm','userBalanceEntity','Logger','defineProperty','1793590aeSxQY','object','forEach','LessThanOrEqual','14IRrzUi','479382sGxOfJ','./../globalConfig/globalConfig.service','design:paramtypes','debug','../models/models.service','ModelsService','__esModule','@nestjs/common','Cron','1550072Stfnal','326100QYNiCp','globalConfigService','decorate','2468628MCuuMr','__decorate','checkUserMemerExpire','会员已到期、清空所有余额并移除会员身份！','GlobalConfigService','CronExpression','getOwnPropertyDescriptor','function','handleCron','TaskService','modelsService','design:type','Repository','then','metadata','../userBalance/userBalance.entity','__param','54979PCIVyK','__metadata','catch','EVERY_HOUR','32616MCoDSU','design:returntype','update'];_0x51d7=function(){return _0x40a56e;};return _0x51d7();}let TaskService=class TaskService{constructor(_0x42ef74,_0x3ed814,_0x51327a){const _0x5e836d=_0x2656bb;this[_0x5e836d(0xdc)]=_0x42ef74,this['globalConfigService']=_0x3ed814,this[_0x5e836d(0xfb)]=_0x51327a;}['handleCron'](){const _0x14e71c=_0x2656bb;common_1['Logger'][_0x14e71c(0xe7)](_0x14e71c(0xd7),_0x14e71c(0xfa)),this[_0x14e71c(0xef)]['getWechatAccessToken']()[_0x14e71c(0x104)](_0xc34ab7=>console['log']('定时任务异常',_0xc34ab7));}async[_0x2656bb(0xf3)](){const _0x563209=_0x2656bb,_0x2c03a9=await this[_0x563209(0xdc)]['find']({'where':{'expirationTime':(0x0,typeorm_2[_0x563209(0xe2)])(new Date())}});if(!_0x2c03a9||!_0x2c03a9['length'])return;_0x2c03a9[_0x563209(0xe1)](_0x3e357b=>{const _0xccb5f9=_0x563209;this[_0xccb5f9(0xdc)][_0xccb5f9(0xd6)]({'id':_0x3e357b['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0xccb5f9(0xfe)](_0x3c1601=>{const _0x3819d0=_0xccb5f9;common_1[_0x3819d0(0xdd)][_0x3819d0(0xe7)](_0x3e357b['id']+_0x3819d0(0xf4),'TaskService');});});}};__decorate([(0x0,schedule_1['Cron'])(schedule_1['CronExpression'][_0x2656bb(0xd3)]),__metadata(_0x2656bb(0xfc),Function),__metadata(_0x2656bb(0xe6),[]),__metadata('design:returntype',void 0x0)],TaskService[_0x2656bb(0xd9)],_0x2656bb(0xf9),null),__decorate([(0x0,schedule_1[_0x2656bb(0xec)])(schedule_1[_0x2656bb(0xf6)]['EVERY_5_MINUTES']),__metadata(_0x2656bb(0xfc),Function),__metadata(_0x2656bb(0xe6),[]),__metadata(_0x2656bb(0xd5),Promise)],TaskService[_0x2656bb(0xd9)],_0x2656bb(0xf3),null),TaskService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1['UserBalanceEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x2656bb(0xfd)],globalConfig_service_1[_0x2656bb(0xf5)],models_service_1[_0x2656bb(0xe9)]])],TaskService),exports[_0x2656bb(0xfa)]=TaskService;