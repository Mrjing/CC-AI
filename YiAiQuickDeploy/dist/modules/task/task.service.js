'use strict';function _0x3bc9(){const _0x39ef6b=['Injectable','debug','2645196XPsAWI','2756820sMdpni','typeorm','InjectRepository','userBalanceEntity','design:type','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','object','../models/models.service','__param','@nestjs/typeorm','update','@nestjs/schedule','handleCron','LessThanOrEqual','getWechatAccessToken','getOwnPropertyDescriptor','16fcbFwG','CronExpression','globalConfigService','function','__metadata','TaskService','1793840uJvKOu','1739928CaUbTx','__esModule','Repository','design:returntype','3106138HxYNRB','149471mScPfp','defineProperty','forEach','../userBalance/userBalance.entity','14HiUKWD','decorate','length','prototype','Cron','@nestjs/common','modelsService','EVERY_5_MINUTES','design:paramtypes','UserBalanceEntity','Logger','10016307cbSvEr','checkUserMemerExpire','EVERY_HOUR'];_0x3bc9=function(){return _0x39ef6b;};return _0x3bc9();}const _0x5e61bd=_0x5595;(function(_0x52a58a,_0x5f2985){const _0x4064c8=_0x5595,_0x4f32bb=_0x52a58a();while(!![]){try{const _0x26d1a9=parseInt(_0x4064c8(0xf5))/0x1*(-parseInt(_0x4064c8(0xf9))/0x2)+parseInt(_0x4064c8(0xf0))/0x3+-parseInt(_0x4064c8(0xef))/0x4+-parseInt(_0x4064c8(0x10a))/0x5+-parseInt(_0x4064c8(0x109))/0x6+parseInt(_0x4064c8(0xf4))/0x7+-parseInt(_0x4064c8(0xe9))/0x8*(-parseInt(_0x4064c8(0x104))/0x9);if(_0x26d1a9===_0x5f2985)break;else _0x4f32bb['push'](_0x4f32bb['shift']());}catch(_0x4c1a0e){_0x4f32bb['push'](_0x4f32bb['shift']());}}}(_0x3bc9,0xba2c9));function _0x5595(_0x122766,_0x25e954){const _0x3bc946=_0x3bc9();return _0x5595=function(_0x559580,_0x2a9973){_0x559580=_0x559580-0xe0;let _0x196d4d=_0x3bc946[_0x559580];return _0x196d4d;},_0x5595(_0x122766,_0x25e954);}var __decorate=this&&this['__decorate']||function(_0xae4540,_0x13b4e1,_0x4601be,_0x78f04d){const _0x44315a=_0x5595;var _0x42e5bb=arguments[_0x44315a(0xfb)],_0x318af4=_0x42e5bb<0x3?_0x13b4e1:_0x78f04d===null?_0x78f04d=Object[_0x44315a(0xe8)](_0x13b4e1,_0x4601be):_0x78f04d,_0x55b892;if(typeof Reflect===_0x44315a(0x110)&&typeof Reflect[_0x44315a(0xfa)]===_0x44315a(0xec))_0x318af4=Reflect[_0x44315a(0xfa)](_0xae4540,_0x13b4e1,_0x4601be,_0x78f04d);else{for(var _0x574edc=_0xae4540['length']-0x1;_0x574edc>=0x0;_0x574edc--)if(_0x55b892=_0xae4540[_0x574edc])_0x318af4=(_0x42e5bb<0x3?_0x55b892(_0x318af4):_0x42e5bb>0x3?_0x55b892(_0x13b4e1,_0x4601be,_0x318af4):_0x55b892(_0x13b4e1,_0x4601be))||_0x318af4;}return _0x42e5bb>0x3&&_0x318af4&&Object['defineProperty'](_0x13b4e1,_0x4601be,_0x318af4),_0x318af4;},__metadata=this&&this[_0x5e61bd(0xed)]||function(_0x475d27,_0x2e414c){const _0x281291=_0x5e61bd;if(typeof Reflect===_0x281291(0x110)&&typeof Reflect['metadata']===_0x281291(0xec))return Reflect['metadata'](_0x475d27,_0x2e414c);},__param=this&&this[_0x5e61bd(0xe1)]||function(_0x303efb,_0x1ea5a4){return function(_0x36e6b3,_0x460f9d){_0x1ea5a4(_0x36e6b3,_0x460f9d,_0x303efb);};};Object[_0x5e61bd(0xf6)](exports,_0x5e61bd(0xf1),{'value':!![]}),exports['TaskService']=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x5e61bd(0xfe)),schedule_1=require(_0x5e61bd(0xe4)),userBalance_entity_1=require(_0x5e61bd(0xf8)),typeorm_1=require(_0x5e61bd(0xe2)),typeorm_2=require(_0x5e61bd(0x10b)),models_service_1=require(_0x5e61bd(0xe0));let TaskService=class TaskService{constructor(_0x696557,_0x11494d,_0x2caf84){const _0x17ab26=_0x5e61bd;this[_0x17ab26(0x10d)]=_0x696557,this[_0x17ab26(0xeb)]=_0x11494d,this[_0x17ab26(0xff)]=_0x2caf84;}[_0x5e61bd(0xe5)](){const _0x36e523=_0x5e61bd;common_1[_0x36e523(0x103)]['debug'](_0x36e523(0x10f),_0x36e523(0xee)),this['globalConfigService'][_0x36e523(0xe7)]();}async[_0x5e61bd(0x105)](){const _0x24336b=_0x5e61bd,_0x1a2590=await this[_0x24336b(0x10d)]['find']({'where':{'expirationTime':(0x0,typeorm_2[_0x24336b(0xe6)])(new Date())}});if(!_0x1a2590||!_0x1a2590[_0x24336b(0xfb)])return;_0x1a2590[_0x24336b(0xf7)](_0x358d80=>{const _0x1f3aab=_0x24336b;this[_0x1f3aab(0x10d)][_0x1f3aab(0xe3)]({'id':_0x358d80['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})['then'](_0x4b1355=>{const _0x4bd1e7=_0x1f3aab;common_1['Logger'][_0x4bd1e7(0x108)](_0x358d80['id']+'会员已到期、清空所有余额并移除会员身份！',_0x4bd1e7(0xee));});});}};__decorate([(0x0,schedule_1[_0x5e61bd(0xfd)])(schedule_1[_0x5e61bd(0xea)][_0x5e61bd(0x106)]),__metadata(_0x5e61bd(0x10e),Function),__metadata('design:paramtypes',[]),__metadata(_0x5e61bd(0xf3),void 0x0)],TaskService[_0x5e61bd(0xfc)],'handleCron',null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x5e61bd(0xea)][_0x5e61bd(0x100)]),__metadata('design:type',Function),__metadata(_0x5e61bd(0x101),[]),__metadata(_0x5e61bd(0xf3),Promise)],TaskService[_0x5e61bd(0xfc)],_0x5e61bd(0x105),null),TaskService=__decorate([(0x0,common_1[_0x5e61bd(0x107)])(),__param(0x0,(0x0,typeorm_1[_0x5e61bd(0x10c)])(userBalance_entity_1[_0x5e61bd(0x102)])),__metadata('design:paramtypes',[typeorm_2[_0x5e61bd(0xf2)],globalConfig_service_1['GlobalConfigService'],models_service_1['ModelsService']])],TaskService),exports[_0x5e61bd(0xee)]=TaskService;