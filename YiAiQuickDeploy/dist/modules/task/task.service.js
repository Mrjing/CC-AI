'use strict';const _0x3bdf24=_0x1d48;(function(_0x1c9c74,_0xd33ca0){const _0x56b865=_0x1d48,_0x189bd7=_0x1c9c74();while(!![]){try{const _0x820610=-parseInt(_0x56b865(0x120))/0x1+-parseInt(_0x56b865(0x138))/0x2+parseInt(_0x56b865(0x13c))/0x3+-parseInt(_0x56b865(0x13b))/0x4*(parseInt(_0x56b865(0x142))/0x5)+-parseInt(_0x56b865(0x128))/0x6+parseInt(_0x56b865(0x147))/0x7+parseInt(_0x56b865(0x12e))/0x8*(parseInt(_0x56b865(0x127))/0x9);if(_0x820610===_0xd33ca0)break;else _0x189bd7['push'](_0x189bd7['shift']());}catch(_0x308789){_0x189bd7['push'](_0x189bd7['shift']());}}}(_0x4c87,0xca407));var __decorate=this&&this[_0x3bdf24(0x140)]||function(_0x2fcb4b,_0x18af82,_0x12550b,_0xe64de5){const _0x41b955=_0x3bdf24;var _0x592f4a=arguments['length'],_0x6db8a4=_0x592f4a<0x3?_0x18af82:_0xe64de5===null?_0xe64de5=Object[_0x41b955(0x135)](_0x18af82,_0x12550b):_0xe64de5,_0x5e0972;if(typeof Reflect===_0x41b955(0x13d)&&typeof Reflect[_0x41b955(0x12c)]===_0x41b955(0x144))_0x6db8a4=Reflect[_0x41b955(0x12c)](_0x2fcb4b,_0x18af82,_0x12550b,_0xe64de5);else{for(var _0x33829f=_0x2fcb4b[_0x41b955(0x137)]-0x1;_0x33829f>=0x0;_0x33829f--)if(_0x5e0972=_0x2fcb4b[_0x33829f])_0x6db8a4=(_0x592f4a<0x3?_0x5e0972(_0x6db8a4):_0x592f4a>0x3?_0x5e0972(_0x18af82,_0x12550b,_0x6db8a4):_0x5e0972(_0x18af82,_0x12550b))||_0x6db8a4;}return _0x592f4a>0x3&&_0x6db8a4&&Object[_0x41b955(0x123)](_0x18af82,_0x12550b,_0x6db8a4),_0x6db8a4;},__metadata=this&&this[_0x3bdf24(0x11d)]||function(_0x501a2d,_0xdd37f4){const _0x1cf41b=_0x3bdf24;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1cf41b(0x144))return Reflect[_0x1cf41b(0x126)](_0x501a2d,_0xdd37f4);},__param=this&&this[_0x3bdf24(0x146)]||function(_0x1723e9,_0x586c3d){return function(_0x170548,_0x42d93a){_0x586c3d(_0x170548,_0x42d93a,_0x1723e9);};};function _0x4c87(){const _0x13021d=['Repository','__param','9468025OdMdzO','Injectable','then','GlobalConfigService','__metadata','forEach','typeorm','330229QyMNsy','globalConfigService','TaskService','defineProperty','@nestjs/common','../models/models.service','metadata','83637ldNYEr','7944294enOtfA','Logger','LessThanOrEqual','prototype','decorate','find','2312oSbJZw','design:paramtypes','userBalanceEntity','modelsService','__esModule','CronExpression','Cron','getOwnPropertyDescriptor','./../globalConfig/globalConfig.service','length','2864794wasqGZ','design:returntype','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','529696gyZeRO','27810qJuHef','object','update','@nestjs/schedule','__decorate','UserBalanceEntity','5kCMtZQ','checkUserMemerExpire','function'];_0x4c87=function(){return _0x13021d;};return _0x4c87();}Object['defineProperty'](exports,_0x3bdf24(0x132),{'value':!![]}),exports['TaskService']=void 0x0;const globalConfig_service_1=require(_0x3bdf24(0x136)),common_1=require(_0x3bdf24(0x124)),schedule_1=require(_0x3bdf24(0x13f)),userBalance_entity_1=require('../userBalance/userBalance.entity'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x3bdf24(0x11f)),models_service_1=require(_0x3bdf24(0x125));function _0x1d48(_0x5f45d0,_0x2dffca){const _0x4c87ea=_0x4c87();return _0x1d48=function(_0x1d4823,_0xe30bfc){_0x1d4823=_0x1d4823-0x11a;let _0x3c577c=_0x4c87ea[_0x1d4823];return _0x3c577c;},_0x1d48(_0x5f45d0,_0x2dffca);}let TaskService=class TaskService{constructor(_0x5b6b9c,_0x56127b,_0x8644cd){const _0xfca6b5=_0x3bdf24;this['userBalanceEntity']=_0x5b6b9c,this[_0xfca6b5(0x121)]=_0x56127b,this[_0xfca6b5(0x131)]=_0x8644cd;}['handleCron'](){const _0x3d288c=_0x3bdf24;common_1[_0x3d288c(0x129)]['debug'](_0x3d288c(0x13a),'TaskService'),this[_0x3d288c(0x121)]['getWechatAccessToken']();}async['checkUserMemerExpire'](){const _0x218052=_0x3bdf24,_0x377666=await this[_0x218052(0x130)][_0x218052(0x12d)]({'where':{'expirationTime':(0x0,typeorm_2[_0x218052(0x12a)])(new Date())}});if(!_0x377666||!_0x377666[_0x218052(0x137)])return;_0x377666[_0x218052(0x11e)](_0x4fbf6d=>{const _0x38e936=_0x218052;this['userBalanceEntity'][_0x38e936(0x13e)]({'id':_0x4fbf6d['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x38e936(0x11b)](_0x317d7a=>{const _0x5beefe=_0x38e936;common_1['Logger']['debug'](_0x4fbf6d['id']+'会员已到期、清空所有余额并移除会员身份！',_0x5beefe(0x122));});});}};__decorate([(0x0,schedule_1[_0x3bdf24(0x134)])(schedule_1[_0x3bdf24(0x133)]['EVERY_HOUR']),__metadata('design:type',Function),__metadata(_0x3bdf24(0x12f),[]),__metadata('design:returntype',void 0x0)],TaskService['prototype'],'handleCron',null),__decorate([(0x0,schedule_1[_0x3bdf24(0x134)])(schedule_1[_0x3bdf24(0x133)]['EVERY_5_MINUTES']),__metadata('design:type',Function),__metadata(_0x3bdf24(0x12f),[]),__metadata(_0x3bdf24(0x139),Promise)],TaskService[_0x3bdf24(0x12b)],_0x3bdf24(0x143),null),TaskService=__decorate([(0x0,common_1[_0x3bdf24(0x11a)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1[_0x3bdf24(0x141)])),__metadata(_0x3bdf24(0x12f),[typeorm_2[_0x3bdf24(0x145)],globalConfig_service_1[_0x3bdf24(0x11c)],models_service_1['ModelsService']])],TaskService),exports['TaskService']=TaskService;