'use strict';function _0x2fb7(){const _0x2c63eb=['length','decorate','Cron','getWechatAccessToken','10rkMQRX','Logger','__metadata','object','globalConfigService','then','771100krixRk','9yqNhOH','./../globalConfig/globalConfig.service','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','prototype','design:paramtypes','@nestjs/typeorm','handleCron','TaskService','EVERY_HOUR','defineProperty','__param','checkUserMemerExpire','2380651cAHEhy','5428464fqTSpw','221912DnIyoh','Injectable','InjectRepository','modelsService','__decorate','__esModule','Repository','function','GlobalConfigService','LessThanOrEqual','@nestjs/schedule','design:returntype','../userBalance/userBalance.entity','CronExpression','2030430prrEKL','typeorm','debug','metadata','1491480DcODDs','246339aXNMEO','../models/models.service','getOwnPropertyDescriptor','userBalanceEntity','@nestjs/common','find'];_0x2fb7=function(){return _0x2c63eb;};return _0x2fb7();}const _0x474cde=_0x37b3;(function(_0x5775e5,_0xaaac36){const _0x58dbf3=_0x37b3,_0x8c20d1=_0x5775e5();while(!![]){try{const _0xe473ff=-parseInt(_0x58dbf3(0x125))/0x1+parseInt(_0x58dbf3(0x110))/0x2*(-parseInt(_0x58dbf3(0x138))/0x3)+parseInt(_0x58dbf3(0x137))/0x4+-parseInt(_0x58dbf3(0x116))/0x5+parseInt(_0x58dbf3(0x133))/0x6+-parseInt(_0x58dbf3(0x123))/0x7+-parseInt(_0x58dbf3(0x124))/0x8*(-parseInt(_0x58dbf3(0x117))/0x9);if(_0xe473ff===_0xaaac36)break;else _0x8c20d1['push'](_0x8c20d1['shift']());}catch(_0x1fbbc8){_0x8c20d1['push'](_0x8c20d1['shift']());}}}(_0x2fb7,0x40383));var __decorate=this&&this[_0x474cde(0x129)]||function(_0x249938,_0x554a3b,_0x289704,_0x15ec79){const _0x220dbe=_0x474cde;var _0x1f0d56=arguments[_0x220dbe(0x10c)],_0x5b9ade=_0x1f0d56<0x3?_0x554a3b:_0x15ec79===null?_0x15ec79=Object[_0x220dbe(0x13a)](_0x554a3b,_0x289704):_0x15ec79,_0x470e05;if(typeof Reflect===_0x220dbe(0x113)&&typeof Reflect['decorate']===_0x220dbe(0x12c))_0x5b9ade=Reflect[_0x220dbe(0x10d)](_0x249938,_0x554a3b,_0x289704,_0x15ec79);else{for(var _0x5894fc=_0x249938[_0x220dbe(0x10c)]-0x1;_0x5894fc>=0x0;_0x5894fc--)if(_0x470e05=_0x249938[_0x5894fc])_0x5b9ade=(_0x1f0d56<0x3?_0x470e05(_0x5b9ade):_0x1f0d56>0x3?_0x470e05(_0x554a3b,_0x289704,_0x5b9ade):_0x470e05(_0x554a3b,_0x289704))||_0x5b9ade;}return _0x1f0d56>0x3&&_0x5b9ade&&Object[_0x220dbe(0x120)](_0x554a3b,_0x289704,_0x5b9ade),_0x5b9ade;},__metadata=this&&this[_0x474cde(0x112)]||function(_0x38c9ae,_0x5306e7){const _0x1c3133=_0x474cde;if(typeof Reflect===_0x1c3133(0x113)&&typeof Reflect[_0x1c3133(0x136)]===_0x1c3133(0x12c))return Reflect[_0x1c3133(0x136)](_0x38c9ae,_0x5306e7);},__param=this&&this[_0x474cde(0x121)]||function(_0x36fda9,_0x2ff6b4){return function(_0x2456a4,_0x3183d1){_0x2ff6b4(_0x2456a4,_0x3183d1,_0x36fda9);};};Object[_0x474cde(0x120)](exports,_0x474cde(0x12a),{'value':!![]}),exports[_0x474cde(0x11e)]=void 0x0;const globalConfig_service_1=require(_0x474cde(0x118)),common_1=require(_0x474cde(0x13c)),schedule_1=require(_0x474cde(0x12f)),userBalance_entity_1=require(_0x474cde(0x131)),typeorm_1=require(_0x474cde(0x11c)),typeorm_2=require(_0x474cde(0x134)),models_service_1=require(_0x474cde(0x139));function _0x37b3(_0x5bd47b,_0xf99c97){const _0x2fb76c=_0x2fb7();return _0x37b3=function(_0x37b3df,_0x11b954){_0x37b3df=_0x37b3df-0x10c;let _0x425c7a=_0x2fb76c[_0x37b3df];return _0x425c7a;},_0x37b3(_0x5bd47b,_0xf99c97);}let TaskService=class TaskService{constructor(_0x50bd05,_0x559c7c,_0x2fe8a1){const _0x5bb7bf=_0x474cde;this[_0x5bb7bf(0x13b)]=_0x50bd05,this[_0x5bb7bf(0x114)]=_0x559c7c,this[_0x5bb7bf(0x128)]=_0x2fe8a1;}[_0x474cde(0x11d)](){const _0x2c6910=_0x474cde;common_1[_0x2c6910(0x111)][_0x2c6910(0x135)](_0x2c6910(0x119),'TaskService'),this[_0x2c6910(0x114)][_0x2c6910(0x10f)]();}async[_0x474cde(0x122)](){const _0x547319=_0x474cde,_0x2b8218=await this['userBalanceEntity'][_0x547319(0x13d)]({'where':{'expirationTime':(0x0,typeorm_2[_0x547319(0x12e)])(new Date())}});if(!_0x2b8218||!_0x2b8218[_0x547319(0x10c)])return;_0x2b8218['forEach'](_0x30cf72=>{const _0x10f0db=_0x547319;this[_0x10f0db(0x13b)]['update']({'id':_0x30cf72['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x10f0db(0x115)](_0x1a3487=>{const _0x500212=_0x10f0db;common_1[_0x500212(0x111)][_0x500212(0x135)](_0x30cf72['id']+'会员已到期、清空所有余额并移除会员身份！',_0x500212(0x11e));});});}};__decorate([(0x0,schedule_1[_0x474cde(0x10e)])(schedule_1[_0x474cde(0x132)][_0x474cde(0x11f)]),__metadata('design:type',Function),__metadata(_0x474cde(0x11b),[]),__metadata('design:returntype',void 0x0)],TaskService[_0x474cde(0x11a)],_0x474cde(0x11d),null),__decorate([(0x0,schedule_1[_0x474cde(0x10e)])(schedule_1[_0x474cde(0x132)]['EVERY_5_MINUTES']),__metadata('design:type',Function),__metadata(_0x474cde(0x11b),[]),__metadata(_0x474cde(0x130),Promise)],TaskService['prototype'],_0x474cde(0x122),null),TaskService=__decorate([(0x0,common_1[_0x474cde(0x126)])(),__param(0x0,(0x0,typeorm_1[_0x474cde(0x127)])(userBalance_entity_1['UserBalanceEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x474cde(0x12b)],globalConfig_service_1[_0x474cde(0x12d)],models_service_1['ModelsService']])],TaskService),exports[_0x474cde(0x11e)]=TaskService;