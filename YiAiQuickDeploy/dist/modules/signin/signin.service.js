'use strict';function _0xf374(){const _0x2cc1b5=['userEntity','2FLgACZ','YYYY-MM-DD','14xJNCwE','1084771zbLWaA','Injectable','16611507ZguyqV','signin.userId\x20=\x20:userId','用户不存在','Sign\x20in\x20successful.','endOf','saveRecordRechargeLog','../../common/constants/balance.constant','debug','InjectRepository','9412JMvJjL','BAD_REQUEST','userBalanceService','../user/user.entity','获取签到数据失败！','Logger','SigninService','isSigned','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','__esModule','typeorm','decorate','__decorate','signin','object','format','4112166sYpWyy','signInDate','10LSKTLS','error:\x20','user','length','GlobalConfigService','startOf','log','getOwnPropertyDescriptor','findOne','今日已签到、改天再来吧!.','getSignatureGiftConfig','getRawMany','defineProperty','../globalConfig/globalConfig.service','Repository','select','globalConfigService','2039211weeXpz','2870168JxkAbl','YYYY-MM-DD\x20HH:mm:ss','default','metadata','sign','find','UserBalanceService','RechargeType','@nestjs/typeorm','day','1176650jSlWHb','HttpStatus','push','signinEntity','昨天没签到、今天重置天数！','../../common/utils/date','昨天签到了、今天是连续签到！','942UTykBz','subtract','getDate','andWhere','@nestjs/common','save','update','HttpException','signin.signInTime\x20<=\x20:lastDay'];_0xf374=function(){return _0x2cc1b5;};return _0xf374();}function _0x4335(_0x5b270a,_0x237152){const _0xf37423=_0xf374();return _0x4335=function(_0x433515,_0xfa7c43){_0x433515=_0x433515-0x1a9;let _0x5df4da=_0xf37423[_0x433515];return _0x5df4da;},_0x4335(_0x5b270a,_0x237152);}const _0x507184=_0x4335;(function(_0x6309da,_0x5a3260){const _0x12d546=_0x4335,_0x4ff24d=_0x6309da();while(!![]){try{const _0x67c02c=-parseInt(_0x12d546(0x1e8))/0x1*(parseInt(_0x12d546(0x1e5))/0x2)+-parseInt(_0x12d546(0x1db))/0x3*(parseInt(_0x12d546(0x1f3))/0x4)+parseInt(_0x12d546(0x1d4))/0x5+parseInt(_0x12d546(0x1b6))/0x6*(parseInt(_0x12d546(0x1e7))/0x7)+-parseInt(_0x12d546(0x1ca))/0x8+-parseInt(_0x12d546(0x1c9))/0x9*(parseInt(_0x12d546(0x1b8))/0xa)+parseInt(_0x12d546(0x1ea))/0xb;if(_0x67c02c===_0x5a3260)break;else _0x4ff24d['push'](_0x4ff24d['shift']());}catch(_0x80cf15){_0x4ff24d['push'](_0x4ff24d['shift']());}}}(_0xf374,0xaca9a));var __decorate=this&&this[_0x507184(0x1b2)]||function(_0x11e175,_0x332aab,_0xe0d4ff,_0x39205d){const _0x479469=_0x507184;var _0x24b513=arguments[_0x479469(0x1bb)],_0x3e71e3=_0x24b513<0x3?_0x332aab:_0x39205d===null?_0x39205d=Object[_0x479469(0x1bf)](_0x332aab,_0xe0d4ff):_0x39205d,_0x388b94;if(typeof Reflect===_0x479469(0x1b4)&&typeof Reflect[_0x479469(0x1b1)]==='function')_0x3e71e3=Reflect[_0x479469(0x1b1)](_0x11e175,_0x332aab,_0xe0d4ff,_0x39205d);else{for(var _0x3f5532=_0x11e175['length']-0x1;_0x3f5532>=0x0;_0x3f5532--)if(_0x388b94=_0x11e175[_0x3f5532])_0x3e71e3=(_0x24b513<0x3?_0x388b94(_0x3e71e3):_0x24b513>0x3?_0x388b94(_0x332aab,_0xe0d4ff,_0x3e71e3):_0x388b94(_0x332aab,_0xe0d4ff))||_0x3e71e3;}return _0x24b513>0x3&&_0x3e71e3&&Object['defineProperty'](_0x332aab,_0xe0d4ff,_0x3e71e3),_0x3e71e3;},__metadata=this&&this['__metadata']||function(_0xe38c04,_0xaf82f1){const _0x2c0e94=_0x507184;if(typeof Reflect===_0x2c0e94(0x1b4)&&typeof Reflect[_0x2c0e94(0x1cd)]==='function')return Reflect[_0x2c0e94(0x1cd)](_0xe38c04,_0xaf82f1);},__param=this&&this['__param']||function(_0x22b72d,_0x44bfcb){return function(_0x570e88,_0x565f8b){_0x44bfcb(_0x570e88,_0x565f8b,_0x22b72d);};};Object[_0x507184(0x1c4)](exports,_0x507184(0x1af),{'value':!![]}),exports['SigninService']=void 0x0;const globalConfig_service_1=require(_0x507184(0x1c5)),userBalance_service_1=require('../userBalance/userBalance.service'),common_1=require(_0x507184(0x1df)),signIn_entity_1=require('./signIn.entity'),typeorm_1=require(_0x507184(0x1d2)),typeorm_2=require(_0x507184(0x1b0)),date_1=require(_0x507184(0x1d9)),user_entity_1=require(_0x507184(0x1a9)),balance_constant_1=require(_0x507184(0x1f0));let SigninService=class SigninService{constructor(_0x4e2eee,_0x1fff6e,_0x3123b1,_0x19d8cc){const _0x1485bc=_0x507184;this[_0x1485bc(0x1d7)]=_0x4e2eee,this[_0x1485bc(0x1e4)]=_0x1fff6e,this[_0x1485bc(0x1f5)]=_0x3123b1,this[_0x1485bc(0x1c8)]=_0x19d8cc;}async[_0x507184(0x1ce)](_0x58730e){const _0xee9ce9=_0x507184,{id:_0x45ce55}=_0x58730e[_0xee9ce9(0x1ba)],_0x424c40=(0x0,date_1[_0xee9ce9(0x1cc)])(new Date())[_0xee9ce9(0x1b5)](_0xee9ce9(0x1e6)),_0x2b0e5d=await this[_0xee9ce9(0x1d7)][_0xee9ce9(0x1c0)]({'where':{'userId':_0x45ce55,'signInDate':_0x424c40}});if(_0x2b0e5d)throw new common_1[(_0xee9ce9(0x1e2))](_0xee9ce9(0x1c1),common_1[_0xee9ce9(0x1d5)][_0xee9ce9(0x1f4)]);const {model3Count:_0x2f27e6,model4Count:_0xe09b2,drawMjCount:_0x37dfd4}=await this[_0xee9ce9(0x1c8)][_0xee9ce9(0x1c2)]();await this['signinEntity'][_0xee9ce9(0x1e0)]({'userId':_0x45ce55,'signInTime':new Date(),'signInDate':_0x424c40,'isSigned':!![]}),await this['userBalanceService']['addBalanceToUser'](_0x45ce55,{'model3Count':_0x2f27e6,'model4Count':_0xe09b2,'drawMjCount':_0x37dfd4}),await this[_0xee9ce9(0x1f5)][_0xee9ce9(0x1ef)]({'userId':_0x45ce55,'rechargeType':balance_constant_1[_0xee9ce9(0x1d1)]['SIGN_IN'],'model3Count':_0x2f27e6,'model4Count':_0xe09b2,'drawMjCount':_0x37dfd4});const _0x9053a2=(0x0,date_1[_0xee9ce9(0x1cc)])(new Date())[_0xee9ce9(0x1dc)](0x1,_0xee9ce9(0x1d3))[_0xee9ce9(0x1b5)](_0xee9ce9(0x1e6)),_0x1c88e9=await this['signinEntity']['findOne']({'where':{'userId':_0x45ce55,'signInDate':_0x9053a2}});if(_0x1c88e9){common_1['Logger']['debug']('用户'+_0x45ce55+_0xee9ce9(0x1da),_0xee9ce9(0x1ac));const _0x4f5292=await this['userEntity'][_0xee9ce9(0x1c0)]({'where':{'id':_0x45ce55}});if(!_0x4f5292)throw new common_1[(_0xee9ce9(0x1e2))](_0xee9ce9(0x1ec),common_1[_0xee9ce9(0x1d5)][_0xee9ce9(0x1f4)]);const {consecutiveDays:consecutiveDays=0x0}=_0x4f5292;await this[_0xee9ce9(0x1e4)]['update']({'id':_0x45ce55},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0xee9ce9(0x1ab)][_0xee9ce9(0x1f1)]('用户'+_0x45ce55+_0xee9ce9(0x1d8),_0xee9ce9(0x1ac)),await this[_0xee9ce9(0x1e4)][_0xee9ce9(0x1e1)]({'id':_0x45ce55},{'consecutiveDays':0x1});return _0xee9ce9(0x1ed);}async['getSigninLog'](_0x71ea1f){const _0x2ac92b=_0x507184;try{const {id:_0x3e9731}=_0x71ea1f[_0x2ac92b(0x1ba)],_0x2378ff=(0x0,date_1[_0x2ac92b(0x1cc)])()[_0x2ac92b(0x1bd)]('month')[_0x2ac92b(0x1b5)](_0x2ac92b(0x1cb)),_0xf19b7f=(0x0,date_1[_0x2ac92b(0x1cc)])()[_0x2ac92b(0x1ee)]('month')[_0x2ac92b(0x1b5)](_0x2ac92b(0x1cb)),_0x5eeb5e=this['signinEntity']['createQueryBuilder'](_0x2ac92b(0x1b3)),_0x1a0598=await _0x5eeb5e[_0x2ac92b(0x1c7)](_0x2ac92b(0x1ae))[_0x2ac92b(0x1de)](_0x2ac92b(0x1eb),{'userId':_0x71ea1f[_0x2ac92b(0x1ba)]['id']})[_0x2ac92b(0x1de)]('signin.signInTime\x20>=\x20:firstDay',{'firstDay':_0x2378ff})['andWhere'](_0x2ac92b(0x1e3),{'lastDay':_0xf19b7f})[_0x2ac92b(0x1c3)](),_0x31869b=new Date(_0x2378ff),_0xcc6ea7=new Date(_0xf19b7f),_0x3fa04e=[],_0x557a50=new Date(_0x31869b);while(_0x557a50<=_0xcc6ea7){_0x3fa04e['push']((0x0,date_1[_0x2ac92b(0x1cc)])(new Date(_0x557a50))[_0x2ac92b(0x1b5)](_0x2ac92b(0x1e6))),_0x557a50['setDate'](_0x557a50[_0x2ac92b(0x1dd)]()+0x1);}const _0x1c22cf=[];for(const _0x2cedac of _0x3fa04e){const _0x2fb8ae=_0x1a0598[_0x2ac92b(0x1cf)](_0x36bd48=>_0x36bd48[_0x2ac92b(0x1b7)]===_0x2cedac);!_0x2fb8ae?_0x1c22cf[_0x2ac92b(0x1d6)]({'signInDate':_0x2cedac,'isSigned':![]}):(_0x2fb8ae[_0x2ac92b(0x1ad)]=!![],_0x1c22cf[_0x2ac92b(0x1d6)](_0x2fb8ae));}return _0x1c22cf;}catch(_0x2667c5){console[_0x2ac92b(0x1be)](_0x2ac92b(0x1b9),_0x2667c5);throw new common_1[(_0x2ac92b(0x1e2))](_0x2ac92b(0x1aa),common_1[_0x2ac92b(0x1d5)][_0x2ac92b(0x1f4)]);}}};SigninService=__decorate([(0x0,common_1[_0x507184(0x1e9)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1['SigninEntity'])),__param(0x1,(0x0,typeorm_1[_0x507184(0x1f2)])(user_entity_1['UserEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x507184(0x1c6)],typeorm_2['Repository'],userBalance_service_1[_0x507184(0x1d0)],globalConfig_service_1[_0x507184(0x1bc)]])],SigninService),exports[_0x507184(0x1ac)]=SigninService;