'use strict';const _0x5e1529=_0x228a;function _0x228a(_0x27e101,_0x2ece0a){const _0xb34ddb=_0xb34d();return _0x228a=function(_0x228ada,_0x25cbb2){_0x228ada=_0x228ada-0x113;let _0x4fa4d6=_0xb34ddb[_0x228ada];return _0x4fa4d6;},_0x228a(_0x27e101,_0x2ece0a);}(function(_0x24d66d,_0x2bb860){const _0x2d5507=_0x228a,_0x383d25=_0x24d66d();while(!![]){try{const _0x410f0e=-parseInt(_0x2d5507(0x116))/0x1*(-parseInt(_0x2d5507(0x156))/0x2)+-parseInt(_0x2d5507(0x11e))/0x3*(parseInt(_0x2d5507(0x147))/0x4)+parseInt(_0x2d5507(0x15a))/0x5*(-parseInt(_0x2d5507(0x120))/0x6)+-parseInt(_0x2d5507(0x11f))/0x7+parseInt(_0x2d5507(0x146))/0x8*(parseInt(_0x2d5507(0x12e))/0x9)+parseInt(_0x2d5507(0x14d))/0xa*(parseInt(_0x2d5507(0x124))/0xb)+parseInt(_0x2d5507(0x114))/0xc;if(_0x410f0e===_0x2bb860)break;else _0x383d25['push'](_0x383d25['shift']());}catch(_0x5b4126){_0x383d25['push'](_0x383d25['shift']());}}}(_0xb34d,0x50f8e));var __decorate=this&&this[_0x5e1529(0x15f)]||function(_0x5b5e8e,_0xc799ff,_0x3bde0f,_0x9809a){const _0x5ea325=_0x5e1529;var _0x3116a7=arguments[_0x5ea325(0x14a)],_0x16da63=_0x3116a7<0x3?_0xc799ff:_0x9809a===null?_0x9809a=Object[_0x5ea325(0x11c)](_0xc799ff,_0x3bde0f):_0x9809a,_0x4010a7;if(typeof Reflect==='object'&&typeof Reflect[_0x5ea325(0x138)]===_0x5ea325(0x163))_0x16da63=Reflect[_0x5ea325(0x138)](_0x5b5e8e,_0xc799ff,_0x3bde0f,_0x9809a);else{for(var _0x287793=_0x5b5e8e[_0x5ea325(0x14a)]-0x1;_0x287793>=0x0;_0x287793--)if(_0x4010a7=_0x5b5e8e[_0x287793])_0x16da63=(_0x3116a7<0x3?_0x4010a7(_0x16da63):_0x3116a7>0x3?_0x4010a7(_0xc799ff,_0x3bde0f,_0x16da63):_0x4010a7(_0xc799ff,_0x3bde0f))||_0x16da63;}return _0x3116a7>0x3&&_0x16da63&&Object[_0x5ea325(0x139)](_0xc799ff,_0x3bde0f,_0x16da63),_0x16da63;},__metadata=this&&this[_0x5e1529(0x153)]||function(_0xe7feec,_0x5a9096){const _0xb91e13=_0x5e1529;if(typeof Reflect===_0xb91e13(0x12d)&&typeof Reflect[_0xb91e13(0x11a)]==='function')return Reflect['metadata'](_0xe7feec,_0x5a9096);},__param=this&&this[_0x5e1529(0x151)]||function(_0x33db9b,_0x6861f1){return function(_0x2cd1fe,_0x36baaf){_0x6861f1(_0x2cd1fe,_0x36baaf,_0x33db9b);};};function _0xb34d(){const _0x198104=['decorate','defineProperty','SigninService','subtract','YYYY-MM-DD\x20HH:mm:ss','Repository','../userBalance/userBalance.service','update','获取签到数据失败！','SigninEntity','../user/user.entity','昨天没签到、今天重置天数！','log','findOne','404976gdHnBE','2380756FubvWY','BAD_REQUEST','HttpStatus','length','month','GlobalConfigService','1276620MIbbTF','./signIn.entity','day','signin.signInTime\x20<=\x20:lastDay','__param','@nestjs/common','__metadata','今日已签到、改天再来吧!.','getSigninLog','18840oZLqjk','error:\x20','save','format','5jhMYVN','default','select','debug','UserEntity','__decorate','getDate','startOf','signInDate','function','signinEntity','push','__esModule','user','9621336tyeLDO','InjectRepository','57CMSVcF','userEntity','YYYY-MM-DD','signin.signInTime\x20>=\x20:firstDay','metadata','UserBalanceService','getOwnPropertyDescriptor','用户不存在','3cgmaNj','1582175VqzPhF','2488488LdXTkK','昨天签到了、今天是连续签到！','addBalanceToUser','../../common/utils/date','11gmeRIU','getRawMany','Sign\x20in\x20successful.','../globalConfig/globalConfig.service','design:paramtypes','../../common/constants/balance.constant','globalConfigService','saveRecordRechargeLog','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','object','18lMobjv','HttpException','Logger','signin','SIGN_IN','andWhere','signin.userId\x20=\x20:userId','createQueryBuilder','find','setDate'];_0xb34d=function(){return _0x198104;};return _0xb34d();}Object[_0x5e1529(0x139)](exports,_0x5e1529(0x166),{'value':!![]}),exports[_0x5e1529(0x13a)]=void 0x0;const globalConfig_service_1=require(_0x5e1529(0x127)),userBalance_service_1=require(_0x5e1529(0x13e)),common_1=require(_0x5e1529(0x152)),signIn_entity_1=require(_0x5e1529(0x14e)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),date_1=require(_0x5e1529(0x123)),user_entity_1=require(_0x5e1529(0x142)),balance_constant_1=require(_0x5e1529(0x129));let SigninService=class SigninService{constructor(_0x2f37b9,_0x395117,_0x2a1544,_0x2c93ed){const _0x46a8b7=_0x5e1529;this['signinEntity']=_0x2f37b9,this[_0x46a8b7(0x117)]=_0x395117,this['userBalanceService']=_0x2a1544,this['globalConfigService']=_0x2c93ed;}async['sign'](_0x239e5e){const _0x20f0df=_0x5e1529,{id:_0x284b46}=_0x239e5e[_0x20f0df(0x113)],_0x46c3ed=(0x0,date_1[_0x20f0df(0x15b)])(new Date())[_0x20f0df(0x159)](_0x20f0df(0x118)),_0x123693=await this[_0x20f0df(0x164)][_0x20f0df(0x145)]({'where':{'userId':_0x284b46,'signInDate':_0x46c3ed}});if(_0x123693)throw new common_1[(_0x20f0df(0x12f))](_0x20f0df(0x154),common_1[_0x20f0df(0x149)][_0x20f0df(0x148)]);const {model3Count:_0x4d4b20,model4Count:_0x288fda,drawMjCount:_0x48cf7d}=await this[_0x20f0df(0x12a)]['getSignatureGiftConfig']();await this[_0x20f0df(0x164)][_0x20f0df(0x158)]({'userId':_0x284b46,'signInTime':new Date(),'signInDate':_0x46c3ed,'isSigned':!![]}),await this['userBalanceService'][_0x20f0df(0x122)](_0x284b46,{'model3Count':_0x4d4b20,'model4Count':_0x288fda,'drawMjCount':_0x48cf7d}),await this['userBalanceService'][_0x20f0df(0x12b)]({'userId':_0x284b46,'rechargeType':balance_constant_1['RechargeType'][_0x20f0df(0x132)],'model3Count':_0x4d4b20,'model4Count':_0x288fda,'drawMjCount':_0x48cf7d});const _0x2ab50b=(0x0,date_1[_0x20f0df(0x15b)])(new Date())[_0x20f0df(0x13b)](0x1,_0x20f0df(0x14f))[_0x20f0df(0x159)]('YYYY-MM-DD'),_0x4ed5d8=await this[_0x20f0df(0x164)][_0x20f0df(0x145)]({'where':{'userId':_0x284b46,'signInDate':_0x2ab50b}});if(_0x4ed5d8){common_1[_0x20f0df(0x130)][_0x20f0df(0x15d)]('用户'+_0x284b46+_0x20f0df(0x121),_0x20f0df(0x13a));const _0x4b60ad=await this[_0x20f0df(0x117)]['findOne']({'where':{'id':_0x284b46}});if(!_0x4b60ad)throw new common_1[(_0x20f0df(0x12f))](_0x20f0df(0x11d),common_1[_0x20f0df(0x149)]['BAD_REQUEST']);const {consecutiveDays:consecutiveDays=0x0}=_0x4b60ad;await this[_0x20f0df(0x117)][_0x20f0df(0x13f)]({'id':_0x284b46},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x20f0df(0x130)][_0x20f0df(0x15d)]('用户'+_0x284b46+_0x20f0df(0x143),'SigninService'),await this[_0x20f0df(0x117)][_0x20f0df(0x13f)]({'id':_0x284b46},{'consecutiveDays':0x1});return _0x20f0df(0x126);}async[_0x5e1529(0x155)](_0x185e7d){const _0xa8323f=_0x5e1529;try{const {id:_0x9a58bb}=_0x185e7d[_0xa8323f(0x113)],_0x293af9=(0x0,date_1[_0xa8323f(0x15b)])()[_0xa8323f(0x161)]('month')[_0xa8323f(0x159)]('YYYY-MM-DD\x20HH:mm:ss'),_0x3c3deb=(0x0,date_1['default'])()['endOf'](_0xa8323f(0x14b))[_0xa8323f(0x159)](_0xa8323f(0x13c)),_0xb0aede=this[_0xa8323f(0x164)][_0xa8323f(0x135)](_0xa8323f(0x131)),_0x57e478=await _0xb0aede[_0xa8323f(0x15c)](_0xa8323f(0x12c))[_0xa8323f(0x133)](_0xa8323f(0x134),{'userId':_0x185e7d['user']['id']})['andWhere'](_0xa8323f(0x119),{'firstDay':_0x293af9})[_0xa8323f(0x133)](_0xa8323f(0x150),{'lastDay':_0x3c3deb})[_0xa8323f(0x125)](),_0x530ca5=new Date(_0x293af9),_0x15d396=new Date(_0x3c3deb),_0x3bcba1=[],_0x1f28bf=new Date(_0x530ca5);while(_0x1f28bf<=_0x15d396){_0x3bcba1[_0xa8323f(0x165)]((0x0,date_1[_0xa8323f(0x15b)])(new Date(_0x1f28bf))[_0xa8323f(0x159)](_0xa8323f(0x118))),_0x1f28bf[_0xa8323f(0x137)](_0x1f28bf[_0xa8323f(0x160)]()+0x1);}const _0x5146f7=[];for(const _0xb58eac of _0x3bcba1){const _0x2a6891=_0x57e478[_0xa8323f(0x136)](_0x53cf57=>_0x53cf57[_0xa8323f(0x162)]===_0xb58eac);!_0x2a6891?_0x5146f7[_0xa8323f(0x165)]({'signInDate':_0xb58eac,'isSigned':![]}):(_0x2a6891['isSigned']=!![],_0x5146f7[_0xa8323f(0x165)](_0x2a6891));}return _0x5146f7;}catch(_0x4f5eb8){console[_0xa8323f(0x144)](_0xa8323f(0x157),_0x4f5eb8);throw new common_1['HttpException'](_0xa8323f(0x140),common_1[_0xa8323f(0x149)][_0xa8323f(0x148)]);}}};SigninService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x5e1529(0x115)])(signIn_entity_1[_0x5e1529(0x141)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x5e1529(0x15e)])),__metadata(_0x5e1529(0x128),[typeorm_2[_0x5e1529(0x13d)],typeorm_2[_0x5e1529(0x13d)],userBalance_service_1[_0x5e1529(0x11b)],globalConfig_service_1[_0x5e1529(0x14c)]])],SigninService),exports[_0x5e1529(0x13a)]=SigninService;