'use strict';const _0x230ae4=_0x355e;(function(_0x451252,_0x3e401f){const _0x4fd972=_0x355e,_0x3feda2=_0x451252();while(!![]){try{const _0x424fe9=-parseInt(_0x4fd972(0x231))/0x1+-parseInt(_0x4fd972(0x22b))/0x2*(-parseInt(_0x4fd972(0x1f0))/0x3)+-parseInt(_0x4fd972(0x21a))/0x4*(-parseInt(_0x4fd972(0x212))/0x5)+-parseInt(_0x4fd972(0x1e8))/0x6+-parseInt(_0x4fd972(0x1fa))/0x7+-parseInt(_0x4fd972(0x213))/0x8+parseInt(_0x4fd972(0x1eb))/0x9*(parseInt(_0x4fd972(0x21e))/0xa);if(_0x424fe9===_0x3e401f)break;else _0x3feda2['push'](_0x3feda2['shift']());}catch(_0x39e290){_0x3feda2['push'](_0x3feda2['shift']());}}}(_0x1569,0x58698));function _0x1569(){const _0x4607c9=['BAD_REQUEST','metadata','@nestjs/typeorm','Repository','function','getDate','select','SigninService','globalConfigService','error:\x20','65VPpHAX','2943528QWpfHJ','./signIn.entity','HttpStatus','push','object','save','userEntity','21852fFOgBj','subtract','debug','typeorm','10PVIOIO','signin.signInTime\x20<=\x20:lastDay','createQueryBuilder','user','getSigninLog','sign','GlobalConfigService','HttpException','startOf','andWhere','获取签到数据失败！','昨天没签到、今天重置天数！','__param','243214kDCPWe','signinEntity','../globalConfig/globalConfig.service','用户不存在','design:paramtypes','getOwnPropertyDescriptor','696107MGcHvB','UserBalanceService','SIGN_IN','getRawMany','update','昨天签到了、今天是连续签到！','3294582RtGeVV','format','day','17420310eWwrIw','../../common/constants/balance.constant','findOne','Sign\x20in\x20successful.','InjectRepository','15xdEelf','@nestjs/common','YYYY-MM-DD\x20HH:mm:ss','今日已签到、改天再来吧!.','../user/user.entity','userBalanceService','SigninEntity','Logger','__metadata','__decorate','4475541UKdNuh','Injectable','decorate','YYYY-MM-DD','signin.userId\x20=\x20:userId','month','RechargeType','UserEntity','length','__esModule','endOf','default','defineProperty','signin'];_0x1569=function(){return _0x4607c9;};return _0x1569();}var __decorate=this&&this[_0x230ae4(0x1f9)]||function(_0x3eca89,_0x53015c,_0x4919b0,_0x1b3cad){const _0x15f19e=_0x230ae4;var _0x1e309f=arguments[_0x15f19e(0x202)],_0xbfe160=_0x1e309f<0x3?_0x53015c:_0x1b3cad===null?_0x1b3cad=Object[_0x15f19e(0x230)](_0x53015c,_0x4919b0):_0x1b3cad,_0x218b64;if(typeof Reflect===_0x15f19e(0x217)&&typeof Reflect[_0x15f19e(0x1fc)]===_0x15f19e(0x20c))_0xbfe160=Reflect[_0x15f19e(0x1fc)](_0x3eca89,_0x53015c,_0x4919b0,_0x1b3cad);else{for(var _0x2c6f70=_0x3eca89['length']-0x1;_0x2c6f70>=0x0;_0x2c6f70--)if(_0x218b64=_0x3eca89[_0x2c6f70])_0xbfe160=(_0x1e309f<0x3?_0x218b64(_0xbfe160):_0x1e309f>0x3?_0x218b64(_0x53015c,_0x4919b0,_0xbfe160):_0x218b64(_0x53015c,_0x4919b0))||_0xbfe160;}return _0x1e309f>0x3&&_0xbfe160&&Object[_0x15f19e(0x206)](_0x53015c,_0x4919b0,_0xbfe160),_0xbfe160;},__metadata=this&&this[_0x230ae4(0x1f8)]||function(_0x5e087b,_0x36e08a){const _0x1b5633=_0x230ae4;if(typeof Reflect==='object'&&typeof Reflect[_0x1b5633(0x209)]===_0x1b5633(0x20c))return Reflect[_0x1b5633(0x209)](_0x5e087b,_0x36e08a);},__param=this&&this[_0x230ae4(0x22a)]||function(_0x4d9c05,_0x539430){return function(_0x104087,_0xc59408){_0x539430(_0x104087,_0xc59408,_0x4d9c05);};};Object[_0x230ae4(0x206)](exports,_0x230ae4(0x203),{'value':!![]}),exports['SigninService']=void 0x0;const globalConfig_service_1=require(_0x230ae4(0x22d)),userBalance_service_1=require('../userBalance/userBalance.service'),common_1=require(_0x230ae4(0x1f1)),signIn_entity_1=require(_0x230ae4(0x214)),typeorm_1=require(_0x230ae4(0x20a)),typeorm_2=require(_0x230ae4(0x21d)),date_1=require('../../common/utils/date'),user_entity_1=require(_0x230ae4(0x1f4)),balance_constant_1=require(_0x230ae4(0x1ec));function _0x355e(_0xdb6665,_0x3738d4){const _0x156995=_0x1569();return _0x355e=function(_0x355e15,_0x28c809){_0x355e15=_0x355e15-0x1e3;let _0x3229f0=_0x156995[_0x355e15];return _0x3229f0;},_0x355e(_0xdb6665,_0x3738d4);}let SigninService=class SigninService{constructor(_0x259457,_0x569447,_0x5d9ddb,_0x2b8cc2){const _0x50c7be=_0x230ae4;this[_0x50c7be(0x22c)]=_0x259457,this[_0x50c7be(0x219)]=_0x569447,this[_0x50c7be(0x1f5)]=_0x5d9ddb,this['globalConfigService']=_0x2b8cc2;}async[_0x230ae4(0x223)](_0x26ff47){const _0x239deb=_0x230ae4,{id:_0x542930}=_0x26ff47[_0x239deb(0x221)],_0x3defda=(0x0,date_1[_0x239deb(0x205)])(new Date())[_0x239deb(0x1e9)]('YYYY-MM-DD'),_0x56f30c=await this['signinEntity']['findOne']({'where':{'userId':_0x542930,'signInDate':_0x3defda}});if(_0x56f30c)throw new common_1[(_0x239deb(0x225))](_0x239deb(0x1f3),common_1['HttpStatus'][_0x239deb(0x208)]);const {model3Count:_0x179e75,model4Count:_0x39e069,drawMjCount:_0x85b149}=await this[_0x239deb(0x210)]['getSignatureGiftConfig']();await this[_0x239deb(0x22c)][_0x239deb(0x218)]({'userId':_0x542930,'signInTime':new Date(),'signInDate':_0x3defda,'isSigned':!![]}),await this[_0x239deb(0x1f5)]['addBalanceToUser'](_0x542930,{'model3Count':_0x179e75,'model4Count':_0x39e069,'drawMjCount':_0x85b149}),await this[_0x239deb(0x1f5)]['saveRecordRechargeLog']({'userId':_0x542930,'rechargeType':balance_constant_1[_0x239deb(0x200)][_0x239deb(0x1e4)],'model3Count':_0x179e75,'model4Count':_0x39e069,'drawMjCount':_0x85b149});const _0x448d1d=(0x0,date_1['default'])(new Date())[_0x239deb(0x21b)](0x1,_0x239deb(0x1ea))[_0x239deb(0x1e9)](_0x239deb(0x1fd)),_0x57594a=await this[_0x239deb(0x22c)][_0x239deb(0x1ed)]({'where':{'userId':_0x542930,'signInDate':_0x448d1d}});if(_0x57594a){common_1[_0x239deb(0x1f7)][_0x239deb(0x21c)]('用户'+_0x542930+_0x239deb(0x1e7),_0x239deb(0x20f));const _0x4c4e72=await this['userEntity'][_0x239deb(0x1ed)]({'where':{'id':_0x542930}});if(!_0x4c4e72)throw new common_1[(_0x239deb(0x225))](_0x239deb(0x22e),common_1[_0x239deb(0x215)][_0x239deb(0x208)]);const {consecutiveDays:consecutiveDays=0x0}=_0x4c4e72;await this[_0x239deb(0x219)][_0x239deb(0x1e6)]({'id':_0x542930},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x239deb(0x1f7)][_0x239deb(0x21c)]('用户'+_0x542930+_0x239deb(0x229),_0x239deb(0x20f)),await this[_0x239deb(0x219)][_0x239deb(0x1e6)]({'id':_0x542930},{'consecutiveDays':0x1});return _0x239deb(0x1ee);}async[_0x230ae4(0x222)](_0x210a48){const _0x32274c=_0x230ae4;try{const {id:_0x4d5bf0}=_0x210a48[_0x32274c(0x221)],_0x3cc9b1=(0x0,date_1[_0x32274c(0x205)])()[_0x32274c(0x226)](_0x32274c(0x1ff))[_0x32274c(0x1e9)](_0x32274c(0x1f2)),_0x3d0d08=(0x0,date_1[_0x32274c(0x205)])()[_0x32274c(0x204)](_0x32274c(0x1ff))[_0x32274c(0x1e9)](_0x32274c(0x1f2)),_0x536dab=this[_0x32274c(0x22c)][_0x32274c(0x220)](_0x32274c(0x207)),_0x17a1ac=await _0x536dab[_0x32274c(0x20e)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0x32274c(0x227)](_0x32274c(0x1fe),{'userId':_0x210a48[_0x32274c(0x221)]['id']})[_0x32274c(0x227)]('signin.signInTime\x20>=\x20:firstDay',{'firstDay':_0x3cc9b1})[_0x32274c(0x227)](_0x32274c(0x21f),{'lastDay':_0x3d0d08})[_0x32274c(0x1e5)](),_0x44cfd8=new Date(_0x3cc9b1),_0x54b846=new Date(_0x3d0d08),_0x469562=[],_0x3747a0=new Date(_0x44cfd8);while(_0x3747a0<=_0x54b846){_0x469562[_0x32274c(0x216)]((0x0,date_1['default'])(new Date(_0x3747a0))[_0x32274c(0x1e9)](_0x32274c(0x1fd))),_0x3747a0['setDate'](_0x3747a0[_0x32274c(0x20d)]()+0x1);}const _0x9ae4e=[];for(const _0x1faa5a of _0x469562){const _0x39b50a=_0x17a1ac['find'](_0x4dcda3=>_0x4dcda3['signInDate']===_0x1faa5a);!_0x39b50a?_0x9ae4e[_0x32274c(0x216)]({'signInDate':_0x1faa5a,'isSigned':![]}):(_0x39b50a['isSigned']=!![],_0x9ae4e[_0x32274c(0x216)](_0x39b50a));}return _0x9ae4e;}catch(_0x48383d){console['log'](_0x32274c(0x211),_0x48383d);throw new common_1['HttpException'](_0x32274c(0x228),common_1['HttpStatus'][_0x32274c(0x208)]);}}};SigninService=__decorate([(0x0,common_1[_0x230ae4(0x1fb)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1[_0x230ae4(0x1f6)])),__param(0x1,(0x0,typeorm_1[_0x230ae4(0x1ef)])(user_entity_1[_0x230ae4(0x201)])),__metadata(_0x230ae4(0x22f),[typeorm_2['Repository'],typeorm_2[_0x230ae4(0x20b)],userBalance_service_1[_0x230ae4(0x1e3)],globalConfig_service_1[_0x230ae4(0x224)]])],SigninService),exports[_0x230ae4(0x20f)]=SigninService;