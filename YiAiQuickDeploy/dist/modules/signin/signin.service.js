'use strict';const _0x513648=_0x4150;(function(_0x2176b7,_0x279217){const _0x3343a6=_0x4150,_0x755fa1=_0x2176b7();while(!![]){try{const _0x44faf5=parseInt(_0x3343a6(0x1f9))/0x1*(parseInt(_0x3343a6(0x213))/0x2)+-parseInt(_0x3343a6(0x1ff))/0x3+-parseInt(_0x3343a6(0x203))/0x4+parseInt(_0x3343a6(0x216))/0x5*(parseInt(_0x3343a6(0x206))/0x6)+-parseInt(_0x3343a6(0x212))/0x7*(-parseInt(_0x3343a6(0x221))/0x8)+-parseInt(_0x3343a6(0x1e5))/0x9*(parseInt(_0x3343a6(0x20a))/0xa)+-parseInt(_0x3343a6(0x20d))/0xb*(-parseInt(_0x3343a6(0x1e6))/0xc);if(_0x44faf5===_0x279217)break;else _0x755fa1['push'](_0x755fa1['shift']());}catch(_0x303d63){_0x755fa1['push'](_0x755fa1['shift']());}}}(_0x2705,0xa6b44));function _0x2705(){const _0x2cff33=['findOne','Repository','length','877880wsOrGi','userBalanceService','sign','__decorate','YYYY-MM-DD\x20HH:mm:ss','../../common/utils/date','metadata','function','month','setDate','获取签到数据失败！','昨天没签到、今天重置天数！','@nestjs/common','save','UserBalanceService','push','Injectable','getOwnPropertyDescriptor','getRawMany','RechargeType','object','9dPWwEz','24NXNfGQ','SIGN_IN','../user/user.entity','./signIn.entity','__param','andWhere','format','__metadata','getSigninLog','../globalConfig/globalConfig.service','debug','user','subtract','HttpStatus','@nestjs/typeorm','SigninService','error:\x20','InjectRepository','signinEntity','213837xoggrx','saveRecordRechargeLog','UserEntity','getDate','addBalanceToUser','../userBalance/userBalance.service','2878284bigwkW','startOf','endOf','YYYY-MM-DD','4826448wLEwxw','HttpException','decorate','6wtvOxv','default','getSignatureGiftConfig','typeorm','13548630wzfDpd','userEntity','Logger','18567494ZxSEqe','../../common/constants/balance.constant','SigninEntity','Sign\x20in\x20successful.','今日已签到、改天再来吧!.','7CcGlqp','6PWaAGX','__esModule','design:paramtypes','382845TjLxbL','globalConfigService','update','select','isSigned','log','defineProperty','BAD_REQUEST'];_0x2705=function(){return _0x2cff33;};return _0x2705();}var __decorate=this&&this[_0x513648(0x224)]||function(_0x36e2c4,_0x5ae99f,_0x49f033,_0x359441){const _0x33fd07=_0x513648;var _0xd7032=arguments[_0x33fd07(0x220)],_0x3f2d5f=_0xd7032<0x3?_0x5ae99f:_0x359441===null?_0x359441=Object[_0x33fd07(0x1e1)](_0x5ae99f,_0x49f033):_0x359441,_0x2446df;if(typeof Reflect===_0x33fd07(0x1e4)&&typeof Reflect[_0x33fd07(0x205)]===_0x33fd07(0x228))_0x3f2d5f=Reflect[_0x33fd07(0x205)](_0x36e2c4,_0x5ae99f,_0x49f033,_0x359441);else{for(var _0x1eaf6d=_0x36e2c4['length']-0x1;_0x1eaf6d>=0x0;_0x1eaf6d--)if(_0x2446df=_0x36e2c4[_0x1eaf6d])_0x3f2d5f=(_0xd7032<0x3?_0x2446df(_0x3f2d5f):_0xd7032>0x3?_0x2446df(_0x5ae99f,_0x49f033,_0x3f2d5f):_0x2446df(_0x5ae99f,_0x49f033))||_0x3f2d5f;}return _0xd7032>0x3&&_0x3f2d5f&&Object[_0x33fd07(0x21c)](_0x5ae99f,_0x49f033,_0x3f2d5f),_0x3f2d5f;},__metadata=this&&this[_0x513648(0x1ed)]||function(_0x9184c0,_0x348fa9){const _0x46f995=_0x513648;if(typeof Reflect===_0x46f995(0x1e4)&&typeof Reflect[_0x46f995(0x227)]===_0x46f995(0x228))return Reflect[_0x46f995(0x227)](_0x9184c0,_0x348fa9);},__param=this&&this[_0x513648(0x1ea)]||function(_0x1e4db7,_0x5935e9){return function(_0x5365b2,_0x20646f){_0x5935e9(_0x5365b2,_0x20646f,_0x1e4db7);};};Object[_0x513648(0x21c)](exports,_0x513648(0x214),{'value':!![]}),exports[_0x513648(0x1f5)]=void 0x0;const globalConfig_service_1=require(_0x513648(0x1ef)),userBalance_service_1=require(_0x513648(0x1fe)),common_1=require(_0x513648(0x22d)),signIn_entity_1=require(_0x513648(0x1e9)),typeorm_1=require(_0x513648(0x1f4)),typeorm_2=require(_0x513648(0x209)),date_1=require(_0x513648(0x226)),user_entity_1=require(_0x513648(0x1e8)),balance_constant_1=require(_0x513648(0x20e));let SigninService=class SigninService{constructor(_0x163a3e,_0x281ca0,_0x639ba2,_0x2408b1){const _0x188463=_0x513648;this['signinEntity']=_0x163a3e,this['userEntity']=_0x281ca0,this[_0x188463(0x222)]=_0x639ba2,this[_0x188463(0x217)]=_0x2408b1;}async[_0x513648(0x223)](_0x5d053e){const _0x27aa23=_0x513648,{id:_0x3c3996}=_0x5d053e[_0x27aa23(0x1f1)],_0x121d28=(0x0,date_1[_0x27aa23(0x207)])(new Date())[_0x27aa23(0x1ec)](_0x27aa23(0x202)),_0x37bcc3=await this[_0x27aa23(0x1f8)][_0x27aa23(0x21e)]({'where':{'userId':_0x3c3996,'signInDate':_0x121d28}});if(_0x37bcc3)throw new common_1['HttpException'](_0x27aa23(0x211),common_1['HttpStatus'][_0x27aa23(0x21d)]);const {model3Count:_0x4f1faa,model4Count:_0x580cdf,drawMjCount:_0x2f293a}=await this[_0x27aa23(0x217)][_0x27aa23(0x208)]();await this['signinEntity'][_0x27aa23(0x22e)]({'userId':_0x3c3996,'signInTime':new Date(),'signInDate':_0x121d28,'isSigned':!![]}),await this[_0x27aa23(0x222)][_0x27aa23(0x1fd)](_0x3c3996,{'model3Count':_0x4f1faa,'model4Count':_0x580cdf,'drawMjCount':_0x2f293a}),await this['userBalanceService'][_0x27aa23(0x1fa)]({'userId':_0x3c3996,'rechargeType':balance_constant_1[_0x27aa23(0x1e3)][_0x27aa23(0x1e7)],'model3Count':_0x4f1faa,'model4Count':_0x580cdf,'drawMjCount':_0x2f293a});const _0x2b1cb2=(0x0,date_1[_0x27aa23(0x207)])(new Date())[_0x27aa23(0x1f2)](0x1,'day')['format']('YYYY-MM-DD'),_0x2504fa=await this['signinEntity'][_0x27aa23(0x21e)]({'where':{'userId':_0x3c3996,'signInDate':_0x2b1cb2}});if(_0x2504fa){common_1[_0x27aa23(0x20c)][_0x27aa23(0x1f0)]('用户'+_0x3c3996+'昨天签到了、今天是连续签到！',_0x27aa23(0x1f5));const _0x30513a=await this[_0x27aa23(0x20b)][_0x27aa23(0x21e)]({'where':{'id':_0x3c3996}});if(!_0x30513a)throw new common_1[(_0x27aa23(0x204))]('用户不存在',common_1[_0x27aa23(0x1f3)][_0x27aa23(0x21d)]);const {consecutiveDays:consecutiveDays=0x0}=_0x30513a;await this[_0x27aa23(0x20b)][_0x27aa23(0x218)]({'id':_0x3c3996},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x27aa23(0x20c)][_0x27aa23(0x1f0)]('用户'+_0x3c3996+_0x27aa23(0x22c),_0x27aa23(0x1f5)),await this[_0x27aa23(0x20b)]['update']({'id':_0x3c3996},{'consecutiveDays':0x1});return _0x27aa23(0x210);}async[_0x513648(0x1ee)](_0xa8109a){const _0x159e16=_0x513648;try{const {id:_0x2f2a7c}=_0xa8109a[_0x159e16(0x1f1)],_0x4d9a60=(0x0,date_1[_0x159e16(0x207)])()[_0x159e16(0x200)]('month')[_0x159e16(0x1ec)]('YYYY-MM-DD\x20HH:mm:ss'),_0x320f38=(0x0,date_1[_0x159e16(0x207)])()[_0x159e16(0x201)](_0x159e16(0x229))[_0x159e16(0x1ec)](_0x159e16(0x225)),_0x5d30e4=this[_0x159e16(0x1f8)]['createQueryBuilder']('signin'),_0x4e882c=await _0x5d30e4[_0x159e16(0x219)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0x159e16(0x1eb)]('signin.userId\x20=\x20:userId',{'userId':_0xa8109a['user']['id']})[_0x159e16(0x1eb)]('signin.signInTime\x20>=\x20:firstDay',{'firstDay':_0x4d9a60})[_0x159e16(0x1eb)]('signin.signInTime\x20<=\x20:lastDay',{'lastDay':_0x320f38})[_0x159e16(0x1e2)](),_0x5c0fd6=new Date(_0x4d9a60),_0xc54ecf=new Date(_0x320f38),_0x24ddca=[],_0x886775=new Date(_0x5c0fd6);while(_0x886775<=_0xc54ecf){_0x24ddca[_0x159e16(0x1df)]((0x0,date_1[_0x159e16(0x207)])(new Date(_0x886775))[_0x159e16(0x1ec)]('YYYY-MM-DD')),_0x886775[_0x159e16(0x22a)](_0x886775[_0x159e16(0x1fc)]()+0x1);}const _0x5d1aa3=[];for(const _0x53bb84 of _0x24ddca){const _0x22ea65=_0x4e882c['find'](_0x42c2c8=>_0x42c2c8['signInDate']===_0x53bb84);!_0x22ea65?_0x5d1aa3[_0x159e16(0x1df)]({'signInDate':_0x53bb84,'isSigned':![]}):(_0x22ea65[_0x159e16(0x21a)]=!![],_0x5d1aa3[_0x159e16(0x1df)](_0x22ea65));}return _0x5d1aa3;}catch(_0xe9d5cd){console[_0x159e16(0x21b)](_0x159e16(0x1f6),_0xe9d5cd);throw new common_1[(_0x159e16(0x204))](_0x159e16(0x22b),common_1['HttpStatus'][_0x159e16(0x21d)]);}}};function _0x4150(_0x2dd8cb,_0x4c71ad){const _0x27051c=_0x2705();return _0x4150=function(_0x41505f,_0x4a00d4){_0x41505f=_0x41505f-0x1de;let _0x3ae28e=_0x27051c[_0x41505f];return _0x3ae28e;},_0x4150(_0x2dd8cb,_0x4c71ad);}SigninService=__decorate([(0x0,common_1[_0x513648(0x1e0)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1[_0x513648(0x20f)])),__param(0x1,(0x0,typeorm_1[_0x513648(0x1f7)])(user_entity_1[_0x513648(0x1fb)])),__metadata(_0x513648(0x215),[typeorm_2[_0x513648(0x21f)],typeorm_2[_0x513648(0x21f)],userBalance_service_1[_0x513648(0x1de)],globalConfig_service_1['GlobalConfigService']])],SigninService),exports[_0x513648(0x1f5)]=SigninService;