'use strict';const _0x2d455e=_0x1251;(function(_0x123dc2,_0x3732c1){const _0x515471=_0x1251,_0x5769d3=_0x123dc2();while(!![]){try{const _0x484ec0=-parseInt(_0x515471(0xfc))/0x1*(parseInt(_0x515471(0xf4))/0x2)+parseInt(_0x515471(0xeb))/0x3+-parseInt(_0x515471(0x115))/0x4+parseInt(_0x515471(0xe8))/0x5+-parseInt(_0x515471(0xdb))/0x6+-parseInt(_0x515471(0x110))/0x7*(parseInt(_0x515471(0xf5))/0x8)+parseInt(_0x515471(0xd9))/0x9*(parseInt(_0x515471(0x11d))/0xa);if(_0x484ec0===_0x3732c1)break;else _0x5769d3['push'](_0x5769d3['shift']());}catch(_0x59fe89){_0x5769d3['push'](_0x5769d3['shift']());}}}(_0xb18b,0xc000a));function _0x1251(_0x2e250d,_0x4b37c9){const _0xb18b6b=_0xb18b();return _0x1251=function(_0x125158,_0x50e5e3){_0x125158=_0x125158-0xd6;let _0x3f8d0d=_0xb18b6b[_0x125158];return _0x3f8d0d;},_0x1251(_0x2e250d,_0x4b37c9);}var __decorate=this&&this[_0x2d455e(0x114)]||function(_0x2a7b28,_0x2d6ca7,_0x3c9eed,_0x9857e9){const _0x5ecf37=_0x2d455e;var _0x40ade1=arguments['length'],_0x3c6e01=_0x40ade1<0x3?_0x2d6ca7:_0x9857e9===null?_0x9857e9=Object[_0x5ecf37(0xdd)](_0x2d6ca7,_0x3c9eed):_0x9857e9,_0x2ec1a9;if(typeof Reflect===_0x5ecf37(0x11b)&&typeof Reflect[_0x5ecf37(0xfb)]===_0x5ecf37(0x11e))_0x3c6e01=Reflect[_0x5ecf37(0xfb)](_0x2a7b28,_0x2d6ca7,_0x3c9eed,_0x9857e9);else{for(var _0x11f67b=_0x2a7b28[_0x5ecf37(0x121)]-0x1;_0x11f67b>=0x0;_0x11f67b--)if(_0x2ec1a9=_0x2a7b28[_0x11f67b])_0x3c6e01=(_0x40ade1<0x3?_0x2ec1a9(_0x3c6e01):_0x40ade1>0x3?_0x2ec1a9(_0x2d6ca7,_0x3c9eed,_0x3c6e01):_0x2ec1a9(_0x2d6ca7,_0x3c9eed))||_0x3c6e01;}return _0x40ade1>0x3&&_0x3c6e01&&Object[_0x5ecf37(0xf7)](_0x2d6ca7,_0x3c9eed,_0x3c6e01),_0x3c6e01;},__metadata=this&&this['__metadata']||function(_0x24863c,_0x3f53ac){const _0x23e8c1=_0x2d455e;if(typeof Reflect===_0x23e8c1(0x11b)&&typeof Reflect[_0x23e8c1(0x109)]==='function')return Reflect[_0x23e8c1(0x109)](_0x24863c,_0x3f53ac);},__param=this&&this[_0x2d455e(0xd8)]||function(_0x161203,_0x3ed6ca){return function(_0x29bc80,_0x2fd4e5){_0x3ed6ca(_0x29bc80,_0x2fd4e5,_0x161203);};};Object['defineProperty'](exports,_0x2d455e(0x117),{'value':!![]}),exports[_0x2d455e(0x11a)]=void 0x0;const globalConfig_service_1=require(_0x2d455e(0xfe)),userBalance_service_1=require(_0x2d455e(0xdf)),common_1=require(_0x2d455e(0xec)),signIn_entity_1=require(_0x2d455e(0x10a)),typeorm_1=require(_0x2d455e(0x10e)),typeorm_2=require(_0x2d455e(0x10c)),date_1=require(_0x2d455e(0x111)),user_entity_1=require(_0x2d455e(0xf9)),balance_constant_1=require(_0x2d455e(0x120));let SigninService=class SigninService{constructor(_0x2277c9,_0x1c026c,_0x3145fb,_0x36771e){const _0x21cf74=_0x2d455e;this[_0x21cf74(0x106)]=_0x2277c9,this[_0x21cf74(0x112)]=_0x1c026c,this[_0x21cf74(0xd6)]=_0x3145fb,this[_0x21cf74(0xdc)]=_0x36771e;}async[_0x2d455e(0xfa)](_0x13529c){const _0xc21934=_0x2d455e,{id:_0x2770c9}=_0x13529c[_0xc21934(0xe6)],_0x40e119=(0x0,date_1[_0xc21934(0xed)])(new Date())[_0xc21934(0x125)](_0xc21934(0x116)),_0x1fde97=await this[_0xc21934(0x106)][_0xc21934(0x123)]({'where':{'userId':_0x2770c9,'signInDate':_0x40e119}});if(_0x1fde97)throw new common_1['HttpException']('今日已签到、改天再来吧!.',common_1['HttpStatus'][_0xc21934(0x124)]);const {model3Count:_0x1a9b93,model4Count:_0x2ea15f,drawMjCount:_0x32d3eb}=await this[_0xc21934(0xdc)][_0xc21934(0x101)]();await this[_0xc21934(0x106)][_0xc21934(0xf8)]({'userId':_0x2770c9,'signInTime':new Date(),'signInDate':_0x40e119,'isSigned':!![]}),await this[_0xc21934(0xd6)][_0xc21934(0xe7)](_0x2770c9,{'model3Count':_0x1a9b93,'model4Count':_0x2ea15f,'drawMjCount':_0x32d3eb}),await this[_0xc21934(0xd6)][_0xc21934(0x10d)]({'userId':_0x2770c9,'rechargeType':balance_constant_1[_0xc21934(0x10f)]['SIGN_IN'],'model3Count':_0x1a9b93,'model4Count':_0x2ea15f,'drawMjCount':_0x32d3eb});const _0x3ad8d6=(0x0,date_1['default'])(new Date())[_0xc21934(0xf0)](0x1,_0xc21934(0xda))['format'](_0xc21934(0x116)),_0x320b6e=await this[_0xc21934(0x106)][_0xc21934(0x123)]({'where':{'userId':_0x2770c9,'signInDate':_0x3ad8d6}});if(_0x320b6e){common_1[_0xc21934(0xde)][_0xc21934(0xf2)]('用户'+_0x2770c9+_0xc21934(0x113),_0xc21934(0x11a));const _0x17edfa=await this[_0xc21934(0x112)][_0xc21934(0x123)]({'where':{'id':_0x2770c9}});if(!_0x17edfa)throw new common_1[(_0xc21934(0x100))](_0xc21934(0x108),common_1[_0xc21934(0xea)][_0xc21934(0x124)]);const {consecutiveDays:consecutiveDays=0x0}=_0x17edfa;await this[_0xc21934(0x112)][_0xc21934(0xe0)]({'id':_0x2770c9},{'consecutiveDays':consecutiveDays+0x1});}else common_1['Logger'][_0xc21934(0xf2)]('用户'+_0x2770c9+_0xc21934(0x10b),_0xc21934(0x11a)),await this[_0xc21934(0x112)][_0xc21934(0xe0)]({'id':_0x2770c9},{'consecutiveDays':0x1});return'Sign\x20in\x20successful.';}async['getSigninLog'](_0x50986d){const _0x3084d9=_0x2d455e;try{const {id:_0x1dc3df}=_0x50986d[_0x3084d9(0xe6)],_0x257d0f=(0x0,date_1[_0x3084d9(0xed)])()['startOf'](_0x3084d9(0x118))[_0x3084d9(0x125)](_0x3084d9(0x102)),_0x4a7df6=(0x0,date_1[_0x3084d9(0xed)])()[_0x3084d9(0x11c)](_0x3084d9(0x118))[_0x3084d9(0x125)](_0x3084d9(0x102)),_0x41ce45=this['signinEntity'][_0x3084d9(0x122)]('signin'),_0x1d3501=await _0x41ce45[_0x3084d9(0xf6)](_0x3084d9(0xe5))[_0x3084d9(0x119)](_0x3084d9(0xf1),{'userId':_0x50986d[_0x3084d9(0xe6)]['id']})[_0x3084d9(0x119)]('signin.signInTime\x20>=\x20:firstDay',{'firstDay':_0x257d0f})['andWhere']('signin.signInTime\x20<=\x20:lastDay',{'lastDay':_0x4a7df6})[_0x3084d9(0xef)](),_0x59543d=new Date(_0x257d0f),_0x4c941d=new Date(_0x4a7df6),_0x1da41f=[],_0x2bc197=new Date(_0x59543d);while(_0x2bc197<=_0x4c941d){_0x1da41f[_0x3084d9(0xf3)]((0x0,date_1[_0x3084d9(0xed)])(new Date(_0x2bc197))['format'](_0x3084d9(0x116))),_0x2bc197[_0x3084d9(0x103)](_0x2bc197[_0x3084d9(0xe3)]()+0x1);}const _0x37a119=[];for(const _0x2689b0 of _0x1da41f){const _0x43118f=_0x1d3501[_0x3084d9(0xff)](_0x3c29b8=>_0x3c29b8[_0x3084d9(0x107)]===_0x2689b0);!_0x43118f?_0x37a119[_0x3084d9(0xf3)]({'signInDate':_0x2689b0,'isSigned':![]}):(_0x43118f[_0x3084d9(0xe1)]=!![],_0x37a119[_0x3084d9(0xf3)](_0x43118f));}return _0x37a119;}catch(_0x1158e8){console['log'](_0x3084d9(0x104),_0x1158e8);throw new common_1[(_0x3084d9(0x100))](_0x3084d9(0x126),common_1[_0x3084d9(0xea)][_0x3084d9(0x124)]);}}};SigninService=__decorate([(0x0,common_1[_0x2d455e(0xe9)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1[_0x2d455e(0xee)])),__param(0x1,(0x0,typeorm_1[_0x2d455e(0xe4)])(user_entity_1[_0x2d455e(0xe2)])),__metadata(_0x2d455e(0xd7),[typeorm_2[_0x2d455e(0x105)],typeorm_2['Repository'],userBalance_service_1[_0x2d455e(0x11f)],globalConfig_service_1[_0x2d455e(0xfd)]])],SigninService),exports[_0x2d455e(0x11a)]=SigninService;function _0xb18b(){const _0x15ea72=['../user/user.entity','sign','decorate','118XEGMyZ','GlobalConfigService','../globalConfig/globalConfig.service','find','HttpException','getSignatureGiftConfig','YYYY-MM-DD\x20HH:mm:ss','setDate','error:\x20','Repository','signinEntity','signInDate','用户不存在','metadata','./signIn.entity','昨天没签到、今天重置天数！','typeorm','saveRecordRechargeLog','@nestjs/typeorm','RechargeType','2460836wzmYVx','../../common/utils/date','userEntity','昨天签到了、今天是连续签到！','__decorate','1413808uAmlDf','YYYY-MM-DD','__esModule','month','andWhere','SigninService','object','endOf','20VPaIBV','function','UserBalanceService','../../common/constants/balance.constant','length','createQueryBuilder','findOne','BAD_REQUEST','format','获取签到数据失败！','userBalanceService','design:paramtypes','__param','9534204UtGkgK','day','4159062oBZLCo','globalConfigService','getOwnPropertyDescriptor','Logger','../userBalance/userBalance.service','update','isSigned','UserEntity','getDate','InjectRepository','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','user','addBalanceToUser','2565140VfKYLy','Injectable','HttpStatus','1038225gJMFgT','@nestjs/common','default','SigninEntity','getRawMany','subtract','signin.userId\x20=\x20:userId','debug','push','13444FkSXiU','8RAbGyv','select','defineProperty','save'];_0xb18b=function(){return _0x15ea72;};return _0xb18b();}