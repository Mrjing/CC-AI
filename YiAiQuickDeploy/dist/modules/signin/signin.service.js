'use strict';const _0x86ab94=_0x278b;(function(_0x29038f,_0x1b5775){const _0x4b2434=_0x278b,_0x23aefd=_0x29038f();while(!![]){try{const _0x1ac452=-parseInt(_0x4b2434(0x1ac))/0x1+-parseInt(_0x4b2434(0x1a2))/0x2*(parseInt(_0x4b2434(0x1a3))/0x3)+parseInt(_0x4b2434(0x1c1))/0x4*(-parseInt(_0x4b2434(0x1cb))/0x5)+parseInt(_0x4b2434(0x1c0))/0x6+parseInt(_0x4b2434(0x1c9))/0x7*(parseInt(_0x4b2434(0x19d))/0x8)+parseInt(_0x4b2434(0x189))/0x9*(-parseInt(_0x4b2434(0x1af))/0xa)+parseInt(_0x4b2434(0x1bb))/0xb*(parseInt(_0x4b2434(0x19f))/0xc);if(_0x1ac452===_0x1b5775)break;else _0x23aefd['push'](_0x23aefd['shift']());}catch(_0x1edd7d){_0x23aefd['push'](_0x23aefd['shift']());}}}(_0x2650,0x92e73));var __decorate=this&&this['__decorate']||function(_0x22a96b,_0x3de9b1,_0x40d568,_0x5afee6){const _0x1e4536=_0x278b;var _0x4ca239=arguments['length'],_0x25bb3b=_0x4ca239<0x3?_0x3de9b1:_0x5afee6===null?_0x5afee6=Object['getOwnPropertyDescriptor'](_0x3de9b1,_0x40d568):_0x5afee6,_0xea1089;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1e4536(0x1a4))_0x25bb3b=Reflect[_0x1e4536(0x1bd)](_0x22a96b,_0x3de9b1,_0x40d568,_0x5afee6);else{for(var _0x37e6ff=_0x22a96b['length']-0x1;_0x37e6ff>=0x0;_0x37e6ff--)if(_0xea1089=_0x22a96b[_0x37e6ff])_0x25bb3b=(_0x4ca239<0x3?_0xea1089(_0x25bb3b):_0x4ca239>0x3?_0xea1089(_0x3de9b1,_0x40d568,_0x25bb3b):_0xea1089(_0x3de9b1,_0x40d568))||_0x25bb3b;}return _0x4ca239>0x3&&_0x25bb3b&&Object['defineProperty'](_0x3de9b1,_0x40d568,_0x25bb3b),_0x25bb3b;},__metadata=this&&this[_0x86ab94(0x1c6)]||function(_0x3fe891,_0x130400){const _0x19a02f=_0x86ab94;if(typeof Reflect==='object'&&typeof Reflect[_0x19a02f(0x1cf)]===_0x19a02f(0x1a4))return Reflect[_0x19a02f(0x1cf)](_0x3fe891,_0x130400);},__param=this&&this[_0x86ab94(0x1ab)]||function(_0x30228a,_0x4b7b55){return function(_0x17756e,_0x22770e){_0x4b7b55(_0x17756e,_0x22770e,_0x30228a);};};function _0x2650(){const _0x1c841a=['SIGN_IN','用户不存在','__esModule','userBalanceService','signin','BAD_REQUEST','../globalConfig/globalConfig.service','SigninService','day','1853357CZMvBu','Repository','decorate','../userBalance/userBalance.service','createQueryBuilder','4755162rfLQRM','24892PXPeMI','YYYY-MM-DD\x20HH:mm:ss','signinEntity','昨天签到了、今天是连续签到！','debug','__metadata','Logger','default','7bayZdK','HttpException','800cMfVVL','format','update','userEntity','metadata','startOf','sign','../../common/constants/balance.constant','find','86247SrhPUt','isSigned','HttpStatus','addBalanceToUser','defineProperty','saveRecordRechargeLog','andWhere','@nestjs/typeorm','month','push','design:paramtypes','../../common/utils/date','getSignatureGiftConfig','findOne','signin.signInTime\x20<=\x20:lastDay','endOf','subtract','user','RechargeType','log','2006344TsFzio','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','192jxasvJ','InjectRepository','昨天没签到、今天重置天数！','164026cekaZp','18IEvPjh','function','signin.userId\x20=\x20:userId','globalConfigService','./signIn.entity','../user/user.entity','获取签到数据失败！','SigninEntity','__param','585926iTZrcO','Sign\x20in\x20successful.','signin.signInTime\x20>=\x20:firstDay','1110LjyMue','getRawMany','YYYY-MM-DD'];_0x2650=function(){return _0x1c841a;};return _0x2650();}function _0x278b(_0x1b5848,_0x55d39c){const _0x26501a=_0x2650();return _0x278b=function(_0x278b01,_0x5e0a27){_0x278b01=_0x278b01-0x189;let _0x53f703=_0x26501a[_0x278b01];return _0x53f703;},_0x278b(_0x1b5848,_0x55d39c);}Object[_0x86ab94(0x18d)](exports,_0x86ab94(0x1b4),{'value':!![]}),exports[_0x86ab94(0x1b9)]=void 0x0;const globalConfig_service_1=require(_0x86ab94(0x1b8)),userBalance_service_1=require(_0x86ab94(0x1be)),common_1=require('@nestjs/common'),signIn_entity_1=require(_0x86ab94(0x1a7)),typeorm_1=require(_0x86ab94(0x190)),typeorm_2=require('typeorm'),date_1=require(_0x86ab94(0x194)),user_entity_1=require(_0x86ab94(0x1a8)),balance_constant_1=require(_0x86ab94(0x1d2));let SigninService=class SigninService{constructor(_0x36b74a,_0xa8553c,_0xfef49a,_0x3c6ada){const _0x564054=_0x86ab94;this[_0x564054(0x1c3)]=_0x36b74a,this[_0x564054(0x1ce)]=_0xa8553c,this[_0x564054(0x1b5)]=_0xfef49a,this['globalConfigService']=_0x3c6ada;}async[_0x86ab94(0x1d1)](_0x2afc50){const _0xf31341=_0x86ab94,{id:_0x272d25}=_0x2afc50[_0xf31341(0x19a)],_0x127fdd=(0x0,date_1['default'])(new Date())[_0xf31341(0x1cc)]('YYYY-MM-DD'),_0x2f77c7=await this[_0xf31341(0x1c3)][_0xf31341(0x196)]({'where':{'userId':_0x272d25,'signInDate':_0x127fdd}});if(_0x2f77c7)throw new common_1[(_0xf31341(0x1ca))]('今日已签到、改天再来吧!.',common_1[_0xf31341(0x18b)][_0xf31341(0x1b7)]);const {model3Count:_0x45f8df,model4Count:_0x3a402c,drawMjCount:_0x43e9b3}=await this[_0xf31341(0x1a6)][_0xf31341(0x195)]();await this[_0xf31341(0x1c3)]['save']({'userId':_0x272d25,'signInTime':new Date(),'signInDate':_0x127fdd,'isSigned':!![]}),await this['userBalanceService'][_0xf31341(0x18c)](_0x272d25,{'model3Count':_0x45f8df,'model4Count':_0x3a402c,'drawMjCount':_0x43e9b3}),await this['userBalanceService'][_0xf31341(0x18e)]({'userId':_0x272d25,'rechargeType':balance_constant_1[_0xf31341(0x19b)][_0xf31341(0x1b2)],'model3Count':_0x45f8df,'model4Count':_0x3a402c,'drawMjCount':_0x43e9b3});const _0x53c878=(0x0,date_1[_0xf31341(0x1c8)])(new Date())[_0xf31341(0x199)](0x1,_0xf31341(0x1ba))[_0xf31341(0x1cc)]('YYYY-MM-DD'),_0x48a3ae=await this['signinEntity'][_0xf31341(0x196)]({'where':{'userId':_0x272d25,'signInDate':_0x53c878}});if(_0x48a3ae){common_1[_0xf31341(0x1c7)][_0xf31341(0x1c5)]('用户'+_0x272d25+_0xf31341(0x1c4),'SigninService');const _0xa4702e=await this['userEntity'][_0xf31341(0x196)]({'where':{'id':_0x272d25}});if(!_0xa4702e)throw new common_1[(_0xf31341(0x1ca))](_0xf31341(0x1b3),common_1[_0xf31341(0x18b)][_0xf31341(0x1b7)]);const {consecutiveDays:consecutiveDays=0x0}=_0xa4702e;await this[_0xf31341(0x1ce)][_0xf31341(0x1cd)]({'id':_0x272d25},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0xf31341(0x1c7)][_0xf31341(0x1c5)]('用户'+_0x272d25+_0xf31341(0x1a1),_0xf31341(0x1b9)),await this['userEntity'][_0xf31341(0x1cd)]({'id':_0x272d25},{'consecutiveDays':0x1});return _0xf31341(0x1ad);}async['getSigninLog'](_0x14e4ee){const _0x12f4bf=_0x86ab94;try{const {id:_0x49841f}=_0x14e4ee[_0x12f4bf(0x19a)],_0x559836=(0x0,date_1[_0x12f4bf(0x1c8)])()[_0x12f4bf(0x1d0)](_0x12f4bf(0x191))[_0x12f4bf(0x1cc)](_0x12f4bf(0x1c2)),_0x1b3e56=(0x0,date_1[_0x12f4bf(0x1c8)])()[_0x12f4bf(0x198)](_0x12f4bf(0x191))['format'](_0x12f4bf(0x1c2)),_0x41bdeb=this[_0x12f4bf(0x1c3)][_0x12f4bf(0x1bf)](_0x12f4bf(0x1b6)),_0x539cc2=await _0x41bdeb['select'](_0x12f4bf(0x19e))[_0x12f4bf(0x18f)](_0x12f4bf(0x1a5),{'userId':_0x14e4ee[_0x12f4bf(0x19a)]['id']})[_0x12f4bf(0x18f)](_0x12f4bf(0x1ae),{'firstDay':_0x559836})[_0x12f4bf(0x18f)](_0x12f4bf(0x197),{'lastDay':_0x1b3e56})[_0x12f4bf(0x1b0)](),_0x18cfe4=new Date(_0x559836),_0x2cc201=new Date(_0x1b3e56),_0x1115b2=[],_0x35e22d=new Date(_0x18cfe4);while(_0x35e22d<=_0x2cc201){_0x1115b2['push']((0x0,date_1['default'])(new Date(_0x35e22d))[_0x12f4bf(0x1cc)](_0x12f4bf(0x1b1))),_0x35e22d['setDate'](_0x35e22d['getDate']()+0x1);}const _0x5c3a0b=[];for(const _0x527bde of _0x1115b2){const _0x30b32e=_0x539cc2[_0x12f4bf(0x1d3)](_0x5bd0cd=>_0x5bd0cd['signInDate']===_0x527bde);!_0x30b32e?_0x5c3a0b[_0x12f4bf(0x192)]({'signInDate':_0x527bde,'isSigned':![]}):(_0x30b32e[_0x12f4bf(0x18a)]=!![],_0x5c3a0b['push'](_0x30b32e));}return _0x5c3a0b;}catch(_0x2aad3b){console[_0x12f4bf(0x19c)]('error:\x20',_0x2aad3b);throw new common_1[(_0x12f4bf(0x1ca))](_0x12f4bf(0x1a9),common_1[_0x12f4bf(0x18b)][_0x12f4bf(0x1b7)]);}}};SigninService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x86ab94(0x1a0)])(signIn_entity_1[_0x86ab94(0x1aa)])),__param(0x1,(0x0,typeorm_1[_0x86ab94(0x1a0)])(user_entity_1['UserEntity'])),__metadata(_0x86ab94(0x193),[typeorm_2[_0x86ab94(0x1bc)],typeorm_2[_0x86ab94(0x1bc)],userBalance_service_1['UserBalanceService'],globalConfig_service_1['GlobalConfigService']])],SigninService),exports[_0x86ab94(0x1b9)]=SigninService;