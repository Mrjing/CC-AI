'use strict';var _0x33a34d=_0x3c50;(function(_0xe071a,_0x5885a7){var _0x14c367=_0x3c50,_0x1e2ca6=_0xe071a();while(!![]){try{var _0x4237f6=parseInt(_0x14c367(0x142))/0x1*(-parseInt(_0x14c367(0x122))/0x2)+parseInt(_0x14c367(0x12f))/0x3+parseInt(_0x14c367(0x13e))/0x4*(parseInt(_0x14c367(0x13d))/0x5)+-parseInt(_0x14c367(0x132))/0x6+parseInt(_0x14c367(0x123))/0x7*(parseInt(_0x14c367(0x14f))/0x8)+parseInt(_0x14c367(0x117))/0x9*(-parseInt(_0x14c367(0x152))/0xa)+parseInt(_0x14c367(0x13f))/0xb*(parseInt(_0x14c367(0x14b))/0xc);if(_0x4237f6===_0x5885a7)break;else _0x1e2ca6['push'](_0x1e2ca6['shift']());}catch(_0x43281f){_0x1e2ca6['push'](_0x1e2ca6['shift']());}}}(_0x46dd,0xa2309));function _0x46dd(){var _0x24068f=['3141258hazFcn','OnQueueError','handleJob','OnQueueDrained','Process','logger','error',':\x20绘画失败\x20','function','onQueueActive','@nestjs/bull','35NpFNoL','3780llFSUU','4393114JNKcUC','design:returntype','log','1YvUjqy','Processor','OnQueueActive','prototype','getOwnPropertyDescriptor','MidjourneyService','onQueuePaused','data','Logger','24nPcOeR','object','onQueueDrained','onQueueError','2568oSdNwN','onQueueCleaned','design:paramtypes','30XuOpcB','decorate','OnQueueResumed','CONCURRENCY','mjDraw','midjourneyService','514161CoQlnz','@nestjs/common','../midjourney/midjourney.service','draw','OnQueueFailed','env','__decorate','drawFailed','队列暂停的时候调用','__esModule','__metadata','1935334RunpKo','5684LxgwaN','name','design:type','length','metadata','Queue\x20failed:\x20','QueueProcessor','onQueueCompleted','onQueueFailed','\x20were\x20cleaned.','MJDRAW','defineProperty','3782733XzCDVn','onQueueProgress','OnQueueProgress'];_0x46dd=function(){return _0x24068f;};return _0x46dd();}var __decorate=this&&this[_0x33a34d(0x11d)]||function(_0x3634e2,_0x19c219,_0x11f77d,_0x80f829){var _0x51fdbd=_0x33a34d,_0x438941=arguments[_0x51fdbd(0x126)],_0x39f79f=_0x438941<0x3?_0x19c219:_0x80f829===null?_0x80f829=Object[_0x51fdbd(0x146)](_0x19c219,_0x11f77d):_0x80f829,_0x2980fb;if(typeof Reflect===_0x51fdbd(0x14c)&&typeof Reflect[_0x51fdbd(0x153)]===_0x51fdbd(0x13a))_0x39f79f=Reflect[_0x51fdbd(0x153)](_0x3634e2,_0x19c219,_0x11f77d,_0x80f829);else{for(var _0x5b6d2d=_0x3634e2['length']-0x1;_0x5b6d2d>=0x0;_0x5b6d2d--)if(_0x2980fb=_0x3634e2[_0x5b6d2d])_0x39f79f=(_0x438941<0x3?_0x2980fb(_0x39f79f):_0x438941>0x3?_0x2980fb(_0x19c219,_0x11f77d,_0x39f79f):_0x2980fb(_0x19c219,_0x11f77d))||_0x39f79f;}return _0x438941>0x3&&_0x39f79f&&Object['defineProperty'](_0x19c219,_0x11f77d,_0x39f79f),_0x39f79f;},__metadata=this&&this[_0x33a34d(0x121)]||function(_0x451505,_0x5ccd46){var _0x5e59f1=_0x33a34d;if(typeof Reflect===_0x5e59f1(0x14c)&&typeof Reflect[_0x5e59f1(0x127)]==='function')return Reflect[_0x5e59f1(0x127)](_0x451505,_0x5ccd46);},QueueProcessor_1;Object[_0x33a34d(0x12e)](exports,_0x33a34d(0x120),{'value':!![]}),exports[_0x33a34d(0x129)]=void 0x0;function _0x3c50(_0x363c09,_0x29b64c){var _0x46dd93=_0x46dd();return _0x3c50=function(_0x3c50fb,_0x22afbc){_0x3c50fb=_0x3c50fb-0x113;var _0x17920a=_0x46dd93[_0x3c50fb];return _0x17920a;},_0x3c50(_0x363c09,_0x29b64c);}const bull_1=require(_0x33a34d(0x13c)),common_1=require(_0x33a34d(0x118)),midjourney_service_1=require(_0x33a34d(0x119));let QueueProcessor=QueueProcessor_1=class QueueProcessor{constructor(_0x396ed6){var _0x5575f6=_0x33a34d;this[_0x5575f6(0x116)]=_0x396ed6,this[_0x5575f6(0x137)]=new common_1[(_0x5575f6(0x14a))](QueueProcessor_1[_0x5575f6(0x124)]);}async[_0x33a34d(0x134)](_0x24104e){var _0x1b76db=_0x33a34d;const _0x37713e=await this[_0x1b76db(0x116)][_0x1b76db(0x11a)](_0x24104e[_0x1b76db(0x149)],_0x24104e['id']);return _0x37713e;}[_0x33a34d(0x13b)](_0x30bbad){}[_0x33a34d(0x14e)](_0x4d6f6b){var _0x33ff63=_0x33a34d;console[_0x33ff63(0x141)]('队列发生错误',_0x4d6f6b);}[_0x33a34d(0x130)](_0x5a90f0,_0x53ce6b){var _0x172600=_0x33a34d;console[_0x172600(0x141)]('队列任务的一个回调用于通知当前进度',_0x5a90f0['id'],_0x53ce6b);}[_0x33a34d(0x12a)](_0x454ad2,_0x574833){}[_0x33a34d(0x12b)](_0x89b779,_0x2b9bf1){var _0x2ede33=_0x33a34d;common_1[_0x2ede33(0x14a)][_0x2ede33(0x138)](_0x2ede33(0x128)+_0x2b9bf1['message']+_0x2ede33(0x139)+_0x89b779['id'],_0x2ede33(0x129)),this[_0x2ede33(0x116)][_0x2ede33(0x11e)](_0x89b779[_0x2ede33(0x149)]);}['onQueuePaused'](){var _0x3e4947=_0x33a34d;console['log'](_0x3e4947(0x11f));}['onQueueResumed'](){console['log']('队列恢复的时候调用');}[_0x33a34d(0x150)](_0x4b1e06,_0x2d6140){var _0x53b6ce=_0x33a34d;common_1['Logger'][_0x53b6ce(0x141)]('Queue\x20cleaned:\x20'+_0x4b1e06['length']+'\x20jobs\x20of\x20type\x20'+_0x2d6140+_0x53b6ce(0x12c),_0x53b6ce(0x129));}[_0x33a34d(0x14d)](){}};__decorate([(0x0,bull_1[_0x33a34d(0x136)])({'name':_0x33a34d(0x115),'concurrency':process[_0x33a34d(0x11c)]['CONCURRENCY']?+process[_0x33a34d(0x11c)][_0x33a34d(0x114)]:0x3}),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Object]),__metadata(_0x33a34d(0x140),Promise)],QueueProcessor[_0x33a34d(0x145)],_0x33a34d(0x134),null),__decorate([(0x0,bull_1[_0x33a34d(0x144)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Object]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor[_0x33a34d(0x145)],_0x33a34d(0x13b),null),__decorate([(0x0,bull_1[_0x33a34d(0x133)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Error]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor['prototype'],_0x33a34d(0x14e),null),__decorate([(0x0,bull_1[_0x33a34d(0x131)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Object,Number]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor[_0x33a34d(0x145)],_0x33a34d(0x130),null),__decorate([(0x0,bull_1['OnQueueCompleted'])(),__metadata('design:type',Function),__metadata(_0x33a34d(0x151),[Object,Object]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor['prototype'],_0x33a34d(0x12a),null),__decorate([(0x0,bull_1[_0x33a34d(0x11b)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Object,Error]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor[_0x33a34d(0x145)],'onQueueFailed',null),__decorate([(0x0,bull_1['OnQueuePaused'])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor[_0x33a34d(0x145)],_0x33a34d(0x148),null),__decorate([(0x0,bull_1[_0x33a34d(0x113)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[]),__metadata(_0x33a34d(0x140),void 0x0)],QueueProcessor['prototype'],'onQueueResumed',null),__decorate([(0x0,bull_1['OnQueueCleaned'])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[Array,String]),__metadata('design:returntype',void 0x0)],QueueProcessor[_0x33a34d(0x145)],'onQueueCleaned',null),__decorate([(0x0,bull_1[_0x33a34d(0x135)])(),__metadata(_0x33a34d(0x125),Function),__metadata(_0x33a34d(0x151),[]),__metadata('design:returntype',void 0x0)],QueueProcessor[_0x33a34d(0x145)],_0x33a34d(0x14d),null),QueueProcessor=QueueProcessor_1=__decorate([(0x0,bull_1[_0x33a34d(0x143)])(_0x33a34d(0x12d)),__metadata('design:paramtypes',[midjourney_service_1[_0x33a34d(0x147)]])],QueueProcessor),exports[_0x33a34d(0x129)]=QueueProcessor;