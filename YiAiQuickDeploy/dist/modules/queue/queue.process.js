'use strict';var _0x17f38d=_0x33cb;function _0x1000(){var _0x2046b6=['log','error','OnQueuePaused','name','onQueuePaused','draw','__decorate',':\x20绘画失败\x20','OnQueueError','2dmdJgt','onQueueActive','mjDraw','Queue\x20cleaned:\x20','MidjourneyService','onQueueProgress','16Gqnigu','function','../midjourney/midjourney.service','队列发生错误','OnQueueCleaned','defineProperty','OnQueueDrained','OnQueueResumed','\x20were\x20cleaned.','1174247TibvXZ','message','OnQueueCompleted','onQueueDrained','OnQueueProgress','onQueueError','Process','env','onQueueCleaned','520812ZNkrXv','onQueueCompleted','design:type','@nestjs/common','Logger','handleJob','QueueProcessor','getOwnPropertyDescriptor','OnQueueActive','object','logger','31918040qCcRzM','design:returntype','7385332YzFjau','49130wpJvco','OnQueueFailed','队列恢复的时候调用','metadata','data','midjourneyService','onQueueResumed','decorate','prototype','design:paramtypes','@nestjs/bull','6266934WyhdiN','9513441wYPXqD','length','Queue\x20failed:\x20','CONCURRENCY','__esModule','onQueueFailed','816xobpFt','__metadata'];_0x1000=function(){return _0x2046b6;};return _0x1000();}(function(_0xa34a3a,_0x195c0c){var _0x3ced80=_0x33cb,_0x3b9de8=_0xa34a3a();while(!![]){try{var _0x4102ca=parseInt(_0x3ced80(0xb6))/0x1*(parseInt(_0x3ced80(0xa7))/0x2)+-parseInt(_0x3ced80(0x7c))/0x3+-parseInt(_0x3ced80(0x89))/0x4+-parseInt(_0x3ced80(0x8a))/0x5*(parseInt(_0x3ced80(0x9c))/0x6)+parseInt(_0x3ced80(0x96))/0x7+-parseInt(_0x3ced80(0xad))/0x8*(parseInt(_0x3ced80(0x95))/0x9)+parseInt(_0x3ced80(0x87))/0xa;if(_0x4102ca===_0x195c0c)break;else _0x3b9de8['push'](_0x3b9de8['shift']());}catch(_0x24cd44){_0x3b9de8['push'](_0x3b9de8['shift']());}}}(_0x1000,0xee53d));var __decorate=this&&this[_0x17f38d(0xa4)]||function(_0x7d4fb2,_0x4cc9f7,_0x5ce279,_0x668fe1){var _0xb29975=_0x17f38d,_0x31f1a3=arguments['length'],_0x1ec129=_0x31f1a3<0x3?_0x4cc9f7:_0x668fe1===null?_0x668fe1=Object[_0xb29975(0x83)](_0x4cc9f7,_0x5ce279):_0x668fe1,_0x12f801;if(typeof Reflect===_0xb29975(0x85)&&typeof Reflect[_0xb29975(0x91)]===_0xb29975(0xae))_0x1ec129=Reflect[_0xb29975(0x91)](_0x7d4fb2,_0x4cc9f7,_0x5ce279,_0x668fe1);else{for(var _0x5188f5=_0x7d4fb2[_0xb29975(0x97)]-0x1;_0x5188f5>=0x0;_0x5188f5--)if(_0x12f801=_0x7d4fb2[_0x5188f5])_0x1ec129=(_0x31f1a3<0x3?_0x12f801(_0x1ec129):_0x31f1a3>0x3?_0x12f801(_0x4cc9f7,_0x5ce279,_0x1ec129):_0x12f801(_0x4cc9f7,_0x5ce279))||_0x1ec129;}return _0x31f1a3>0x3&&_0x1ec129&&Object[_0xb29975(0xb2)](_0x4cc9f7,_0x5ce279,_0x1ec129),_0x1ec129;},__metadata=this&&this[_0x17f38d(0x9d)]||function(_0x1d432e,_0x1e0c20){var _0x4b89c0=_0x17f38d;if(typeof Reflect===_0x4b89c0(0x85)&&typeof Reflect['metadata']==='function')return Reflect[_0x4b89c0(0x8d)](_0x1d432e,_0x1e0c20);},QueueProcessor_1;Object[_0x17f38d(0xb2)](exports,_0x17f38d(0x9a),{'value':!![]}),exports['QueueProcessor']=void 0x0;const bull_1=require(_0x17f38d(0x94)),common_1=require(_0x17f38d(0x7f)),midjourney_service_1=require(_0x17f38d(0xaf));function _0x33cb(_0x25a56b,_0xb19b22){var _0x10001b=_0x1000();return _0x33cb=function(_0x33cb36,_0x32ff4a){_0x33cb36=_0x33cb36-0x7c;var _0x41e667=_0x10001b[_0x33cb36];return _0x41e667;},_0x33cb(_0x25a56b,_0xb19b22);}let QueueProcessor=QueueProcessor_1=class QueueProcessor{constructor(_0x457e7b){var _0x183d22=_0x17f38d;this[_0x183d22(0x8f)]=_0x457e7b,this[_0x183d22(0x86)]=new common_1[(_0x183d22(0x80))](QueueProcessor_1[_0x183d22(0xa1)]);}async[_0x17f38d(0x81)](_0x38879f){var _0x2fe5c1=_0x17f38d;const _0x5b0fc9=await this['midjourneyService'][_0x2fe5c1(0xa3)](_0x38879f[_0x2fe5c1(0x8e)],_0x38879f['id']);return _0x5b0fc9;}[_0x17f38d(0xa8)](_0xb75cbb){}[_0x17f38d(0xbb)](_0x2a8a02){var _0x10769c=_0x17f38d;console[_0x10769c(0x9e)](_0x10769c(0xb0),_0x2a8a02);}[_0x17f38d(0xac)](_0x3a0d8b,_0x482e7a){console['log']('队列任务的一个回调用于通知当前进度',_0x3a0d8b['id'],_0x482e7a);}[_0x17f38d(0x7d)](_0xcd36d7,_0x51305c){}['onQueueFailed'](_0x13a1fc,_0x45b349){var _0x4fa9ae=_0x17f38d;common_1[_0x4fa9ae(0x80)][_0x4fa9ae(0x9f)](_0x4fa9ae(0x98)+_0x45b349[_0x4fa9ae(0xb7)]+_0x4fa9ae(0xa5)+_0x13a1fc['id'],'QueueProcessor'),this['midjourneyService']['drawFailed'](_0x13a1fc[_0x4fa9ae(0x8e)]);}[_0x17f38d(0xa2)](){var _0x334f8d=_0x17f38d;console[_0x334f8d(0x9e)]('队列暂停的时候调用');}[_0x17f38d(0x90)](){var _0x1370fa=_0x17f38d;console[_0x1370fa(0x9e)](_0x1370fa(0x8c));}['onQueueCleaned'](_0x17881f,_0x3558fe){var _0x10285a=_0x17f38d;common_1['Logger'][_0x10285a(0x9e)](_0x10285a(0xaa)+_0x17881f['length']+'\x20jobs\x20of\x20type\x20'+_0x3558fe+_0x10285a(0xb5),_0x10285a(0x82));}[_0x17f38d(0xb9)](){}};__decorate([(0x0,bull_1[_0x17f38d(0xbc)])({'name':_0x17f38d(0xa9),'concurrency':process[_0x17f38d(0xbd)][_0x17f38d(0x99)]?+process[_0x17f38d(0xbd)][_0x17f38d(0x99)]:0x3}),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[Object]),__metadata(_0x17f38d(0x88),Promise)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0x81),null),__decorate([(0x0,bull_1[_0x17f38d(0x84)])(),__metadata(_0x17f38d(0x7e),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],'onQueueActive',null),__decorate([(0x0,bull_1[_0x17f38d(0xa6)])(),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[Error]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],'onQueueError',null),__decorate([(0x0,bull_1[_0x17f38d(0xba)])(),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[Object,Number]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0xac),null),__decorate([(0x0,bull_1[_0x17f38d(0xb8)])(),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[Object,Object]),__metadata('design:returntype',void 0x0)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0x7d),null),__decorate([(0x0,bull_1[_0x17f38d(0x8b)])(),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[Object,Error]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0x9b),null),__decorate([(0x0,bull_1[_0x17f38d(0xa0)])(),__metadata(_0x17f38d(0x7e),Function),__metadata('design:paramtypes',[]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor['prototype'],_0x17f38d(0xa2),null),__decorate([(0x0,bull_1[_0x17f38d(0xb4)])(),__metadata('design:type',Function),__metadata(_0x17f38d(0x93),[]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0x90),null),__decorate([(0x0,bull_1[_0x17f38d(0xb1)])(),__metadata('design:type',Function),__metadata(_0x17f38d(0x93),[Array,String]),__metadata(_0x17f38d(0x88),void 0x0)],QueueProcessor[_0x17f38d(0x92)],_0x17f38d(0xbe),null),__decorate([(0x0,bull_1[_0x17f38d(0xb3)])(),__metadata(_0x17f38d(0x7e),Function),__metadata(_0x17f38d(0x93),[]),__metadata('design:returntype',void 0x0)],QueueProcessor['prototype'],'onQueueDrained',null),QueueProcessor=QueueProcessor_1=__decorate([(0x0,bull_1['Processor'])('MJDRAW'),__metadata(_0x17f38d(0x93),[midjourney_service_1[_0x17f38d(0xab)]])],QueueProcessor),exports[_0x17f38d(0x82)]=QueueProcessor;