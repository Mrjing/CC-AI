'use strict';const _0x21c78f=_0x5483;(function(_0xcd7818,_0x38eb95){const _0x56ddd9=_0x5483,_0x1466ec=_0xcd7818();while(!![]){try{const _0x2afb49=parseInt(_0x56ddd9(0x1e2))/0x1*(parseInt(_0x56ddd9(0x1eb))/0x2)+-parseInt(_0x56ddd9(0x1cb))/0x3*(parseInt(_0x56ddd9(0x1d8))/0x4)+-parseInt(_0x56ddd9(0x1e5))/0x5+parseInt(_0x56ddd9(0x1e7))/0x6+-parseInt(_0x56ddd9(0x1e1))/0x7*(-parseInt(_0x56ddd9(0x1ca))/0x8)+-parseInt(_0x56ddd9(0x1e6))/0x9*(parseInt(_0x56ddd9(0x1e9))/0xa)+parseInt(_0x56ddd9(0x1c3))/0xb;if(_0x2afb49===_0x38eb95)break;else _0x1466ec['push'](_0x1466ec['shift']());}catch(_0x4684a1){_0x1466ec['push'](_0x1466ec['shift']());}}}(_0x1bee,0xc2b28));function _0x5483(_0x1f5ee3,_0x3c7f17){const _0x1bee30=_0x1bee();return _0x5483=function(_0x5483fb,_0x58a3e6){_0x5483fb=_0x5483fb-0x1c1;let _0x57bef6=_0x1bee30[_0x5483fb];return _0x57bef6;},_0x5483(_0x1f5ee3,_0x3c7f17);}var __decorate=this&&this[_0x21c78f(0x1c1)]||function(_0x7a0080,_0x3e44a3,_0x52f951,_0x164fa5){const _0x163ffc=_0x21c78f;var _0x41ffc9=arguments[_0x163ffc(0x1f0)],_0x7fae3a=_0x41ffc9<0x3?_0x3e44a3:_0x164fa5===null?_0x164fa5=Object[_0x163ffc(0x1c6)](_0x3e44a3,_0x52f951):_0x164fa5,_0x1f0c71;if(typeof Reflect==='object'&&typeof Reflect[_0x163ffc(0x1c7)]===_0x163ffc(0x1d4))_0x7fae3a=Reflect[_0x163ffc(0x1c7)](_0x7a0080,_0x3e44a3,_0x52f951,_0x164fa5);else{for(var _0x5d9cca=_0x7a0080[_0x163ffc(0x1f0)]-0x1;_0x5d9cca>=0x0;_0x5d9cca--)if(_0x1f0c71=_0x7a0080[_0x5d9cca])_0x7fae3a=(_0x41ffc9<0x3?_0x1f0c71(_0x7fae3a):_0x41ffc9>0x3?_0x1f0c71(_0x3e44a3,_0x52f951,_0x7fae3a):_0x1f0c71(_0x3e44a3,_0x52f951))||_0x7fae3a;}return _0x41ffc9>0x3&&_0x7fae3a&&Object['defineProperty'](_0x3e44a3,_0x52f951,_0x7fae3a),_0x7fae3a;},__metadata=this&&this[_0x21c78f(0x1e8)]||function(_0x3ce2d9,_0x3f352e){const _0xf58ef9=_0x21c78f;if(typeof Reflect==='object'&&typeof Reflect[_0xf58ef9(0x1df)]===_0xf58ef9(0x1d4))return Reflect[_0xf58ef9(0x1df)](_0x3ce2d9,_0x3f352e);},__param=this&&this['__param']||function(_0x59f13f,_0x44284a){return function(_0x3afca3,_0x248153){_0x44284a(_0x3afca3,_0x248153,_0x59f13f);};};Object['defineProperty'](exports,_0x21c78f(0x1cd),{'value':!![]}),exports[_0x21c78f(0x1d5)]=void 0x0;const common_1=require(_0x21c78f(0x1d2)),bull_1=require(_0x21c78f(0x1d1)),utils_1=require(_0x21c78f(0x1c2)),midjourney_service_1=require(_0x21c78f(0x1ec)),userBalance_service_1=require(_0x21c78f(0x1ce)),globalConfig_service_1=require(_0x21c78f(0x1d9));let QueueService=class QueueService{constructor(_0x439f80,_0x2a9889,_0x36a9e9,_0x3e5b89){const _0x478e79=_0x21c78f;this[_0x478e79(0x1cf)]=_0x439f80,this[_0x478e79(0x1ef)]=_0x2a9889,this[_0x478e79(0x1cc)]=_0x36a9e9,this[_0x478e79(0x1dd)]=_0x3e5b89,this[_0x478e79(0x1c5)]=[];}async['onApplicationBootstrap'](){const _0x10e6cd=_0x21c78f;await this[_0x10e6cd(0x1cf)]['clean'](0x0,_0x10e6cd(0x1e0)),await this['midjourneyService']['cleanQueue']();}async[_0x21c78f(0x1c4)](_0x5958e4,_0x1636ec){const _0x3e9a0f=_0x21c78f,{imgUrl:_0x39249e,orderId:_0x269c0a,action:_0x42679a,drawId:_0x509a24}=_0x5958e4;await this['midjourneyService'][_0x3e9a0f(0x1dc)](_0x1636ec),await this[_0x3e9a0f(0x1cc)]['validateBalance'](_0x1636ec,_0x3e9a0f(0x1d6),_0x42679a===_0x3e9a0f(0x1d0)?0x1:0x4);if(_0x42679a==='IMAGINE'){const _0x258260=''+(0x0,utils_1['createRandomUid'])(),_0x10bbd7=Object[_0x3e9a0f(0x1da)](Object['assign']({},_0x5958e4),{'userId':_0x1636ec[_0x3e9a0f(0x1ee)]['id'],'randomDrawId':_0x258260}),_0x161712=await this[_0x3e9a0f(0x1ef)]['addDrawQueue'](_0x10bbd7),_0x456f75=await this[_0x3e9a0f(0x1dd)][_0x3e9a0f(0x1e4)]([_0x3e9a0f(0x1ed)])||0x30d40,_0xd41a9a=await this['mjDrawQueue']['add'](_0x3e9a0f(0x1d6),{'id':_0x161712['id'],'action':_0x42679a,'userId':_0x1636ec['user']['id']},{'delay':0x3e8,'timeout':+_0x456f75});return this[_0x3e9a0f(0x1c5)][_0x3e9a0f(0x1c9)](_0xd41a9a['id']),!![];}else{const {orderId:_0x102662,action:_0x2552c8,drawId:_0x49ea84}=_0x5958e4,_0x11c991=await this[_0x3e9a0f(0x1ef)]['getDrawActionDetail'](_0x2552c8,_0x49ea84,_0x102662),_0x36efe7=Object[_0x3e9a0f(0x1da)](Object[_0x3e9a0f(0x1da)](Object[_0x3e9a0f(0x1da)]({},_0x5958e4),{'userId':_0x1636ec[_0x3e9a0f(0x1ee)]['id']}),_0x11c991),_0x2cbab6=await this['midjourneyService']['addDrawQueue'](_0x36efe7),_0x363eb0=await this[_0x3e9a0f(0x1dd)]['getConfigs'](['mjTimeoutMs'])||0x30d40,_0x59189a=await this[_0x3e9a0f(0x1cf)]['add'](_0x3e9a0f(0x1d6),{'id':_0x2cbab6['id'],'action':_0x2552c8,'userId':_0x1636ec[_0x3e9a0f(0x1ee)]['id']},{'delay':0x3e8,'timeout':+_0x363eb0});this[_0x3e9a0f(0x1c5)]['push'](_0x59189a['id']);return;}if(!_0x509a24||!_0x269c0a)throw new common_1[(_0x3e9a0f(0x1e3))](_0x3e9a0f(0x1d7),common_1['HttpStatus']['BAD_REQUEST']);}async['getQueue'](){return{'jobIds':this['jobIds']};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x21c78f(0x1d3)])(_0x21c78f(0x1de))),__metadata(_0x21c78f(0x1ea),[Object,midjourney_service_1['MidjourneyService'],userBalance_service_1[_0x21c78f(0x1c8)],globalConfig_service_1[_0x21c78f(0x1db)]])],QueueService),exports[_0x21c78f(0x1d5)]=QueueService;function _0x1bee(){const _0x1b330e=['globalConfigService','MJDRAW','metadata','active','77jcvFJZ','29391IUeDKk','HttpException','getConfigs','2553115TZHedy','10116PoKdoS','2816178YknXRQ','__metadata','8130zRuGWB','design:paramtypes','106DAbkFt','../midjourney/midjourney.service','mjTimeoutMs','user','midjourneyService','length','__decorate','../../common/utils','11433851dPUCFk','addMjDrawQueue','jobIds','getOwnPropertyDescriptor','decorate','UserBalanceService','push','380504ArnRQt','4103415IKxkXz','userBalanceService','__esModule','../userBalance/userBalance.service','mjDrawQueue','UPSCALE','@nestjs/bull','@nestjs/common','InjectQueue','function','QueueService','mjDraw','缺少必要参数！','4QDQXKN','../globalConfig/globalConfig.service','assign','GlobalConfigService','checkLimit'];_0x1bee=function(){return _0x1b330e;};return _0x1bee();}