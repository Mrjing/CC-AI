'use strict';function _0x35f0(_0x35ff1f,_0x22a9ab){const _0x249474=_0x2494();return _0x35f0=function(_0x35f0f6,_0x1ce9d4){_0x35f0f6=_0x35f0f6-0xcb;let _0x1d5352=_0x249474[_0x35f0f6];return _0x1d5352;},_0x35f0(_0x35ff1f,_0x22a9ab);}const _0x57d0d4=_0x35f0;(function(_0x3d21be,_0x3cd41e){const _0x4a48b7=_0x35f0,_0x5245ca=_0x3d21be();while(!![]){try{const _0x15e4cb=-parseInt(_0x4a48b7(0xed))/0x1+parseInt(_0x4a48b7(0xfa))/0x2*(-parseInt(_0x4a48b7(0xfc))/0x3)+parseInt(_0x4a48b7(0xe2))/0x4*(-parseInt(_0x4a48b7(0xf2))/0x5)+parseInt(_0x4a48b7(0xd9))/0x6*(parseInt(_0x4a48b7(0xf8))/0x7)+parseInt(_0x4a48b7(0xd1))/0x8*(-parseInt(_0x4a48b7(0xdc))/0x9)+parseInt(_0x4a48b7(0xec))/0xa*(parseInt(_0x4a48b7(0xd8))/0xb)+parseInt(_0x4a48b7(0xe3))/0xc*(parseInt(_0x4a48b7(0xd4))/0xd);if(_0x15e4cb===_0x3cd41e)break;else _0x5245ca['push'](_0x5245ca['shift']());}catch(_0x5d8513){_0x5245ca['push'](_0x5245ca['shift']());}}}(_0x2494,0x36788));function _0x2494(){const _0x32c6c8=['2955768pMNkMz','@nestjs/bull','user','13vDhKjN','createRandomUid','mjDrawQueue','push','11NYqabE','2380254AYMpFK','QueueService','defineProperty','9aevsKX','UPSCALE','active','getConfigs','getOwnPropertyDescriptor','design:paramtypes','4QHvYIr','5816604XrFFzv','__decorate','@nestjs/common','midjourneyService','validateBalance','MJDRAW','HttpStatus','onApplicationBootstrap','jobIds','3162180djRCjP','333728qcEPwc','cleanQueue','length','../userBalance/userBalance.service','function','89795SsEcjj','MidjourneyService','__esModule','mjTimeoutMs','GlobalConfigService','assign','7WaYWZt','mjDraw','253374ekLnOA','metadata','6NWETiH','checkLimit','addDrawQueue','UserBalanceService','__metadata','decorate','clean','../../common/utils','__param','object','globalConfigService'];_0x2494=function(){return _0x32c6c8;};return _0x2494();}var __decorate=this&&this[_0x57d0d4(0xe4)]||function(_0x4cc1bc,_0x1829c0,_0xda2dfa,_0x8c2209){const _0x1ee49f=_0x57d0d4;var _0x98e237=arguments[_0x1ee49f(0xef)],_0x18ba96=_0x98e237<0x3?_0x1829c0:_0x8c2209===null?_0x8c2209=Object[_0x1ee49f(0xe0)](_0x1829c0,_0xda2dfa):_0x8c2209,_0x257061;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1ee49f(0xf1))_0x18ba96=Reflect[_0x1ee49f(0xcb)](_0x4cc1bc,_0x1829c0,_0xda2dfa,_0x8c2209);else{for(var _0x195d38=_0x4cc1bc[_0x1ee49f(0xef)]-0x1;_0x195d38>=0x0;_0x195d38--)if(_0x257061=_0x4cc1bc[_0x195d38])_0x18ba96=(_0x98e237<0x3?_0x257061(_0x18ba96):_0x98e237>0x3?_0x257061(_0x1829c0,_0xda2dfa,_0x18ba96):_0x257061(_0x1829c0,_0xda2dfa))||_0x18ba96;}return _0x98e237>0x3&&_0x18ba96&&Object[_0x1ee49f(0xdb)](_0x1829c0,_0xda2dfa,_0x18ba96),_0x18ba96;},__metadata=this&&this[_0x57d0d4(0x100)]||function(_0x36f3d8,_0x149514){const _0x28afed=_0x57d0d4;if(typeof Reflect===_0x28afed(0xcf)&&typeof Reflect[_0x28afed(0xfb)]===_0x28afed(0xf1))return Reflect[_0x28afed(0xfb)](_0x36f3d8,_0x149514);},__param=this&&this[_0x57d0d4(0xce)]||function(_0x4eee20,_0x116e24){return function(_0x545d67,_0x38fd69){_0x116e24(_0x545d67,_0x38fd69,_0x4eee20);};};Object['defineProperty'](exports,_0x57d0d4(0xf4),{'value':!![]}),exports[_0x57d0d4(0xda)]=void 0x0;const common_1=require(_0x57d0d4(0xe5)),bull_1=require(_0x57d0d4(0xd2)),utils_1=require(_0x57d0d4(0xcd)),midjourney_service_1=require('../midjourney/midjourney.service'),userBalance_service_1=require(_0x57d0d4(0xf0)),globalConfig_service_1=require('../globalConfig/globalConfig.service');let QueueService=class QueueService{constructor(_0x50f550,_0x372d33,_0x556a46,_0x3e0b4b){const _0x4fbf2a=_0x57d0d4;this['mjDrawQueue']=_0x50f550,this[_0x4fbf2a(0xe6)]=_0x372d33,this['userBalanceService']=_0x556a46,this[_0x4fbf2a(0xd0)]=_0x3e0b4b,this[_0x4fbf2a(0xeb)]=[];}async[_0x57d0d4(0xea)](){const _0x1e153b=_0x57d0d4;await this[_0x1e153b(0xd6)][_0x1e153b(0xcc)](0x0,_0x1e153b(0xde)),await this[_0x1e153b(0xe6)][_0x1e153b(0xee)]();}async['addMjDrawQueue'](_0x2d81dd,_0x3e8ad7){const _0x1786f9=_0x57d0d4,{imgUrl:_0x355bb8,orderId:_0xf854f3,action:_0x8ca777,drawId:_0x2590e4}=_0x2d81dd;await this['midjourneyService'][_0x1786f9(0xfd)](_0x3e8ad7),await this['userBalanceService'][_0x1786f9(0xe7)](_0x3e8ad7,_0x1786f9(0xf9),_0x8ca777===_0x1786f9(0xdd)?0x1:0x4);if(_0x8ca777==='IMAGINE'){const _0x36b3e0=''+(0x0,utils_1[_0x1786f9(0xd5)])(),_0x183681=Object[_0x1786f9(0xf7)](Object[_0x1786f9(0xf7)]({},_0x2d81dd),{'userId':_0x3e8ad7[_0x1786f9(0xd3)]['id'],'randomDrawId':_0x36b3e0}),_0x2e8d1e=await this[_0x1786f9(0xe6)][_0x1786f9(0xfe)](_0x183681),_0x52ef4e=await this[_0x1786f9(0xd0)][_0x1786f9(0xdf)]([_0x1786f9(0xf5)])||0x30d40,_0x517c14=await this[_0x1786f9(0xd6)]['add']('mjDraw',{'id':_0x2e8d1e['id'],'action':_0x8ca777,'userId':_0x3e8ad7['user']['id']},{'delay':0x3e8,'timeout':+_0x52ef4e});return this['jobIds'][_0x1786f9(0xd7)](_0x517c14['id']),!![];}else{const {orderId:_0x2b7ef3,action:_0x97b1a9,drawId:_0x186a85}=_0x2d81dd,_0x4649fb=await this['midjourneyService']['getDrawActionDetail'](_0x97b1a9,_0x186a85,_0x2b7ef3),_0x380b5e=Object['assign'](Object[_0x1786f9(0xf7)](Object[_0x1786f9(0xf7)]({},_0x2d81dd),{'userId':_0x3e8ad7[_0x1786f9(0xd3)]['id']}),_0x4649fb),_0x2b2423=await this[_0x1786f9(0xe6)][_0x1786f9(0xfe)](_0x380b5e),_0x1d97fe=await this[_0x1786f9(0xd0)][_0x1786f9(0xdf)](['mjTimeoutMs'])||0x30d40,_0x211d68=await this[_0x1786f9(0xd6)]['add']('mjDraw',{'id':_0x2b2423['id'],'action':_0x97b1a9,'userId':_0x3e8ad7['user']['id']},{'delay':0x3e8,'timeout':+_0x1d97fe});this[_0x1786f9(0xeb)][_0x1786f9(0xd7)](_0x211d68['id']);return;}if(!_0x2590e4||!_0xf854f3)throw new common_1['HttpException']('缺少必要参数！',common_1[_0x1786f9(0xe9)]['BAD_REQUEST']);}async['getQueue'](){const _0x317cd4=_0x57d0d4;return{'jobIds':this[_0x317cd4(0xeb)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1['InjectQueue'])(_0x57d0d4(0xe8))),__metadata(_0x57d0d4(0xe1),[Object,midjourney_service_1[_0x57d0d4(0xf3)],userBalance_service_1[_0x57d0d4(0xff)],globalConfig_service_1[_0x57d0d4(0xf6)]])],QueueService),exports[_0x57d0d4(0xda)]=QueueService;