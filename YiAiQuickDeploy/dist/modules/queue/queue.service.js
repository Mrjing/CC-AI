'use strict';const _0x30cb81=_0x5321;(function(_0x11ffe6,_0x272bc9){const _0x10e06d=_0x5321,_0x44c9e4=_0x11ffe6();while(!![]){try{const _0x27eefe=parseInt(_0x10e06d(0x201))/0x1*(parseInt(_0x10e06d(0x20b))/0x2)+parseInt(_0x10e06d(0x213))/0x3+-parseInt(_0x10e06d(0x214))/0x4+-parseInt(_0x10e06d(0x205))/0x5*(-parseInt(_0x10e06d(0x212))/0x6)+parseInt(_0x10e06d(0x224))/0x7*(-parseInt(_0x10e06d(0x1f4))/0x8)+parseInt(_0x10e06d(0x207))/0x9*(parseInt(_0x10e06d(0x21b))/0xa)+-parseInt(_0x10e06d(0x228))/0xb;if(_0x27eefe===_0x272bc9)break;else _0x44c9e4['push'](_0x44c9e4['shift']());}catch(_0x5e48f1){_0x44c9e4['push'](_0x44c9e4['shift']());}}}(_0x465b,0x820e6));function _0x5321(_0x155a6f,_0x14345b){const _0x465b20=_0x465b();return _0x5321=function(_0x532149,_0x4161ea){_0x532149=_0x532149-0x1f4;let _0x4096cb=_0x465b20[_0x532149];return _0x4096cb;},_0x5321(_0x155a6f,_0x14345b);}var __decorate=this&&this[_0x30cb81(0x210)]||function(_0x452247,_0x3b1ade,_0x431aa8,_0x8cbfb4){const _0x36cc32=_0x30cb81;var _0x23983b=arguments[_0x36cc32(0x215)],_0xe81a4c=_0x23983b<0x3?_0x3b1ade:_0x8cbfb4===null?_0x8cbfb4=Object[_0x36cc32(0x21f)](_0x3b1ade,_0x431aa8):_0x8cbfb4,_0x2a5ade;if(typeof Reflect===_0x36cc32(0x20f)&&typeof Reflect['decorate']===_0x36cc32(0x1ff))_0xe81a4c=Reflect[_0x36cc32(0x202)](_0x452247,_0x3b1ade,_0x431aa8,_0x8cbfb4);else{for(var _0x3bd468=_0x452247[_0x36cc32(0x215)]-0x1;_0x3bd468>=0x0;_0x3bd468--)if(_0x2a5ade=_0x452247[_0x3bd468])_0xe81a4c=(_0x23983b<0x3?_0x2a5ade(_0xe81a4c):_0x23983b>0x3?_0x2a5ade(_0x3b1ade,_0x431aa8,_0xe81a4c):_0x2a5ade(_0x3b1ade,_0x431aa8))||_0xe81a4c;}return _0x23983b>0x3&&_0xe81a4c&&Object['defineProperty'](_0x3b1ade,_0x431aa8,_0xe81a4c),_0xe81a4c;},__metadata=this&&this['__metadata']||function(_0x2ba778,_0x3ea28e){const _0xb7ee6e=_0x30cb81;if(typeof Reflect==='object'&&typeof Reflect[_0xb7ee6e(0x200)]===_0xb7ee6e(0x1ff))return Reflect[_0xb7ee6e(0x200)](_0x2ba778,_0x3ea28e);},__param=this&&this[_0x30cb81(0x223)]||function(_0x4b64a3,_0xb3c06){return function(_0x488510,_0x2c4b86){_0xb3c06(_0x488510,_0x2c4b86,_0x4b64a3);};};function _0x465b(){const _0x3e482d=['assign','9908350IhHgTo','jobIds','createRandomUid','../globalConfig/globalConfig.service','getOwnPropertyDescriptor','mjDrawQueue','clean','addMjDrawQueue','__param','181601pDVNou','push','globalConfigService','midjourneyService','7929658XuZaKR','248XmKkjC','QueueService','缺少必要参数！','MidjourneyService','cleanQueue','HttpException','getConfigs','UPSCALE','userBalanceService','@nestjs/bull','@nestjs/common','function','metadata','3642XOkcnv','decorate','addDrawQueue','HttpStatus','20KWMCFM','UserBalanceService','9tEnPLA','defineProperty','IMAGINE','mjTimeoutMs','460IqkfLv','user','checkLimit','../userBalance/userBalance.service','object','__decorate','MJDRAW','924564qHOiru','1722474buXntF','3844832YBVFGQ','length','active','mjDraw','getDrawActionDetail','__esModule'];_0x465b=function(){return _0x3e482d;};return _0x465b();}Object[_0x30cb81(0x208)](exports,_0x30cb81(0x219),{'value':!![]}),exports[_0x30cb81(0x1f5)]=void 0x0;const common_1=require(_0x30cb81(0x1fe)),bull_1=require(_0x30cb81(0x1fd)),utils_1=require('../../common/utils'),midjourney_service_1=require('../midjourney/midjourney.service'),userBalance_service_1=require(_0x30cb81(0x20e)),globalConfig_service_1=require(_0x30cb81(0x21e));let QueueService=class QueueService{constructor(_0x43085a,_0x3afd42,_0x433180,_0x338b4d){const _0x212fe3=_0x30cb81;this[_0x212fe3(0x220)]=_0x43085a,this['midjourneyService']=_0x3afd42,this[_0x212fe3(0x1fc)]=_0x433180,this['globalConfigService']=_0x338b4d,this[_0x212fe3(0x21c)]=[];}async['onApplicationBootstrap'](){const _0x35c9d4=_0x30cb81;await this[_0x35c9d4(0x220)][_0x35c9d4(0x221)](0x0,_0x35c9d4(0x216)),await this['midjourneyService'][_0x35c9d4(0x1f8)]();}async[_0x30cb81(0x222)](_0x59b96d,_0x1163d7){const _0x3f92e5=_0x30cb81,{imgUrl:_0x1f5f47,orderId:_0x15e5f9,action:_0x45b233,drawId:_0x2ea161}=_0x59b96d;await this[_0x3f92e5(0x227)][_0x3f92e5(0x20d)](_0x1163d7),await this['userBalanceService']['validateBalance'](_0x1163d7,_0x3f92e5(0x217),_0x45b233===_0x3f92e5(0x1fb)?0x1:0x4);if(_0x45b233===_0x3f92e5(0x209)){const _0x1645f9=''+(0x0,utils_1[_0x3f92e5(0x21d)])(),_0x1f9ed6=Object[_0x3f92e5(0x21a)](Object[_0x3f92e5(0x21a)]({},_0x59b96d),{'userId':_0x1163d7['user']['id'],'randomDrawId':_0x1645f9}),_0x2f9dc5=await this[_0x3f92e5(0x227)]['addDrawQueue'](_0x1f9ed6),_0xb73848=await this[_0x3f92e5(0x226)][_0x3f92e5(0x1fa)]([_0x3f92e5(0x20a)])||0x30d40,_0x89e5af=await this[_0x3f92e5(0x220)]['add']('mjDraw',{'id':_0x2f9dc5['id'],'action':_0x45b233,'userId':_0x1163d7[_0x3f92e5(0x20c)]['id']},{'delay':0x3e8,'timeout':+_0xb73848});return this[_0x3f92e5(0x21c)]['push'](_0x89e5af['id']),!![];}else{const {orderId:_0x4e4c47,action:_0x47ce23,drawId:_0x1add6d}=_0x59b96d,_0x5d0df6=await this[_0x3f92e5(0x227)][_0x3f92e5(0x218)](_0x47ce23,_0x1add6d,_0x4e4c47),_0x14ac9d=Object[_0x3f92e5(0x21a)](Object[_0x3f92e5(0x21a)](Object['assign']({},_0x59b96d),{'userId':_0x1163d7[_0x3f92e5(0x20c)]['id']}),_0x5d0df6),_0x24da7c=await this[_0x3f92e5(0x227)][_0x3f92e5(0x203)](_0x14ac9d),_0x5f30d1=await this[_0x3f92e5(0x226)]['getConfigs'](['mjTimeoutMs'])||0x30d40,_0x5c6091=await this[_0x3f92e5(0x220)]['add'](_0x3f92e5(0x217),{'id':_0x24da7c['id'],'action':_0x47ce23,'userId':_0x1163d7[_0x3f92e5(0x20c)]['id']},{'delay':0x3e8,'timeout':+_0x5f30d1});this[_0x3f92e5(0x21c)][_0x3f92e5(0x225)](_0x5c6091['id']);return;}if(!_0x2ea161||!_0x15e5f9)throw new common_1[(_0x3f92e5(0x1f9))](_0x3f92e5(0x1f6),common_1[_0x3f92e5(0x204)]['BAD_REQUEST']);}async['getQueue'](){const _0x4f50da=_0x30cb81;return{'jobIds':this[_0x4f50da(0x21c)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1['InjectQueue'])(_0x30cb81(0x211))),__metadata('design:paramtypes',[Object,midjourney_service_1[_0x30cb81(0x1f7)],userBalance_service_1[_0x30cb81(0x206)],globalConfig_service_1['GlobalConfigService']])],QueueService),exports['QueueService']=QueueService;