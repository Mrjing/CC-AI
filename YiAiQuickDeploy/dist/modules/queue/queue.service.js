'use strict';const _0x1ffa31=_0x6bf1;function _0x15a2(){const _0x5046d7=['1146XGVfxr','cleanQueue','object','checkLimit','68196BVnBwR','@nestjs/bull','user','18wHOIya','mjDraw','jobIds','function','GlobalConfigService','HttpException','../../common/utils','validateBalance','InjectQueue','getQueue','IMAGINE','createRandomUid','1561436UKHjpC','mjDrawQueue','4105584XIDcml','UserBalanceService','push','midjourneyService','getDrawActionDetail','1udSpAU','MidjourneyService','getOwnPropertyDescriptor','addDrawQueue','175707mWQZwy','add','userBalanceService','assign','active','1255tRnEVz','../userBalance/userBalance.service','design:paramtypes','getConfigs','7400128rtJaeZ','onApplicationBootstrap','MJDRAW','globalConfigService','QueueService','UPSCALE','26692nvaNVh','HttpStatus','metadata','1749ERGgMr','defineProperty','__esModule','../midjourney/midjourney.service','clean','length','__param','mjTimeoutMs','330mpZOQS','__decorate'];_0x15a2=function(){return _0x5046d7;};return _0x15a2();}(function(_0x22c055,_0x3498cc){const _0x318806=_0x6bf1,_0x2d0a6f=_0x22c055();while(!![]){try{const _0xee35be=-parseInt(_0x318806(0xb9))/0x1*(-parseInt(_0x318806(0xb2))/0x2)+-parseInt(_0x318806(0xa6))/0x3*(-parseInt(_0x318806(0x92))/0x4)+parseInt(_0x318806(0xc2))/0x5*(-parseInt(_0x318806(0x9f))/0x6)+parseInt(_0x318806(0xb4))/0x7+-parseInt(_0x318806(0xc6))/0x8+parseInt(_0x318806(0xbd))/0x9*(-parseInt(_0x318806(0x9d))/0xa)+-parseInt(_0x318806(0x95))/0xb*(-parseInt(_0x318806(0xa3))/0xc);if(_0xee35be===_0x3498cc)break;else _0x2d0a6f['push'](_0x2d0a6f['shift']());}catch(_0x378240){_0x2d0a6f['push'](_0x2d0a6f['shift']());}}}(_0x15a2,0xa9591));function _0x6bf1(_0x417ba8,_0x211e72){const _0x15a263=_0x15a2();return _0x6bf1=function(_0x6bf1c2,_0x13e811){_0x6bf1c2=_0x6bf1c2-0x92;let _0x2c1f99=_0x15a263[_0x6bf1c2];return _0x2c1f99;},_0x6bf1(_0x417ba8,_0x211e72);}var __decorate=this&&this[_0x1ffa31(0x9e)]||function(_0x17a7b1,_0x4b7787,_0x3fa22f,_0x5cc388){const _0x487b99=_0x1ffa31;var _0xb92d5c=arguments[_0x487b99(0x9a)],_0x2e2418=_0xb92d5c<0x3?_0x4b7787:_0x5cc388===null?_0x5cc388=Object[_0x487b99(0xbb)](_0x4b7787,_0x3fa22f):_0x5cc388,_0x14abf8;if(typeof Reflect===_0x487b99(0xa1)&&typeof Reflect['decorate']===_0x487b99(0xa9))_0x2e2418=Reflect['decorate'](_0x17a7b1,_0x4b7787,_0x3fa22f,_0x5cc388);else{for(var _0x3660c4=_0x17a7b1['length']-0x1;_0x3660c4>=0x0;_0x3660c4--)if(_0x14abf8=_0x17a7b1[_0x3660c4])_0x2e2418=(_0xb92d5c<0x3?_0x14abf8(_0x2e2418):_0xb92d5c>0x3?_0x14abf8(_0x4b7787,_0x3fa22f,_0x2e2418):_0x14abf8(_0x4b7787,_0x3fa22f))||_0x2e2418;}return _0xb92d5c>0x3&&_0x2e2418&&Object[_0x487b99(0x96)](_0x4b7787,_0x3fa22f,_0x2e2418),_0x2e2418;},__metadata=this&&this['__metadata']||function(_0x1cbb18,_0x50c6b2){const _0x4ad8dd=_0x1ffa31;if(typeof Reflect===_0x4ad8dd(0xa1)&&typeof Reflect['metadata']===_0x4ad8dd(0xa9))return Reflect[_0x4ad8dd(0x94)](_0x1cbb18,_0x50c6b2);},__param=this&&this[_0x1ffa31(0x9b)]||function(_0x78f37e,_0xa7729e){return function(_0x4a37ce,_0x53f3a2){_0xa7729e(_0x4a37ce,_0x53f3a2,_0x78f37e);};};Object[_0x1ffa31(0x96)](exports,_0x1ffa31(0x97),{'value':!![]}),exports[_0x1ffa31(0xca)]=void 0x0;const common_1=require('@nestjs/common'),bull_1=require(_0x1ffa31(0xa4)),utils_1=require(_0x1ffa31(0xac)),midjourney_service_1=require(_0x1ffa31(0x98)),userBalance_service_1=require(_0x1ffa31(0xc3)),globalConfig_service_1=require('../globalConfig/globalConfig.service');let QueueService=class QueueService{constructor(_0xe11e9f,_0x4aa373,_0x43c9b1,_0x2b3a24){const _0x2ffee2=_0x1ffa31;this['mjDrawQueue']=_0xe11e9f,this[_0x2ffee2(0xb7)]=_0x4aa373,this[_0x2ffee2(0xbf)]=_0x43c9b1,this[_0x2ffee2(0xc9)]=_0x2b3a24,this[_0x2ffee2(0xa8)]=[];}async[_0x1ffa31(0xc7)](){const _0x48b96a=_0x1ffa31;await this[_0x48b96a(0xb3)][_0x48b96a(0x99)](0x0,_0x48b96a(0xc1)),await this[_0x48b96a(0xb7)][_0x48b96a(0xa0)]();}async['addMjDrawQueue'](_0x58c3b3,_0x51b117){const _0x1fb703=_0x1ffa31,{imgUrl:_0x18dc37,orderId:_0x4b91dd,action:_0x3420cc,drawId:_0x1c713a}=_0x58c3b3;await this[_0x1fb703(0xb7)][_0x1fb703(0xa2)](_0x51b117),await this[_0x1fb703(0xbf)][_0x1fb703(0xad)](_0x51b117,_0x1fb703(0xa7),_0x3420cc===_0x1fb703(0xcb)?0x1:0x4);if(_0x3420cc===_0x1fb703(0xb0)){const _0x593928=''+(0x0,utils_1[_0x1fb703(0xb1)])(),_0x455d54=Object['assign'](Object[_0x1fb703(0xc0)]({},_0x58c3b3),{'userId':_0x51b117[_0x1fb703(0xa5)]['id'],'randomDrawId':_0x593928}),_0x59acd5=await this[_0x1fb703(0xb7)][_0x1fb703(0xbc)](_0x455d54),_0x5dfdb3=await this[_0x1fb703(0xc9)][_0x1fb703(0xc5)]([_0x1fb703(0x9c)])||0x30d40,_0x145b8b=await this[_0x1fb703(0xb3)][_0x1fb703(0xbe)](_0x1fb703(0xa7),{'id':_0x59acd5['id'],'action':_0x3420cc,'userId':_0x51b117['user']['id']},{'delay':0x3e8,'timeout':+_0x5dfdb3});return this[_0x1fb703(0xa8)][_0x1fb703(0xb6)](_0x145b8b['id']),!![];}else{const {orderId:_0x40b7b3,action:_0x5494fe,drawId:_0xdd357b}=_0x58c3b3,_0x476fd5=await this[_0x1fb703(0xb7)][_0x1fb703(0xb8)](_0x5494fe,_0xdd357b,_0x40b7b3),_0x40f833=Object[_0x1fb703(0xc0)](Object[_0x1fb703(0xc0)](Object['assign']({},_0x58c3b3),{'userId':_0x51b117[_0x1fb703(0xa5)]['id']}),_0x476fd5),_0x12cd5d=await this['midjourneyService'][_0x1fb703(0xbc)](_0x40f833),_0x3bd788=await this[_0x1fb703(0xc9)][_0x1fb703(0xc5)]([_0x1fb703(0x9c)])||0x30d40,_0x54c43f=await this[_0x1fb703(0xb3)][_0x1fb703(0xbe)](_0x1fb703(0xa7),{'id':_0x12cd5d['id'],'action':_0x5494fe,'userId':_0x51b117[_0x1fb703(0xa5)]['id']},{'delay':0x3e8,'timeout':+_0x3bd788});this['jobIds'][_0x1fb703(0xb6)](_0x54c43f['id']);return;}if(!_0x1c713a||!_0x4b91dd)throw new common_1[(_0x1fb703(0xab))]('缺少必要参数！',common_1[_0x1fb703(0x93)]['BAD_REQUEST']);}async[_0x1ffa31(0xaf)](){const _0x577aad=_0x1ffa31;return{'jobIds':this[_0x577aad(0xa8)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x1ffa31(0xae)])(_0x1ffa31(0xc8))),__metadata(_0x1ffa31(0xc4),[Object,midjourney_service_1[_0x1ffa31(0xba)],userBalance_service_1[_0x1ffa31(0xb5)],globalConfig_service_1[_0x1ffa31(0xaa)]])],QueueService),exports['QueueService']=QueueService;