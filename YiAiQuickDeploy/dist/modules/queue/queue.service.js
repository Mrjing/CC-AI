'use strict';const _0x5a8a4a=_0xe2a5;(function(_0x18bf72,_0x484f14){const _0xc87e83=_0xe2a5,_0x630dc=_0x18bf72();while(!![]){try{const _0x36b523=parseInt(_0xc87e83(0x10d))/0x1+parseInt(_0xc87e83(0xff))/0x2*(-parseInt(_0xc87e83(0xf7))/0x3)+parseInt(_0xc87e83(0x113))/0x4+-parseInt(_0xc87e83(0xfe))/0x5*(parseInt(_0xc87e83(0xfb))/0x6)+parseInt(_0xc87e83(0xf3))/0x7*(-parseInt(_0xc87e83(0xed))/0x8)+parseInt(_0xc87e83(0xf1))/0x9*(-parseInt(_0xc87e83(0x115))/0xa)+parseInt(_0xc87e83(0x114))/0xb;if(_0x36b523===_0x484f14)break;else _0x630dc['push'](_0x630dc['shift']());}catch(_0x3cb660){_0x630dc['push'](_0x630dc['shift']());}}}(_0x9441,0x5bef5));var __decorate=this&&this['__decorate']||function(_0x1e73c1,_0x1bde25,_0x57bcae,_0x9d061d){const _0x14d0f0=_0xe2a5;var _0x30c93d=arguments[_0x14d0f0(0xf5)],_0x345945=_0x30c93d<0x3?_0x1bde25:_0x9d061d===null?_0x9d061d=Object['getOwnPropertyDescriptor'](_0x1bde25,_0x57bcae):_0x9d061d,_0x53d287;if(typeof Reflect==='object'&&typeof Reflect[_0x14d0f0(0x101)]===_0x14d0f0(0x103))_0x345945=Reflect[_0x14d0f0(0x101)](_0x1e73c1,_0x1bde25,_0x57bcae,_0x9d061d);else{for(var _0x593702=_0x1e73c1[_0x14d0f0(0xf5)]-0x1;_0x593702>=0x0;_0x593702--)if(_0x53d287=_0x1e73c1[_0x593702])_0x345945=(_0x30c93d<0x3?_0x53d287(_0x345945):_0x30c93d>0x3?_0x53d287(_0x1bde25,_0x57bcae,_0x345945):_0x53d287(_0x1bde25,_0x57bcae))||_0x345945;}return _0x30c93d>0x3&&_0x345945&&Object['defineProperty'](_0x1bde25,_0x57bcae,_0x345945),_0x345945;},__metadata=this&&this[_0x5a8a4a(0xf0)]||function(_0x3fde86,_0x38d4c9){const _0x2cb923=_0x5a8a4a;if(typeof Reflect==='object'&&typeof Reflect[_0x2cb923(0x10c)]==='function')return Reflect[_0x2cb923(0x10c)](_0x3fde86,_0x38d4c9);},__param=this&&this[_0x5a8a4a(0x112)]||function(_0x112024,_0x3cee49){return function(_0x512833,_0x524529){_0x3cee49(_0x512833,_0x524529,_0x112024);};};Object[_0x5a8a4a(0xee)](exports,_0x5a8a4a(0x102),{'value':!![]}),exports['QueueService']=void 0x0;const common_1=require(_0x5a8a4a(0x116)),bull_1=require('@nestjs/bull'),utils_1=require(_0x5a8a4a(0xec)),midjourney_service_1=require('../midjourney/midjourney.service'),userBalance_service_1=require('../userBalance/userBalance.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service');function _0xe2a5(_0x1f1cc8,_0xbf54fe){const _0x944193=_0x9441();return _0xe2a5=function(_0xe2a5f8,_0x21171b){_0xe2a5f8=_0xe2a5f8-0xe8;let _0x4e97ca=_0x944193[_0xe2a5f8];return _0x4e97ca;},_0xe2a5(_0x1f1cc8,_0xbf54fe);}function _0x9441(){const _0x115238=['assign','getConfigs','addMjDrawQueue','__param','1311412qMMKuB','20072074IbERlB','4631890fcPvHE','@nestjs/common','HttpStatus','push','midjourneyService','getQueue','onApplicationBootstrap','InjectQueue','mjTimeoutMs','../../common/utils','67296omtRxc','defineProperty','mjDrawQueue','__metadata','9odmfPS','IMAGINE','497rrEvlu','createRandomUid','length','getDrawActionDetail','6bljzAA','add','addDrawQueue','validateBalance','87198CFSCHl','GlobalConfigService','globalConfigService','185IdgPhl','438398ZuzgUQ','HttpException','decorate','__esModule','function','jobIds','MJDRAW','clean','UPSCALE','userBalanceService','mjDraw','user','design:paramtypes','metadata','260538qJfRYX','QueueService'];_0x9441=function(){return _0x115238;};return _0x9441();}let QueueService=class QueueService{constructor(_0x2c9536,_0x1530a0,_0xbe3119,_0x4ac4a3){const _0x1dbc0f=_0x5a8a4a;this['mjDrawQueue']=_0x2c9536,this[_0x1dbc0f(0x119)]=_0x1530a0,this[_0x1dbc0f(0x108)]=_0xbe3119,this['globalConfigService']=_0x4ac4a3,this[_0x1dbc0f(0x104)]=[];}async[_0x5a8a4a(0xe9)](){const _0x502339=_0x5a8a4a;await this['mjDrawQueue'][_0x502339(0x106)](0x0,'active'),await this[_0x502339(0x119)]['cleanQueue']();}async[_0x5a8a4a(0x111)](_0xfd2ac1,_0x37eb59){const _0x4a09e0=_0x5a8a4a,{imgUrl:_0x156397,orderId:_0x565f71,action:_0x48ecdf,drawId:_0x93a5a4}=_0xfd2ac1;await this[_0x4a09e0(0x119)]['checkLimit'](_0x37eb59),await this[_0x4a09e0(0x108)][_0x4a09e0(0xfa)](_0x37eb59,_0x4a09e0(0x109),_0x48ecdf===_0x4a09e0(0x107)?0x1:0x4);if(_0x48ecdf===_0x4a09e0(0xf2)){const _0x50b8e7=''+(0x0,utils_1[_0x4a09e0(0xf4)])(),_0x2fcd24=Object[_0x4a09e0(0x10f)](Object[_0x4a09e0(0x10f)]({},_0xfd2ac1),{'userId':_0x37eb59[_0x4a09e0(0x10a)]['id'],'randomDrawId':_0x50b8e7}),_0x26ad9c=await this[_0x4a09e0(0x119)][_0x4a09e0(0xf9)](_0x2fcd24),_0x139ae1=await this[_0x4a09e0(0xfd)][_0x4a09e0(0x110)]([_0x4a09e0(0xeb)])||0x30d40,_0x3f8fa8=await this[_0x4a09e0(0xef)][_0x4a09e0(0xf8)]('mjDraw',{'id':_0x26ad9c['id'],'action':_0x48ecdf,'userId':_0x37eb59[_0x4a09e0(0x10a)]['id']},{'delay':0x3e8,'timeout':+_0x139ae1});return this[_0x4a09e0(0x104)][_0x4a09e0(0x118)](_0x3f8fa8['id']),!![];}else{const {orderId:_0x3b9261,action:_0x33f97a,drawId:_0x391567}=_0xfd2ac1,_0x46788e=await this[_0x4a09e0(0x119)][_0x4a09e0(0xf6)](_0x33f97a,_0x391567,_0x3b9261),_0x59a5af=Object[_0x4a09e0(0x10f)](Object['assign'](Object['assign']({},_0xfd2ac1),{'userId':_0x37eb59['user']['id']}),_0x46788e),_0x1e77e8=await this[_0x4a09e0(0x119)][_0x4a09e0(0xf9)](_0x59a5af),_0x4b1dc2=await this[_0x4a09e0(0xfd)][_0x4a09e0(0x110)]([_0x4a09e0(0xeb)])||0x30d40,_0x4dc8a3=await this[_0x4a09e0(0xef)][_0x4a09e0(0xf8)]('mjDraw',{'id':_0x1e77e8['id'],'action':_0x33f97a,'userId':_0x37eb59[_0x4a09e0(0x10a)]['id']},{'delay':0x3e8,'timeout':+_0x4b1dc2});this[_0x4a09e0(0x104)]['push'](_0x4dc8a3['id']);return;}if(!_0x93a5a4||!_0x565f71)throw new common_1[(_0x4a09e0(0x100))]('缺少必要参数！',common_1[_0x4a09e0(0x117)]['BAD_REQUEST']);}async[_0x5a8a4a(0xe8)](){return{'jobIds':this['jobIds']};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x5a8a4a(0xea)])(_0x5a8a4a(0x105))),__metadata(_0x5a8a4a(0x10b),[Object,midjourney_service_1['MidjourneyService'],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x5a8a4a(0xfc)]])],QueueService),exports[_0x5a8a4a(0x10e)]=QueueService;