'use strict';const _0x552541=_0x29c7;(function(_0x56404e,_0xcbe596){const _0x4a1a61=_0x29c7,_0x21fa5f=_0x56404e();while(!![]){try{const _0x2a028d=-parseInt(_0x4a1a61(0xa2))/0x1+parseInt(_0x4a1a61(0xb6))/0x2+parseInt(_0x4a1a61(0x82))/0x3+-parseInt(_0x4a1a61(0x8b))/0x4*(-parseInt(_0x4a1a61(0xb9))/0x5)+parseInt(_0x4a1a61(0xb3))/0x6+parseInt(_0x4a1a61(0xa5))/0x7*(parseInt(_0x4a1a61(0xaf))/0x8)+-parseInt(_0x4a1a61(0x96))/0x9*(parseInt(_0x4a1a61(0x8a))/0xa);if(_0x2a028d===_0xcbe596)break;else _0x21fa5f['push'](_0x21fa5f['shift']());}catch(_0x2f247b){_0x21fa5f['push'](_0x21fa5f['shift']());}}}(_0x33ab,0x8c14d));var __decorate=this&&this[_0x552541(0x87)]||function(_0xc0658d,_0x138ae1,_0x390f83,_0xdfbbaa){const _0x2178a4=_0x552541;var _0x55b7d0=arguments[_0x2178a4(0x8e)],_0xbd9bae=_0x55b7d0<0x3?_0x138ae1:_0xdfbbaa===null?_0xdfbbaa=Object['getOwnPropertyDescriptor'](_0x138ae1,_0x390f83):_0xdfbbaa,_0x28f888;if(typeof Reflect===_0x2178a4(0xb0)&&typeof Reflect[_0x2178a4(0x9c)]===_0x2178a4(0xa0))_0xbd9bae=Reflect['decorate'](_0xc0658d,_0x138ae1,_0x390f83,_0xdfbbaa);else{for(var _0x5a3dfb=_0xc0658d[_0x2178a4(0x8e)]-0x1;_0x5a3dfb>=0x0;_0x5a3dfb--)if(_0x28f888=_0xc0658d[_0x5a3dfb])_0xbd9bae=(_0x55b7d0<0x3?_0x28f888(_0xbd9bae):_0x55b7d0>0x3?_0x28f888(_0x138ae1,_0x390f83,_0xbd9bae):_0x28f888(_0x138ae1,_0x390f83))||_0xbd9bae;}return _0x55b7d0>0x3&&_0xbd9bae&&Object['defineProperty'](_0x138ae1,_0x390f83,_0xbd9bae),_0xbd9bae;},__metadata=this&&this[_0x552541(0x89)]||function(_0x1c63b0,_0x1dfbba){const _0x52d516=_0x552541;if(typeof Reflect===_0x52d516(0xb0)&&typeof Reflect[_0x52d516(0x95)]==='function')return Reflect[_0x52d516(0x95)](_0x1c63b0,_0x1dfbba);},__param=this&&this['__param']||function(_0x3d3130,_0x2b8875){return function(_0x2893dd,_0x5df112){_0x2b8875(_0x2893dd,_0x5df112,_0x3d3130);};};function _0x29c7(_0x42805b,_0x2e9180){const _0x33ab0e=_0x33ab();return _0x29c7=function(_0x29c7c8,_0x2e53f5){_0x29c7c8=_0x29c7c8-0x82;let _0x5e55c7=_0x33ab0e[_0x29c7c8];return _0x5e55c7;},_0x29c7(_0x42805b,_0x2e9180);}Object[_0x552541(0xb7)](exports,_0x552541(0xab),{'value':!![]}),exports[_0x552541(0xba)]=void 0x0;const common_1=require(_0x552541(0xa9)),bull_1=require(_0x552541(0x94)),utils_1=require('../../common/utils'),midjourney_service_1=require(_0x552541(0x86)),userBalance_service_1=require(_0x552541(0x8f)),globalConfig_service_1=require(_0x552541(0x91));let QueueService=class QueueService{constructor(_0x505d8e,_0x18b726,_0x1940c1,_0x203a03){const _0x2143a8=_0x552541;this[_0x2143a8(0x9f)]=_0x505d8e,this[_0x2143a8(0x9a)]=_0x18b726,this[_0x2143a8(0x83)]=_0x1940c1,this[_0x2143a8(0xac)]=_0x203a03,this[_0x2143a8(0xaa)]=[];}async['onApplicationBootstrap'](){const _0x4ba587=_0x552541;await this['mjDrawQueue'][_0x4ba587(0xa8)](0x0,_0x4ba587(0x84)),await this['midjourneyService'][_0x4ba587(0x9d)]();}async[_0x552541(0x99)](_0x483e65,_0x1353fa){const _0x51bb6b=_0x552541,{imgUrl:_0x17f5af,orderId:_0x74803f,action:_0x2775e7,drawId:_0x2d32e6}=_0x483e65;await this[_0x51bb6b(0x9a)][_0x51bb6b(0x85)](_0x1353fa),await this['userBalanceService'][_0x51bb6b(0xb8)](_0x1353fa,_0x51bb6b(0x8c),_0x2775e7===_0x51bb6b(0x8d)?0x1:0x4);if(_0x2775e7===_0x51bb6b(0x90)){const _0x4f0012=''+(0x0,utils_1[_0x51bb6b(0xa1)])(),_0x238c7c=Object[_0x51bb6b(0x93)](Object[_0x51bb6b(0x93)]({},_0x483e65),{'userId':_0x1353fa[_0x51bb6b(0xa6)]['id'],'randomDrawId':_0x4f0012}),_0x45ae23=await this[_0x51bb6b(0x9a)][_0x51bb6b(0xb2)](_0x238c7c),_0x49c51e=await this[_0x51bb6b(0xac)]['getConfigs']([_0x51bb6b(0x9b)])||0x30d40,_0x151d84=await this[_0x51bb6b(0x9f)][_0x51bb6b(0xa7)](_0x51bb6b(0x8c),{'id':_0x45ae23['id'],'action':_0x2775e7,'userId':_0x1353fa[_0x51bb6b(0xa6)]['id']},{'delay':0x3e8,'timeout':+_0x49c51e});return this[_0x51bb6b(0xaa)][_0x51bb6b(0xb4)](_0x151d84['id']),!![];}else{const {orderId:_0x30cf9e,action:_0x337d5c,drawId:_0x50a491}=_0x483e65,_0x2fb28b=await this[_0x51bb6b(0x9a)][_0x51bb6b(0xa4)](_0x337d5c,_0x50a491,_0x30cf9e),_0x52d1fc=Object['assign'](Object[_0x51bb6b(0x93)](Object[_0x51bb6b(0x93)]({},_0x483e65),{'userId':_0x1353fa['user']['id']}),_0x2fb28b),_0x2f0f41=await this[_0x51bb6b(0x9a)]['addDrawQueue'](_0x52d1fc),_0x10c71f=await this[_0x51bb6b(0xac)][_0x51bb6b(0x88)]([_0x51bb6b(0x9b)])||0x30d40,_0x50db34=await this[_0x51bb6b(0x9f)][_0x51bb6b(0xa7)](_0x51bb6b(0x8c),{'id':_0x2f0f41['id'],'action':_0x337d5c,'userId':_0x1353fa['user']['id']},{'delay':0x3e8,'timeout':+_0x10c71f});this['jobIds'][_0x51bb6b(0xb4)](_0x50db34['id']);return;}if(!_0x2d32e6||!_0x74803f)throw new common_1[(_0x51bb6b(0xae))](_0x51bb6b(0x98),common_1[_0x51bb6b(0xb1)][_0x51bb6b(0xb5)]);}async['getQueue'](){const _0xda9faa=_0x552541;return{'jobIds':this[_0xda9faa(0xaa)]};}};function _0x33ab(){const _0x38ec1f=['缺少必要参数！','addMjDrawQueue','midjourneyService','mjTimeoutMs','decorate','cleanQueue','InjectQueue','mjDrawQueue','function','createRandomUid','751461JdRKWj','UserBalanceService','getDrawActionDetail','3120292IIswBw','user','add','clean','@nestjs/common','jobIds','__esModule','globalConfigService','MJDRAW','HttpException','8UNIyZM','object','HttpStatus','addDrawQueue','1411746Xrmsic','push','BAD_REQUEST','1012268veVpJs','defineProperty','validateBalance','80NpvuLr','QueueService','2991009NbAUCS','userBalanceService','active','checkLimit','../midjourney/midjourney.service','__decorate','getConfigs','__metadata','513510lgLsUN','119044kFSncn','mjDraw','UPSCALE','length','../userBalance/userBalance.service','IMAGINE','../globalConfig/globalConfig.service','MidjourneyService','assign','@nestjs/bull','metadata','234geTjDU','design:paramtypes'];_0x33ab=function(){return _0x38ec1f;};return _0x33ab();}QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x552541(0x9e)])(_0x552541(0xad))),__metadata(_0x552541(0x97),[Object,midjourney_service_1[_0x552541(0x92)],userBalance_service_1[_0x552541(0xa3)],globalConfig_service_1['GlobalConfigService']])],QueueService),exports[_0x552541(0xba)]=QueueService;