'use strict';const _0x1c7427=_0x2407;(function(_0x4a7a54,_0x1bb3aa){const _0x2b1359=_0x2407,_0x52a6e6=_0x4a7a54();while(!![]){try{const _0x11f52d=-parseInt(_0x2b1359(0xd1))/0x1+-parseInt(_0x2b1359(0xb1))/0x2+-parseInt(_0x2b1359(0xe2))/0x3+-parseInt(_0x2b1359(0xd3))/0x4*(parseInt(_0x2b1359(0xdb))/0x5)+parseInt(_0x2b1359(0xcc))/0x6+parseInt(_0x2b1359(0xb9))/0x7*(parseInt(_0x2b1359(0xda))/0x8)+parseInt(_0x2b1359(0xd5))/0x9;if(_0x11f52d===_0x1bb3aa)break;else _0x52a6e6['push'](_0x52a6e6['shift']());}catch(_0x2ccdbc){_0x52a6e6['push'](_0x52a6e6['shift']());}}}(_0x32da,0x2ab6b));function _0x32da(){const _0xfdbcd6=['BAD_REQUEST','837924UUDbTk','MJDRAW','__metadata','clean','518900otqgUO','缺少必要参数！','QueueService','__param','IMAGINE','add','cleanQueue','../globalConfig/globalConfig.service','65639wAuWwS','createRandomUid','validateBalance','metadata','user','globalConfigService','object','function','push','__decorate','userBalanceService','midjourneyService','getConfigs','mjDrawQueue','jobIds','mjTimeoutMs','defineProperty','length','getDrawActionDetail','245628NyroRN','InjectQueue','MidjourneyService','UPSCALE','getOwnPropertyDescriptor','146934laWJDP','assign','988uuUwFk','design:paramtypes','8354250vZNxsp','UserBalanceService','GlobalConfigService','addDrawQueue','checkLimit','96OQMEgR','4475CUcBhV','addMjDrawQueue','getQueue','decorate','mjDraw','HttpException'];_0x32da=function(){return _0xfdbcd6;};return _0x32da();}function _0x2407(_0x590fbd,_0x4e4288){const _0x32dab6=_0x32da();return _0x2407=function(_0x2407a3,_0x3d433d){_0x2407a3=_0x2407a3-0xaf;let _0x569f63=_0x32dab6[_0x2407a3];return _0x569f63;},_0x2407(_0x590fbd,_0x4e4288);}var __decorate=this&&this[_0x1c7427(0xc2)]||function(_0x5e00fd,_0x484a04,_0x12e223,_0x6fc845){const _0x3db3be=_0x1c7427;var _0x1780e2=arguments['length'],_0xf9df98=_0x1780e2<0x3?_0x484a04:_0x6fc845===null?_0x6fc845=Object[_0x3db3be(0xd0)](_0x484a04,_0x12e223):_0x6fc845,_0x23a631;if(typeof Reflect===_0x3db3be(0xbf)&&typeof Reflect[_0x3db3be(0xde)]===_0x3db3be(0xc0))_0xf9df98=Reflect[_0x3db3be(0xde)](_0x5e00fd,_0x484a04,_0x12e223,_0x6fc845);else{for(var _0x46c6de=_0x5e00fd[_0x3db3be(0xca)]-0x1;_0x46c6de>=0x0;_0x46c6de--)if(_0x23a631=_0x5e00fd[_0x46c6de])_0xf9df98=(_0x1780e2<0x3?_0x23a631(_0xf9df98):_0x1780e2>0x3?_0x23a631(_0x484a04,_0x12e223,_0xf9df98):_0x23a631(_0x484a04,_0x12e223))||_0xf9df98;}return _0x1780e2>0x3&&_0xf9df98&&Object[_0x3db3be(0xc9)](_0x484a04,_0x12e223,_0xf9df98),_0xf9df98;},__metadata=this&&this[_0x1c7427(0xaf)]||function(_0x4c321f,_0x16620d){const _0x5de083=_0x1c7427;if(typeof Reflect===_0x5de083(0xbf)&&typeof Reflect[_0x5de083(0xbc)]==='function')return Reflect[_0x5de083(0xbc)](_0x4c321f,_0x16620d);},__param=this&&this[_0x1c7427(0xb4)]||function(_0x51be98,_0x1ec310){return function(_0x1553c2,_0x425f23){_0x1ec310(_0x1553c2,_0x425f23,_0x51be98);};};Object[_0x1c7427(0xc9)](exports,'__esModule',{'value':!![]}),exports['QueueService']=void 0x0;const common_1=require('@nestjs/common'),bull_1=require('@nestjs/bull'),utils_1=require('../../common/utils'),midjourney_service_1=require('../midjourney/midjourney.service'),userBalance_service_1=require('../userBalance/userBalance.service'),globalConfig_service_1=require(_0x1c7427(0xb8));let QueueService=class QueueService{constructor(_0x364a91,_0x2a7374,_0x13c78b,_0x2622ba){const _0x29eb4b=_0x1c7427;this[_0x29eb4b(0xc6)]=_0x364a91,this[_0x29eb4b(0xc4)]=_0x2a7374,this[_0x29eb4b(0xc3)]=_0x13c78b,this[_0x29eb4b(0xbe)]=_0x2622ba,this[_0x29eb4b(0xc7)]=[];}async['onApplicationBootstrap'](){const _0x5255fd=_0x1c7427;await this[_0x5255fd(0xc6)][_0x5255fd(0xb0)](0x0,'active'),await this[_0x5255fd(0xc4)][_0x5255fd(0xb7)]();}async[_0x1c7427(0xdc)](_0x15223b,_0xc76184){const _0x4d85d3=_0x1c7427,{imgUrl:_0x519fb9,orderId:_0x2134e4,action:_0x4037c1,drawId:_0x2ec052}=_0x15223b;await this['midjourneyService'][_0x4d85d3(0xd9)](_0xc76184),await this[_0x4d85d3(0xc3)][_0x4d85d3(0xbb)](_0xc76184,'mjDraw',_0x4037c1===_0x4d85d3(0xcf)?0x1:0x4);if(_0x4037c1===_0x4d85d3(0xb5)){const _0x26afbf=''+(0x0,utils_1[_0x4d85d3(0xba)])(),_0x2ea4f6=Object['assign'](Object[_0x4d85d3(0xd2)]({},_0x15223b),{'userId':_0xc76184[_0x4d85d3(0xbd)]['id'],'randomDrawId':_0x26afbf}),_0x394535=await this[_0x4d85d3(0xc4)][_0x4d85d3(0xd8)](_0x2ea4f6),_0x2de764=await this[_0x4d85d3(0xbe)][_0x4d85d3(0xc5)](['mjTimeoutMs'])||0x30d40,_0xf27165=await this[_0x4d85d3(0xc6)][_0x4d85d3(0xb6)](_0x4d85d3(0xdf),{'id':_0x394535['id'],'action':_0x4037c1,'userId':_0xc76184[_0x4d85d3(0xbd)]['id']},{'delay':0x3e8,'timeout':+_0x2de764});return this[_0x4d85d3(0xc7)][_0x4d85d3(0xc1)](_0xf27165['id']),!![];}else{const {orderId:_0x516619,action:_0x27ca71,drawId:_0x37478c}=_0x15223b,_0x2093f4=await this['midjourneyService'][_0x4d85d3(0xcb)](_0x27ca71,_0x37478c,_0x516619),_0x57061d=Object['assign'](Object[_0x4d85d3(0xd2)](Object['assign']({},_0x15223b),{'userId':_0xc76184[_0x4d85d3(0xbd)]['id']}),_0x2093f4),_0x1c9622=await this['midjourneyService'][_0x4d85d3(0xd8)](_0x57061d),_0x356745=await this[_0x4d85d3(0xbe)][_0x4d85d3(0xc5)]([_0x4d85d3(0xc8)])||0x30d40,_0x31723d=await this[_0x4d85d3(0xc6)]['add'](_0x4d85d3(0xdf),{'id':_0x1c9622['id'],'action':_0x27ca71,'userId':_0xc76184[_0x4d85d3(0xbd)]['id']},{'delay':0x3e8,'timeout':+_0x356745});this[_0x4d85d3(0xc7)][_0x4d85d3(0xc1)](_0x31723d['id']);return;}if(!_0x2ec052||!_0x2134e4)throw new common_1[(_0x4d85d3(0xe0))](_0x4d85d3(0xb2),common_1['HttpStatus'][_0x4d85d3(0xe1)]);}async[_0x1c7427(0xdd)](){const _0x1fde2c=_0x1c7427;return{'jobIds':this[_0x1fde2c(0xc7)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x1c7427(0xcd)])(_0x1c7427(0xe3))),__metadata(_0x1c7427(0xd4),[Object,midjourney_service_1[_0x1c7427(0xce)],userBalance_service_1[_0x1c7427(0xd6)],globalConfig_service_1[_0x1c7427(0xd7)]])],QueueService),exports[_0x1c7427(0xb3)]=QueueService;