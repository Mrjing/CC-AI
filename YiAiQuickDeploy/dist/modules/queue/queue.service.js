'use strict';function _0x4f81(_0x519428,_0x38340b){const _0x1be3db=_0x1be3();return _0x4f81=function(_0x4f8116,_0x5a5fec){_0x4f8116=_0x4f8116-0xa1;let _0x53694e=_0x1be3db[_0x4f8116];return _0x53694e;},_0x4f81(_0x519428,_0x38340b);}const _0x38c718=_0x4f81;(function(_0x325408,_0x5080dc){const _0x4a8d93=_0x4f81,_0x2b2405=_0x325408();while(!![]){try{const _0x1eec7e=-parseInt(_0x4a8d93(0xa8))/0x1*(-parseInt(_0x4a8d93(0xa9))/0x2)+parseInt(_0x4a8d93(0xac))/0x3+parseInt(_0x4a8d93(0xd4))/0x4+parseInt(_0x4a8d93(0xd9))/0x5+-parseInt(_0x4a8d93(0xb0))/0x6+-parseInt(_0x4a8d93(0xb4))/0x7*(parseInt(_0x4a8d93(0xcf))/0x8)+parseInt(_0x4a8d93(0xa2))/0x9;if(_0x1eec7e===_0x5080dc)break;else _0x2b2405['push'](_0x2b2405['shift']());}catch(_0x3c75e7){_0x2b2405['push'](_0x2b2405['shift']());}}}(_0x1be3,0xcee91));function _0x1be3(){const _0x169b68=['add','addMjDrawQueue','9187416sZzYVR','BAD_REQUEST','object','defineProperty','112jzYkBA','midjourneyService','globalConfigService','push','checkLimit','function','QueueService','active','../userBalance/userBalance.service','UPSCALE','userBalanceService','addDrawQueue','GlobalConfigService','user','decorate','MidjourneyService','UserBalanceService','../midjourney/midjourney.service','HttpStatus','validateBalance','IMAGINE','clean','createRandomUid','onApplicationBootstrap','@nestjs/bull','jobIds','@nestjs/common','343112GYcUhk','InjectQueue','__param','getDrawActionDetail','getOwnPropertyDescriptor','846612KUDImX','../globalConfig/globalConfig.service','__metadata','../../common/utils','assign','7753985cmORuB','length','804285MQnXCb','HttpException','getConfigs','__esModule','mjDrawQueue','mjTimeoutMs','6533hRWjoE','130ZQghre','__decorate','mjDraw','2365515ikaYyC','metadata'];_0x1be3=function(){return _0x169b68;};return _0x1be3();}var __decorate=this&&this[_0x38c718(0xaa)]||function(_0x3704c5,_0x5c3cf3,_0x446a6a,_0x1f9796){const _0xfcc572=_0x38c718;var _0x291a11=arguments[_0xfcc572(0xa1)],_0x58fe5f=_0x291a11<0x3?_0x5c3cf3:_0x1f9796===null?_0x1f9796=Object[_0xfcc572(0xd3)](_0x5c3cf3,_0x446a6a):_0x1f9796,_0x39e442;if(typeof Reflect===_0xfcc572(0xb2)&&typeof Reflect[_0xfcc572(0xc2)]===_0xfcc572(0xb9))_0x58fe5f=Reflect[_0xfcc572(0xc2)](_0x3704c5,_0x5c3cf3,_0x446a6a,_0x1f9796);else{for(var _0x407d69=_0x3704c5[_0xfcc572(0xa1)]-0x1;_0x407d69>=0x0;_0x407d69--)if(_0x39e442=_0x3704c5[_0x407d69])_0x58fe5f=(_0x291a11<0x3?_0x39e442(_0x58fe5f):_0x291a11>0x3?_0x39e442(_0x5c3cf3,_0x446a6a,_0x58fe5f):_0x39e442(_0x5c3cf3,_0x446a6a))||_0x58fe5f;}return _0x291a11>0x3&&_0x58fe5f&&Object[_0xfcc572(0xb3)](_0x5c3cf3,_0x446a6a,_0x58fe5f),_0x58fe5f;},__metadata=this&&this[_0x38c718(0xd6)]||function(_0x3725e6,_0x4c57a5){const _0x1b6d2b=_0x38c718;if(typeof Reflect==='object'&&typeof Reflect[_0x1b6d2b(0xad)]===_0x1b6d2b(0xb9))return Reflect[_0x1b6d2b(0xad)](_0x3725e6,_0x4c57a5);},__param=this&&this[_0x38c718(0xd1)]||function(_0x3d307c,_0x3c858b){return function(_0x186f03,_0x4560fe){_0x3c858b(_0x186f03,_0x4560fe,_0x3d307c);};};Object[_0x38c718(0xb3)](exports,_0x38c718(0xa5),{'value':!![]}),exports[_0x38c718(0xba)]=void 0x0;const common_1=require(_0x38c718(0xce)),bull_1=require(_0x38c718(0xcc)),utils_1=require(_0x38c718(0xd7)),midjourney_service_1=require(_0x38c718(0xc5)),userBalance_service_1=require(_0x38c718(0xbc)),globalConfig_service_1=require(_0x38c718(0xd5));let QueueService=class QueueService{constructor(_0x9f39d2,_0x460158,_0x1b311a,_0x2333bf){const _0x1b503c=_0x38c718;this[_0x1b503c(0xa6)]=_0x9f39d2,this[_0x1b503c(0xb5)]=_0x460158,this[_0x1b503c(0xbe)]=_0x1b311a,this[_0x1b503c(0xb6)]=_0x2333bf,this[_0x1b503c(0xcd)]=[];}async[_0x38c718(0xcb)](){const _0x444fcc=_0x38c718;await this['mjDrawQueue'][_0x444fcc(0xc9)](0x0,_0x444fcc(0xbb)),await this[_0x444fcc(0xb5)]['cleanQueue']();}async[_0x38c718(0xaf)](_0x24a8a6,_0x31c172){const _0x265027=_0x38c718,{imgUrl:_0x16b0c2,orderId:_0x4c6e54,action:_0x5eae81,drawId:_0x4b36a9}=_0x24a8a6;await this[_0x265027(0xb5)][_0x265027(0xb8)](_0x31c172),await this[_0x265027(0xbe)][_0x265027(0xc7)](_0x31c172,_0x265027(0xab),_0x5eae81===_0x265027(0xbd)?0x1:0x4);if(_0x5eae81===_0x265027(0xc8)){const _0x276a7b=''+(0x0,utils_1[_0x265027(0xca)])(),_0x324895=Object[_0x265027(0xd8)](Object[_0x265027(0xd8)]({},_0x24a8a6),{'userId':_0x31c172['user']['id'],'randomDrawId':_0x276a7b}),_0x35cc2c=await this[_0x265027(0xb5)][_0x265027(0xbf)](_0x324895),_0x3dd8af=await this['globalConfigService'][_0x265027(0xa4)]([_0x265027(0xa7)])||0x30d40,_0x33f4cc=await this[_0x265027(0xa6)]['add']('mjDraw',{'id':_0x35cc2c['id'],'action':_0x5eae81,'userId':_0x31c172[_0x265027(0xc1)]['id']},{'delay':0x3e8,'timeout':+_0x3dd8af});return this[_0x265027(0xcd)][_0x265027(0xb7)](_0x33f4cc['id']),!![];}else{const {orderId:_0x1a8c03,action:_0x3f8fa5,drawId:_0x2cac2e}=_0x24a8a6,_0x3dadc2=await this[_0x265027(0xb5)][_0x265027(0xd2)](_0x3f8fa5,_0x2cac2e,_0x1a8c03),_0x40db4e=Object[_0x265027(0xd8)](Object[_0x265027(0xd8)](Object[_0x265027(0xd8)]({},_0x24a8a6),{'userId':_0x31c172['user']['id']}),_0x3dadc2),_0x404e40=await this[_0x265027(0xb5)][_0x265027(0xbf)](_0x40db4e),_0x2e4ede=await this['globalConfigService']['getConfigs']([_0x265027(0xa7)])||0x30d40,_0x5af83a=await this[_0x265027(0xa6)][_0x265027(0xae)](_0x265027(0xab),{'id':_0x404e40['id'],'action':_0x3f8fa5,'userId':_0x31c172[_0x265027(0xc1)]['id']},{'delay':0x3e8,'timeout':+_0x2e4ede});this[_0x265027(0xcd)][_0x265027(0xb7)](_0x5af83a['id']);return;}if(!_0x4b36a9||!_0x4c6e54)throw new common_1[(_0x265027(0xa3))]('缺少必要参数！',common_1[_0x265027(0xc6)][_0x265027(0xb1)]);}async['getQueue'](){const _0x5d6c79=_0x38c718;return{'jobIds':this[_0x5d6c79(0xcd)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x38c718(0xd0)])('MJDRAW')),__metadata('design:paramtypes',[Object,midjourney_service_1[_0x38c718(0xc3)],userBalance_service_1[_0x38c718(0xc4)],globalConfig_service_1[_0x38c718(0xc0)]])],QueueService),exports[_0x38c718(0xba)]=QueueService;