'use strict';const _0x2e4b33=_0x1410;(function(_0x12764a,_0x15697f){const _0x3fff65=_0x1410,_0x1c5f74=_0x12764a();while(!![]){try{const _0x3cb95d=parseInt(_0x3fff65(0x9c))/0x1*(-parseInt(_0x3fff65(0xa4))/0x2)+-parseInt(_0x3fff65(0xb3))/0x3+parseInt(_0x3fff65(0xbe))/0x4+parseInt(_0x3fff65(0xa1))/0x5*(parseInt(_0x3fff65(0x93))/0x6)+parseInt(_0x3fff65(0xc3))/0x7+parseInt(_0x3fff65(0xba))/0x8*(-parseInt(_0x3fff65(0xa7))/0x9)+parseInt(_0x3fff65(0xb8))/0xa;if(_0x3cb95d===_0x15697f)break;else _0x1c5f74['push'](_0x1c5f74['shift']());}catch(_0xc6b87e){_0x1c5f74['push'](_0x1c5f74['shift']());}}}(_0x2418,0x2f123));var __decorate=this&&this['__decorate']||function(_0x294cfb,_0x5222b1,_0x54d0be,_0x379107){const _0x7706e1=_0x1410;var _0x1a8400=arguments[_0x7706e1(0x99)],_0x35256a=_0x1a8400<0x3?_0x5222b1:_0x379107===null?_0x379107=Object[_0x7706e1(0x9d)](_0x5222b1,_0x54d0be):_0x379107,_0x486980;if(typeof Reflect===_0x7706e1(0x9b)&&typeof Reflect[_0x7706e1(0xb0)]===_0x7706e1(0xa5))_0x35256a=Reflect['decorate'](_0x294cfb,_0x5222b1,_0x54d0be,_0x379107);else{for(var _0x377075=_0x294cfb[_0x7706e1(0x99)]-0x1;_0x377075>=0x0;_0x377075--)if(_0x486980=_0x294cfb[_0x377075])_0x35256a=(_0x1a8400<0x3?_0x486980(_0x35256a):_0x1a8400>0x3?_0x486980(_0x5222b1,_0x54d0be,_0x35256a):_0x486980(_0x5222b1,_0x54d0be))||_0x35256a;}return _0x1a8400>0x3&&_0x35256a&&Object['defineProperty'](_0x5222b1,_0x54d0be,_0x35256a),_0x35256a;},__metadata=this&&this[_0x2e4b33(0xb5)]||function(_0x548dbb,_0x28cbf6){const _0x21ad26=_0x2e4b33;if(typeof Reflect===_0x21ad26(0x9b)&&typeof Reflect['metadata']==='function')return Reflect[_0x21ad26(0x98)](_0x548dbb,_0x28cbf6);},__param=this&&this[_0x2e4b33(0xb4)]||function(_0x1554e5,_0x18c4d9){return function(_0x30a0bc,_0x31a8b8){_0x18c4d9(_0x30a0bc,_0x31a8b8,_0x1554e5);};};Object[_0x2e4b33(0xb7)](exports,'__esModule',{'value':!![]}),exports[_0x2e4b33(0xb1)]=void 0x0;const common_1=require('@nestjs/common'),bull_1=require(_0x2e4b33(0xc0)),utils_1=require(_0x2e4b33(0x95)),midjourney_service_1=require(_0x2e4b33(0xb6)),userBalance_service_1=require('../userBalance/userBalance.service'),globalConfig_service_1=require(_0x2e4b33(0xab));let QueueService=class QueueService{constructor(_0x3b394d,_0x4a9a72,_0x36ef70,_0x322438){const _0x15902d=_0x2e4b33;this[_0x15902d(0xbd)]=_0x3b394d,this['midjourneyService']=_0x4a9a72,this[_0x15902d(0xaf)]=_0x36ef70,this[_0x15902d(0xa2)]=_0x322438,this[_0x15902d(0x9e)]=[];}async[_0x2e4b33(0x94)](){const _0x1ddbac=_0x2e4b33;await this[_0x1ddbac(0xbd)][_0x1ddbac(0x92)](0x0,'active'),await this[_0x1ddbac(0xad)][_0x1ddbac(0xbc)]();}async['addMjDrawQueue'](_0x16c889,_0x2a64d2){const _0x5308d7=_0x2e4b33,{imgUrl:_0x5632f1,orderId:_0x36962d,action:_0x35eb11,drawId:_0x3bad72}=_0x16c889;await this['midjourneyService'][_0x5308d7(0xa6)](_0x2a64d2),await this[_0x5308d7(0xaf)]['validateBalance'](_0x2a64d2,_0x5308d7(0xa8),_0x35eb11===_0x5308d7(0x97)?0x1:0x4);if(_0x35eb11===_0x5308d7(0xaa)){const _0xe2ec3a=''+(0x0,utils_1[_0x5308d7(0xa3)])(),_0x38994f=Object['assign'](Object[_0x5308d7(0xb9)]({},_0x16c889),{'userId':_0x2a64d2[_0x5308d7(0x9a)]['id'],'randomDrawId':_0xe2ec3a}),_0x4f50ed=await this[_0x5308d7(0xad)][_0x5308d7(0xbb)](_0x38994f),_0x4e9c92=await this[_0x5308d7(0xa2)]['getConfigs']([_0x5308d7(0xc4)])||0x30d40,_0x1f050b=await this[_0x5308d7(0xbd)][_0x5308d7(0xac)](_0x5308d7(0xa8),{'id':_0x4f50ed['id'],'action':_0x35eb11,'userId':_0x2a64d2[_0x5308d7(0x9a)]['id']},{'delay':0x3e8,'timeout':+_0x4e9c92});return this['jobIds'][_0x5308d7(0xae)](_0x1f050b['id']),!![];}else{const {orderId:_0x4bc3f8,action:_0x57b403,drawId:_0x4e546c}=_0x16c889,_0x55a1cf=await this[_0x5308d7(0xad)][_0x5308d7(0xc2)](_0x57b403,_0x4e546c,_0x4bc3f8),_0x24a908=Object['assign'](Object['assign'](Object[_0x5308d7(0xb9)]({},_0x16c889),{'userId':_0x2a64d2[_0x5308d7(0x9a)]['id']}),_0x55a1cf),_0x25de67=await this['midjourneyService'][_0x5308d7(0xbb)](_0x24a908),_0x307bf7=await this[_0x5308d7(0xa2)][_0x5308d7(0x96)](['mjTimeoutMs'])||0x30d40,_0x42148b=await this['mjDrawQueue'][_0x5308d7(0xac)]('mjDraw',{'id':_0x25de67['id'],'action':_0x57b403,'userId':_0x2a64d2[_0x5308d7(0x9a)]['id']},{'delay':0x3e8,'timeout':+_0x307bf7});this[_0x5308d7(0x9e)][_0x5308d7(0xae)](_0x42148b['id']);return;}if(!_0x3bad72||!_0x36962d)throw new common_1['HttpException'](_0x5308d7(0xa0),common_1[_0x5308d7(0x9f)]['BAD_REQUEST']);}async[_0x2e4b33(0x91)](){return{'jobIds':this['jobIds']};}};function _0x1410(_0x1e5ab3,_0x31e1b5){const _0x2418ce=_0x2418();return _0x1410=function(_0x1410f1,_0x40b761){_0x1410f1=_0x1410f1-0x90;let _0x15a6d5=_0x2418ce[_0x1410f1];return _0x15a6d5;},_0x1410(_0x1e5ab3,_0x31e1b5);}QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x2e4b33(0xbf)])(_0x2e4b33(0xb2))),__metadata(_0x2e4b33(0xa9),[Object,midjourney_service_1[_0x2e4b33(0x90)],userBalance_service_1[_0x2e4b33(0xc1)],globalConfig_service_1['GlobalConfigService']])],QueueService),exports['QueueService']=QueueService;function _0x2418(){const _0x1fba93=['getDrawActionDetail','1397886QvxZHc','mjTimeoutMs','MidjourneyService','getQueue','clean','56460FLuxzB','onApplicationBootstrap','../../common/utils','getConfigs','UPSCALE','metadata','length','user','object','38207VllYBk','getOwnPropertyDescriptor','jobIds','HttpStatus','缺少必要参数！','5zZwBGD','globalConfigService','createRandomUid','14jXTxzR','function','checkLimit','49923ULrCbQ','mjDraw','design:paramtypes','IMAGINE','../globalConfig/globalConfig.service','add','midjourneyService','push','userBalanceService','decorate','QueueService','MJDRAW','802665EpWvTU','__param','__metadata','../midjourney/midjourney.service','defineProperty','4237510XTJVif','assign','296bujWsm','addDrawQueue','cleanQueue','mjDrawQueue','1200748dOldaE','InjectQueue','@nestjs/bull','UserBalanceService'];_0x2418=function(){return _0x1fba93;};return _0x2418();}