'use strict';const _0x539f5c=_0x2913;(function(_0x25b183,_0x2819cc){const _0x3238f6=_0x2913,_0x3d23cd=_0x25b183();while(!![]){try{const _0x3fa57e=parseInt(_0x3238f6(0x1b6))/0x1+-parseInt(_0x3238f6(0x1d3))/0x2*(-parseInt(_0x3238f6(0x1e9))/0x3)+-parseInt(_0x3238f6(0x1c2))/0x4*(parseInt(_0x3238f6(0x1c4))/0x5)+parseInt(_0x3238f6(0x1c6))/0x6+parseInt(_0x3238f6(0x1c3))/0x7*(parseInt(_0x3238f6(0x209))/0x8)+-parseInt(_0x3238f6(0x20a))/0x9+parseInt(_0x3238f6(0x1e6))/0xa*(parseInt(_0x3238f6(0x1d6))/0xb);if(_0x3fa57e===_0x2819cc)break;else _0x3d23cd['push'](_0x3d23cd['shift']());}catch(_0x1c0704){_0x3d23cd['push'](_0x3d23cd['shift']());}}}(_0x1850,0x4aeea));function _0x1850(){const _0x305b5d=['BAD_REQUEST','delete','username','9194ptADsf','saveRecordRechargeLog','generateCrami','88RnDEBt','userEntity','cramiPackageEntity','更新套餐失败、请重试！','userBalanceService','create','defineProperty','name','CramiPackageEntity','assign','error:\x20','删除卡密成功！','当前卡密不存在、请确认您输入的卡密是否正确！','../user/user.entity','find','套餐名称或套餐等级重复、请检查！','76120QnbJyK','__metadata','findOne','27uESAVO','super','packageName','Like','CramiEntity','./cramiPackage.entity','affected','../../common/utils','RechargeType','LessThanOrEqual','Repository','InjectRepository','design:paramtypes','HttpStatus','queryAllPackage','MoreThan','delPackage','createCrami','useId','object','__esModule','user','当前套餐不存在、请检查你的输入参数！','cramiEntity','forEach','metadata','length','PACKAGE_GIFT','UserEntity','当前卡密已被使用、已使用的卡密禁止删除！','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','findAndCount','12504KiUmFl','385470SKoLSX','Not','email','当前套餐不存在、请确认您选择的套餐是否存在！','status','log','save','__param','自定义卡密必须至少一项余额不为0️零！','generateCramiCode','294682utSCOZ','./crami.entity','maskEmail','role','../userBalance/userBalance.service','batchDelCrami','@nestjs/typeorm','../../common/constants/balance.constant','packageId','update','DESC','decorate','2003860bixMxu','882xrbCim','5XLSslf','HttpException','1540968UnIqTo','CramiService','typeorm','function','UserBalanceService','@nestjs/common','map','当前卡密不存在、请确认您要删除的卡密是否存在！','Injectable','code'];_0x1850=function(){return _0x305b5d;};return _0x1850();}var __decorate=this&&this['__decorate']||function(_0x3b4840,_0x5dd84d,_0x5f4a61,_0x2adead){const _0xa5ecb9=_0x2913;var _0x7a107b=arguments['length'],_0x4ac3f3=_0x7a107b<0x3?_0x5dd84d:_0x2adead===null?_0x2adead=Object['getOwnPropertyDescriptor'](_0x5dd84d,_0x5f4a61):_0x2adead,_0x1920ce;if(typeof Reflect===_0xa5ecb9(0x1fc)&&typeof Reflect[_0xa5ecb9(0x1c1)]===_0xa5ecb9(0x1c9))_0x4ac3f3=Reflect[_0xa5ecb9(0x1c1)](_0x3b4840,_0x5dd84d,_0x5f4a61,_0x2adead);else{for(var _0x47bcf9=_0x3b4840[_0xa5ecb9(0x203)]-0x1;_0x47bcf9>=0x0;_0x47bcf9--)if(_0x1920ce=_0x3b4840[_0x47bcf9])_0x4ac3f3=(_0x7a107b<0x3?_0x1920ce(_0x4ac3f3):_0x7a107b>0x3?_0x1920ce(_0x5dd84d,_0x5f4a61,_0x4ac3f3):_0x1920ce(_0x5dd84d,_0x5f4a61))||_0x4ac3f3;}return _0x7a107b>0x3&&_0x4ac3f3&&Object[_0xa5ecb9(0x1dc)](_0x5dd84d,_0x5f4a61,_0x4ac3f3),_0x4ac3f3;},__metadata=this&&this[_0x539f5c(0x1e7)]||function(_0x20798a,_0x38a946){const _0x2a6cc7=_0x539f5c;if(typeof Reflect==='object'&&typeof Reflect[_0x2a6cc7(0x202)]===_0x2a6cc7(0x1c9))return Reflect['metadata'](_0x20798a,_0x38a946);},__param=this&&this[_0x539f5c(0x1b3)]||function(_0x361f0f,_0x3e29eb){return function(_0x4ea0fe,_0x1190f5){_0x3e29eb(_0x4ea0fe,_0x1190f5,_0x361f0f);};};Object[_0x539f5c(0x1dc)](exports,_0x539f5c(0x1fd),{'value':!![]}),exports[_0x539f5c(0x1c7)]=void 0x0;const common_1=require(_0x539f5c(0x1cb)),crami_entity_1=require(_0x539f5c(0x1b7)),typeorm_1=require(_0x539f5c(0x1bc)),typeorm_2=require(_0x539f5c(0x1c8)),cramiPackage_entity_1=require(_0x539f5c(0x1ee)),utils_1=require(_0x539f5c(0x1f0)),user_entity_1=require(_0x539f5c(0x1e3)),userBalance_service_1=require(_0x539f5c(0x1ba)),balance_constant_1=require(_0x539f5c(0x1bd));function _0x2913(_0x175484,_0x4066e1){const _0x185001=_0x1850();return _0x2913=function(_0x291376,_0x3e9ee1){_0x291376=_0x291376-0x1b2;let _0x497050=_0x185001[_0x291376];return _0x497050;},_0x2913(_0x175484,_0x4066e1);}let CramiService=class CramiService{constructor(_0x35892e,_0x1f6fc8,_0x30d4e5,_0x490df2){const _0xacae6f=_0x539f5c;this['cramiEntity']=_0x35892e,this[_0xacae6f(0x1d8)]=_0x1f6fc8,this[_0xacae6f(0x1d7)]=_0x30d4e5,this[_0xacae6f(0x1da)]=_0x490df2;}async['queryOnePackage'](_0x481c01){const _0x488c67=_0x539f5c;return await this[_0x488c67(0x1d8)]['findOne']({'where':{'id':_0x481c01}});}async[_0x539f5c(0x1f7)](_0xa398b5){const _0x2bb12d=_0x539f5c;try{const {page:page=0x1,size:size=0xa,name:_0x20e66d,status:_0x4c8084,type:_0x124c16}=_0xa398b5,_0x355147={};_0x20e66d&&Object[_0x2bb12d(0x1df)](_0x355147,{'name':(0x0,typeorm_2[_0x2bb12d(0x1ec)])('%'+_0x20e66d+'%')}),_0x4c8084&&Object[_0x2bb12d(0x1df)](_0x355147,{'status':_0x4c8084});_0x124c16&&(_0x124c16>0x0?Object[_0x2bb12d(0x1df)](_0x355147,{'days':(0x0,typeorm_2[_0x2bb12d(0x1f8)])(0x0)}):Object[_0x2bb12d(0x1df)](_0x355147,{'days':(0x0,typeorm_2[_0x2bb12d(0x1f2)])(0x0)}));const [_0x4614b7,_0x9e36f1]=await this['cramiPackageEntity']['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x355147,'order':{'order':_0x2bb12d(0x1c0)}});return{'rows':_0x4614b7,'count':_0x9e36f1};}catch(_0x5d29cf){console[_0x2bb12d(0x20f)](_0x2bb12d(0x1e0),_0x5d29cf);}}async['createPackage'](_0x245a05){const _0xeac16d=_0x539f5c,{name:_0x22187b,weight:_0x532a4b}=_0x245a05,_0x37cd3b=await this[_0xeac16d(0x1d8)][_0xeac16d(0x1e8)]({'where':[{'name':_0x22187b},{'weight':_0x532a4b}]});if(_0x37cd3b)throw new common_1[(_0xeac16d(0x1c5))](_0xeac16d(0x1e5),common_1[_0xeac16d(0x1f6)][_0xeac16d(0x1d0)]);try{return await this['cramiPackageEntity'][_0xeac16d(0x1b2)](_0x245a05);}catch(_0x2d2c2f){console['log']('error:\x20',_0x2d2c2f);throw new common_1[(_0xeac16d(0x1c5))](_0x2d2c2f,common_1[_0xeac16d(0x1f6)][_0xeac16d(0x1d0)]);}}async['updatePackage'](_0x591da1){const _0x5dbf1b=_0x539f5c,{id:_0x50a60c,name:_0x13beb9,weight:_0x581306}=_0x591da1,_0x627d53=await this[_0x5dbf1b(0x1d8)][_0x5dbf1b(0x1e8)]({'where':{'id':_0x50a60c}});if(!_0x627d53)throw new common_1[(_0x5dbf1b(0x1c5))](_0x5dbf1b(0x1ff),common_1['HttpStatus'][_0x5dbf1b(0x1d0)]);const _0x5e8276=await this[_0x5dbf1b(0x1d8)]['count']({'where':[{'name':_0x13beb9,'id':(0x0,typeorm_2[_0x5dbf1b(0x20b)])(_0x50a60c)},{'weight':_0x581306,'id':(0x0,typeorm_2[_0x5dbf1b(0x20b)])(_0x50a60c)}]});if(_0x5e8276)throw new common_1[(_0x5dbf1b(0x1c5))](_0x5dbf1b(0x1e5),common_1[_0x5dbf1b(0x1f6)][_0x5dbf1b(0x1d0)]);const _0xd98b4f=await this[_0x5dbf1b(0x1d8)]['update']({'id':_0x50a60c},_0x591da1);if(_0xd98b4f[_0x5dbf1b(0x1ef)]>0x0)return'更新套餐成功！';else throw new common_1[(_0x5dbf1b(0x1c5))](_0x5dbf1b(0x1d9),common_1[_0x5dbf1b(0x1f6)]['BAD_REQUEST']);}async[_0x539f5c(0x1f9)](_0x3c7a69){const _0x3c7251=_0x539f5c,{id:_0x51bb58}=_0x3c7a69,_0x3f966a=await this[_0x3c7251(0x200)]['count']({'where':{'packageId':_0x51bb58}});if(_0x3f966a)throw new common_1[(_0x3c7251(0x1c5))](_0x3c7251(0x207),common_1['HttpStatus'][_0x3c7251(0x1d0)]);return await this['cramiPackageEntity']['delete']({'id':_0x51bb58});}async[_0x539f5c(0x1fa)](_0x346a87){const _0x4815dc=_0x539f5c,{packageId:_0xb0a6a3,count:count=0x1}=_0x346a87;if(_0xb0a6a3){const _0x4e08d7=await this[_0x4815dc(0x1d8)]['findOne']({'where':{'id':_0xb0a6a3}});if(!_0x4e08d7)throw new common_1['HttpException'](_0x4815dc(0x20d),common_1[_0x4815dc(0x1f6)]['BAD_REQUEST']);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x4e08d7,_0x29d264={'packageId':_0xb0a6a3,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x29d264,count);}if(!_0xb0a6a3){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x346a87;if([model3Count,model4Count,drawMjCount]['every'](_0x21ab0e=>!_0x21ab0e))throw new common_1[(_0x4815dc(0x1c5))](_0x4815dc(0x1b4),common_1[_0x4815dc(0x1f6)][_0x4815dc(0x1d0)]);const _0x4204ae={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x4815dc(0x1d5)](_0x4204ae,count);}}async[_0x539f5c(0x1d5)](_0xa3f97f,_0xc90bd1){const _0x3978ca=_0x539f5c,_0x4b093e=[];for(let _0x224176=0x0;_0x224176<_0xc90bd1;_0x224176++){const _0x2e622e=(0x0,utils_1[_0x3978ca(0x1b5)])(),_0x113eb1=this[_0x3978ca(0x200)][_0x3978ca(0x1db)](Object[_0x3978ca(0x1df)](Object['assign']({},_0xa3f97f),{'code':_0x2e622e}));_0x4b093e['push'](_0x113eb1);}return await this[_0x3978ca(0x200)][_0x3978ca(0x1b2)](_0x4b093e);}async['useCrami'](_0x4de0a1,_0x4f543b){const _0x478229=_0x539f5c,{id:_0x3dd810}=_0x4de0a1[_0x478229(0x1fe)],_0x36009e=await this['cramiEntity']['findOne']({'where':{'code':_0x4f543b[_0x478229(0x1cf)]}});if(!_0x36009e)throw new common_1[(_0x478229(0x1c5))](_0x478229(0x1e2),common_1[_0x478229(0x1f6)][_0x478229(0x1d0)]);const {status:_0x38a56a,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x18f084}=_0x36009e;if(_0x38a56a===0x1)throw new common_1[(_0x478229(0x1c5))]('当前卡密已被使用、请确认您输入的卡密是否正确！',common_1[_0x478229(0x1f6)]['BAD_REQUEST']);const _0x4e7c9c={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x18f084};return await this['userBalanceService']['addBalanceToUser'](_0x3dd810,Object[_0x478229(0x1df)]({},_0x4e7c9c),days),await this[_0x478229(0x1da)][_0x478229(0x1d4)]({'userId':_0x3dd810,'rechargeType':balance_constant_1[_0x478229(0x1f1)][_0x478229(0x204)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x478229(0x200)][_0x478229(0x1bf)]({'code':_0x4f543b[_0x478229(0x1cf)]},{'useId':_0x3dd810,'status':0x1}),'使用卡密成功';}async['queryAllCrami'](_0x4cf5c8,_0x355fa2){const _0x22c9d3=_0x539f5c,{page:page=0x1,size:size=0xa,status:_0x1f682a,useId:_0x4b5671}=_0x4cf5c8,_0x1303ec={};_0x1f682a&&Object[_0x22c9d3(0x1df)](_0x1303ec,{'status':_0x1f682a}),_0x4b5671&&Object[_0x22c9d3(0x1df)](_0x1303ec,{'useId':_0x4b5671});const [_0x4cc3bb,_0x35267a]=await this[_0x22c9d3(0x200)][_0x22c9d3(0x208)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'},'where':_0x1303ec}),_0x3d42e3=_0x4cc3bb[_0x22c9d3(0x1cc)](_0x56a41d=>_0x56a41d[_0x22c9d3(0x1fb)]),_0x16da46=_0x4cc3bb[_0x22c9d3(0x1cc)](_0x4ac1c6=>_0x4ac1c6[_0x22c9d3(0x1be)]),_0x23c80a=await this[_0x22c9d3(0x1d7)][_0x22c9d3(0x1e4)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3d42e3)}}),_0x76c111=await this['cramiPackageEntity'][_0x22c9d3(0x1e4)]({'where':{'id':(0x0,typeorm_2['In'])(_0x16da46)}});return _0x4cc3bb[_0x22c9d3(0x201)](_0x52e2c5=>{const _0x92e292=_0x22c9d3;var _0x456fbb,_0x559b79,_0x3a0f0c;_0x52e2c5[_0x92e292(0x1d2)]=(_0x456fbb=_0x23c80a[_0x92e292(0x1e4)](_0x235e34=>_0x235e34['id']===_0x52e2c5['useId']))===null||_0x456fbb===void 0x0?void 0x0:_0x456fbb[_0x92e292(0x1d2)],_0x52e2c5[_0x92e292(0x20c)]=(_0x559b79=_0x23c80a['find'](_0xa5f30b=>_0xa5f30b['id']===_0x52e2c5[_0x92e292(0x1fb)]))===null||_0x559b79===void 0x0?void 0x0:_0x559b79[_0x92e292(0x20c)],_0x52e2c5[_0x92e292(0x1eb)]=(_0x3a0f0c=_0x76c111['find'](_0x5c5284=>_0x5c5284['id']===_0x52e2c5['packageId']))===null||_0x3a0f0c===void 0x0?void 0x0:_0x3a0f0c[_0x92e292(0x1dd)];}),_0x355fa2['user'][_0x22c9d3(0x1b9)]!==_0x22c9d3(0x1ea)&&_0x4cc3bb['forEach'](_0x3f8688=>_0x3f8688[_0x22c9d3(0x20c)]=(0x0,utils_1[_0x22c9d3(0x1b8)])(_0x3f8688[_0x22c9d3(0x20c)])),_0x355fa2[_0x22c9d3(0x1fe)][_0x22c9d3(0x1b9)]!==_0x22c9d3(0x1ea)&&_0x4cc3bb['forEach'](_0x3fac07=>_0x3fac07[_0x22c9d3(0x1cf)]=(0x0,utils_1['maskCrami'])(_0x3fac07['code'])),{'rows':_0x4cc3bb,'count':_0x35267a};}async['delCrami'](_0x482242){const _0x547f2b=_0x539f5c,_0x570df8=await this[_0x547f2b(0x200)][_0x547f2b(0x1e8)]({'where':{'id':_0x482242}});if(!_0x570df8)throw new common_1[(_0x547f2b(0x1c5))](_0x547f2b(0x1cd),common_1[_0x547f2b(0x1f6)][_0x547f2b(0x1d0)]);if(_0x570df8[_0x547f2b(0x20e)]===0x1)throw new common_1[(_0x547f2b(0x1c5))](_0x547f2b(0x206),common_1['HttpStatus'][_0x547f2b(0x1d0)]);return await this[_0x547f2b(0x200)][_0x547f2b(0x1d1)]({'id':_0x482242});}async[_0x539f5c(0x1bb)](_0x1c4d7f){const _0x2f4fac=_0x539f5c,{ids:_0x3dae19}=_0x1c4d7f,_0x14c2a9=await this[_0x2f4fac(0x200)]['delete'](_0x3dae19);if(_0x14c2a9[_0x2f4fac(0x1ef)]>0x0)return _0x2f4fac(0x1e1);else throw new common_1[(_0x2f4fac(0x1c5))]('删除卡密失败、请重试！',common_1[_0x2f4fac(0x1f6)][_0x2f4fac(0x1d0)]);}};CramiService=__decorate([(0x0,common_1[_0x539f5c(0x1ce)])(),__param(0x0,(0x0,typeorm_1[_0x539f5c(0x1f4)])(crami_entity_1[_0x539f5c(0x1ed)])),__param(0x1,(0x0,typeorm_1[_0x539f5c(0x1f4)])(cramiPackage_entity_1[_0x539f5c(0x1de)])),__param(0x2,(0x0,typeorm_1[_0x539f5c(0x1f4)])(user_entity_1[_0x539f5c(0x205)])),__metadata(_0x539f5c(0x1f5),[typeorm_2[_0x539f5c(0x1f3)],typeorm_2[_0x539f5c(0x1f3)],typeorm_2['Repository'],userBalance_service_1[_0x539f5c(0x1ca)]])],CramiService),exports['CramiService']=CramiService;