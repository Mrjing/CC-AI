'use strict';function _0x54eb(_0x1f5389,_0x57c5b9){const _0x6bc66f=_0x6bc6();return _0x54eb=function(_0x54ebcb,_0x306edd){_0x54ebcb=_0x54ebcb-0x1b5;let _0x2babd8=_0x6bc66f[_0x54ebcb];return _0x2babd8;},_0x54eb(_0x1f5389,_0x57c5b9);}const _0x16de40=_0x54eb;(function(_0x1f2e5e,_0x48a77d){const _0x383a1b=_0x54eb,_0x70caa9=_0x1f2e5e();while(!![]){try{const _0x3072dd=-parseInt(_0x383a1b(0x1c7))/0x1+-parseInt(_0x383a1b(0x1c3))/0x2*(parseInt(_0x383a1b(0x20f))/0x3)+-parseInt(_0x383a1b(0x1f4))/0x4+parseInt(_0x383a1b(0x1d6))/0x5+-parseInt(_0x383a1b(0x1f1))/0x6*(parseInt(_0x383a1b(0x1ba))/0x7)+-parseInt(_0x383a1b(0x1e1))/0x8+-parseInt(_0x383a1b(0x1fe))/0x9*(-parseInt(_0x383a1b(0x1bf))/0xa);if(_0x3072dd===_0x48a77d)break;else _0x70caa9['push'](_0x70caa9['shift']());}catch(_0x4552ea){_0x70caa9['push'](_0x70caa9['shift']());}}}(_0x6bc6,0xe23bf));var __decorate=this&&this['__decorate']||function(_0x426aa1,_0x70b59c,_0x2055ce,_0x216b0d){const _0x4673f3=_0x54eb;var _0x571c89=arguments[_0x4673f3(0x1cb)],_0x3db9cd=_0x571c89<0x3?_0x70b59c:_0x216b0d===null?_0x216b0d=Object[_0x4673f3(0x1df)](_0x70b59c,_0x2055ce):_0x216b0d,_0x1f2570;if(typeof Reflect===_0x4673f3(0x1d9)&&typeof Reflect[_0x4673f3(0x1e9)]===_0x4673f3(0x1f3))_0x3db9cd=Reflect[_0x4673f3(0x1e9)](_0x426aa1,_0x70b59c,_0x2055ce,_0x216b0d);else{for(var _0x14e407=_0x426aa1['length']-0x1;_0x14e407>=0x0;_0x14e407--)if(_0x1f2570=_0x426aa1[_0x14e407])_0x3db9cd=(_0x571c89<0x3?_0x1f2570(_0x3db9cd):_0x571c89>0x3?_0x1f2570(_0x70b59c,_0x2055ce,_0x3db9cd):_0x1f2570(_0x70b59c,_0x2055ce))||_0x3db9cd;}return _0x571c89>0x3&&_0x3db9cd&&Object[_0x4673f3(0x1b5)](_0x70b59c,_0x2055ce,_0x3db9cd),_0x3db9cd;},__metadata=this&&this['__metadata']||function(_0x18d926,_0x26d76d){const _0x241c66=_0x54eb;if(typeof Reflect===_0x241c66(0x1d9)&&typeof Reflect[_0x241c66(0x1c4)]===_0x241c66(0x1f3))return Reflect[_0x241c66(0x1c4)](_0x18d926,_0x26d76d);},__param=this&&this[_0x16de40(0x1c6)]||function(_0x5cf244,_0x4b39ad){return function(_0x4b24de,_0x2cd7a6){_0x4b39ad(_0x4b24de,_0x2cd7a6,_0x5cf244);};};function _0x6bc6(){const _0x57c74b=['HttpStatus','DESC','error:\x20','super','create','saveRecordRechargeLog','PACKAGE_GIFT','自定义卡密必须至少一项余额不为0️零！','@nestjs/typeorm','queryOnePackage','maskCrami','userBalanceService','RechargeType','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','cramiPackageEntity','10245GUPOZv','find','design:paramtypes','CramiService','defineProperty','findOne','当前卡密不存在、请确认您输入的卡密是否正确！','BAD_REQUEST','packageId','49YcnXip','status','LessThanOrEqual','addBalanceToUser','./crami.entity','7462540QGKYyT','maskEmail','userEntity','every','296OZZWXe','metadata','Injectable','__param','671875nTkLHm','createCrami','email','cramiEntity','length','batchDelCrami','updatePackage','当前卡密已被使用、已使用的卡密禁止删除！','code','删除卡密成功！','MoreThan','log','Repository','CramiPackageEntity','HttpException','9015580DrzRfK','useCrami','user','object','forEach','queryAllCrami','packageName','../userBalance/userBalance.service','CramiEntity','getOwnPropertyDescriptor','save','9268744PyFAQM','InjectRepository','role','Not','createPackage','assign','map','push','decorate','useId','delCrami','delPackage','更新套餐失败、请重试！','../../common/constants/balance.constant','findAndCount','generateCrami','466302nbALEc','当前卡密已被使用、请确认您输入的卡密是否正确！','function','6911296RxTiOw','delete','更新套餐成功！','__esModule','count','affected','当前套餐不存在、请确认您选择的套餐是否存在！','../../common/utils','username','update','45CsSgwC','套餐名称或套餐等级重复、请检查！'];_0x6bc6=function(){return _0x57c74b;};return _0x6bc6();}Object[_0x16de40(0x1b5)](exports,_0x16de40(0x1f7),{'value':!![]}),exports[_0x16de40(0x212)]=void 0x0;const common_1=require('@nestjs/common'),crami_entity_1=require(_0x16de40(0x1be)),typeorm_1=require(_0x16de40(0x208)),typeorm_2=require('typeorm'),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require(_0x16de40(0x1fb)),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x16de40(0x1dd)),balance_constant_1=require(_0x16de40(0x1ee));let CramiService=class CramiService{constructor(_0x49ce3a,_0x5a6db0,_0x5e7da9,_0xc89e26){const _0x1aba5c=_0x16de40;this[_0x1aba5c(0x1ca)]=_0x49ce3a,this[_0x1aba5c(0x20e)]=_0x5a6db0,this[_0x1aba5c(0x1c1)]=_0x5e7da9,this[_0x1aba5c(0x20b)]=_0xc89e26;}async[_0x16de40(0x209)](_0x425c18){const _0x47ce88=_0x16de40;return await this[_0x47ce88(0x20e)]['findOne']({'where':{'id':_0x425c18}});}async['queryAllPackage'](_0x4d9a80){const _0x455844=_0x16de40;try{const {page:page=0x1,size:size=0xa,name:_0x501457,status:_0x27dc02,type:_0x23d19d}=_0x4d9a80,_0x3ae353={};_0x501457&&Object[_0x455844(0x1e6)](_0x3ae353,{'name':(0x0,typeorm_2['Like'])('%'+_0x501457+'%')}),_0x27dc02&&Object[_0x455844(0x1e6)](_0x3ae353,{'status':_0x27dc02});_0x23d19d&&(_0x23d19d>0x0?Object[_0x455844(0x1e6)](_0x3ae353,{'days':(0x0,typeorm_2[_0x455844(0x1d1)])(0x0)}):Object[_0x455844(0x1e6)](_0x3ae353,{'days':(0x0,typeorm_2[_0x455844(0x1bc)])(0x0)}));const [_0x133558,_0x420ba9]=await this[_0x455844(0x20e)][_0x455844(0x1ef)]({'skip':(page-0x1)*size,'take':size,'where':_0x3ae353,'order':{'order':_0x455844(0x201)}});return{'rows':_0x133558,'count':_0x420ba9};}catch(_0x7a88f0){console[_0x455844(0x1d2)]('error:\x20',_0x7a88f0);}}async[_0x16de40(0x1e5)](_0x369d84){const _0x210ef0=_0x16de40,{name:_0x40e94f,weight:_0x3d135f}=_0x369d84,_0x1ca53c=await this['cramiPackageEntity'][_0x210ef0(0x1b6)]({'where':[{'name':_0x40e94f},{'weight':_0x3d135f}]});if(_0x1ca53c)throw new common_1[(_0x210ef0(0x1d5))]('套餐名称或套餐等级重复、请检查！',common_1[_0x210ef0(0x200)]['BAD_REQUEST']);try{return await this[_0x210ef0(0x20e)][_0x210ef0(0x1e0)](_0x369d84);}catch(_0x9ec898){console[_0x210ef0(0x1d2)](_0x210ef0(0x202),_0x9ec898);throw new common_1[(_0x210ef0(0x1d5))](_0x9ec898,common_1[_0x210ef0(0x200)][_0x210ef0(0x1b8)]);}}async[_0x16de40(0x1cd)](_0x30120a){const _0x578aed=_0x16de40,{id:_0x7421ac,name:_0x3df7f5,weight:_0x5cf547}=_0x30120a,_0x3f6798=await this[_0x578aed(0x20e)][_0x578aed(0x1b6)]({'where':{'id':_0x7421ac}});if(!_0x3f6798)throw new common_1[(_0x578aed(0x1d5))]('当前套餐不存在、请检查你的输入参数！',common_1[_0x578aed(0x200)][_0x578aed(0x1b8)]);const _0x3b5d63=await this[_0x578aed(0x20e)][_0x578aed(0x1f8)]({'where':[{'name':_0x3df7f5,'id':(0x0,typeorm_2[_0x578aed(0x1e4)])(_0x7421ac)},{'weight':_0x5cf547,'id':(0x0,typeorm_2[_0x578aed(0x1e4)])(_0x7421ac)}]});if(_0x3b5d63)throw new common_1[(_0x578aed(0x1d5))](_0x578aed(0x1ff),common_1['HttpStatus'][_0x578aed(0x1b8)]);const _0x344719=await this[_0x578aed(0x20e)][_0x578aed(0x1fd)]({'id':_0x7421ac},_0x30120a);if(_0x344719[_0x578aed(0x1f9)]>0x0)return _0x578aed(0x1f6);else throw new common_1[(_0x578aed(0x1d5))](_0x578aed(0x1ed),common_1[_0x578aed(0x200)][_0x578aed(0x1b8)]);}async[_0x16de40(0x1ec)](_0x10358d){const _0x48f07f=_0x16de40,{id:_0x4235f6}=_0x10358d,_0x3e3e0f=await this[_0x48f07f(0x1ca)][_0x48f07f(0x1f8)]({'where':{'packageId':_0x4235f6}});if(_0x3e3e0f)throw new common_1[(_0x48f07f(0x1d5))](_0x48f07f(0x20d),common_1[_0x48f07f(0x200)][_0x48f07f(0x1b8)]);return await this[_0x48f07f(0x20e)]['delete']({'id':_0x4235f6});}async[_0x16de40(0x1c8)](_0x4ef5e4){const _0x23b6b2=_0x16de40,{packageId:_0xc2af63,count:count=0x1}=_0x4ef5e4;if(_0xc2af63){const _0x5e1905=await this[_0x23b6b2(0x20e)][_0x23b6b2(0x1b6)]({'where':{'id':_0xc2af63}});if(!_0x5e1905)throw new common_1[(_0x23b6b2(0x1d5))](_0x23b6b2(0x1fa),common_1[_0x23b6b2(0x200)][_0x23b6b2(0x1b8)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5e1905,_0x8b71a1={'packageId':_0xc2af63,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x23b6b2(0x1f0)](_0x8b71a1,count);}if(!_0xc2af63){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x4ef5e4;if([model3Count,model4Count,drawMjCount][_0x23b6b2(0x1c2)](_0x8b27db=>!_0x8b27db))throw new common_1[(_0x23b6b2(0x1d5))](_0x23b6b2(0x207),common_1[_0x23b6b2(0x200)][_0x23b6b2(0x1b8)]);const _0xff9022={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0xff9022,count);}}async[_0x16de40(0x1f0)](_0x593eb7,_0x516247){const _0x3a64f4=_0x16de40,_0x544c81=[];for(let _0x35d8cd=0x0;_0x35d8cd<_0x516247;_0x35d8cd++){const _0x527919=(0x0,utils_1['generateCramiCode'])(),_0x46acd6=this[_0x3a64f4(0x1ca)][_0x3a64f4(0x204)](Object[_0x3a64f4(0x1e6)](Object['assign']({},_0x593eb7),{'code':_0x527919}));_0x544c81[_0x3a64f4(0x1e8)](_0x46acd6);}return await this[_0x3a64f4(0x1ca)][_0x3a64f4(0x1e0)](_0x544c81);}async[_0x16de40(0x1d7)](_0x3aac65,_0x315f05){const _0x19a23a=_0x16de40,{id:_0x33ecb7}=_0x3aac65['user'],_0xff686=await this['cramiEntity'][_0x19a23a(0x1b6)]({'where':{'code':_0x315f05[_0x19a23a(0x1cf)]}});if(!_0xff686)throw new common_1[(_0x19a23a(0x1d5))](_0x19a23a(0x1b7),common_1[_0x19a23a(0x200)][_0x19a23a(0x1b8)]);const {status:_0xe042bc,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0xb6afbd}=_0xff686;if(_0xe042bc===0x1)throw new common_1[(_0x19a23a(0x1d5))](_0x19a23a(0x1f2),common_1[_0x19a23a(0x200)][_0x19a23a(0x1b8)]);const _0x5bbd7c={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0xb6afbd};return await this[_0x19a23a(0x20b)][_0x19a23a(0x1bd)](_0x33ecb7,Object[_0x19a23a(0x1e6)]({},_0x5bbd7c),days),await this[_0x19a23a(0x20b)][_0x19a23a(0x205)]({'userId':_0x33ecb7,'rechargeType':balance_constant_1[_0x19a23a(0x20c)][_0x19a23a(0x206)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x19a23a(0x1ca)]['update']({'code':_0x315f05['code']},{'useId':_0x33ecb7,'status':0x1}),'使用卡密成功';}async[_0x16de40(0x1db)](_0x19cfcb,_0x3b0a16){const _0x132626=_0x16de40,{page:page=0x1,size:size=0xa,status:_0x2a294a,useId:_0x28cb4b}=_0x19cfcb,_0x546568={};_0x2a294a&&Object['assign'](_0x546568,{'status':_0x2a294a}),_0x28cb4b&&Object['assign'](_0x546568,{'useId':_0x28cb4b});const [_0x569d7e,_0x477302]=await this[_0x132626(0x1ca)][_0x132626(0x1ef)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x132626(0x201)},'where':_0x546568}),_0x5c6b1d=_0x569d7e[_0x132626(0x1e7)](_0x16b52b=>_0x16b52b[_0x132626(0x1ea)]),_0x25eb54=_0x569d7e[_0x132626(0x1e7)](_0x461563=>_0x461563[_0x132626(0x1b9)]),_0x57adef=await this[_0x132626(0x1c1)][_0x132626(0x210)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5c6b1d)}}),_0x3b341b=await this[_0x132626(0x20e)][_0x132626(0x210)]({'where':{'id':(0x0,typeorm_2['In'])(_0x25eb54)}});return _0x569d7e[_0x132626(0x1da)](_0x2ff8c7=>{const _0xef46de=_0x132626;var _0x298318,_0x8f2f0,_0x2c2fc1;_0x2ff8c7['username']=(_0x298318=_0x57adef[_0xef46de(0x210)](_0xaf11c6=>_0xaf11c6['id']===_0x2ff8c7[_0xef46de(0x1ea)]))===null||_0x298318===void 0x0?void 0x0:_0x298318[_0xef46de(0x1fc)],_0x2ff8c7['email']=(_0x8f2f0=_0x57adef['find'](_0x50176c=>_0x50176c['id']===_0x2ff8c7[_0xef46de(0x1ea)]))===null||_0x8f2f0===void 0x0?void 0x0:_0x8f2f0[_0xef46de(0x1c9)],_0x2ff8c7[_0xef46de(0x1dc)]=(_0x2c2fc1=_0x3b341b['find'](_0x4faebf=>_0x4faebf['id']===_0x2ff8c7[_0xef46de(0x1b9)]))===null||_0x2c2fc1===void 0x0?void 0x0:_0x2c2fc1['name'];}),_0x3b0a16['user']['role']!==_0x132626(0x203)&&_0x569d7e[_0x132626(0x1da)](_0x59e036=>_0x59e036[_0x132626(0x1c9)]=(0x0,utils_1[_0x132626(0x1c0)])(_0x59e036[_0x132626(0x1c9)])),_0x3b0a16[_0x132626(0x1d8)][_0x132626(0x1e3)]!==_0x132626(0x203)&&_0x569d7e[_0x132626(0x1da)](_0x2475f0=>_0x2475f0[_0x132626(0x1cf)]=(0x0,utils_1[_0x132626(0x20a)])(_0x2475f0[_0x132626(0x1cf)])),{'rows':_0x569d7e,'count':_0x477302};}async[_0x16de40(0x1eb)](_0x485a25){const _0x453d42=_0x16de40,_0x256641=await this[_0x453d42(0x1ca)][_0x453d42(0x1b6)]({'where':{'id':_0x485a25}});if(!_0x256641)throw new common_1[(_0x453d42(0x1d5))]('当前卡密不存在、请确认您要删除的卡密是否存在！',common_1[_0x453d42(0x200)][_0x453d42(0x1b8)]);if(_0x256641[_0x453d42(0x1bb)]===0x1)throw new common_1[(_0x453d42(0x1d5))](_0x453d42(0x1ce),common_1[_0x453d42(0x200)][_0x453d42(0x1b8)]);return await this[_0x453d42(0x1ca)][_0x453d42(0x1f5)]({'id':_0x485a25});}async[_0x16de40(0x1cc)](_0x567bf8){const _0x25d039=_0x16de40,{ids:_0x67150c}=_0x567bf8,_0x1e27a8=await this[_0x25d039(0x1ca)][_0x25d039(0x1f5)](_0x67150c);if(_0x1e27a8['affected']>0x0)return _0x25d039(0x1d0);else throw new common_1['HttpException']('删除卡密失败、请重试！',common_1[_0x25d039(0x200)][_0x25d039(0x1b8)]);}};CramiService=__decorate([(0x0,common_1[_0x16de40(0x1c5)])(),__param(0x0,(0x0,typeorm_1[_0x16de40(0x1e2)])(crami_entity_1[_0x16de40(0x1de)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x16de40(0x1d4)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__metadata(_0x16de40(0x211),[typeorm_2[_0x16de40(0x1d3)],typeorm_2[_0x16de40(0x1d3)],typeorm_2[_0x16de40(0x1d3)],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x16de40(0x212)]=CramiService;