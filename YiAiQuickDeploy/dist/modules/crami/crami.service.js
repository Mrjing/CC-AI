'use strict';const _0x58b952=_0x19d1;(function(_0x54bc10,_0x5e89ac){const _0x13ac36=_0x19d1,_0x14736d=_0x54bc10();while(!![]){try{const _0x1b4f4e=parseInt(_0x13ac36(0x1fb))/0x1*(-parseInt(_0x13ac36(0x1f8))/0x2)+-parseInt(_0x13ac36(0x1fc))/0x3+-parseInt(_0x13ac36(0x213))/0x4*(-parseInt(_0x13ac36(0x1f9))/0x5)+parseInt(_0x13ac36(0x21b))/0x6+parseInt(_0x13ac36(0x206))/0x7+-parseInt(_0x13ac36(0x1d0))/0x8+parseInt(_0x13ac36(0x1f6))/0x9;if(_0x1b4f4e===_0x5e89ac)break;else _0x14736d['push'](_0x14736d['shift']());}catch(_0x2fc544){_0x14736d['push'](_0x14736d['shift']());}}}(_0x1e96,0xbfa3a));var __decorate=this&&this[_0x58b952(0x1f1)]||function(_0x1a49c8,_0x3f293b,_0x2f607e,_0x69bccf){const _0x57009b=_0x58b952;var _0xa68652=arguments[_0x57009b(0x215)],_0x425c97=_0xa68652<0x3?_0x3f293b:_0x69bccf===null?_0x69bccf=Object[_0x57009b(0x1f7)](_0x3f293b,_0x2f607e):_0x69bccf,_0x5a659a;if(typeof Reflect===_0x57009b(0x1d8)&&typeof Reflect[_0x57009b(0x1cb)]===_0x57009b(0x1f2))_0x425c97=Reflect[_0x57009b(0x1cb)](_0x1a49c8,_0x3f293b,_0x2f607e,_0x69bccf);else{for(var _0x50a762=_0x1a49c8[_0x57009b(0x215)]-0x1;_0x50a762>=0x0;_0x50a762--)if(_0x5a659a=_0x1a49c8[_0x50a762])_0x425c97=(_0xa68652<0x3?_0x5a659a(_0x425c97):_0xa68652>0x3?_0x5a659a(_0x3f293b,_0x2f607e,_0x425c97):_0x5a659a(_0x3f293b,_0x2f607e))||_0x425c97;}return _0xa68652>0x3&&_0x425c97&&Object['defineProperty'](_0x3f293b,_0x2f607e,_0x425c97),_0x425c97;},__metadata=this&&this[_0x58b952(0x202)]||function(_0x495d7c,_0x4d09b5){const _0x153101=_0x58b952;if(typeof Reflect==='object'&&typeof Reflect[_0x153101(0x21d)]===_0x153101(0x1f2))return Reflect[_0x153101(0x21d)](_0x495d7c,_0x4d09b5);},__param=this&&this[_0x58b952(0x20c)]||function(_0x131b70,_0x32185e){return function(_0x58d729,_0x392ab7){_0x32185e(_0x58d729,_0x392ab7,_0x131b70);};};Object['defineProperty'](exports,_0x58b952(0x20f),{'value':!![]}),exports[_0x58b952(0x1d7)]=void 0x0;const common_1=require(_0x58b952(0x1cf)),crami_entity_1=require(_0x58b952(0x20d)),typeorm_1=require(_0x58b952(0x1fe)),typeorm_2=require(_0x58b952(0x218)),cramiPackage_entity_1=require(_0x58b952(0x1e7)),utils_1=require(_0x58b952(0x1ff)),user_entity_1=require(_0x58b952(0x219)),userBalance_service_1=require(_0x58b952(0x212)),balance_constant_1=require('../../common/constants/balance.constant');function _0x19d1(_0x254a1f,_0x720565){const _0x1e9601=_0x1e96();return _0x19d1=function(_0x19d17d,_0x159796){_0x19d17d=_0x19d17d-0x1c1;let _0x5f2ba6=_0x1e9601[_0x19d17d];return _0x5f2ba6;},_0x19d1(_0x254a1f,_0x720565);}let CramiService=class CramiService{constructor(_0x538406,_0x25c382,_0x2b9199,_0x3707d2){const _0x5f5cec=_0x58b952;this[_0x5f5cec(0x1d4)]=_0x538406,this[_0x5f5cec(0x1c3)]=_0x25c382,this['userEntity']=_0x2b9199,this['userBalanceService']=_0x3707d2;}async['queryOnePackage'](_0x59990f){const _0xefbc14=_0x58b952;return await this[_0xefbc14(0x1c3)][_0xefbc14(0x1c5)]({'where':{'id':_0x59990f}});}async['queryAllPackage'](_0x5bcae6){const _0x42369e=_0x58b952;try{const {page:page=0x1,size:size=0xa,name:_0x59d9c4,status:_0x1ed8a9,type:_0x45365d}=_0x5bcae6,_0x54a4fe={};_0x59d9c4&&Object[_0x42369e(0x1cc)](_0x54a4fe,{'name':(0x0,typeorm_2[_0x42369e(0x1d6)])('%'+_0x59d9c4+'%')}),_0x1ed8a9&&Object[_0x42369e(0x1cc)](_0x54a4fe,{'status':_0x1ed8a9});_0x45365d&&(_0x45365d>0x0?Object['assign'](_0x54a4fe,{'days':(0x0,typeorm_2[_0x42369e(0x1ea)])(0x0)}):Object[_0x42369e(0x1cc)](_0x54a4fe,{'days':(0x0,typeorm_2['LessThanOrEqual'])(0x0)}));const [_0x519040,_0xeba9e8]=await this['cramiPackageEntity']['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x54a4fe,'order':{'order':_0x42369e(0x1cd)}});return{'rows':_0x519040,'count':_0xeba9e8};}catch(_0x106305){console[_0x42369e(0x201)](_0x42369e(0x1e6),_0x106305);}}async[_0x58b952(0x1e5)](_0x6d9abe){const _0x193481=_0x58b952,{name:_0x2b3b34,weight:_0xcb4a8a}=_0x6d9abe,_0x419e62=await this[_0x193481(0x1c3)][_0x193481(0x1c5)]({'where':[{'name':_0x2b3b34},{'weight':_0xcb4a8a}]});if(_0x419e62)throw new common_1['HttpException'](_0x193481(0x1c2),common_1['HttpStatus'][_0x193481(0x1d1)]);try{return await this[_0x193481(0x1c3)][_0x193481(0x1ce)](_0x6d9abe);}catch(_0x4b4372){console[_0x193481(0x201)](_0x193481(0x1e6),_0x4b4372);throw new common_1['HttpException'](_0x4b4372,common_1[_0x193481(0x1ed)][_0x193481(0x1d1)]);}}async[_0x58b952(0x1fa)](_0x28989b){const _0x66e48b=_0x58b952,{id:_0xd1ce4f,name:_0x571c4d,weight:_0x23c5ab}=_0x28989b,_0x32e678=await this[_0x66e48b(0x1c3)]['findOne']({'where':{'id':_0xd1ce4f}});if(!_0x32e678)throw new common_1['HttpException'](_0x66e48b(0x217),common_1['HttpStatus'][_0x66e48b(0x1d1)]);const _0x339adf=await this[_0x66e48b(0x1c3)][_0x66e48b(0x1e0)]({'where':[{'name':_0x571c4d,'id':(0x0,typeorm_2[_0x66e48b(0x20a)])(_0xd1ce4f)},{'weight':_0x23c5ab,'id':(0x0,typeorm_2[_0x66e48b(0x20a)])(_0xd1ce4f)}]});if(_0x339adf)throw new common_1[(_0x66e48b(0x1e3))](_0x66e48b(0x1c2),common_1[_0x66e48b(0x1ed)][_0x66e48b(0x1d1)]);const _0x478cbf=await this[_0x66e48b(0x1c3)][_0x66e48b(0x1c6)]({'id':_0xd1ce4f},_0x28989b);if(_0x478cbf[_0x66e48b(0x20b)]>0x0)return _0x66e48b(0x1da);else throw new common_1['HttpException'](_0x66e48b(0x1ef),common_1['HttpStatus'][_0x66e48b(0x1d1)]);}async[_0x58b952(0x1d9)](_0x24f5cb){const _0x1ea7bd=_0x58b952,{id:_0x3999ff}=_0x24f5cb,_0x24c638=await this['cramiEntity'][_0x1ea7bd(0x1e0)]({'where':{'packageId':_0x3999ff}});if(_0x24c638)throw new common_1[(_0x1ea7bd(0x1e3))](_0x1ea7bd(0x1f4),common_1['HttpStatus'][_0x1ea7bd(0x1d1)]);return await this['cramiPackageEntity'][_0x1ea7bd(0x21f)]({'id':_0x3999ff});}async[_0x58b952(0x1c7)](_0x2ed412){const _0x30336f=_0x58b952,{packageId:_0x3fdf3d,count:count=0x1}=_0x2ed412;if(_0x3fdf3d){const _0x1f9206=await this['cramiPackageEntity'][_0x30336f(0x1c5)]({'where':{'id':_0x3fdf3d}});if(!_0x1f9206)throw new common_1[(_0x30336f(0x1e3))]('当前套餐不存在、请确认您选择的套餐是否存在！',common_1[_0x30336f(0x1ed)][_0x30336f(0x1d1)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1f9206,_0x137003={'packageId':_0x3fdf3d,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x30336f(0x1f3)](_0x137003,count);}if(!_0x3fdf3d){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x2ed412;if([model3Count,model4Count,drawMjCount][_0x30336f(0x1db)](_0xf79158=>!_0xf79158))throw new common_1['HttpException']('自定义卡密必须至少一项余额不为0️零！',common_1[_0x30336f(0x1ed)][_0x30336f(0x1d1)]);const _0x25b103={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x30336f(0x1f3)](_0x25b103,count);}}async[_0x58b952(0x1f3)](_0x444800,_0x323531){const _0x5bf23e=_0x58b952,_0x2ed204=[];for(let _0x34b83f=0x0;_0x34b83f<_0x323531;_0x34b83f++){const _0x56392a=(0x0,utils_1[_0x5bf23e(0x1ee)])(),_0x20e77f=this[_0x5bf23e(0x1d4)][_0x5bf23e(0x216)](Object['assign'](Object[_0x5bf23e(0x1cc)]({},_0x444800),{'code':_0x56392a}));_0x2ed204[_0x5bf23e(0x211)](_0x20e77f);}return await this[_0x5bf23e(0x1d4)][_0x5bf23e(0x1ce)](_0x2ed204);}async['useCrami'](_0x48296e,_0x6a21ce){const _0x11ef04=_0x58b952,{id:_0x9c90d0}=_0x48296e[_0x11ef04(0x203)],_0x1e42f1=await this[_0x11ef04(0x1d4)][_0x11ef04(0x1c5)]({'where':{'code':_0x6a21ce[_0x11ef04(0x200)]}});if(!_0x1e42f1)throw new common_1[(_0x11ef04(0x1e3))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1['HttpStatus'][_0x11ef04(0x1d1)]);const {status:_0x4175dd,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0xbdb1a8}=_0x1e42f1;if(_0x4175dd===0x1)throw new common_1['HttpException'](_0x11ef04(0x1dd),common_1['HttpStatus'][_0x11ef04(0x1d1)]);const _0x5baa5d={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0xbdb1a8};return await this[_0x11ef04(0x1e4)][_0x11ef04(0x1c1)](_0x9c90d0,Object[_0x11ef04(0x1cc)]({},_0x5baa5d),days),await this[_0x11ef04(0x1e4)][_0x11ef04(0x1e8)]({'userId':_0x9c90d0,'rechargeType':balance_constant_1[_0x11ef04(0x1c9)][_0x11ef04(0x1fd)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x11ef04(0x1d4)]['update']({'code':_0x6a21ce['code']},{'useId':_0x9c90d0,'status':0x1}),_0x11ef04(0x21e);}async['queryAllCrami'](_0x3f8736,_0x5d54a7){const _0x1abf91=_0x58b952,{page:page=0x1,size:size=0xa,status:_0x54bcb3,useId:_0x53fd4f}=_0x3f8736,_0x57a877={};_0x54bcb3&&Object[_0x1abf91(0x1cc)](_0x57a877,{'status':_0x54bcb3}),_0x53fd4f&&Object[_0x1abf91(0x1cc)](_0x57a877,{'useId':_0x53fd4f});const [_0x2daecd,_0x5bfbff]=await this[_0x1abf91(0x1d4)][_0x1abf91(0x1e1)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x1abf91(0x1cd)},'where':_0x57a877}),_0x4aae37=_0x2daecd[_0x1abf91(0x1df)](_0x41caad=>_0x41caad[_0x1abf91(0x208)]),_0x3223ed=_0x2daecd[_0x1abf91(0x1df)](_0x59a21d=>_0x59a21d['packageId']),_0x4a457a=await this[_0x1abf91(0x21c)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4aae37)}}),_0x327ee7=await this['cramiPackageEntity'][_0x1abf91(0x21a)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3223ed)}});return _0x2daecd[_0x1abf91(0x20e)](_0x29dcde=>{const _0x395118=_0x1abf91;var _0x1a06ff,_0x17d71b,_0x144e28;_0x29dcde[_0x395118(0x1de)]=(_0x1a06ff=_0x4a457a[_0x395118(0x21a)](_0x1e86fc=>_0x1e86fc['id']===_0x29dcde[_0x395118(0x208)]))===null||_0x1a06ff===void 0x0?void 0x0:_0x1a06ff[_0x395118(0x1de)],_0x29dcde['email']=(_0x17d71b=_0x4a457a[_0x395118(0x21a)](_0x40ea8a=>_0x40ea8a['id']===_0x29dcde['useId']))===null||_0x17d71b===void 0x0?void 0x0:_0x17d71b[_0x395118(0x1c8)],_0x29dcde[_0x395118(0x1e9)]=(_0x144e28=_0x327ee7[_0x395118(0x21a)](_0x5cfeaf=>_0x5cfeaf['id']===_0x29dcde[_0x395118(0x1eb)]))===null||_0x144e28===void 0x0?void 0x0:_0x144e28[_0x395118(0x1ca)];}),_0x5d54a7['user'][_0x1abf91(0x1ec)]!==_0x1abf91(0x207)&&_0x2daecd[_0x1abf91(0x20e)](_0xafe73b=>_0xafe73b[_0x1abf91(0x1c8)]=(0x0,utils_1[_0x1abf91(0x1f5)])(_0xafe73b[_0x1abf91(0x1c8)])),_0x5d54a7[_0x1abf91(0x203)][_0x1abf91(0x1ec)]!==_0x1abf91(0x207)&&_0x2daecd[_0x1abf91(0x20e)](_0x4eff7d=>_0x4eff7d['code']=(0x0,utils_1[_0x1abf91(0x204)])(_0x4eff7d['code'])),{'rows':_0x2daecd,'count':_0x5bfbff};}async[_0x58b952(0x1d5)](_0x74ac08){const _0x228174=_0x58b952,_0x4e224c=await this[_0x228174(0x1d4)][_0x228174(0x1c5)]({'where':{'id':_0x74ac08}});if(!_0x4e224c)throw new common_1[(_0x228174(0x1e3))](_0x228174(0x1d2),common_1[_0x228174(0x1ed)][_0x228174(0x1d1)]);if(_0x4e224c['status']===0x1)throw new common_1[(_0x228174(0x1e3))](_0x228174(0x209),common_1['HttpStatus'][_0x228174(0x1d1)]);return await this[_0x228174(0x1d4)]['delete']({'id':_0x74ac08});}async['batchDelCrami'](_0x40ee00){const _0x84b7af=_0x58b952,{ids:_0x210a09}=_0x40ee00,_0x1def53=await this[_0x84b7af(0x1d4)]['delete'](_0x210a09);if(_0x1def53[_0x84b7af(0x20b)]>0x0)return'删除卡密成功！';else throw new common_1['HttpException'](_0x84b7af(0x214),common_1[_0x84b7af(0x1ed)][_0x84b7af(0x1d1)]);}};function _0x1e96(){const _0x25cc0a=['MoreThan','packageId','role','HttpStatus','generateCramiCode','更新套餐失败、请重试！','Repository','__decorate','function','generateCrami','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','maskEmail','5583699FSnwty','getOwnPropertyDescriptor','1384156gQlDyH','861450UNBZil','updatePackage','1weNQJJ','2786073QvLjwt','PACKAGE_GIFT','@nestjs/typeorm','../../common/utils','code','log','__metadata','user','maskCrami','UserEntity','3791137INlhCJ','super','useId','当前卡密已被使用、已使用的卡密禁止删除！','Not','affected','__param','./crami.entity','forEach','__esModule','InjectRepository','push','../userBalance/userBalance.service','28VtJTQs','删除卡密失败、请重试！','length','create','当前套餐不存在、请检查你的输入参数！','typeorm','../user/user.entity','find','3122220YlAzvl','userEntity','metadata','使用卡密成功','delete','addBalanceToUser','套餐名称或套餐等级重复、请检查！','cramiPackageEntity','UserBalanceService','findOne','update','createCrami','email','RechargeType','name','decorate','assign','DESC','save','@nestjs/common','3861432CfLRaJ','BAD_REQUEST','当前卡密不存在、请确认您要删除的卡密是否存在！','CramiEntity','cramiEntity','delCrami','Like','CramiService','object','delPackage','更新套餐成功！','every','design:paramtypes','当前卡密已被使用、请确认您输入的卡密是否正确！','username','map','count','findAndCount','CramiPackageEntity','HttpException','userBalanceService','createPackage','error:\x20','./cramiPackage.entity','saveRecordRechargeLog','packageName'];_0x1e96=function(){return _0x25cc0a;};return _0x1e96();}CramiService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x58b952(0x210)])(crami_entity_1[_0x58b952(0x1d3)])),__param(0x1,(0x0,typeorm_1[_0x58b952(0x210)])(cramiPackage_entity_1[_0x58b952(0x1e2)])),__param(0x2,(0x0,typeorm_1[_0x58b952(0x210)])(user_entity_1[_0x58b952(0x205)])),__metadata(_0x58b952(0x1dc),[typeorm_2[_0x58b952(0x1f0)],typeorm_2[_0x58b952(0x1f0)],typeorm_2[_0x58b952(0x1f0)],userBalance_service_1[_0x58b952(0x1c4)]])],CramiService),exports[_0x58b952(0x1d7)]=CramiService;