'use strict';const _0x39396e=_0x54f1;(function(_0x5c6845,_0xe543a){const _0x36df87=_0x54f1,_0x18960a=_0x5c6845();while(!![]){try{const _0x4f35fd=parseInt(_0x36df87(0xd0))/0x1*(-parseInt(_0x36df87(0xe0))/0x2)+parseInt(_0x36df87(0x109))/0x3*(-parseInt(_0x36df87(0xf7))/0x4)+-parseInt(_0x36df87(0x11a))/0x5*(-parseInt(_0x36df87(0x10c))/0x6)+parseInt(_0x36df87(0xd9))/0x7*(-parseInt(_0x36df87(0xca))/0x8)+parseInt(_0x36df87(0xdd))/0x9*(parseInt(_0x36df87(0x127))/0xa)+parseInt(_0x36df87(0x11d))/0xb*(parseInt(_0x36df87(0x11f))/0xc)+parseInt(_0x36df87(0x106))/0xd;if(_0x4f35fd===_0xe543a)break;else _0x18960a['push'](_0x18960a['shift']());}catch(_0x167f85){_0x18960a['push'](_0x18960a['shift']());}}}(_0x1ae5,0x5e5be));function _0x1ae5(){const _0x38fda7=['./cramiPackage.entity','packageName','createCrami','metadata','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','RechargeType','DESC','更新套餐成功！','CramiService','38372cwKgSB','CramiEntity','push','CramiPackageEntity','cramiPackageEntity','object','findAndCount','findOne','InjectRepository','assign','user','Injectable','删除卡密成功！','find','affected','8443903sQmlez','super','getOwnPropertyDescriptor','57XeWyBk','../userBalance/userBalance.service','batchDelCrami','12jXPbxm','username','useCrami','当前卡密已被使用、已使用的卡密禁止删除！','forEach','error:\x20','Not','length','typeorm','使用卡密成功','queryAllPackage','__param','maskCrami','当前套餐不存在、请确认您选择的套餐是否存在！','112505hBdpvV','generateCrami','__decorate','913UFgHgX','当前卡密已被使用、请确认您输入的卡密是否正确！','85716wSVdCf','cramiEntity','Like','defineProperty','maskEmail','PACKAGE_GIFT','当前套餐不存在、请检查你的输入参数！','saveRecordRechargeLog','15340VnIqvf','code','queryOnePackage','function','updatePackage','queryAllCrami','14824FRZETh','@nestjs/common','decorate','log','HttpStatus','status','8hdeEbF','@nestjs/typeorm','count','__esModule','LessThanOrEqual','update','addBalanceToUser','MoreThan','当前卡密不存在、请确认您要删除的卡密是否存在！','1057qudEmf','更新套餐失败、请重试！','__metadata','BAD_REQUEST','1179HepbVW','userBalanceService','role','159948glkKQk','save','userEntity','every','design:paramtypes','../../common/constants/balance.constant','useId','packageId','email','删除卡密失败、请重试！','map','HttpException','Repository','delete'];_0x1ae5=function(){return _0x38fda7;};return _0x1ae5();}var __decorate=this&&this[_0x39396e(0x11c)]||function(_0x5103b6,_0x4ee5bf,_0x2e16e7,_0x5c8525){const _0x1e5f55=_0x39396e;var _0x599790=arguments[_0x1e5f55(0x113)],_0x1e7f21=_0x599790<0x3?_0x4ee5bf:_0x5c8525===null?_0x5c8525=Object[_0x1e5f55(0x108)](_0x4ee5bf,_0x2e16e7):_0x5c8525,_0x1f1313;if(typeof Reflect===_0x1e5f55(0xfc)&&typeof Reflect[_0x1e5f55(0xcc)]===_0x1e5f55(0x12a))_0x1e7f21=Reflect[_0x1e5f55(0xcc)](_0x5103b6,_0x4ee5bf,_0x2e16e7,_0x5c8525);else{for(var _0x2e3688=_0x5103b6[_0x1e5f55(0x113)]-0x1;_0x2e3688>=0x0;_0x2e3688--)if(_0x1f1313=_0x5103b6[_0x2e3688])_0x1e7f21=(_0x599790<0x3?_0x1f1313(_0x1e7f21):_0x599790>0x3?_0x1f1313(_0x4ee5bf,_0x2e16e7,_0x1e7f21):_0x1f1313(_0x4ee5bf,_0x2e16e7))||_0x1e7f21;}return _0x599790>0x3&&_0x1e7f21&&Object[_0x1e5f55(0x122)](_0x4ee5bf,_0x2e16e7,_0x1e7f21),_0x1e7f21;},__metadata=this&&this[_0x39396e(0xdb)]||function(_0x3eb822,_0x1eca91){const _0x55e3f0=_0x39396e;if(typeof Reflect===_0x55e3f0(0xfc)&&typeof Reflect[_0x55e3f0(0xf1)]===_0x55e3f0(0x12a))return Reflect[_0x55e3f0(0xf1)](_0x3eb822,_0x1eca91);},__param=this&&this[_0x39396e(0x117)]||function(_0x4d2b3b,_0x1b9920){return function(_0x421b36,_0x613a2f){_0x1b9920(_0x421b36,_0x613a2f,_0x4d2b3b);};};function _0x54f1(_0x1201b7,_0x281a4c){const _0x1ae51=_0x1ae5();return _0x54f1=function(_0x54f18e,_0x3c917d){_0x54f18e=_0x54f18e-0xca;let _0x596ce1=_0x1ae51[_0x54f18e];return _0x596ce1;},_0x54f1(_0x1201b7,_0x281a4c);}Object[_0x39396e(0x122)](exports,_0x39396e(0xd3),{'value':!![]}),exports[_0x39396e(0xf6)]=void 0x0;const common_1=require(_0x39396e(0xcb)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x39396e(0xd1)),typeorm_2=require(_0x39396e(0x114)),cramiPackage_entity_1=require(_0x39396e(0xee)),utils_1=require('../../common/utils'),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x39396e(0x10a)),balance_constant_1=require(_0x39396e(0xe5));let CramiService=class CramiService{constructor(_0x1a6de1,_0x309037,_0xa015c2,_0x2f4622){const _0x2215fe=_0x39396e;this['cramiEntity']=_0x1a6de1,this[_0x2215fe(0xfb)]=_0x309037,this['userEntity']=_0xa015c2,this['userBalanceService']=_0x2f4622;}async[_0x39396e(0x129)](_0x1c1804){const _0x2f05fa=_0x39396e;return await this[_0x2f05fa(0xfb)][_0x2f05fa(0xfe)]({'where':{'id':_0x1c1804}});}async[_0x39396e(0x116)](_0x20020a){const _0x25b00f=_0x39396e;try{const {page:page=0x1,size:size=0xa,name:_0x314cb3,status:_0x28e1bf,type:_0x3f0196}=_0x20020a,_0x46dc46={};_0x314cb3&&Object[_0x25b00f(0x100)](_0x46dc46,{'name':(0x0,typeorm_2[_0x25b00f(0x121)])('%'+_0x314cb3+'%')}),_0x28e1bf&&Object[_0x25b00f(0x100)](_0x46dc46,{'status':_0x28e1bf});_0x3f0196&&(_0x3f0196>0x0?Object[_0x25b00f(0x100)](_0x46dc46,{'days':(0x0,typeorm_2[_0x25b00f(0xd7)])(0x0)}):Object['assign'](_0x46dc46,{'days':(0x0,typeorm_2[_0x25b00f(0xd4)])(0x0)}));const [_0x579ecf,_0x149e4a]=await this[_0x25b00f(0xfb)][_0x25b00f(0xfd)]({'skip':(page-0x1)*size,'take':size,'where':_0x46dc46,'order':{'order':'DESC'}});return{'rows':_0x579ecf,'count':_0x149e4a};}catch(_0x4e84dc){console[_0x25b00f(0xcd)](_0x25b00f(0x111),_0x4e84dc);}}async['createPackage'](_0x14c77d){const _0x521e3b=_0x39396e,{name:_0x135e1f,weight:_0xa7e41f}=_0x14c77d,_0x5b1e67=await this[_0x521e3b(0xfb)][_0x521e3b(0xfe)]({'where':[{'name':_0x135e1f},{'weight':_0xa7e41f}]});if(_0x5b1e67)throw new common_1[(_0x521e3b(0xeb))]('套餐名称或套餐等级重复、请检查！',common_1['HttpStatus'][_0x521e3b(0xdc)]);try{return await this[_0x521e3b(0xfb)][_0x521e3b(0xe1)](_0x14c77d);}catch(_0x4d0f73){console['log'](_0x521e3b(0x111),_0x4d0f73);throw new common_1[(_0x521e3b(0xeb))](_0x4d0f73,common_1[_0x521e3b(0xce)][_0x521e3b(0xdc)]);}}async[_0x39396e(0x12b)](_0x3752d1){const _0x46ca63=_0x39396e,{id:_0x4703de,name:_0x3405b7,weight:_0xe3a472}=_0x3752d1,_0x24f7d2=await this[_0x46ca63(0xfb)][_0x46ca63(0xfe)]({'where':{'id':_0x4703de}});if(!_0x24f7d2)throw new common_1[(_0x46ca63(0xeb))](_0x46ca63(0x125),common_1['HttpStatus']['BAD_REQUEST']);const _0x4f42eb=await this[_0x46ca63(0xfb)][_0x46ca63(0xd2)]({'where':[{'name':_0x3405b7,'id':(0x0,typeorm_2[_0x46ca63(0x112)])(_0x4703de)},{'weight':_0xe3a472,'id':(0x0,typeorm_2[_0x46ca63(0x112)])(_0x4703de)}]});if(_0x4f42eb)throw new common_1[(_0x46ca63(0xeb))]('套餐名称或套餐等级重复、请检查！',common_1[_0x46ca63(0xce)][_0x46ca63(0xdc)]);const _0x5b8f33=await this[_0x46ca63(0xfb)][_0x46ca63(0xd5)]({'id':_0x4703de},_0x3752d1);if(_0x5b8f33[_0x46ca63(0x105)]>0x0)return _0x46ca63(0xf5);else throw new common_1[(_0x46ca63(0xeb))](_0x46ca63(0xda),common_1[_0x46ca63(0xce)]['BAD_REQUEST']);}async['delPackage'](_0x1a9bfe){const _0x35dcca=_0x39396e,{id:_0x5a3ba9}=_0x1a9bfe,_0x4c58e7=await this[_0x35dcca(0x120)][_0x35dcca(0xd2)]({'where':{'packageId':_0x5a3ba9}});if(_0x4c58e7)throw new common_1[(_0x35dcca(0xeb))](_0x35dcca(0xf2),common_1[_0x35dcca(0xce)][_0x35dcca(0xdc)]);return await this[_0x35dcca(0xfb)]['delete']({'id':_0x5a3ba9});}async[_0x39396e(0xf0)](_0xc1a7f4){const _0xc93d76=_0x39396e,{packageId:_0x3bb804,count:count=0x1}=_0xc1a7f4;if(_0x3bb804){const _0x1d83bb=await this[_0xc93d76(0xfb)][_0xc93d76(0xfe)]({'where':{'id':_0x3bb804}});if(!_0x1d83bb)throw new common_1[(_0xc93d76(0xeb))](_0xc93d76(0x119),common_1[_0xc93d76(0xce)][_0xc93d76(0xdc)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1d83bb,_0x268295={'packageId':_0x3bb804,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0xc93d76(0x11b)](_0x268295,count);}if(!_0x3bb804){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0xc1a7f4;if([model3Count,model4Count,drawMjCount][_0xc93d76(0xe3)](_0x510689=>!_0x510689))throw new common_1[(_0xc93d76(0xeb))]('自定义卡密必须至少一项余额不为0️零！',common_1[_0xc93d76(0xce)][_0xc93d76(0xdc)]);const _0x548cb2={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0xc93d76(0x11b)](_0x548cb2,count);}}async[_0x39396e(0x11b)](_0x277008,_0x4d28e5){const _0x260c6f=_0x39396e,_0x389f34=[];for(let _0xa27f35=0x0;_0xa27f35<_0x4d28e5;_0xa27f35++){const _0x36202d=(0x0,utils_1['generateCramiCode'])(),_0x1253c9=this[_0x260c6f(0x120)]['create'](Object[_0x260c6f(0x100)](Object['assign']({},_0x277008),{'code':_0x36202d}));_0x389f34[_0x260c6f(0xf9)](_0x1253c9);}return await this[_0x260c6f(0x120)]['save'](_0x389f34);}async[_0x39396e(0x10e)](_0x25ec48,_0x68e0a){const _0x13391a=_0x39396e,{id:_0x271d52}=_0x25ec48['user'],_0x5895c5=await this['cramiEntity'][_0x13391a(0xfe)]({'where':{'code':_0x68e0a[_0x13391a(0x128)]}});if(!_0x5895c5)throw new common_1[(_0x13391a(0xeb))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1[_0x13391a(0xce)]['BAD_REQUEST']);const {status:_0x5b7cab,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x186f56}=_0x5895c5;if(_0x5b7cab===0x1)throw new common_1['HttpException'](_0x13391a(0x11e),common_1[_0x13391a(0xce)][_0x13391a(0xdc)]);const _0x2843aa={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x186f56};return await this['userBalanceService'][_0x13391a(0xd6)](_0x271d52,Object[_0x13391a(0x100)]({},_0x2843aa),days),await this[_0x13391a(0xde)][_0x13391a(0x126)]({'userId':_0x271d52,'rechargeType':balance_constant_1[_0x13391a(0xf3)][_0x13391a(0x124)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x13391a(0x120)]['update']({'code':_0x68e0a['code']},{'useId':_0x271d52,'status':0x1}),_0x13391a(0x115);}async[_0x39396e(0x12c)](_0x4f0d16,_0x336221){const _0x1e7e53=_0x39396e,{page:page=0x1,size:size=0xa,status:_0x140fa8,useId:_0x1aad51}=_0x4f0d16,_0x3c5338={};_0x140fa8&&Object['assign'](_0x3c5338,{'status':_0x140fa8}),_0x1aad51&&Object[_0x1e7e53(0x100)](_0x3c5338,{'useId':_0x1aad51});const [_0x427791,_0x2e33db]=await this[_0x1e7e53(0x120)][_0x1e7e53(0xfd)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x1e7e53(0xf4)},'where':_0x3c5338}),_0x2c5cf0=_0x427791[_0x1e7e53(0xea)](_0x5c5290=>_0x5c5290[_0x1e7e53(0xe6)]),_0x4758e7=_0x427791['map'](_0x1affd1=>_0x1affd1[_0x1e7e53(0xe7)]),_0x196b04=await this[_0x1e7e53(0xe2)][_0x1e7e53(0x104)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2c5cf0)}}),_0x5dbfb8=await this['cramiPackageEntity'][_0x1e7e53(0x104)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4758e7)}});return _0x427791[_0x1e7e53(0x110)](_0x1bb10e=>{const _0x3272e1=_0x1e7e53;var _0x3ca093,_0x57fd72,_0x1b8a76;_0x1bb10e[_0x3272e1(0x10d)]=(_0x3ca093=_0x196b04[_0x3272e1(0x104)](_0x282f3e=>_0x282f3e['id']===_0x1bb10e[_0x3272e1(0xe6)]))===null||_0x3ca093===void 0x0?void 0x0:_0x3ca093[_0x3272e1(0x10d)],_0x1bb10e['email']=(_0x57fd72=_0x196b04[_0x3272e1(0x104)](_0x278553=>_0x278553['id']===_0x1bb10e[_0x3272e1(0xe6)]))===null||_0x57fd72===void 0x0?void 0x0:_0x57fd72[_0x3272e1(0xe8)],_0x1bb10e[_0x3272e1(0xef)]=(_0x1b8a76=_0x5dbfb8[_0x3272e1(0x104)](_0x5d8fc2=>_0x5d8fc2['id']===_0x1bb10e['packageId']))===null||_0x1b8a76===void 0x0?void 0x0:_0x1b8a76['name'];}),_0x336221[_0x1e7e53(0x101)][_0x1e7e53(0xdf)]!==_0x1e7e53(0x107)&&_0x427791[_0x1e7e53(0x110)](_0x22e235=>_0x22e235[_0x1e7e53(0xe8)]=(0x0,utils_1[_0x1e7e53(0x123)])(_0x22e235[_0x1e7e53(0xe8)])),_0x336221['user'][_0x1e7e53(0xdf)]!=='super'&&_0x427791[_0x1e7e53(0x110)](_0x4f5803=>_0x4f5803['code']=(0x0,utils_1[_0x1e7e53(0x118)])(_0x4f5803[_0x1e7e53(0x128)])),{'rows':_0x427791,'count':_0x2e33db};}async['delCrami'](_0x4aeafb){const _0x5dfe63=_0x39396e,_0x3dbb27=await this[_0x5dfe63(0x120)][_0x5dfe63(0xfe)]({'where':{'id':_0x4aeafb}});if(!_0x3dbb27)throw new common_1[(_0x5dfe63(0xeb))](_0x5dfe63(0xd8),common_1[_0x5dfe63(0xce)]['BAD_REQUEST']);if(_0x3dbb27[_0x5dfe63(0xcf)]===0x1)throw new common_1[(_0x5dfe63(0xeb))](_0x5dfe63(0x10f),common_1[_0x5dfe63(0xce)]['BAD_REQUEST']);return await this[_0x5dfe63(0x120)]['delete']({'id':_0x4aeafb});}async[_0x39396e(0x10b)](_0x2d7867){const _0x2ebb29=_0x39396e,{ids:_0x3f33dd}=_0x2d7867,_0x30ade0=await this[_0x2ebb29(0x120)][_0x2ebb29(0xed)](_0x3f33dd);if(_0x30ade0[_0x2ebb29(0x105)]>0x0)return _0x2ebb29(0x103);else throw new common_1[(_0x2ebb29(0xeb))](_0x2ebb29(0xe9),common_1[_0x2ebb29(0xce)][_0x2ebb29(0xdc)]);}};CramiService=__decorate([(0x0,common_1[_0x39396e(0x102)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1[_0x39396e(0xf8)])),__param(0x1,(0x0,typeorm_1[_0x39396e(0xff)])(cramiPackage_entity_1[_0x39396e(0xfa)])),__param(0x2,(0x0,typeorm_1[_0x39396e(0xff)])(user_entity_1['UserEntity'])),__metadata(_0x39396e(0xe4),[typeorm_2[_0x39396e(0xec)],typeorm_2[_0x39396e(0xec)],typeorm_2['Repository'],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x39396e(0xf6)]=CramiService;