'use strict';const _0x298940=_0x355a;(function(_0x317370,_0xc71489){const _0x4dace0=_0x355a,_0x285966=_0x317370();while(!![]){try{const _0x3a182c=parseInt(_0x4dace0(0x18a))/0x1+parseInt(_0x4dace0(0x17d))/0x2+-parseInt(_0x4dace0(0x147))/0x3*(parseInt(_0x4dace0(0x170))/0x4)+parseInt(_0x4dace0(0x167))/0x5*(-parseInt(_0x4dace0(0x155))/0x6)+parseInt(_0x4dace0(0x153))/0x7+-parseInt(_0x4dace0(0x145))/0x8*(-parseInt(_0x4dace0(0x14a))/0x9)+-parseInt(_0x4dace0(0x169))/0xa;if(_0x3a182c===_0xc71489)break;else _0x285966['push'](_0x285966['shift']());}catch(_0x4c31de){_0x285966['push'](_0x285966['shift']());}}}(_0x26ea,0xa0f00));function _0x26ea(){const _0x36f828=['24MzAFUi','typeorm','15OCkJKY','HttpException','every','2243961mxDCch','generateCrami','../user/user.entity','function','Like','cramiEntity','object','userBalanceService','saveRecordRechargeLog','2731988ZRPFov','maskEmail','18jXMWAj','user','UserEntity','Injectable','CramiService','当前卡密不存在、请确认您要删除的卡密是否存在！','save','find','PACKAGE_GIFT','log','affected','@nestjs/typeorm','当前卡密已被使用、请确认您输入的卡密是否正确！','更新套餐成功！','username','push','queryOnePackage','status','11940hJeeFn','addBalanceToUser','19400120YgodPN','decorate','forEach','batchDelCrami','updatePackage','Not','当前套餐不存在、请确认您选择的套餐是否存在！','483656fhEvkd','套餐名称或套餐等级重复、请检查！','HttpStatus','delete','cramiPackageEntity','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','../../common/constants/balance.constant','assign','MoreThan','BAD_REQUEST','findOne','findAndCount','./crami.entity','2213664fmYsmH','UserBalanceService','design:paramtypes','DESC','useId','RechargeType','length','使用卡密成功','update','自定义卡密必须至少一项余额不为0️零！','map','super','name','965843UTkRKg','删除卡密成功！','queryAllCrami','queryAllPackage','delCrami','error:\x20','maskCrami','generateCramiCode','email','__param','defineProperty','code','InjectRepository','../userBalance/userBalance.service','packageId','getOwnPropertyDescriptor','count','Repository','当前卡密已被使用、已使用的卡密禁止删除！','删除卡密失败、请重试！','role'];_0x26ea=function(){return _0x36f828;};return _0x26ea();}var __decorate=this&&this['__decorate']||function(_0x1df998,_0x212ddb,_0x369d34,_0x308950){const _0xf7e863=_0x355a;var _0x405da8=arguments[_0xf7e863(0x183)],_0x396c53=_0x405da8<0x3?_0x212ddb:_0x308950===null?_0x308950=Object[_0xf7e863(0x13f)](_0x212ddb,_0x369d34):_0x308950,_0x510093;if(typeof Reflect===_0xf7e863(0x150)&&typeof Reflect[_0xf7e863(0x16a)]===_0xf7e863(0x14d))_0x396c53=Reflect[_0xf7e863(0x16a)](_0x1df998,_0x212ddb,_0x369d34,_0x308950);else{for(var _0x427dc8=_0x1df998[_0xf7e863(0x183)]-0x1;_0x427dc8>=0x0;_0x427dc8--)if(_0x510093=_0x1df998[_0x427dc8])_0x396c53=(_0x405da8<0x3?_0x510093(_0x396c53):_0x405da8>0x3?_0x510093(_0x212ddb,_0x369d34,_0x396c53):_0x510093(_0x212ddb,_0x369d34))||_0x396c53;}return _0x405da8>0x3&&_0x396c53&&Object[_0xf7e863(0x13a)](_0x212ddb,_0x369d34,_0x396c53),_0x396c53;},__metadata=this&&this['__metadata']||function(_0x6ba362,_0x46d5d1){const _0x338340=_0x355a;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x338340(0x14d))return Reflect['metadata'](_0x6ba362,_0x46d5d1);},__param=this&&this[_0x298940(0x139)]||function(_0x1280ff,_0x1b24d5){return function(_0x5a1e8e,_0x1082ee){_0x1b24d5(_0x5a1e8e,_0x1082ee,_0x1280ff);};};Object[_0x298940(0x13a)](exports,'__esModule',{'value':!![]}),exports[_0x298940(0x159)]=void 0x0;const common_1=require('@nestjs/common'),crami_entity_1=require(_0x298940(0x17c)),typeorm_1=require(_0x298940(0x160)),typeorm_2=require(_0x298940(0x146)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require('../../common/utils'),user_entity_1=require(_0x298940(0x14c)),userBalance_service_1=require(_0x298940(0x13d)),balance_constant_1=require(_0x298940(0x176));let CramiService=class CramiService{constructor(_0x3bdf99,_0x3ae051,_0x461692,_0x4cb365){const _0x506043=_0x298940;this['cramiEntity']=_0x3bdf99,this['cramiPackageEntity']=_0x3ae051,this['userEntity']=_0x461692,this[_0x506043(0x151)]=_0x4cb365;}async[_0x298940(0x165)](_0x15bd22){const _0x53de8c=_0x298940;return await this[_0x53de8c(0x174)]['findOne']({'where':{'id':_0x15bd22}});}async[_0x298940(0x18d)](_0x40a791){const _0x3e5e68=_0x298940;try{const {page:page=0x1,size:size=0xa,name:_0x414a8d,status:_0x5a3e84,type:_0x33490e}=_0x40a791,_0x3cd2a1={};_0x414a8d&&Object[_0x3e5e68(0x177)](_0x3cd2a1,{'name':(0x0,typeorm_2[_0x3e5e68(0x14e)])('%'+_0x414a8d+'%')}),_0x5a3e84&&Object[_0x3e5e68(0x177)](_0x3cd2a1,{'status':_0x5a3e84});_0x33490e&&(_0x33490e>0x0?Object[_0x3e5e68(0x177)](_0x3cd2a1,{'days':(0x0,typeorm_2[_0x3e5e68(0x178)])(0x0)}):Object[_0x3e5e68(0x177)](_0x3cd2a1,{'days':(0x0,typeorm_2['LessThanOrEqual'])(0x0)}));const [_0x116382,_0x102fff]=await this[_0x3e5e68(0x174)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x3cd2a1,'order':{'order':_0x3e5e68(0x180)}});return{'rows':_0x116382,'count':_0x102fff};}catch(_0x564f2a){console[_0x3e5e68(0x15e)](_0x3e5e68(0x135),_0x564f2a);}}async['createPackage'](_0x332d64){const _0x4cdb84=_0x298940,{name:_0x3019cb,weight:_0x4eab64}=_0x332d64,_0x42f568=await this[_0x4cdb84(0x174)][_0x4cdb84(0x17a)]({'where':[{'name':_0x3019cb},{'weight':_0x4eab64}]});if(_0x42f568)throw new common_1[(_0x4cdb84(0x148))]('套餐名称或套餐等级重复、请检查！',common_1[_0x4cdb84(0x172)][_0x4cdb84(0x179)]);try{return await this['cramiPackageEntity'][_0x4cdb84(0x15b)](_0x332d64);}catch(_0x128a95){console[_0x4cdb84(0x15e)](_0x4cdb84(0x135),_0x128a95);throw new common_1[(_0x4cdb84(0x148))](_0x128a95,common_1[_0x4cdb84(0x172)]['BAD_REQUEST']);}}async[_0x298940(0x16d)](_0x1aba59){const _0x3a1bd5=_0x298940,{id:_0x5d0887,name:_0x1dfdde,weight:_0x497d33}=_0x1aba59,_0x5ee275=await this[_0x3a1bd5(0x174)][_0x3a1bd5(0x17a)]({'where':{'id':_0x5d0887}});if(!_0x5ee275)throw new common_1[(_0x3a1bd5(0x148))]('当前套餐不存在、请检查你的输入参数！',common_1['HttpStatus']['BAD_REQUEST']);const _0x448a15=await this['cramiPackageEntity']['count']({'where':[{'name':_0x1dfdde,'id':(0x0,typeorm_2['Not'])(_0x5d0887)},{'weight':_0x497d33,'id':(0x0,typeorm_2[_0x3a1bd5(0x16e)])(_0x5d0887)}]});if(_0x448a15)throw new common_1[(_0x3a1bd5(0x148))](_0x3a1bd5(0x171),common_1[_0x3a1bd5(0x172)][_0x3a1bd5(0x179)]);const _0x211e28=await this[_0x3a1bd5(0x174)][_0x3a1bd5(0x185)]({'id':_0x5d0887},_0x1aba59);if(_0x211e28[_0x3a1bd5(0x15f)]>0x0)return _0x3a1bd5(0x162);else throw new common_1[(_0x3a1bd5(0x148))]('更新套餐失败、请重试！',common_1[_0x3a1bd5(0x172)]['BAD_REQUEST']);}async['delPackage'](_0x3b03bd){const _0x4a49d7=_0x298940,{id:_0x3e4cb5}=_0x3b03bd,_0x5d07ba=await this[_0x4a49d7(0x14f)][_0x4a49d7(0x140)]({'where':{'packageId':_0x3e4cb5}});if(_0x5d07ba)throw new common_1['HttpException'](_0x4a49d7(0x175),common_1[_0x4a49d7(0x172)][_0x4a49d7(0x179)]);return await this[_0x4a49d7(0x174)]['delete']({'id':_0x3e4cb5});}async['createCrami'](_0x327500){const _0x2f45ec=_0x298940,{packageId:_0x759b84,count:count=0x1}=_0x327500;if(_0x759b84){const _0x376056=await this[_0x2f45ec(0x174)][_0x2f45ec(0x17a)]({'where':{'id':_0x759b84}});if(!_0x376056)throw new common_1[(_0x2f45ec(0x148))](_0x2f45ec(0x16f),common_1['HttpStatus'][_0x2f45ec(0x179)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x376056,_0x42af6b={'packageId':_0x759b84,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2f45ec(0x14b)](_0x42af6b,count);}if(!_0x759b84){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x327500;if([model3Count,model4Count,drawMjCount][_0x2f45ec(0x149)](_0x209588=>!_0x209588))throw new common_1[(_0x2f45ec(0x148))](_0x2f45ec(0x186),common_1['HttpStatus'][_0x2f45ec(0x179)]);const _0x433a6d={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2f45ec(0x14b)](_0x433a6d,count);}}async[_0x298940(0x14b)](_0x2d5da4,_0x1ec9aa){const _0x1e77e9=_0x298940,_0xf8ab07=[];for(let _0x453321=0x0;_0x453321<_0x1ec9aa;_0x453321++){const _0x5539df=(0x0,utils_1[_0x1e77e9(0x137)])(),_0x302dac=this[_0x1e77e9(0x14f)]['create'](Object[_0x1e77e9(0x177)](Object['assign']({},_0x2d5da4),{'code':_0x5539df}));_0xf8ab07[_0x1e77e9(0x164)](_0x302dac);}return await this['cramiEntity'][_0x1e77e9(0x15b)](_0xf8ab07);}async['useCrami'](_0x26ce8f,_0x4b5ca5){const _0x164da2=_0x298940,{id:_0x15fb67}=_0x26ce8f[_0x164da2(0x156)],_0x4b1c96=await this['cramiEntity'][_0x164da2(0x17a)]({'where':{'code':_0x4b5ca5['code']}});if(!_0x4b1c96)throw new common_1[(_0x164da2(0x148))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1['HttpStatus'][_0x164da2(0x179)]);const {status:_0x4b0554,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x361c73}=_0x4b1c96;if(_0x4b0554===0x1)throw new common_1[(_0x164da2(0x148))](_0x164da2(0x161),common_1[_0x164da2(0x172)]['BAD_REQUEST']);const _0x28e81f={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x361c73};return await this[_0x164da2(0x151)][_0x164da2(0x168)](_0x15fb67,Object[_0x164da2(0x177)]({},_0x28e81f),days),await this[_0x164da2(0x151)][_0x164da2(0x152)]({'userId':_0x15fb67,'rechargeType':balance_constant_1[_0x164da2(0x182)][_0x164da2(0x15d)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x164da2(0x14f)][_0x164da2(0x185)]({'code':_0x4b5ca5[_0x164da2(0x13b)]},{'useId':_0x15fb67,'status':0x1}),_0x164da2(0x184);}async[_0x298940(0x18c)](_0x5ce5b0,_0x2e0f11){const _0x5acd19=_0x298940,{page:page=0x1,size:size=0xa,status:_0xfab84a,useId:_0x502cc8}=_0x5ce5b0,_0x2ed687={};_0xfab84a&&Object[_0x5acd19(0x177)](_0x2ed687,{'status':_0xfab84a}),_0x502cc8&&Object['assign'](_0x2ed687,{'useId':_0x502cc8});const [_0x4e905d,_0x286247]=await this['cramiEntity'][_0x5acd19(0x17b)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x5acd19(0x180)},'where':_0x2ed687}),_0x2bd573=_0x4e905d[_0x5acd19(0x187)](_0x182cc3=>_0x182cc3[_0x5acd19(0x181)]),_0x3dd405=_0x4e905d[_0x5acd19(0x187)](_0x14ef90=>_0x14ef90[_0x5acd19(0x13e)]),_0x3c80c4=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2bd573)}}),_0x11df44=await this[_0x5acd19(0x174)][_0x5acd19(0x15c)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3dd405)}});return _0x4e905d[_0x5acd19(0x16b)](_0x565df1=>{const _0x458bbc=_0x5acd19;var _0x36e05a,_0x4704e5,_0x2d21db;_0x565df1['username']=(_0x36e05a=_0x3c80c4[_0x458bbc(0x15c)](_0x4c3420=>_0x4c3420['id']===_0x565df1[_0x458bbc(0x181)]))===null||_0x36e05a===void 0x0?void 0x0:_0x36e05a[_0x458bbc(0x163)],_0x565df1[_0x458bbc(0x138)]=(_0x4704e5=_0x3c80c4[_0x458bbc(0x15c)](_0x5d91de=>_0x5d91de['id']===_0x565df1[_0x458bbc(0x181)]))===null||_0x4704e5===void 0x0?void 0x0:_0x4704e5[_0x458bbc(0x138)],_0x565df1['packageName']=(_0x2d21db=_0x11df44[_0x458bbc(0x15c)](_0x1048f1=>_0x1048f1['id']===_0x565df1[_0x458bbc(0x13e)]))===null||_0x2d21db===void 0x0?void 0x0:_0x2d21db[_0x458bbc(0x189)];}),_0x2e0f11['user'][_0x5acd19(0x144)]!==_0x5acd19(0x188)&&_0x4e905d[_0x5acd19(0x16b)](_0x21ecfd=>_0x21ecfd[_0x5acd19(0x138)]=(0x0,utils_1[_0x5acd19(0x154)])(_0x21ecfd[_0x5acd19(0x138)])),_0x2e0f11[_0x5acd19(0x156)][_0x5acd19(0x144)]!==_0x5acd19(0x188)&&_0x4e905d[_0x5acd19(0x16b)](_0x5a4754=>_0x5a4754[_0x5acd19(0x13b)]=(0x0,utils_1[_0x5acd19(0x136)])(_0x5a4754[_0x5acd19(0x13b)])),{'rows':_0x4e905d,'count':_0x286247};}async[_0x298940(0x134)](_0x4805e8){const _0x34ddc8=_0x298940,_0x3099c3=await this[_0x34ddc8(0x14f)]['findOne']({'where':{'id':_0x4805e8}});if(!_0x3099c3)throw new common_1[(_0x34ddc8(0x148))](_0x34ddc8(0x15a),common_1[_0x34ddc8(0x172)]['BAD_REQUEST']);if(_0x3099c3[_0x34ddc8(0x166)]===0x1)throw new common_1[(_0x34ddc8(0x148))](_0x34ddc8(0x142),common_1[_0x34ddc8(0x172)][_0x34ddc8(0x179)]);return await this['cramiEntity'][_0x34ddc8(0x173)]({'id':_0x4805e8});}async[_0x298940(0x16c)](_0x842a0f){const _0x3062bd=_0x298940,{ids:_0x423c0d}=_0x842a0f,_0x149d6f=await this[_0x3062bd(0x14f)][_0x3062bd(0x173)](_0x423c0d);if(_0x149d6f[_0x3062bd(0x15f)]>0x0)return _0x3062bd(0x18b);else throw new common_1[(_0x3062bd(0x148))](_0x3062bd(0x143),common_1[_0x3062bd(0x172)]['BAD_REQUEST']);}};function _0x355a(_0xf49196,_0xb6d86b){const _0x26ea84=_0x26ea();return _0x355a=function(_0x355a36,_0x53dac7){_0x355a36=_0x355a36-0x134;let _0x29f689=_0x26ea84[_0x355a36];return _0x29f689;},_0x355a(_0xf49196,_0xb6d86b);}CramiService=__decorate([(0x0,common_1[_0x298940(0x158)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1[_0x298940(0x13c)])(cramiPackage_entity_1['CramiPackageEntity'])),__param(0x2,(0x0,typeorm_1[_0x298940(0x13c)])(user_entity_1[_0x298940(0x157)])),__metadata(_0x298940(0x17f),[typeorm_2[_0x298940(0x141)],typeorm_2[_0x298940(0x141)],typeorm_2[_0x298940(0x141)],userBalance_service_1[_0x298940(0x17e)]])],CramiService),exports['CramiService']=CramiService;