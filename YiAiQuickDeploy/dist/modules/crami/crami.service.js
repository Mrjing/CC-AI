'use strict';const _0x2b06cb=_0x4634;(function(_0x33e729,_0x593848){const _0x193f1b=_0x4634,_0xbc033f=_0x33e729();while(!![]){try{const _0x2e3ab9=parseInt(_0x193f1b(0x1c4))/0x1*(parseInt(_0x193f1b(0x1f5))/0x2)+-parseInt(_0x193f1b(0x1a7))/0x3*(parseInt(_0x193f1b(0x1ab))/0x4)+-parseInt(_0x193f1b(0x1b8))/0x5*(-parseInt(_0x193f1b(0x1c6))/0x6)+-parseInt(_0x193f1b(0x1de))/0x7*(parseInt(_0x193f1b(0x1a5))/0x8)+-parseInt(_0x193f1b(0x1ee))/0x9*(parseInt(_0x193f1b(0x1cd))/0xa)+-parseInt(_0x193f1b(0x1cf))/0xb*(parseInt(_0x193f1b(0x1f7))/0xc)+parseInt(_0x193f1b(0x1ea))/0xd;if(_0x2e3ab9===_0x593848)break;else _0xbc033f['push'](_0xbc033f['shift']());}catch(_0x3a5f08){_0xbc033f['push'](_0xbc033f['shift']());}}}(_0xee5c,0x25474));function _0xee5c(){const _0x60d46c=['maskEmail','defineProperty','当前卡密不存在、请确认您输入的卡密是否正确！','UserEntity','metadata','当前套餐不存在、请确认您选择的套餐是否存在！','function','../../common/constants/balance.constant','当前套餐不存在、请检查你的输入参数！','InjectRepository','当前卡密不存在、请确认您要删除的卡密是否存在！','forEach','every','error:\x20','4024hKgufP','当前卡密已被使用、已使用的卡密禁止删除！','132xutfEi','更新套餐成功！','updatePackage','log','2816tNyfig','getOwnPropertyDescriptor','HttpException','PACKAGE_GIFT','LessThanOrEqual','save','更新套餐失败、请重试！','UserBalanceService','RechargeType','useId','自定义卡密必须至少一项余额不为0️零！','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','push','788240NQvtmn','Injectable','Repository','object','createCrami','queryAllCrami','update','__metadata','../userBalance/userBalance.service','findAndCount','Not','status','1pQzovB','CramiEntity','6XRDbbF','name','../../common/utils','Like','delCrami','cramiEntity','code','430wpKCUr','./crami.entity','2981143IWNDoD','套餐名称或套餐等级重复、请检查！','HttpStatus','email','使用卡密成功','删除卡密失败、请重试！','count','assign','decorate','cramiPackageEntity','addBalanceToUser','role','affected','maskCrami','queryAllPackage','315fneMQR','userBalanceService','当前卡密已被使用、请确认您输入的卡密是否正确！','typeorm','map','@nestjs/typeorm','CramiService','length','delete','create','packageId','__param','4656990tgSePe','find','删除卡密成功！','DESC','55737vMVTWD','username','BAD_REQUEST','batchDelCrami','user','CramiPackageEntity','generateCramiCode','455474IEOZzv','__esModule','12hdizkl','findOne','__decorate','generateCrami','userEntity','super'];_0xee5c=function(){return _0x60d46c;};return _0xee5c();}function _0x4634(_0x9d7810,_0x201684){const _0xee5c14=_0xee5c();return _0x4634=function(_0x46348f,_0x2ac942){_0x46348f=_0x46348f-0x19a;let _0x4637a7=_0xee5c14[_0x46348f];return _0x4637a7;},_0x4634(_0x9d7810,_0x201684);}var __decorate=this&&this[_0x2b06cb(0x1f9)]||function(_0x54e2aa,_0x5fa30f,_0x29aa5a,_0x42656f){const _0x4820af=_0x2b06cb;var _0x1ddffc=arguments[_0x4820af(0x1e5)],_0x545eab=_0x1ddffc<0x3?_0x5fa30f:_0x42656f===null?_0x42656f=Object[_0x4820af(0x1ac)](_0x5fa30f,_0x29aa5a):_0x42656f,_0x1e6770;if(typeof Reflect==='object'&&typeof Reflect[_0x4820af(0x1d7)]===_0x4820af(0x19d))_0x545eab=Reflect['decorate'](_0x54e2aa,_0x5fa30f,_0x29aa5a,_0x42656f);else{for(var _0xeba6f9=_0x54e2aa[_0x4820af(0x1e5)]-0x1;_0xeba6f9>=0x0;_0xeba6f9--)if(_0x1e6770=_0x54e2aa[_0xeba6f9])_0x545eab=(_0x1ddffc<0x3?_0x1e6770(_0x545eab):_0x1ddffc>0x3?_0x1e6770(_0x5fa30f,_0x29aa5a,_0x545eab):_0x1e6770(_0x5fa30f,_0x29aa5a))||_0x545eab;}return _0x1ddffc>0x3&&_0x545eab&&Object[_0x4820af(0x1fe)](_0x5fa30f,_0x29aa5a,_0x545eab),_0x545eab;},__metadata=this&&this[_0x2b06cb(0x1bf)]||function(_0x28ce3e,_0x344c4f){const _0x5f0ac5=_0x2b06cb;if(typeof Reflect===_0x5f0ac5(0x1bb)&&typeof Reflect['metadata']===_0x5f0ac5(0x19d))return Reflect[_0x5f0ac5(0x19b)](_0x28ce3e,_0x344c4f);},__param=this&&this[_0x2b06cb(0x1e9)]||function(_0x1bb200,_0x1f7e3c){return function(_0xbf1942,_0x3f78ef){_0x1f7e3c(_0xbf1942,_0x3f78ef,_0x1bb200);};};Object[_0x2b06cb(0x1fe)](exports,_0x2b06cb(0x1f6),{'value':!![]}),exports['CramiService']=void 0x0;const common_1=require('@nestjs/common'),crami_entity_1=require(_0x2b06cb(0x1ce)),typeorm_1=require(_0x2b06cb(0x1e3)),typeorm_2=require(_0x2b06cb(0x1e1)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require(_0x2b06cb(0x1c8)),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x2b06cb(0x1c0)),balance_constant_1=require(_0x2b06cb(0x19e));let CramiService=class CramiService{constructor(_0x21a790,_0x407d29,_0x4171fa,_0xd6a1d){const _0x5aec58=_0x2b06cb;this[_0x5aec58(0x1cb)]=_0x21a790,this['cramiPackageEntity']=_0x407d29,this[_0x5aec58(0x1fb)]=_0x4171fa,this['userBalanceService']=_0xd6a1d;}async['queryOnePackage'](_0x19152b){const _0x89edc5=_0x2b06cb;return await this[_0x89edc5(0x1d8)]['findOne']({'where':{'id':_0x19152b}});}async[_0x2b06cb(0x1dd)](_0x7d5ca6){const _0x4c17db=_0x2b06cb;try{const {page:page=0x1,size:size=0xa,name:_0x19c38a,status:_0x1ac8b9,type:_0x506128}=_0x7d5ca6,_0x532122={};_0x19c38a&&Object[_0x4c17db(0x1d6)](_0x532122,{'name':(0x0,typeorm_2[_0x4c17db(0x1c9)])('%'+_0x19c38a+'%')}),_0x1ac8b9&&Object[_0x4c17db(0x1d6)](_0x532122,{'status':_0x1ac8b9});_0x506128&&(_0x506128>0x0?Object[_0x4c17db(0x1d6)](_0x532122,{'days':(0x0,typeorm_2['MoreThan'])(0x0)}):Object[_0x4c17db(0x1d6)](_0x532122,{'days':(0x0,typeorm_2[_0x4c17db(0x1af)])(0x0)}));const [_0x2fc0a7,_0x41ac09]=await this[_0x4c17db(0x1d8)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x532122,'order':{'order':'DESC'}});return{'rows':_0x2fc0a7,'count':_0x41ac09};}catch(_0x3a2250){console[_0x4c17db(0x1aa)](_0x4c17db(0x1a4),_0x3a2250);}}async['createPackage'](_0x59caa5){const _0x347d55=_0x2b06cb,{name:_0x4b9d0d,weight:_0x182caf}=_0x59caa5,_0x76f76a=await this[_0x347d55(0x1d8)][_0x347d55(0x1f8)]({'where':[{'name':_0x4b9d0d},{'weight':_0x182caf}]});if(_0x76f76a)throw new common_1[(_0x347d55(0x1ad))](_0x347d55(0x1d0),common_1[_0x347d55(0x1d1)][_0x347d55(0x1f0)]);try{return await this['cramiPackageEntity'][_0x347d55(0x1b0)](_0x59caa5);}catch(_0x4ad1a9){console[_0x347d55(0x1aa)](_0x347d55(0x1a4),_0x4ad1a9);throw new common_1[(_0x347d55(0x1ad))](_0x4ad1a9,common_1[_0x347d55(0x1d1)][_0x347d55(0x1f0)]);}}async[_0x2b06cb(0x1a9)](_0x583d80){const _0x1ef840=_0x2b06cb,{id:_0x328eb6,name:_0x10c502,weight:_0x5e6fcb}=_0x583d80,_0x25b73e=await this['cramiPackageEntity'][_0x1ef840(0x1f8)]({'where':{'id':_0x328eb6}});if(!_0x25b73e)throw new common_1[(_0x1ef840(0x1ad))](_0x1ef840(0x19f),common_1['HttpStatus'][_0x1ef840(0x1f0)]);const _0x4dd0a8=await this['cramiPackageEntity'][_0x1ef840(0x1d5)]({'where':[{'name':_0x10c502,'id':(0x0,typeorm_2['Not'])(_0x328eb6)},{'weight':_0x5e6fcb,'id':(0x0,typeorm_2[_0x1ef840(0x1c2)])(_0x328eb6)}]});if(_0x4dd0a8)throw new common_1['HttpException'](_0x1ef840(0x1d0),common_1[_0x1ef840(0x1d1)][_0x1ef840(0x1f0)]);const _0x228a3f=await this[_0x1ef840(0x1d8)]['update']({'id':_0x328eb6},_0x583d80);if(_0x228a3f[_0x1ef840(0x1db)]>0x0)return _0x1ef840(0x1a8);else throw new common_1[(_0x1ef840(0x1ad))](_0x1ef840(0x1b1),common_1[_0x1ef840(0x1d1)]['BAD_REQUEST']);}async['delPackage'](_0x4428b3){const _0x40a6d5=_0x2b06cb,{id:_0x346f8a}=_0x4428b3,_0x32cfe9=await this[_0x40a6d5(0x1cb)][_0x40a6d5(0x1d5)]({'where':{'packageId':_0x346f8a}});if(_0x32cfe9)throw new common_1[(_0x40a6d5(0x1ad))](_0x40a6d5(0x1b6),common_1[_0x40a6d5(0x1d1)][_0x40a6d5(0x1f0)]);return await this[_0x40a6d5(0x1d8)][_0x40a6d5(0x1e6)]({'id':_0x346f8a});}async[_0x2b06cb(0x1bc)](_0x1feff1){const _0x51477f=_0x2b06cb,{packageId:_0x67d4e2,count:count=0x1}=_0x1feff1;if(_0x67d4e2){const _0x5b20d1=await this[_0x51477f(0x1d8)][_0x51477f(0x1f8)]({'where':{'id':_0x67d4e2}});if(!_0x5b20d1)throw new common_1['HttpException'](_0x51477f(0x19c),common_1[_0x51477f(0x1d1)][_0x51477f(0x1f0)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5b20d1,_0x939865={'packageId':_0x67d4e2,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x51477f(0x1fa)](_0x939865,count);}if(!_0x67d4e2){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1feff1;if([model3Count,model4Count,drawMjCount][_0x51477f(0x1a3)](_0xda6688=>!_0xda6688))throw new common_1[(_0x51477f(0x1ad))](_0x51477f(0x1b5),common_1['HttpStatus'][_0x51477f(0x1f0)]);const _0x45a0bd={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x51477f(0x1fa)](_0x45a0bd,count);}}async[_0x2b06cb(0x1fa)](_0x38cd7a,_0x1efc8e){const _0x1fe48b=_0x2b06cb,_0x38713=[];for(let _0x351a12=0x0;_0x351a12<_0x1efc8e;_0x351a12++){const _0x4b47a5=(0x0,utils_1[_0x1fe48b(0x1f4)])(),_0x489d20=this[_0x1fe48b(0x1cb)][_0x1fe48b(0x1e7)](Object[_0x1fe48b(0x1d6)](Object[_0x1fe48b(0x1d6)]({},_0x38cd7a),{'code':_0x4b47a5}));_0x38713[_0x1fe48b(0x1b7)](_0x489d20);}return await this[_0x1fe48b(0x1cb)][_0x1fe48b(0x1b0)](_0x38713);}async['useCrami'](_0x3355c5,_0x1f88d6){const _0xe36960=_0x2b06cb,{id:_0x272372}=_0x3355c5[_0xe36960(0x1f2)],_0x23d1ee=await this[_0xe36960(0x1cb)]['findOne']({'where':{'code':_0x1f88d6[_0xe36960(0x1cc)]}});if(!_0x23d1ee)throw new common_1[(_0xe36960(0x1ad))](_0xe36960(0x1ff),common_1['HttpStatus']['BAD_REQUEST']);const {status:_0x1d9353,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x1e3f3d}=_0x23d1ee;if(_0x1d9353===0x1)throw new common_1[(_0xe36960(0x1ad))](_0xe36960(0x1e0),common_1['HttpStatus'][_0xe36960(0x1f0)]);const _0xf6ae5e={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x1e3f3d};return await this[_0xe36960(0x1df)][_0xe36960(0x1d9)](_0x272372,Object[_0xe36960(0x1d6)]({},_0xf6ae5e),days),await this[_0xe36960(0x1df)]['saveRecordRechargeLog']({'userId':_0x272372,'rechargeType':balance_constant_1[_0xe36960(0x1b3)][_0xe36960(0x1ae)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0xe36960(0x1cb)][_0xe36960(0x1be)]({'code':_0x1f88d6[_0xe36960(0x1cc)]},{'useId':_0x272372,'status':0x1}),_0xe36960(0x1d3);}async[_0x2b06cb(0x1bd)](_0x353309,_0x5031fc){const _0x1601c5=_0x2b06cb,{page:page=0x1,size:size=0xa,status:_0xe9d313,useId:_0x28f90b}=_0x353309,_0x2bff5f={};_0xe9d313&&Object[_0x1601c5(0x1d6)](_0x2bff5f,{'status':_0xe9d313}),_0x28f90b&&Object[_0x1601c5(0x1d6)](_0x2bff5f,{'useId':_0x28f90b});const [_0x16e09d,_0x4ded9d]=await this[_0x1601c5(0x1cb)][_0x1601c5(0x1c1)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x1601c5(0x1ed)},'where':_0x2bff5f}),_0x5a618c=_0x16e09d[_0x1601c5(0x1e2)](_0x492f09=>_0x492f09['useId']),_0x4f04ac=_0x16e09d[_0x1601c5(0x1e2)](_0x3b525e=>_0x3b525e[_0x1601c5(0x1e8)]),_0x5bc0d8=await this[_0x1601c5(0x1fb)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x5a618c)}}),_0x3d0b13=await this[_0x1601c5(0x1d8)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4f04ac)}});return _0x16e09d[_0x1601c5(0x1a2)](_0x4b829b=>{const _0x1f41ec=_0x1601c5;var _0x111f79,_0x460f19,_0x565da3;_0x4b829b[_0x1f41ec(0x1ef)]=(_0x111f79=_0x5bc0d8[_0x1f41ec(0x1eb)](_0x48d8de=>_0x48d8de['id']===_0x4b829b[_0x1f41ec(0x1b4)]))===null||_0x111f79===void 0x0?void 0x0:_0x111f79[_0x1f41ec(0x1ef)],_0x4b829b[_0x1f41ec(0x1d2)]=(_0x460f19=_0x5bc0d8[_0x1f41ec(0x1eb)](_0x1c32f7=>_0x1c32f7['id']===_0x4b829b[_0x1f41ec(0x1b4)]))===null||_0x460f19===void 0x0?void 0x0:_0x460f19['email'],_0x4b829b['packageName']=(_0x565da3=_0x3d0b13[_0x1f41ec(0x1eb)](_0x2e8ad5=>_0x2e8ad5['id']===_0x4b829b[_0x1f41ec(0x1e8)]))===null||_0x565da3===void 0x0?void 0x0:_0x565da3[_0x1f41ec(0x1c7)];}),_0x5031fc[_0x1601c5(0x1f2)][_0x1601c5(0x1da)]!==_0x1601c5(0x1fc)&&_0x16e09d[_0x1601c5(0x1a2)](_0xc3a933=>_0xc3a933[_0x1601c5(0x1d2)]=(0x0,utils_1[_0x1601c5(0x1fd)])(_0xc3a933[_0x1601c5(0x1d2)])),_0x5031fc['user'][_0x1601c5(0x1da)]!==_0x1601c5(0x1fc)&&_0x16e09d[_0x1601c5(0x1a2)](_0x415587=>_0x415587['code']=(0x0,utils_1[_0x1601c5(0x1dc)])(_0x415587[_0x1601c5(0x1cc)])),{'rows':_0x16e09d,'count':_0x4ded9d};}async[_0x2b06cb(0x1ca)](_0x4d1c55){const _0x24f7c5=_0x2b06cb,_0x3e4e6a=await this[_0x24f7c5(0x1cb)][_0x24f7c5(0x1f8)]({'where':{'id':_0x4d1c55}});if(!_0x3e4e6a)throw new common_1['HttpException'](_0x24f7c5(0x1a1),common_1[_0x24f7c5(0x1d1)]['BAD_REQUEST']);if(_0x3e4e6a[_0x24f7c5(0x1c3)]===0x1)throw new common_1[(_0x24f7c5(0x1ad))](_0x24f7c5(0x1a6),common_1[_0x24f7c5(0x1d1)][_0x24f7c5(0x1f0)]);return await this['cramiEntity'][_0x24f7c5(0x1e6)]({'id':_0x4d1c55});}async[_0x2b06cb(0x1f1)](_0x604d1e){const _0x3c2c71=_0x2b06cb,{ids:_0x47e719}=_0x604d1e,_0x388de2=await this[_0x3c2c71(0x1cb)]['delete'](_0x47e719);if(_0x388de2[_0x3c2c71(0x1db)]>0x0)return _0x3c2c71(0x1ec);else throw new common_1['HttpException'](_0x3c2c71(0x1d4),common_1[_0x3c2c71(0x1d1)][_0x3c2c71(0x1f0)]);}};CramiService=__decorate([(0x0,common_1[_0x2b06cb(0x1b9)])(),__param(0x0,(0x0,typeorm_1[_0x2b06cb(0x1a0)])(crami_entity_1[_0x2b06cb(0x1c5)])),__param(0x1,(0x0,typeorm_1[_0x2b06cb(0x1a0)])(cramiPackage_entity_1[_0x2b06cb(0x1f3)])),__param(0x2,(0x0,typeorm_1[_0x2b06cb(0x1a0)])(user_entity_1[_0x2b06cb(0x19a)])),__metadata('design:paramtypes',[typeorm_2[_0x2b06cb(0x1ba)],typeorm_2['Repository'],typeorm_2[_0x2b06cb(0x1ba)],userBalance_service_1[_0x2b06cb(0x1b2)]])],CramiService),exports[_0x2b06cb(0x1e4)]=CramiService;