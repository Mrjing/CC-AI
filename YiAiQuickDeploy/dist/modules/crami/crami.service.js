'use strict';const _0x5a0c6e=_0x414d;(function(_0x46e9da,_0x3715df){const _0x135ac1=_0x414d,_0x1d40a2=_0x46e9da();while(!![]){try{const _0x1051a3=-parseInt(_0x135ac1(0x115))/0x1*(parseInt(_0x135ac1(0x128))/0x2)+-parseInt(_0x135ac1(0x13c))/0x3+-parseInt(_0x135ac1(0x107))/0x4+-parseInt(_0x135ac1(0x142))/0x5*(parseInt(_0x135ac1(0x139))/0x6)+parseInt(_0x135ac1(0x148))/0x7+-parseInt(_0x135ac1(0x12b))/0x8+parseInt(_0x135ac1(0x10b))/0x9;if(_0x1051a3===_0x3715df)break;else _0x1d40a2['push'](_0x1d40a2['shift']());}catch(_0x1e8da0){_0x1d40a2['push'](_0x1d40a2['shift']());}}}(_0x4bc4,0x9ec91));function _0x4bc4(){const _0x5ebb69=['./crami.entity','LessThanOrEqual','code','CramiService','7245406xlgVdt','当前套餐不存在、请检查你的输入参数！','当前卡密已被使用、请确认您输入的卡密是否正确！','./cramiPackage.entity','useCrami','findAndCount','PACKAGE_GIFT','super','userEntity','../userBalance/userBalance.service','email','status','length','queryAllCrami','defineProperty','CramiPackageEntity','map','UserEntity','count','DESC','queryOnePackage','createCrami','addBalanceToUser','Injectable','update','当前卡密已被使用、已使用的卡密禁止删除！','2535836bvcuqG','generateCramiCode','cramiEntity','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','20488005sbHeoc','Repository','Not','design:paramtypes','name','function','RechargeType','InjectRepository','username','saveRecordRechargeLog','5UqTgJz','forEach','__param','更新套餐失败、请重试！','userBalanceService','maskEmail','findOne','updatePackage','BAD_REQUEST','../user/user.entity','metadata','当前卡密不存在、请确认您要删除的卡密是否存在！','HttpException','createPackage','error:\x20','../../common/constants/balance.constant','MoreThan','cramiPackageEntity','delPackage','441652rNRZgD','useId','当前卡密不存在、请确认您输入的卡密是否正确！','2845344grTMxB','log','typeorm','save','create','object','assign','role','affected','@nestjs/typeorm','__esModule','当前套餐不存在、请确认您选择的套餐是否存在！','packageId','套餐名称或套餐等级重复、请检查！','1932846cDxgil','user','generateCrami','735660gXUKuE','删除卡密成功！','find','@nestjs/common','HttpStatus','delete','5wisEsG','自定义卡密必须至少一项余额不为0️零！'];_0x4bc4=function(){return _0x5ebb69;};return _0x4bc4();}var __decorate=this&&this['__decorate']||function(_0x21ba12,_0x2a10b4,_0x163250,_0x55af54){const _0x4deefc=_0x414d;var _0x621986=arguments[_0x4deefc(0x154)],_0x1a79e9=_0x621986<0x3?_0x2a10b4:_0x55af54===null?_0x55af54=Object['getOwnPropertyDescriptor'](_0x2a10b4,_0x163250):_0x55af54,_0x56c2be;if(typeof Reflect===_0x4deefc(0x130)&&typeof Reflect['decorate']===_0x4deefc(0x110))_0x1a79e9=Reflect['decorate'](_0x21ba12,_0x2a10b4,_0x163250,_0x55af54);else{for(var _0x27ffb7=_0x21ba12['length']-0x1;_0x27ffb7>=0x0;_0x27ffb7--)if(_0x56c2be=_0x21ba12[_0x27ffb7])_0x1a79e9=(_0x621986<0x3?_0x56c2be(_0x1a79e9):_0x621986>0x3?_0x56c2be(_0x2a10b4,_0x163250,_0x1a79e9):_0x56c2be(_0x2a10b4,_0x163250))||_0x1a79e9;}return _0x621986>0x3&&_0x1a79e9&&Object[_0x4deefc(0x156)](_0x2a10b4,_0x163250,_0x1a79e9),_0x1a79e9;},__metadata=this&&this['__metadata']||function(_0x2c4f4d,_0x53e727){const _0xf9656=_0x414d;if(typeof Reflect===_0xf9656(0x130)&&typeof Reflect[_0xf9656(0x11f)]===_0xf9656(0x110))return Reflect['metadata'](_0x2c4f4d,_0x53e727);},__param=this&&this[_0x5a0c6e(0x117)]||function(_0x1d0ae7,_0xab7545){return function(_0x3cbc89,_0x32e6ec){_0xab7545(_0x3cbc89,_0x32e6ec,_0x1d0ae7);};};Object['defineProperty'](exports,_0x5a0c6e(0x135),{'value':!![]}),exports[_0x5a0c6e(0x147)]=void 0x0;const common_1=require(_0x5a0c6e(0x13f)),crami_entity_1=require(_0x5a0c6e(0x144)),typeorm_1=require(_0x5a0c6e(0x134)),typeorm_2=require(_0x5a0c6e(0x12d)),cramiPackage_entity_1=require(_0x5a0c6e(0x14b)),utils_1=require('../../common/utils'),user_entity_1=require(_0x5a0c6e(0x11e)),userBalance_service_1=require(_0x5a0c6e(0x151)),balance_constant_1=require(_0x5a0c6e(0x124));function _0x414d(_0x50a95f,_0x39a6d4){const _0x4bc4e3=_0x4bc4();return _0x414d=function(_0x414d4b,_0x3f49e4){_0x414d4b=_0x414d4b-0xfc;let _0x43c00f=_0x4bc4e3[_0x414d4b];return _0x43c00f;},_0x414d(_0x50a95f,_0x39a6d4);}let CramiService=class CramiService{constructor(_0x5b76b5,_0x1d00ac,_0x747c76,_0x3a066e){const _0x49f626=_0x5a0c6e;this['cramiEntity']=_0x5b76b5,this[_0x49f626(0x126)]=_0x1d00ac,this[_0x49f626(0x150)]=_0x747c76,this['userBalanceService']=_0x3a066e;}async[_0x5a0c6e(0x101)](_0x503bd1){const _0x573334=_0x5a0c6e;return await this['cramiPackageEntity'][_0x573334(0x11b)]({'where':{'id':_0x503bd1}});}async['queryAllPackage'](_0x3632da){const _0xaafc00=_0x5a0c6e;try{const {page:page=0x1,size:size=0xa,name:_0x3b3503,status:_0x17c1ab,type:_0x1256da}=_0x3632da,_0x1399fd={};_0x3b3503&&Object['assign'](_0x1399fd,{'name':(0x0,typeorm_2['Like'])('%'+_0x3b3503+'%')}),_0x17c1ab&&Object[_0xaafc00(0x131)](_0x1399fd,{'status':_0x17c1ab});_0x1256da&&(_0x1256da>0x0?Object[_0xaafc00(0x131)](_0x1399fd,{'days':(0x0,typeorm_2[_0xaafc00(0x125)])(0x0)}):Object[_0xaafc00(0x131)](_0x1399fd,{'days':(0x0,typeorm_2[_0xaafc00(0x145)])(0x0)}));const [_0x5b9e99,_0x3e4578]=await this[_0xaafc00(0x126)][_0xaafc00(0x14d)]({'skip':(page-0x1)*size,'take':size,'where':_0x1399fd,'order':{'order':_0xaafc00(0x100)}});return{'rows':_0x5b9e99,'count':_0x3e4578};}catch(_0x523915){console[_0xaafc00(0x12c)](_0xaafc00(0x123),_0x523915);}}async[_0x5a0c6e(0x122)](_0x1b9c6e){const _0xfcdb69=_0x5a0c6e,{name:_0x2bf6e4,weight:_0x2a7f01}=_0x1b9c6e,_0x376d26=await this[_0xfcdb69(0x126)][_0xfcdb69(0x11b)]({'where':[{'name':_0x2bf6e4},{'weight':_0x2a7f01}]});if(_0x376d26)throw new common_1[(_0xfcdb69(0x121))]('套餐名称或套餐等级重复、请检查！',common_1[_0xfcdb69(0x140)][_0xfcdb69(0x11d)]);try{return await this[_0xfcdb69(0x126)][_0xfcdb69(0x12e)](_0x1b9c6e);}catch(_0x2e600d){console['log'](_0xfcdb69(0x123),_0x2e600d);throw new common_1[(_0xfcdb69(0x121))](_0x2e600d,common_1[_0xfcdb69(0x140)]['BAD_REQUEST']);}}async[_0x5a0c6e(0x11c)](_0x3f77ef){const _0x3a6e04=_0x5a0c6e,{id:_0x15f2a4,name:_0x2852f6,weight:_0x4c8452}=_0x3f77ef,_0x320840=await this[_0x3a6e04(0x126)]['findOne']({'where':{'id':_0x15f2a4}});if(!_0x320840)throw new common_1['HttpException'](_0x3a6e04(0x149),common_1[_0x3a6e04(0x140)][_0x3a6e04(0x11d)]);const _0x4d00b2=await this['cramiPackageEntity'][_0x3a6e04(0xff)]({'where':[{'name':_0x2852f6,'id':(0x0,typeorm_2[_0x3a6e04(0x10d)])(_0x15f2a4)},{'weight':_0x4c8452,'id':(0x0,typeorm_2[_0x3a6e04(0x10d)])(_0x15f2a4)}]});if(_0x4d00b2)throw new common_1['HttpException'](_0x3a6e04(0x138),common_1[_0x3a6e04(0x140)][_0x3a6e04(0x11d)]);const _0x5e9c39=await this['cramiPackageEntity'][_0x3a6e04(0x105)]({'id':_0x15f2a4},_0x3f77ef);if(_0x5e9c39[_0x3a6e04(0x133)]>0x0)return'更新套餐成功！';else throw new common_1[(_0x3a6e04(0x121))](_0x3a6e04(0x118),common_1[_0x3a6e04(0x140)]['BAD_REQUEST']);}async[_0x5a0c6e(0x127)](_0x3cc18e){const _0x9d6339=_0x5a0c6e,{id:_0x195127}=_0x3cc18e,_0x3d5466=await this[_0x9d6339(0x109)][_0x9d6339(0xff)]({'where':{'packageId':_0x195127}});if(_0x3d5466)throw new common_1[(_0x9d6339(0x121))](_0x9d6339(0x10a),common_1['HttpStatus'][_0x9d6339(0x11d)]);return await this[_0x9d6339(0x126)]['delete']({'id':_0x195127});}async[_0x5a0c6e(0x102)](_0x3860ec){const _0x15418f=_0x5a0c6e,{packageId:_0x2cd823,count:count=0x1}=_0x3860ec;if(_0x2cd823){const _0x27402e=await this[_0x15418f(0x126)][_0x15418f(0x11b)]({'where':{'id':_0x2cd823}});if(!_0x27402e)throw new common_1['HttpException'](_0x15418f(0x136),common_1[_0x15418f(0x140)][_0x15418f(0x11d)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x27402e,_0x23531b={'packageId':_0x2cd823,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x15418f(0x13b)](_0x23531b,count);}if(!_0x2cd823){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x3860ec;if([model3Count,model4Count,drawMjCount]['every'](_0x1aba01=>!_0x1aba01))throw new common_1[(_0x15418f(0x121))](_0x15418f(0x143),common_1[_0x15418f(0x140)][_0x15418f(0x11d)]);const _0x3bc703={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x15418f(0x13b)](_0x3bc703,count);}}async[_0x5a0c6e(0x13b)](_0x1f65d9,_0x2ba914){const _0x57ecdd=_0x5a0c6e,_0x105f73=[];for(let _0x405abd=0x0;_0x405abd<_0x2ba914;_0x405abd++){const _0x303d26=(0x0,utils_1[_0x57ecdd(0x108)])(),_0x1e47f4=this['cramiEntity'][_0x57ecdd(0x12f)](Object[_0x57ecdd(0x131)](Object['assign']({},_0x1f65d9),{'code':_0x303d26}));_0x105f73['push'](_0x1e47f4);}return await this[_0x57ecdd(0x109)]['save'](_0x105f73);}async[_0x5a0c6e(0x14c)](_0x13df70,_0x181060){const _0x30e280=_0x5a0c6e,{id:_0x58e41c}=_0x13df70[_0x30e280(0x13a)],_0x54b3c3=await this['cramiEntity'][_0x30e280(0x11b)]({'where':{'code':_0x181060['code']}});if(!_0x54b3c3)throw new common_1[(_0x30e280(0x121))](_0x30e280(0x12a),common_1[_0x30e280(0x140)][_0x30e280(0x11d)]);const {status:_0x398a91,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0xea7b4a}=_0x54b3c3;if(_0x398a91===0x1)throw new common_1['HttpException'](_0x30e280(0x14a),common_1[_0x30e280(0x140)][_0x30e280(0x11d)]);const _0x50708b={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0xea7b4a};return await this[_0x30e280(0x119)][_0x30e280(0x103)](_0x58e41c,Object['assign']({},_0x50708b),days),await this[_0x30e280(0x119)][_0x30e280(0x114)]({'userId':_0x58e41c,'rechargeType':balance_constant_1[_0x30e280(0x111)][_0x30e280(0x14e)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x30e280(0x109)]['update']({'code':_0x181060[_0x30e280(0x146)]},{'useId':_0x58e41c,'status':0x1}),'使用卡密成功';}async[_0x5a0c6e(0x155)](_0x49f0c4,_0x1eeff2){const _0x45d8d2=_0x5a0c6e,{page:page=0x1,size:size=0xa,status:_0x30deed,useId:_0x47f0be}=_0x49f0c4,_0x216cf8={};_0x30deed&&Object[_0x45d8d2(0x131)](_0x216cf8,{'status':_0x30deed}),_0x47f0be&&Object[_0x45d8d2(0x131)](_0x216cf8,{'useId':_0x47f0be});const [_0x3394dc,_0x1e9b9e]=await this[_0x45d8d2(0x109)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'},'where':_0x216cf8}),_0x479d13=_0x3394dc[_0x45d8d2(0xfd)](_0x1a6de5=>_0x1a6de5[_0x45d8d2(0x129)]),_0x2de8a1=_0x3394dc['map'](_0x381e86=>_0x381e86[_0x45d8d2(0x137)]),_0x181c36=await this[_0x45d8d2(0x150)][_0x45d8d2(0x13e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x479d13)}}),_0x5e133f=await this[_0x45d8d2(0x126)][_0x45d8d2(0x13e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2de8a1)}});return _0x3394dc[_0x45d8d2(0x116)](_0xb48743=>{const _0x1b25fb=_0x45d8d2;var _0x1a460e,_0x2ee382,_0x52ae8a;_0xb48743[_0x1b25fb(0x113)]=(_0x1a460e=_0x181c36[_0x1b25fb(0x13e)](_0x1f7912=>_0x1f7912['id']===_0xb48743[_0x1b25fb(0x129)]))===null||_0x1a460e===void 0x0?void 0x0:_0x1a460e[_0x1b25fb(0x113)],_0xb48743[_0x1b25fb(0x152)]=(_0x2ee382=_0x181c36[_0x1b25fb(0x13e)](_0x374472=>_0x374472['id']===_0xb48743[_0x1b25fb(0x129)]))===null||_0x2ee382===void 0x0?void 0x0:_0x2ee382['email'],_0xb48743['packageName']=(_0x52ae8a=_0x5e133f[_0x1b25fb(0x13e)](_0x328c6c=>_0x328c6c['id']===_0xb48743[_0x1b25fb(0x137)]))===null||_0x52ae8a===void 0x0?void 0x0:_0x52ae8a[_0x1b25fb(0x10f)];}),_0x1eeff2['user'][_0x45d8d2(0x132)]!==_0x45d8d2(0x14f)&&_0x3394dc[_0x45d8d2(0x116)](_0x1c9057=>_0x1c9057[_0x45d8d2(0x152)]=(0x0,utils_1[_0x45d8d2(0x11a)])(_0x1c9057[_0x45d8d2(0x152)])),_0x1eeff2[_0x45d8d2(0x13a)]['role']!=='super'&&_0x3394dc['forEach'](_0xf98fa7=>_0xf98fa7[_0x45d8d2(0x146)]=(0x0,utils_1['maskCrami'])(_0xf98fa7['code'])),{'rows':_0x3394dc,'count':_0x1e9b9e};}async['delCrami'](_0x11e0de){const _0x251687=_0x5a0c6e,_0x376c9c=await this[_0x251687(0x109)][_0x251687(0x11b)]({'where':{'id':_0x11e0de}});if(!_0x376c9c)throw new common_1['HttpException'](_0x251687(0x120),common_1[_0x251687(0x140)][_0x251687(0x11d)]);if(_0x376c9c[_0x251687(0x153)]===0x1)throw new common_1['HttpException'](_0x251687(0x106),common_1[_0x251687(0x140)]['BAD_REQUEST']);return await this[_0x251687(0x109)][_0x251687(0x141)]({'id':_0x11e0de});}async['batchDelCrami'](_0x40bc8a){const _0x97f6a9=_0x5a0c6e,{ids:_0x341f39}=_0x40bc8a,_0x3752c9=await this[_0x97f6a9(0x109)][_0x97f6a9(0x141)](_0x341f39);if(_0x3752c9[_0x97f6a9(0x133)]>0x0)return _0x97f6a9(0x13d);else throw new common_1[(_0x97f6a9(0x121))]('删除卡密失败、请重试！',common_1[_0x97f6a9(0x140)][_0x97f6a9(0x11d)]);}};CramiService=__decorate([(0x0,common_1[_0x5a0c6e(0x104)])(),__param(0x0,(0x0,typeorm_1[_0x5a0c6e(0x112)])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x5a0c6e(0xfc)])),__param(0x2,(0x0,typeorm_1[_0x5a0c6e(0x112)])(user_entity_1[_0x5a0c6e(0xfe)])),__metadata(_0x5a0c6e(0x10e),[typeorm_2[_0x5a0c6e(0x10c)],typeorm_2[_0x5a0c6e(0x10c)],typeorm_2[_0x5a0c6e(0x10c)],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x5a0c6e(0x147)]=CramiService;