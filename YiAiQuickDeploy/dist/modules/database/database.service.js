'use strict';const _0x48b622=_0x354a;(function(_0x20ca21,_0xa284de){const _0x4da8f6=_0x354a,_0x326c3f=_0x20ca21();while(!![]){try{const _0x3671f9=-parseInt(_0x4da8f6(0x1f5))/0x1*(-parseInt(_0x4da8f6(0x218))/0x2)+parseInt(_0x4da8f6(0x1e6))/0x3*(-parseInt(_0x4da8f6(0x1de))/0x4)+parseInt(_0x4da8f6(0x21f))/0x5*(-parseInt(_0x4da8f6(0x20a))/0x6)+-parseInt(_0x4da8f6(0x1db))/0x7*(-parseInt(_0x4da8f6(0x1ff))/0x8)+parseInt(_0x4da8f6(0x227))/0x9*(parseInt(_0x4da8f6(0x22b))/0xa)+parseInt(_0x4da8f6(0x1eb))/0xb+parseInt(_0x4da8f6(0x23c))/0xc;if(_0x3671f9===_0xa284de)break;else _0x326c3f['push'](_0x326c3f['shift']());}catch(_0x56ec62){_0x326c3f['push'](_0x326c3f['shift']());}}}(_0x3ff2,0xa3b9c));function _0x354a(_0x7e6614,_0x4f44c1){const _0x3ff295=_0x3ff2();return _0x354a=function(_0x354a7f,_0x1ff417){_0x354a7f=_0x354a7f-0x1db;let _0x14fd21=_0x3ff295[_0x354a7f];return _0x14fd21;},_0x354a(_0x7e6614,_0x4f44c1);}var __decorate=this&&this[_0x48b622(0x1e0)]||function(_0x4422e4,_0x4293bb,_0x410b1b,_0x15d23c){const _0x332b20=_0x48b622;var _0x52ef96=arguments[_0x332b20(0x1e9)],_0x5228e6=_0x52ef96<0x3?_0x4293bb:_0x15d23c===null?_0x15d23c=Object[_0x332b20(0x1fe)](_0x4293bb,_0x410b1b):_0x15d23c,_0xc81560;if(typeof Reflect===_0x332b20(0x21d)&&typeof Reflect['decorate']===_0x332b20(0x21b))_0x5228e6=Reflect['decorate'](_0x4422e4,_0x4293bb,_0x410b1b,_0x15d23c);else{for(var _0x4f6836=_0x4422e4[_0x332b20(0x1e9)]-0x1;_0x4f6836>=0x0;_0x4f6836--)if(_0xc81560=_0x4422e4[_0x4f6836])_0x5228e6=(_0x52ef96<0x3?_0xc81560(_0x5228e6):_0x52ef96>0x3?_0xc81560(_0x4293bb,_0x410b1b,_0x5228e6):_0xc81560(_0x4293bb,_0x410b1b))||_0x5228e6;}return _0x52ef96>0x3&&_0x5228e6&&Object[_0x332b20(0x23a)](_0x4293bb,_0x410b1b,_0x5228e6),_0x5228e6;},__metadata=this&&this[_0x48b622(0x22a)]||function(_0x448ade,_0x4d8a5c){const _0x139cf8=_0x48b622;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x139cf8(0x232)](_0x448ade,_0x4d8a5c);};Object[_0x48b622(0x23a)](exports,_0x48b622(0x222),{'value':!![]}),exports[_0x48b622(0x217)]=void 0x0;const common_1=require(_0x48b622(0x209)),typeorm_1=require(_0x48b622(0x205)),bcrypt=require(_0x48b622(0x1df));let DatabaseService=class DatabaseService{constructor(_0x227899){this['connection']=_0x227899;}async[_0x48b622(0x220)](){await this['checkSuperAdmin'](),await this['checkSiteBaseConfig']();}async[_0x48b622(0x1e4)](){const _0xb8736f=_0x48b622,_0x4c35f1=await this[_0xb8736f(0x20b)][_0xb8736f(0x203)](_0xb8736f(0x1f6));if(!_0x4c35f1||_0x4c35f1[_0xb8736f(0x1e9)]===0x0){const _0x58717d=bcrypt[_0xb8736f(0x215)](_0xb8736f(0x226),0xa),_0x53af9f=bcrypt[_0xb8736f(0x215)](_0xb8736f(0x226),0xa),_0x5c6c26=_0xb8736f(0x23d),_0x11cd5b=_0xb8736f(0x1f7),_0x4378c7={'username':_0xb8736f(0x213),'password':_0x58717d,'status':0x1,'email':_0x5c6c26,'sex':0x1,'role':_0xb8736f(0x213)},_0x3c53fd={'username':_0xb8736f(0x237),'password':_0x53af9f,'status':0x1,'email':_0x11cd5b,'sex':0x1,'role':'admin'};await this[_0xb8736f(0x234)](_0x4378c7),await this[_0xb8736f(0x234)](_0x3c53fd);}}async['createDefaultUser'](_0x3b5aef){const _0x3d3e71=_0x48b622;try{const {username:_0x310751,password:_0x588e03,status:_0x5e08e3,email:_0x1d6183,role:_0x4416c1}=_0x3b5aef,_0x392ac2=await this[_0x3d3e71(0x20b)][_0x3d3e71(0x203)](_0x3d3e71(0x214)+_0x310751+_0x3d3e71(0x230)+_0x588e03+_0x3d3e71(0x230)+_0x5e08e3+_0x3d3e71(0x230)+_0x1d6183+_0x3d3e71(0x230)+_0x4416c1+'\x27)'),_0x226406=_0x392ac2[_0x3d3e71(0x1e8)],_0x258626=await this[_0x3d3e71(0x20b)][_0x3d3e71(0x203)](_0x3d3e71(0x1f9)+_0x226406+_0x3d3e71(0x1ec));common_1[_0x3d3e71(0x210)][_0x3d3e71(0x1ef)]('初始化创建'+_0x4416c1+_0x3d3e71(0x1e3)+_0x310751+_0x3d3e71(0x216)+(_0x310751==='super'?_0x3d3e71(0x219):_0x3d3e71(0x226))+_0x3d3e71(0x1f4),_0x3d3e71(0x217));}catch(_0x262896){console[_0x3d3e71(0x1ef)](_0x3d3e71(0x1fc),_0x262896);throw new common_1['HttpException']('创建默认超级管理员失败！',common_1['HttpStatus'][_0x3d3e71(0x21c)]);}}async[_0x48b622(0x223)](){const _0x172d05=_0x48b622,_0x5e8517=['siteName',_0x172d05(0x224),'vxNumber','robotAvatar','userDefautlAvatar'],_0x8d3dea=await this[_0x172d05(0x20b)][_0x172d05(0x203)](_0x172d05(0x22d)+_0x5e8517[_0x172d05(0x1f8)](_0x1848ea=>'\x27'+_0x1848ea+'\x27')['join'](',')+')\x0a'),_0x48292c=parseInt(_0x8d3dea[0x0]['count']);_0x48292c===0x0&&await this[_0x172d05(0x236)]();}async[_0x48b622(0x236)](){const _0x154e54=_0x48b622;try{const _0x4d10f2='',_0x315f74=_0x154e54(0x201),_0x1ad37c=[{'configKey':_0x154e54(0x20e),'configVal':_0x154e54(0x1f2),'public':0x1,'encry':0x0},{'configKey':_0x154e54(0x224),'configVal':_0x154e54(0x1f3),'public':0x1,'encry':0x0},{'configKey':'vxNumber','configVal':_0x154e54(0x1fa),'public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1ee),'configVal':'','public':0x1,'encry':0x0},{'configKey':'userDefautlAvatar','configVal':'','public':0x0,'encry':0x0},{'configKey':'baiduCode','configVal':_0x4d10f2,'public':0x1,'encry':0x0},{'configKey':_0x154e54(0x21a),'configVal':'','public':0x0,'encry':0x0},{'configKey':_0x154e54(0x22c),'configVal':'','public':0x0,'encry':0x0},{'configKey':'buyCramiAddress','configVal':'','public':0x1,'encry':0x0},{'configKey':'openaiBaseUrl','configVal':_0x154e54(0x23b),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x228),'configVal':_0x315f74,'public':0x1,'encry':0x0},{'configKey':_0x154e54(0x202),'configVal':_0x154e54(0x208),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x20c),'configVal':_0x154e54(0x229),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x206),'configVal':_0x154e54(0x238),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x211),'configVal':_0x154e54(0x20d),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x1fd),'configVal':_0x154e54(0x20f),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x235),'configVal':'Yi\x20Ai','public':0x0,'encry':0x0},{'configKey':'registerSuccessEmaileAppend','configVal':',请妥善保管您的账号，祝您使用愉快','public':0x0,'encry':0x0},{'configKey':_0x154e54(0x200),'configVal':_0x154e54(0x225),'public':0x0,'encry':0x0},{'configKey':_0x154e54(0x1dd),'configVal':'Yi\x20Ai团队','public':0x0,'encry':0x0},{'configKey':_0x154e54(0x221),'configVal':'1','public':0x1,'encry':0x0},{'configKey':'registerSendModel3Count','configVal':'30','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x212),'configVal':'3','public':0x1,'encry':0x0},{'configKey':'registerSendDrawMjCount','configVal':'3','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1f1),'configVal':'1','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1e2),'configVal':_0x154e54(0x204),'public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1e1),'configVal':'10','public':0x1,'encry':0x0},{'configKey':'firstRregisterSendModel4Count','configVal':'10','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x22f),'configVal':'10','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1ed),'configVal':'1','public':0x1,'encry':0x0},{'configKey':'inviteGiveSendModel3Count','configVal':'0','public':0x1,'encry':0x0},{'configKey':'inviteGiveSendModel4Count','configVal':'0','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x207),'configVal':'0','public':0x1,'encry':0x0},{'configKey':_0x154e54(0x1ea),'configVal':'10','public':0x1,'encry':0x0},{'configKey':'invitedGuestSendModel4Count','configVal':'10','public':0x1,'encry':0x0},{'configKey':'invitedGuestSendDrawMjCount','configVal':'10','public':0x1,'encry':0x0},{'configKey':'isVerifyEmail','configVal':'1','public':0x1,'encry':0x0}],_0x56a859=await this[_0x154e54(0x20b)][_0x154e54(0x203)]('INSERT\x20INTO\x20config\x20(configKey,\x20configVal,\x20public,\x20encry)\x20VALUES\x20'+_0x1ad37c[_0x154e54(0x1f8)](_0x15e705=>'(\x27'+_0x15e705[_0x154e54(0x1fb)]+_0x154e54(0x230)+_0x15e705[_0x154e54(0x239)][_0x154e54(0x1e5)](/'/g,'\x5c\x27')+_0x154e54(0x230)+_0x15e705[_0x154e54(0x22e)]+_0x154e54(0x230)+_0x15e705[_0x154e54(0x1e7)]+'\x27)')['join'](',\x20'));common_1[_0x154e54(0x210)][_0x154e54(0x1ef)](_0x154e54(0x233),_0x154e54(0x217));}catch(_0xcb4b33){console['log'](_0x154e54(0x1fc),_0xcb4b33);throw new common_1['HttpException'](_0x154e54(0x1f0),common_1[_0x154e54(0x1dc)][_0x154e54(0x21c)]);}}};function _0x3ff2(){const _0x1a4983=['defineProperty','https://api.openai.com','4654164TjVcTN','default@cooper.com','453404KrtBqg','HttpStatus','registerFailEmailTeamName','56NkJZry','bcryptjs','__decorate','firstRregisterSendModel3Count','firstRegisterSendRank','用户成功、用户名为[','checkSuperAdmin','replace','236628xKSRCq','encry','insertId','length','invitedGuestSendModel3Count','3863651eiQKCV','\x27,\x200,\x201000,\x20100)','inviteSendStatus','robotAvatar','log','创建默认网站配置失败！','firstRegisterSendStatus','Yi\x20Ai','805239273',']\x20==============>\x20请注意查阅','5989grKKzb','SELECT\x20*\x20FROM\x20users\x20WHERE\x20role\x20=\x20\x27super\x27','defaultAdmin@cooper.com','map','INSERT\x20INTO\x20balance\x20(userId,\x20balance,\x20usesLeft,\x20paintCount)\x20VALUES\x20(\x27','HelloWordYi819','configKey','error:\x20','registerSuccessEmailTitle','getOwnPropertyDescriptor','16Gotjqe','registerFailEmailTitle','\x0a####\x20YiAi\x20欢迎您\x0a\x20-\x20欢迎使用YiAi\x0a\x20-\x20初始管理员账号密码\x20\x20super\x20\x20123456\x20【前台后台登录都可以修改】\x0a\x20-\x20初始预览账号密码\x20\x20admin\x20\x20123456\x20【为后台查看账号\x20仅可查看部分非敏感数据】\x0a','registerVerifyEmailTitle','query','500','typeorm','registerVerifyEmailFrom','inviteGiveSendDrawMjCount','Yi\x20Ai团队账号验证','@nestjs/common','948TQPlYu','connection','registerVerifyEmailDesc','1800','siteName','Yi\x20Ai账号激活成功','Logger','registerVerifyExpir','registerSendModel4Count','super','INSERT\x20INTO\x20users\x20(username,\x20password,\x20status,\x20email,\x20role)\x20VALUES\x20(\x27','hashSync',']、初始密码为[','DatabaseService','244CTgFYz','nine-super','baiduSiteId','function','INTERNAL_SERVER_ERROR','object','Injectable','34835WYCmDV','onModuleInit','registerSendStatus','__esModule','checkSiteBaseConfig','qqNumber','Yi\x20Ai账号激活失败','123456','638190IkXYIB','noticeInfo','欢迎使用Yi\x20Ai团队的产品服务,请在五分钟内完成你的账号激活,点击以下按钮激活您的账号，','__metadata','180rGLWKg','baiduToken','\x0a\x20\x20SELECT\x20COUNT(*)\x20AS\x20count\x20FROM\x20config\x20WHERE\x20`configKey`\x20IN\x20(','public','firstRregisterSendDrawMjCount','\x27,\x20\x27','Connection','metadata','初始化网站配置信息成功、如您需要修改网站配置信息，请前往管理系统系统配置设置\x20==============>\x20请注意查阅','createDefaultUser','registerSuccessEmailTeamName','createBaseSiteConfig','admin','Yi\x20Ai团队','configVal'];_0x3ff2=function(){return _0x1a4983;};return _0x3ff2();}DatabaseService=__decorate([(0x0,common_1[_0x48b622(0x21e)])(),__metadata('design:paramtypes',[typeorm_1[_0x48b622(0x231)]])],DatabaseService),exports[_0x48b622(0x217)]=DatabaseService;