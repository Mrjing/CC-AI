'use strict';const _0x4cd932=_0x3155;(function(_0x44e56a,_0x100605){const _0x415ecd=_0x3155,_0xa3bc0=_0x44e56a();while(!![]){try{const _0x57fe8c=parseInt(_0x415ecd(0x165))/0x1*(parseInt(_0x415ecd(0x157))/0x2)+parseInt(_0x415ecd(0x169))/0x3*(parseInt(_0x415ecd(0x154))/0x4)+-parseInt(_0x415ecd(0x148))/0x5*(-parseInt(_0x415ecd(0x14f))/0x6)+parseInt(_0x415ecd(0x160))/0x7+parseInt(_0x415ecd(0x164))/0x8*(parseInt(_0x415ecd(0x168))/0x9)+parseInt(_0x415ecd(0x14e))/0xa+-parseInt(_0x415ecd(0x143))/0xb;if(_0x57fe8c===_0x100605)break;else _0xa3bc0['push'](_0xa3bc0['shift']());}catch(_0x4ba03e){_0xa3bc0['push'](_0xa3bc0['shift']());}}}(_0x1328,0xdce92));Object[_0x4cd932(0x14a)](exports,'__esModule',{'value':!![]}),exports['sendMessageFromZhipu']=exports[_0x4cd932(0x144)]=exports['compilerMetaJsonStr']=exports[_0x4cd932(0x16c)]=void 0x0;const axios=require(_0x4cd932(0x158)),jwt=require(_0x4cd932(0x150));function _0x1328(){const _0x39b483=['length','data:','replace','12204120gsMbvK','656418mRsILt','jsonwebtoken','meta:','text','trim','22628rBkCGU','filter','log','123708VmvbMx','axios','sendMessageFromZhipu','catch','application/json','toString','error:\x20','SIGN','now','6193740bVwWma','event:','then','is_end','13320712UuRmnk','25xESJQA','sign','json\x20parse\x20error\x20from\x20zhipu!','9rgwMll','429WDkPSp','HS256','/sse-invoke','generateToken','split','data','id:','stream','round','65852523gyChoq','compilerStream','usage','parse','https://open.bigmodel.cn/api/paas/v3/model-api/','35byuZRO','compilerMetaJsonStr','defineProperty'];_0x1328=function(){return _0x39b483;};return _0x1328();}function generateToken(_0x8f1e05,_0xb62dcd=0x3e8*0x3c*0x3c*0x18*0x168){const _0x30319e=_0x4cd932,[_0x496420,_0x3f2598]=_0x8f1e05[_0x30319e(0x16d)]('.'),_0x4d1a53={'api_key':_0x496420,'exp':Math[_0x30319e(0x142)](Date['now']())+_0xb62dcd*0x3e8,'timestamp':Math[_0x30319e(0x142)](Date[_0x30319e(0x15f)]())};return jwt[_0x30319e(0x166)](_0x4d1a53,_0x3f2598,{'algorithm':_0x30319e(0x16a),'header':{'alg':'HS256','sign_type':_0x30319e(0x15e)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x23d024){const _0x49e03f=_0x4cd932;let _0x31aee1={};try{_0x31aee1=JSON[_0x49e03f(0x146)](_0x23d024);}catch(_0x50fe7b){_0x31aee1={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console['error'](_0x49e03f(0x167),_0x23d024);}return _0x31aee1;}exports[_0x4cd932(0x149)]=compilerMetaJsonStr;function compilerStream(_0x24a2aa){const _0x1ea4ad=_0x4cd932;var _0x4fb5fa;if(_0x24a2aa['length']===0x3)return{'event':_0x24a2aa[0x0][_0x1ea4ad(0x14d)](_0x1ea4ad(0x161),''),'id':_0x24a2aa[0x1]['replace']('id:',''),'is_end':![],'result':_0x24a2aa[0x2][_0x1ea4ad(0x14d)](_0x1ea4ad(0x14c),'')['trim']()};if(_0x24a2aa[_0x1ea4ad(0x14b)]===0x4)return{'event':_0x24a2aa[0x0][_0x1ea4ad(0x14d)](_0x1ea4ad(0x161),''),'id':_0x24a2aa[0x1][_0x1ea4ad(0x14d)](_0x1ea4ad(0x16f),''),'result':_0x24a2aa[0x2]['replace']('data:','')[_0x1ea4ad(0x153)](),'is_end':!![],'usage':(_0x4fb5fa=compilerMetaJsonStr(_0x24a2aa[0x3][_0x1ea4ad(0x14d)](_0x1ea4ad(0x151),'')))===null||_0x4fb5fa===void 0x0?void 0x0:_0x4fb5fa[_0x1ea4ad(0x145)]};}exports[_0x4cd932(0x144)]=compilerStream;async function sendMessageFromZhipu(_0x5467af,{onProgress:_0x49dcf1,key:_0x286c8a,model:_0x44e3b8,temperature:temperature=0.95}){const _0x131eb4=await generateToken(_0x286c8a);return new Promise((_0x3afcf8,_0x16015f)=>{const _0x46badd=_0x3155,_0x26f2d7=_0x46badd(0x147)+_0x44e3b8+_0x46badd(0x16b),_0x374d10={'method':'POST','url':_0x26f2d7,'responseType':_0x46badd(0x170),'headers':{'Content-Type':_0x46badd(0x15b),'Authorization':_0x131eb4},'data':{'prompt':_0x5467af,'temperature':temperature}};axios(_0x374d10)[_0x46badd(0x162)](_0x46fa92=>{const _0x3af641=_0x46badd,_0x18b371=_0x46fa92[_0x3af641(0x16e)];let _0x1b3e2a,_0x5c5be5='';_0x18b371['on'](_0x3af641(0x16e),_0x3a84e0=>{const _0x16095f=_0x3af641,_0x4afa94=_0x3a84e0[_0x16095f(0x15c)]()[_0x16095f(0x16d)]('\x0a')[_0x16095f(0x155)](_0x1fece7=>_0x1fece7[_0x16095f(0x153)]()!==''),_0x1074b3=compilerStream(_0x4afa94);if(!_0x1074b3)return;const {id:_0x5bd04c,result:_0x8e18aa,is_end:_0x40e7de}=_0x1074b3;_0x8e18aa&&(_0x5c5be5+=_0x8e18aa[_0x16095f(0x153)]()),_0x40e7de&&(_0x1074b3[_0x16095f(0x163)]=![],_0x1b3e2a=_0x1074b3,_0x1b3e2a[_0x16095f(0x152)]=_0x5c5be5),_0x49dcf1(_0x1074b3);}),_0x18b371['on']('end',()=>{_0x3afcf8(_0x1b3e2a),_0x5c5be5='';});})[_0x46badd(0x15a)](_0x52447b=>{const _0x4a3391=_0x46badd;console[_0x4a3391(0x156)](_0x4a3391(0x15d),_0x52447b);});});}function _0x3155(_0x11129f,_0x5ecacb){const _0x13288b=_0x1328();return _0x3155=function(_0x3155f6,_0x5b32c5){_0x3155f6=_0x3155f6-0x142;let _0x4564d2=_0x13288b[_0x3155f6];return _0x4564d2;},_0x3155(_0x11129f,_0x5ecacb);}exports[_0x4cd932(0x159)]=sendMessageFromZhipu;