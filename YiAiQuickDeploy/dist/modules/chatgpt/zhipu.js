'use strict';function _0x3393(_0x143064,_0x1a9891){const _0x55b3e5=_0x55b3();return _0x3393=function(_0x339328,_0x15d23d){_0x339328=_0x339328-0x17b;let _0x5239c5=_0x55b3e5[_0x339328];return _0x5239c5;},_0x3393(_0x143064,_0x1a9891);}const _0x4a2d37=_0x3393;(function(_0x168afe,_0x3c33b3){const _0x4c3246=_0x3393,_0x220b14=_0x168afe();while(!![]){try{const _0x43e039=-parseInt(_0x4c3246(0x188))/0x1*(parseInt(_0x4c3246(0x1a2))/0x2)+-parseInt(_0x4c3246(0x182))/0x3+-parseInt(_0x4c3246(0x19d))/0x4+-parseInt(_0x4c3246(0x17e))/0x5+-parseInt(_0x4c3246(0x17f))/0x6+-parseInt(_0x4c3246(0x18d))/0x7*(parseInt(_0x4c3246(0x186))/0x8)+parseInt(_0x4c3246(0x1a5))/0x9*(parseInt(_0x4c3246(0x180))/0xa);if(_0x43e039===_0x3c33b3)break;else _0x220b14['push'](_0x220b14['shift']());}catch(_0x26e01c){_0x220b14['push'](_0x220b14['shift']());}}}(_0x55b3,0xb0cff));Object[_0x4a2d37(0x195)](exports,'__esModule',{'value':!![]}),exports[_0x4a2d37(0x193)]=exports[_0x4a2d37(0x18a)]=exports[_0x4a2d37(0x18e)]=exports['generateToken']=void 0x0;const axios=require(_0x4a2d37(0x190)),jwt=require(_0x4a2d37(0x19a));function generateToken(_0x47d878,_0x13a481=0x3e8*0x3c*0x3c*0x18*0x168){const _0x1e8127=_0x4a2d37,[_0x323325,_0x4044f7]=_0x47d878['split']('.'),_0x406115={'api_key':_0x323325,'exp':Math[_0x1e8127(0x19c)](Date[_0x1e8127(0x181)]())+_0x13a481*0x3e8,'timestamp':Math[_0x1e8127(0x19c)](Date[_0x1e8127(0x181)]())};return jwt[_0x1e8127(0x184)](_0x406115,_0x4044f7,{'algorithm':_0x1e8127(0x19e),'header':{'alg':_0x1e8127(0x19e),'sign_type':_0x1e8127(0x183)}});}exports[_0x4a2d37(0x191)]=generateToken;function compilerMetaJsonStr(_0x14de79){const _0x3455b1=_0x4a2d37;let _0x382945={};try{_0x382945=JSON[_0x3455b1(0x189)](_0x14de79);}catch(_0x23bd3c){_0x382945={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x3455b1(0x18b)]('json\x20parse\x20error\x20from\x20zhipu!',_0x14de79);}return _0x382945;}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function compilerStream(_0x805fc){const _0x38f1f8=_0x4a2d37;var _0x1ff354;if(_0x805fc[_0x38f1f8(0x17d)]===0x3)return{'event':_0x805fc[0x0][_0x38f1f8(0x197)](_0x38f1f8(0x185),''),'id':_0x805fc[0x1][_0x38f1f8(0x197)](_0x38f1f8(0x19b),''),'is_end':![],'result':_0x805fc[0x2]['replace'](_0x38f1f8(0x196),'')['trim']()};if(_0x805fc[_0x38f1f8(0x17d)]===0x4)return{'event':_0x805fc[0x0][_0x38f1f8(0x197)](_0x38f1f8(0x185),''),'id':_0x805fc[0x1]['replace'](_0x38f1f8(0x19b),''),'result':_0x805fc[0x2][_0x38f1f8(0x197)]('data:','')[_0x38f1f8(0x199)](),'is_end':!![],'usage':(_0x1ff354=compilerMetaJsonStr(_0x805fc[0x3][_0x38f1f8(0x197)](_0x38f1f8(0x1a1),'')))===null||_0x1ff354===void 0x0?void 0x0:_0x1ff354['usage']};}exports['compilerStream']=compilerStream;function _0x55b3(){const _0x583952=['log','trim','jsonwebtoken','id:','round','189344hEjdex','HS256','error:\x20','POST','meta:','2DhNRba','split','filter','36nJGlbx','application/json','stream','length','2899285VRaRBP','320088rxbjek','12150890qSBluM','now','4209216bwCIYo','SIGN','sign','event:','8JwFUVf','toString','1166181FIMPaK','parse','compilerStream','error','catch','6204373rLmGPP','compilerMetaJsonStr','data','axios','generateToken','then','sendMessageFromZhipu','https://open.bigmodel.cn/api/paas/v3/model-api/','defineProperty','data:','replace'];_0x55b3=function(){return _0x583952;};return _0x55b3();}async function sendMessageFromZhipu(_0x5c502c,{onProgress:_0x49669d,key:_0x2aa92f,model:_0xb80d89,temperature:temperature=0.95}){const _0xa7ad7d=await generateToken(_0x2aa92f);return new Promise((_0x41daf6,_0x1bbcc3)=>{const _0x3befba=_0x3393,_0x49bde7=_0x3befba(0x194)+_0xb80d89+'/sse-invoke',_0x4eb32e={'method':_0x3befba(0x1a0),'url':_0x49bde7,'responseType':_0x3befba(0x17c),'headers':{'Content-Type':_0x3befba(0x17b),'Authorization':_0xa7ad7d},'data':{'prompt':_0x5c502c,'temperature':temperature}};axios(_0x4eb32e)[_0x3befba(0x192)](_0x4db4d2=>{const _0x29dd99=_0x3befba,_0x531c4a=_0x4db4d2[_0x29dd99(0x18f)];let _0x3975d6,_0x2068dd='';_0x531c4a['on'](_0x29dd99(0x18f),_0xdcde02=>{const _0x7eb7ee=_0x29dd99,_0x6ccb8a=_0xdcde02[_0x7eb7ee(0x187)]()[_0x7eb7ee(0x1a3)]('\x0a')[_0x7eb7ee(0x1a4)](_0x2f726d=>_0x2f726d[_0x7eb7ee(0x199)]()!==''),_0x2c601b=compilerStream(_0x6ccb8a);if(!_0x2c601b)return;const {id:_0x32b0e5,result:_0x44d982,is_end:_0x2c18ba}=_0x2c601b;_0x44d982&&(_0x2068dd+=_0x44d982['trim']()),_0x2c18ba&&(_0x2c601b['is_end']=![],_0x3975d6=_0x2c601b,_0x3975d6['text']=_0x2068dd),_0x49669d(_0x2c601b);}),_0x531c4a['on']('end',()=>{_0x41daf6(_0x3975d6),_0x2068dd='';});})[_0x3befba(0x18c)](_0x2e63d8=>{const _0x5fe3cc=_0x3befba;console[_0x5fe3cc(0x198)](_0x5fe3cc(0x19f),_0x2e63d8);});});}exports[_0x4a2d37(0x193)]=sendMessageFromZhipu;