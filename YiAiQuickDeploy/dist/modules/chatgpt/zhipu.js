'use strict';const _0x5decef=_0x139e;function _0x2fe7(){const _0x1a8332=['error:\x20','length','2059841vVnZlx','parse','data','defineProperty','POST','data:','generateToken','replace','HS256','is_end','10opRsoj','109123FlhoiP','axios','412628CUjAve','json\x20parse\x20error\x20from\x20zhipu!','id:','sign','usage','application/json','error','log','1687206exlvcP','https://open.bigmodel.cn/api/paas/v3/model-api/','now','catch','toString','/sse-invoke','sendMessageFromZhipu','compilerStream','182319HtWHuT','SIGN','round','then','compilerMetaJsonStr','split','filter','1596865PoQSzh','3387632YmApEv','text','event:','trim'];_0x2fe7=function(){return _0x1a8332;};return _0x2fe7();}(function(_0x4f28a3,_0x30630d){const _0x5d1a1a=_0x139e,_0x5c418f=_0x4f28a3();while(!![]){try{const _0xfcfe30=-parseInt(_0x5d1a1a(0xab))/0x1+-parseInt(_0x5d1a1a(0xaa))/0x2*(-parseInt(_0x5d1a1a(0x92))/0x3)+-parseInt(_0x5d1a1a(0xad))/0x4+-parseInt(_0x5d1a1a(0x99))/0x5+-parseInt(_0x5d1a1a(0x8a))/0x6+parseInt(_0x5d1a1a(0xa0))/0x7+parseInt(_0x5d1a1a(0x9a))/0x8;if(_0xfcfe30===_0x30630d)break;else _0x5c418f['push'](_0x5c418f['shift']());}catch(_0x35dc71){_0x5c418f['push'](_0x5c418f['shift']());}}}(_0x2fe7,0x32f58));Object[_0x5decef(0xa3)](exports,'__esModule',{'value':!![]}),exports['sendMessageFromZhipu']=exports[_0x5decef(0x91)]=exports[_0x5decef(0x96)]=exports[_0x5decef(0xa6)]=void 0x0;const axios=require(_0x5decef(0xac)),jwt=require('jsonwebtoken');function generateToken(_0xfa342b,_0x4dddc0=0x3e8*0x3c*0x3c*0x18*0x168){const _0xbc0a51=_0x5decef,[_0x2405b3,_0x148611]=_0xfa342b[_0xbc0a51(0x97)]('.'),_0x28e02d={'api_key':_0x2405b3,'exp':Math[_0xbc0a51(0x94)](Date[_0xbc0a51(0x8c)]())+_0x4dddc0*0x3e8,'timestamp':Math['round'](Date[_0xbc0a51(0x8c)]())};return jwt[_0xbc0a51(0xb0)](_0x28e02d,_0x148611,{'algorithm':_0xbc0a51(0xa8),'header':{'alg':_0xbc0a51(0xa8),'sign_type':_0xbc0a51(0x93)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x1942ef){const _0x5091a2=_0x5decef;let _0x536b81={};try{_0x536b81=JSON[_0x5091a2(0xa1)](_0x1942ef);}catch(_0x2dfc6a){_0x536b81={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x5091a2(0x88)](_0x5091a2(0xae),_0x1942ef);}return _0x536b81;}exports[_0x5decef(0x96)]=compilerMetaJsonStr;function compilerStream(_0x5acb7e){const _0x103d06=_0x5decef;var _0x2eadef;if(_0x5acb7e[_0x103d06(0x9f)]===0x3)return{'event':_0x5acb7e[0x0]['replace'](_0x103d06(0x9c),''),'id':_0x5acb7e[0x1][_0x103d06(0xa7)](_0x103d06(0xaf),''),'is_end':![],'result':_0x5acb7e[0x2][_0x103d06(0xa7)]('data:','')['trim']()};if(_0x5acb7e[_0x103d06(0x9f)]===0x4)return{'event':_0x5acb7e[0x0][_0x103d06(0xa7)](_0x103d06(0x9c),''),'id':_0x5acb7e[0x1][_0x103d06(0xa7)](_0x103d06(0xaf),''),'result':_0x5acb7e[0x2][_0x103d06(0xa7)](_0x103d06(0xa5),'')[_0x103d06(0x9d)](),'is_end':!![],'usage':(_0x2eadef=compilerMetaJsonStr(_0x5acb7e[0x3][_0x103d06(0xa7)]('meta:','')))===null||_0x2eadef===void 0x0?void 0x0:_0x2eadef[_0x103d06(0x86)]};}exports['compilerStream']=compilerStream;function _0x139e(_0x4246bb,_0x3f5702){const _0x2fe7a4=_0x2fe7();return _0x139e=function(_0x139e53,_0x4f7b32){_0x139e53=_0x139e53-0x86;let _0x3839bd=_0x2fe7a4[_0x139e53];return _0x3839bd;},_0x139e(_0x4246bb,_0x3f5702);}async function sendMessageFromZhipu(_0x48d1b9,{onProgress:_0x5d4875,key:_0x5d9a37,model:_0x131d9a,temperature:temperature=0.95}){const _0x5d7315=await generateToken(_0x5d9a37);return new Promise((_0x1568d,_0x153b35)=>{const _0x45bbb3=_0x139e,_0x23fce9=_0x45bbb3(0x8b)+_0x131d9a+_0x45bbb3(0x8f),_0x4d4c3e={'method':_0x45bbb3(0xa4),'url':_0x23fce9,'responseType':'stream','headers':{'Content-Type':_0x45bbb3(0x87),'Authorization':_0x5d7315},'data':{'prompt':_0x48d1b9,'temperature':temperature}};axios(_0x4d4c3e)[_0x45bbb3(0x95)](_0x577760=>{const _0x3cdac6=_0x45bbb3,_0x50202e=_0x577760[_0x3cdac6(0xa2)];let _0x4cdbf2,_0x20bfab='';_0x50202e['on'](_0x3cdac6(0xa2),_0x5bd573=>{const _0x4835b0=_0x3cdac6,_0x256e48=_0x5bd573[_0x4835b0(0x8e)]()[_0x4835b0(0x97)]('\x0a')[_0x4835b0(0x98)](_0x40bb67=>_0x40bb67[_0x4835b0(0x9d)]()!==''),_0x26aaee=compilerStream(_0x256e48);if(!_0x26aaee)return;const {id:_0x50c516,result:_0x7e095e,is_end:_0x18829f}=_0x26aaee;_0x7e095e&&(_0x20bfab+=_0x7e095e[_0x4835b0(0x9d)]()),_0x18829f&&(_0x26aaee[_0x4835b0(0xa9)]=![],_0x4cdbf2=_0x26aaee,_0x4cdbf2[_0x4835b0(0x9b)]=_0x20bfab),_0x5d4875(_0x26aaee);}),_0x50202e['on']('end',()=>{_0x1568d(_0x4cdbf2),_0x20bfab='';});})[_0x45bbb3(0x8d)](_0xdabffa=>{const _0x369e96=_0x45bbb3;console[_0x369e96(0x89)](_0x369e96(0x9e),_0xdabffa);});});}exports[_0x5decef(0x90)]=sendMessageFromZhipu;