'use strict';const _0xd3eb44=_0x512b;(function(_0x177094,_0x101ef6){const _0x450e59=_0x512b,_0x22b3bd=_0x177094();while(!![]){try{const _0x599b50=-parseInt(_0x450e59(0xed))/0x1+-parseInt(_0x450e59(0xd8))/0x2*(-parseInt(_0x450e59(0xd6))/0x3)+-parseInt(_0x450e59(0xe9))/0x4+-parseInt(_0x450e59(0xf5))/0x5*(parseInt(_0x450e59(0xd9))/0x6)+-parseInt(_0x450e59(0xf0))/0x7*(-parseInt(_0x450e59(0xd5))/0x8)+parseInt(_0x450e59(0xf4))/0x9*(-parseInt(_0x450e59(0xdb))/0xa)+parseInt(_0x450e59(0xdd))/0xb;if(_0x599b50===_0x101ef6)break;else _0x22b3bd['push'](_0x22b3bd['shift']());}catch(_0x1ac7a9){_0x22b3bd['push'](_0x22b3bd['shift']());}}}(_0x5c38,0x354d8));Object[_0xd3eb44(0xeb)](exports,_0xd3eb44(0xda),{'value':!![]}),exports[_0xd3eb44(0xe3)]=exports[_0xd3eb44(0xe4)]=exports[_0xd3eb44(0xe0)]=exports['generateToken']=void 0x0;const axios=require(_0xd3eb44(0xfd)),jwt=require('jsonwebtoken');function _0x5c38(){const _0x276ff9=['sendMessageFromZhipu','compilerStream','replace','filter','round','POST','391464GZzCgB','error','defineProperty','end','356808gGkfft','/sse-invoke','stream','798wJcpKl','data','data:','text','8991WBhdQQ','29255UZEsdu','event:','error:\x20','HS256','application/json','sign','id:','toString','axios','length','now','18848PPcErg','6KuadfA','catch','369866AoTzLO','330tTsiaU','__esModule','2390OmLQqp','log','6546298ueMkmW','SIGN','usage','compilerMetaJsonStr','trim','json\x20parse\x20error\x20from\x20zhipu!'];_0x5c38=function(){return _0x276ff9;};return _0x5c38();}function _0x512b(_0x204396,_0x328d35){const _0x5c385f=_0x5c38();return _0x512b=function(_0x512b87,_0x1107b9){_0x512b87=_0x512b87-0xd4;let _0x4f525f=_0x5c385f[_0x512b87];return _0x4f525f;},_0x512b(_0x204396,_0x328d35);}function generateToken(_0xc67502,_0x1ca449=0x3e8*0x3c*0x3c*0x18*0x168){const _0xce3a49=_0xd3eb44,[_0x4a7d79,_0x4a5a62]=_0xc67502['split']('.'),_0x10ec56={'api_key':_0x4a7d79,'exp':Math[_0xce3a49(0xe7)](Date[_0xce3a49(0xd4)]())+_0x1ca449*0x3e8,'timestamp':Math['round'](Date['now']())};return jwt[_0xce3a49(0xfa)](_0x10ec56,_0x4a5a62,{'algorithm':_0xce3a49(0xf8),'header':{'alg':'HS256','sign_type':_0xce3a49(0xde)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x1aada1){const _0x15f451=_0xd3eb44;let _0x472ab7={};try{_0x472ab7=JSON['parse'](_0x1aada1);}catch(_0x46a2fa){_0x472ab7={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x15f451(0xea)](_0x15f451(0xe2),_0x1aada1);}return _0x472ab7;}exports[_0xd3eb44(0xe0)]=compilerMetaJsonStr;function compilerStream(_0x395080){const _0x633ae1=_0xd3eb44;var _0x2df8b0;if(_0x395080[_0x633ae1(0xfe)]===0x3)return{'event':_0x395080[0x0]['replace'](_0x633ae1(0xf6),''),'id':_0x395080[0x1][_0x633ae1(0xe5)](_0x633ae1(0xfb),''),'is_end':![],'result':_0x395080[0x2][_0x633ae1(0xe5)](_0x633ae1(0xf2),'')[_0x633ae1(0xe1)]()};if(_0x395080['length']===0x4)return{'event':_0x395080[0x0][_0x633ae1(0xe5)](_0x633ae1(0xf6),''),'id':_0x395080[0x1]['replace'](_0x633ae1(0xfb),''),'result':_0x395080[0x2][_0x633ae1(0xe5)]('data:','')[_0x633ae1(0xe1)](),'is_end':!![],'usage':(_0x2df8b0=compilerMetaJsonStr(_0x395080[0x3][_0x633ae1(0xe5)]('meta:','')))===null||_0x2df8b0===void 0x0?void 0x0:_0x2df8b0[_0x633ae1(0xdf)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x56adc3,{onProgress:_0x45a339,key:_0x171f65,model:_0x4b92e2,temperature:temperature=0.95}){const _0x2cabc9=await generateToken(_0x171f65);return new Promise((_0x34af4e,_0x5b7b9c)=>{const _0x2f03e9=_0x512b,_0x356a81='https://open.bigmodel.cn/api/paas/v3/model-api/'+_0x4b92e2+_0x2f03e9(0xee),_0x49e1da={'method':_0x2f03e9(0xe8),'url':_0x356a81,'responseType':_0x2f03e9(0xef),'headers':{'Content-Type':_0x2f03e9(0xf9),'Authorization':_0x2cabc9},'data':{'prompt':_0x56adc3,'temperature':temperature}};axios(_0x49e1da)['then'](_0x262d43=>{const _0x497ad8=_0x2f03e9,_0x43e81a=_0x262d43[_0x497ad8(0xf1)];let _0x146cbf,_0x49681b='';_0x43e81a['on'](_0x497ad8(0xf1),_0x46d95b=>{const _0x237383=_0x497ad8,_0x1700ed=_0x46d95b[_0x237383(0xfc)]()['split']('\x0a')[_0x237383(0xe6)](_0x168d42=>_0x168d42[_0x237383(0xe1)]()!==''),_0x5db78d=compilerStream(_0x1700ed);if(!_0x5db78d)return;const {id:_0x3e8f4d,result:_0x50b4e1,is_end:_0x2b605d}=_0x5db78d;_0x50b4e1&&(_0x49681b+=_0x50b4e1['trim']()),_0x2b605d&&(_0x5db78d['is_end']=![],_0x146cbf=_0x5db78d,_0x146cbf[_0x237383(0xf3)]=_0x49681b),_0x45a339(_0x5db78d);}),_0x43e81a['on'](_0x497ad8(0xec),()=>{_0x34af4e(_0x146cbf),_0x49681b='';});})[_0x2f03e9(0xd7)](_0x320a5a=>{const _0x36d2ad=_0x2f03e9;console[_0x36d2ad(0xdc)](_0x36d2ad(0xf7),_0x320a5a);});});}exports[_0xd3eb44(0xe3)]=sendMessageFromZhipu;