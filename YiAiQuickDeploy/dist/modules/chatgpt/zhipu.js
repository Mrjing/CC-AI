'use strict';const _0x4e3d03=_0x1cd4;(function(_0x3fcc1a,_0x1a1fb1){const _0xcdf005=_0x1cd4,_0x15ab87=_0x3fcc1a();while(!![]){try{const _0x4a8fd8=-parseInt(_0xcdf005(0x1e8))/0x1+parseInt(_0xcdf005(0x1d5))/0x2*(parseInt(_0xcdf005(0x1e1))/0x3)+parseInt(_0xcdf005(0x1f3))/0x4+-parseInt(_0xcdf005(0x1d2))/0x5+parseInt(_0xcdf005(0x1ec))/0x6*(-parseInt(_0xcdf005(0x1ca))/0x7)+-parseInt(_0xcdf005(0x1cc))/0x8*(-parseInt(_0xcdf005(0x1db))/0x9)+-parseInt(_0xcdf005(0x1d7))/0xa;if(_0x4a8fd8===_0x1a1fb1)break;else _0x15ab87['push'](_0x15ab87['shift']());}catch(_0xd9c539){_0x15ab87['push'](_0x15ab87['shift']());}}}(_0x5592,0xd4b5a));function _0x5592(){const _0x1b54ec=['6501965ewGNvQ','__esModule','parse','44mTCoYA','application/json','3436180IYObEl','compilerStream','event:','meta:','896472oLVjZn','end','HS256','then','length','json\x20parse\x20error\x20from\x20zhipu!','222171yGpPfi','sendMessageFromZhipu','defineProperty','axios','data','jsonwebtoken','sign','1508430pTWyEX','error:\x20','split','https://open.bigmodel.cn/api/paas/v3/model-api/','66XxroUu','/sse-invoke','replace','toString','compilerMetaJsonStr','trim','stream','4157832XzwaqV','catch','215313BHpxHs','generateToken','136KcAEwT','id:','text','round','data:','usage'];_0x5592=function(){return _0x1b54ec;};return _0x5592();}Object[_0x4e3d03(0x1e3)](exports,_0x4e3d03(0x1d3),{'value':!![]}),exports[_0x4e3d03(0x1e2)]=exports[_0x4e3d03(0x1d8)]=exports[_0x4e3d03(0x1f0)]=exports[_0x4e3d03(0x1cb)]=void 0x0;const axios=require(_0x4e3d03(0x1e4)),jwt=require(_0x4e3d03(0x1e6));function generateToken(_0x103e37,_0x452fc1=0x3e8*0x3c*0x3c*0x18*0x168){const _0x1a383c=_0x4e3d03,[_0xffafc2,_0x4fb255]=_0x103e37[_0x1a383c(0x1ea)]('.'),_0x2f814f={'api_key':_0xffafc2,'exp':Math[_0x1a383c(0x1cf)](Date['now']())+_0x452fc1*0x3e8,'timestamp':Math[_0x1a383c(0x1cf)](Date['now']())};return jwt[_0x1a383c(0x1e7)](_0x2f814f,_0x4fb255,{'algorithm':_0x1a383c(0x1dd),'header':{'alg':_0x1a383c(0x1dd),'sign_type':'SIGN'}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x57f184){const _0x112989=_0x4e3d03;let _0x9ad9e5={};try{_0x9ad9e5=JSON[_0x112989(0x1d4)](_0x57f184);}catch(_0x2624b1){_0x9ad9e5={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console['error'](_0x112989(0x1e0),_0x57f184);}return _0x9ad9e5;}exports[_0x4e3d03(0x1f0)]=compilerMetaJsonStr;function compilerStream(_0x490d5f){const _0x2d3ada=_0x4e3d03;var _0x5efdf0;if(_0x490d5f[_0x2d3ada(0x1df)]===0x3)return{'event':_0x490d5f[0x0][_0x2d3ada(0x1ee)]('event:',''),'id':_0x490d5f[0x1]['replace'](_0x2d3ada(0x1cd),''),'is_end':![],'result':_0x490d5f[0x2][_0x2d3ada(0x1ee)](_0x2d3ada(0x1d0),'')['trim']()};if(_0x490d5f['length']===0x4)return{'event':_0x490d5f[0x0][_0x2d3ada(0x1ee)](_0x2d3ada(0x1d9),''),'id':_0x490d5f[0x1][_0x2d3ada(0x1ee)](_0x2d3ada(0x1cd),''),'result':_0x490d5f[0x2]['replace']('data:','')[_0x2d3ada(0x1f1)](),'is_end':!![],'usage':(_0x5efdf0=compilerMetaJsonStr(_0x490d5f[0x3][_0x2d3ada(0x1ee)](_0x2d3ada(0x1da),'')))===null||_0x5efdf0===void 0x0?void 0x0:_0x5efdf0[_0x2d3ada(0x1d1)]};}function _0x1cd4(_0xe2a9cc,_0x393491){const _0x559293=_0x5592();return _0x1cd4=function(_0x1cd400,_0x448239){_0x1cd400=_0x1cd400-0x1c9;let _0x201c9d=_0x559293[_0x1cd400];return _0x201c9d;},_0x1cd4(_0xe2a9cc,_0x393491);}exports[_0x4e3d03(0x1d8)]=compilerStream;async function sendMessageFromZhipu(_0x1d4dab,{onProgress:_0x157ca8,key:_0x638387,model:_0xcfa1d3,temperature:temperature=0.95}){const _0x3197bd=await generateToken(_0x638387);return new Promise((_0x1c971c,_0x32784f)=>{const _0x331700=_0x1cd4,_0x514409=_0x331700(0x1eb)+_0xcfa1d3+_0x331700(0x1ed),_0x522fbc={'method':'POST','url':_0x514409,'responseType':_0x331700(0x1f2),'headers':{'Content-Type':_0x331700(0x1d6),'Authorization':_0x3197bd},'data':{'prompt':_0x1d4dab,'temperature':temperature}};axios(_0x522fbc)[_0x331700(0x1de)](_0xf15691=>{const _0x25de57=_0x331700,_0x20cfd1=_0xf15691[_0x25de57(0x1e5)];let _0x2ae9e7,_0x461944='';_0x20cfd1['on'](_0x25de57(0x1e5),_0x3ec6ec=>{const _0x1cabdf=_0x25de57,_0x4b1bd2=_0x3ec6ec[_0x1cabdf(0x1ef)]()['split']('\x0a')['filter'](_0x38c1ac=>_0x38c1ac[_0x1cabdf(0x1f1)]()!==''),_0x160086=compilerStream(_0x4b1bd2);if(!_0x160086)return;const {id:_0x3c619e,result:_0x18c10e,is_end:_0x4c47fe}=_0x160086;_0x18c10e&&(_0x461944+=_0x18c10e[_0x1cabdf(0x1f1)]()),_0x4c47fe&&(_0x160086['is_end']=![],_0x2ae9e7=_0x160086,_0x2ae9e7[_0x1cabdf(0x1ce)]=_0x461944),_0x157ca8(_0x160086);}),_0x20cfd1['on'](_0x25de57(0x1dc),()=>{_0x1c971c(_0x2ae9e7),_0x461944='';});})[_0x331700(0x1c9)](_0x57f982=>{const _0x3b6dcf=_0x331700;console['log'](_0x3b6dcf(0x1e9),_0x57f982);});});}exports[_0x4e3d03(0x1e2)]=sendMessageFromZhipu;