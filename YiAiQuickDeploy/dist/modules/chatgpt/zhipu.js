'use strict';const _0x2bd90c=_0xe3d9;(function(_0x3d08d1,_0x35483a){const _0x542cd7=_0xe3d9,_0x4cb278=_0x3d08d1();while(!![]){try{const _0x34e2a6=parseInt(_0x542cd7(0x1dc))/0x1+-parseInt(_0x542cd7(0x1e9))/0x2*(-parseInt(_0x542cd7(0x1e7))/0x3)+parseInt(_0x542cd7(0x1e8))/0x4*(-parseInt(_0x542cd7(0x1e2))/0x5)+parseInt(_0x542cd7(0x1f6))/0x6+parseInt(_0x542cd7(0x1ea))/0x7+-parseInt(_0x542cd7(0x1f3))/0x8*(-parseInt(_0x542cd7(0x1fd))/0x9)+parseInt(_0x542cd7(0x1dd))/0xa*(-parseInt(_0x542cd7(0x1ef))/0xb);if(_0x34e2a6===_0x35483a)break;else _0x4cb278['push'](_0x4cb278['shift']());}catch(_0x27a90c){_0x4cb278['push'](_0x4cb278['shift']());}}}(_0x26d0,0x8d377));Object[_0x2bd90c(0x1f4)](exports,_0x2bd90c(0x1e1),{'value':!![]}),exports[_0x2bd90c(0x1ee)]=exports[_0x2bd90c(0x1db)]=exports[_0x2bd90c(0x1e5)]=exports[_0x2bd90c(0x1d6)]=void 0x0;function _0x26d0(){const _0x478dea=['id:','meta:','generateToken','data:','parse','error','split','compilerStream','4409DsvwGN','1558870XdNTiI','stream','text','/sse-invoke','__esModule','45350QwLjDn','trim','application/json','compilerMetaJsonStr','sign','5814UWnxXT','80ogtgVr','230NlHSma','2733710JGBVOX','axios','toString','POST','sendMessageFromZhipu','121WnPyqj','then','event:','usage','96OjIIIV','defineProperty','now','5467098XgIMza','HS256','round','end','data','replace','catch','709191eCGeEA','is_end','SIGN'];_0x26d0=function(){return _0x478dea;};return _0x26d0();}function _0xe3d9(_0x523c2e,_0x39dd05){const _0x26d09b=_0x26d0();return _0xe3d9=function(_0xe3d926,_0x7fb0bb){_0xe3d926=_0xe3d926-0x1d2;let _0x2f2afd=_0x26d09b[_0xe3d926];return _0x2f2afd;},_0xe3d9(_0x523c2e,_0x39dd05);}const axios=require(_0x2bd90c(0x1eb)),jwt=require('jsonwebtoken');function generateToken(_0x70ebf8,_0x59fd45=0x3e8*0x3c*0x3c*0x18*0x168){const _0x53b5a6=_0x2bd90c,[_0x507334,_0x200d83]=_0x70ebf8[_0x53b5a6(0x1da)]('.'),_0x79f9ca={'api_key':_0x507334,'exp':Math['round'](Date[_0x53b5a6(0x1f5)]())+_0x59fd45*0x3e8,'timestamp':Math[_0x53b5a6(0x1f8)](Date[_0x53b5a6(0x1f5)]())};return jwt[_0x53b5a6(0x1e6)](_0x79f9ca,_0x200d83,{'algorithm':_0x53b5a6(0x1f7),'header':{'alg':_0x53b5a6(0x1f7),'sign_type':_0x53b5a6(0x1d3)}});}exports[_0x2bd90c(0x1d6)]=generateToken;function compilerMetaJsonStr(_0x270ceb){const _0x3c97bd=_0x2bd90c;let _0x1a3179={};try{_0x1a3179=JSON[_0x3c97bd(0x1d8)](_0x270ceb);}catch(_0x202a2e){_0x1a3179={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x3c97bd(0x1d9)]('json\x20parse\x20error\x20from\x20zhipu!',_0x270ceb);}return _0x1a3179;}exports[_0x2bd90c(0x1e5)]=compilerMetaJsonStr;function compilerStream(_0x5ee9fe){const _0xfac576=_0x2bd90c;var _0x3d8e06;if(_0x5ee9fe['length']===0x3)return{'event':_0x5ee9fe[0x0][_0xfac576(0x1fb)](_0xfac576(0x1f1),''),'id':_0x5ee9fe[0x1][_0xfac576(0x1fb)](_0xfac576(0x1d4),''),'is_end':![],'result':_0x5ee9fe[0x2][_0xfac576(0x1fb)](_0xfac576(0x1d7),'')[_0xfac576(0x1e3)]()};if(_0x5ee9fe['length']===0x4)return{'event':_0x5ee9fe[0x0]['replace'](_0xfac576(0x1f1),''),'id':_0x5ee9fe[0x1][_0xfac576(0x1fb)]('id:',''),'result':_0x5ee9fe[0x2][_0xfac576(0x1fb)]('data:','')['trim'](),'is_end':!![],'usage':(_0x3d8e06=compilerMetaJsonStr(_0x5ee9fe[0x3][_0xfac576(0x1fb)](_0xfac576(0x1d5),'')))===null||_0x3d8e06===void 0x0?void 0x0:_0x3d8e06[_0xfac576(0x1f2)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0xe489ad,{onProgress:_0x35e586,key:_0x1a7521,model:_0x2d4aa8,temperature:temperature=0.95}){const _0x1d4afb=await generateToken(_0x1a7521);return new Promise((_0x204d60,_0x59e9ae)=>{const _0xe3feb2=_0xe3d9,_0x175309='https://open.bigmodel.cn/api/paas/v3/model-api/'+_0x2d4aa8+_0xe3feb2(0x1e0),_0x516fb1={'method':_0xe3feb2(0x1ed),'url':_0x175309,'responseType':_0xe3feb2(0x1de),'headers':{'Content-Type':_0xe3feb2(0x1e4),'Authorization':_0x1d4afb},'data':{'prompt':_0xe489ad,'temperature':temperature}};axios(_0x516fb1)[_0xe3feb2(0x1f0)](_0x1c12d9=>{const _0x1f9deb=_0xe3feb2,_0xbadf91=_0x1c12d9[_0x1f9deb(0x1fa)];let _0x25aa18,_0x2c41b3='';_0xbadf91['on'](_0x1f9deb(0x1fa),_0x2f9921=>{const _0x1e3521=_0x1f9deb,_0x4e02d2=_0x2f9921[_0x1e3521(0x1ec)]()['split']('\x0a')['filter'](_0x481284=>_0x481284['trim']()!==''),_0x6a9ba3=compilerStream(_0x4e02d2);if(!_0x6a9ba3)return;const {id:_0xde3c7b,result:_0x2dfb6f,is_end:_0xbdafb6}=_0x6a9ba3;_0x2dfb6f&&(_0x2c41b3+=_0x2dfb6f[_0x1e3521(0x1e3)]()),_0xbdafb6&&(_0x6a9ba3[_0x1e3521(0x1d2)]=![],_0x25aa18=_0x6a9ba3,_0x25aa18[_0x1e3521(0x1df)]=_0x2c41b3),_0x35e586(_0x6a9ba3);}),_0xbadf91['on'](_0x1f9deb(0x1f9),()=>{_0x204d60(_0x25aa18),_0x2c41b3='';});})[_0xe3feb2(0x1fc)](_0x301db5=>{console['log']('error:\x20',_0x301db5);});});}exports[_0x2bd90c(0x1ee)]=sendMessageFromZhipu;