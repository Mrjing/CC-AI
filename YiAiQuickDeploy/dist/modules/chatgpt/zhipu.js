'use strict';const _0x485b21=_0x5b8c;(function(_0x3bc3aa,_0x41ce90){const _0x1da62a=_0x5b8c,_0x4a156d=_0x3bc3aa();while(!![]){try{const _0x56f757=-parseInt(_0x1da62a(0x18a))/0x1*(-parseInt(_0x1da62a(0x1a2))/0x2)+-parseInt(_0x1da62a(0x193))/0x3*(parseInt(_0x1da62a(0x17e))/0x4)+parseInt(_0x1da62a(0x19c))/0x5*(parseInt(_0x1da62a(0x191))/0x6)+parseInt(_0x1da62a(0x180))/0x7+-parseInt(_0x1da62a(0x183))/0x8*(parseInt(_0x1da62a(0x19f))/0x9)+-parseInt(_0x1da62a(0x18e))/0xa*(parseInt(_0x1da62a(0x184))/0xb)+-parseInt(_0x1da62a(0x18d))/0xc*(-parseInt(_0x1da62a(0x18f))/0xd);if(_0x56f757===_0x41ce90)break;else _0x4a156d['push'](_0x4a156d['shift']());}catch(_0x3fbbde){_0x4a156d['push'](_0x4a156d['shift']());}}}(_0x2c5a,0xf0ce2));function _0x2c5a(){const _0x31a4ec=['error','POST','/sse-invoke','HS256','compilerMetaJsonStr','catch','438410DoRFqp','axios','compilerStream','396xGLbKr','length','event:','4ZvDwRX','https://open.bigmodel.cn/api/paas/v3/model-api/','jsonwebtoken','trim','id:','split','parse','filter','data:','sendMessageFromZhipu','usage','SIGN','3672020CNscDn','replace','8670088AUraqo','round','log','333368HkBQnR','11UwXouU','then','toString','application/json','__esModule','now','520531DRPHdb','defineProperty','meta:','102180bGOtcd','9727010ZqKePr','4979nTMvnV','error:\x20','6mMKDRx','generateToken','6PIEIZk','data','end'];_0x2c5a=function(){return _0x31a4ec;};return _0x2c5a();}Object[_0x485b21(0x18b)](exports,_0x485b21(0x188),{'value':!![]}),exports['sendMessageFromZhipu']=exports['compilerStream']=exports[_0x485b21(0x19a)]=exports['generateToken']=void 0x0;const axios=require(_0x485b21(0x19d)),jwt=require(_0x485b21(0x1a4));function _0x5b8c(_0x530566,_0x8678b0){const _0x2c5a04=_0x2c5a();return _0x5b8c=function(_0x5b8c19,_0x2189f5){_0x5b8c19=_0x5b8c19-0x175;let _0x47e4e0=_0x2c5a04[_0x5b8c19];return _0x47e4e0;},_0x5b8c(_0x530566,_0x8678b0);}function generateToken(_0x10c804,_0x60adc2=0x3e8*0x3c*0x3c*0x18*0x168){const _0x3c51ad=_0x485b21,[_0x197421,_0x160926]=_0x10c804[_0x3c51ad(0x177)]('.'),_0x3b91ca={'api_key':_0x197421,'exp':Math[_0x3c51ad(0x181)](Date[_0x3c51ad(0x189)]())+_0x60adc2*0x3e8,'timestamp':Math[_0x3c51ad(0x181)](Date['now']())};return jwt['sign'](_0x3b91ca,_0x160926,{'algorithm':_0x3c51ad(0x199),'header':{'alg':_0x3c51ad(0x199),'sign_type':_0x3c51ad(0x17d)}});}exports[_0x485b21(0x192)]=generateToken;function compilerMetaJsonStr(_0x303b8a){const _0x3420ff=_0x485b21;let _0x3794a3={};try{_0x3794a3=JSON[_0x3420ff(0x178)](_0x303b8a);}catch(_0x6db987){_0x3794a3={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x3420ff(0x196)]('json\x20parse\x20error\x20from\x20zhipu!',_0x303b8a);}return _0x3794a3;}exports[_0x485b21(0x19a)]=compilerMetaJsonStr;function compilerStream(_0x28e4cc){const _0x42ccf9=_0x485b21;var _0x57f779;if(_0x28e4cc[_0x42ccf9(0x1a0)]===0x3)return{'event':_0x28e4cc[0x0][_0x42ccf9(0x17f)]('event:',''),'id':_0x28e4cc[0x1][_0x42ccf9(0x17f)](_0x42ccf9(0x176),''),'is_end':![],'result':_0x28e4cc[0x2][_0x42ccf9(0x17f)](_0x42ccf9(0x17a),'')[_0x42ccf9(0x175)]()};if(_0x28e4cc['length']===0x4)return{'event':_0x28e4cc[0x0][_0x42ccf9(0x17f)](_0x42ccf9(0x1a1),''),'id':_0x28e4cc[0x1]['replace'](_0x42ccf9(0x176),''),'result':_0x28e4cc[0x2]['replace'](_0x42ccf9(0x17a),'')[_0x42ccf9(0x175)](),'is_end':!![],'usage':(_0x57f779=compilerMetaJsonStr(_0x28e4cc[0x3][_0x42ccf9(0x17f)](_0x42ccf9(0x18c),'')))===null||_0x57f779===void 0x0?void 0x0:_0x57f779[_0x42ccf9(0x17c)]};}exports[_0x485b21(0x19e)]=compilerStream;async function sendMessageFromZhipu(_0x10a930,{onProgress:_0x73b28d,key:_0x3f0dd2,model:_0x5d02be,temperature:temperature=0.95}){const _0x3b26d7=await generateToken(_0x3f0dd2);return new Promise((_0x487ba5,_0x338437)=>{const _0x577876=_0x5b8c,_0x40e14b=_0x577876(0x1a3)+_0x5d02be+_0x577876(0x198),_0x34300a={'method':_0x577876(0x197),'url':_0x40e14b,'responseType':'stream','headers':{'Content-Type':_0x577876(0x187),'Authorization':_0x3b26d7},'data':{'prompt':_0x10a930,'temperature':temperature}};axios(_0x34300a)[_0x577876(0x185)](_0x4d8da1=>{const _0x50d650=_0x577876,_0x5491c7=_0x4d8da1[_0x50d650(0x194)];let _0x1818b0,_0x2a6d53='';_0x5491c7['on'](_0x50d650(0x194),_0x505d1b=>{const _0x843f8a=_0x50d650,_0x3413ef=_0x505d1b[_0x843f8a(0x186)]()['split']('\x0a')[_0x843f8a(0x179)](_0x5d203b=>_0x5d203b[_0x843f8a(0x175)]()!==''),_0xc07002=compilerStream(_0x3413ef);if(!_0xc07002)return;const {id:_0x13fdbf,result:_0x289285,is_end:_0x2d5c9d}=_0xc07002;_0x289285&&(_0x2a6d53+=_0x289285[_0x843f8a(0x175)]()),_0x2d5c9d&&(_0xc07002['is_end']=![],_0x1818b0=_0xc07002,_0x1818b0['text']=_0x2a6d53),_0x73b28d(_0xc07002);}),_0x5491c7['on'](_0x50d650(0x195),()=>{_0x487ba5(_0x1818b0),_0x2a6d53='';});})[_0x577876(0x19b)](_0x3bb37d=>{const _0x42596c=_0x577876;console[_0x42596c(0x182)](_0x42596c(0x190),_0x3bb37d);});});}exports[_0x485b21(0x17b)]=sendMessageFromZhipu;