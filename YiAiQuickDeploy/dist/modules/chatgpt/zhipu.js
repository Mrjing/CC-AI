'use strict';const _0x339ae3=_0x3e75;(function(_0x3b6528,_0x1fd5b5){const _0x1fa42a=_0x3e75,_0x161bbd=_0x3b6528();while(!![]){try{const _0x397f00=parseInt(_0x1fa42a(0x1e8))/0x1*(-parseInt(_0x1fa42a(0x1e1))/0x2)+-parseInt(_0x1fa42a(0x1df))/0x3*(parseInt(_0x1fa42a(0x1f8))/0x4)+-parseInt(_0x1fa42a(0x1e3))/0x5+parseInt(_0x1fa42a(0x1fc))/0x6+-parseInt(_0x1fa42a(0x1eb))/0x7+parseInt(_0x1fa42a(0x1f3))/0x8*(parseInt(_0x1fa42a(0x1f2))/0x9)+parseInt(_0x1fa42a(0x1dd))/0xa;if(_0x397f00===_0x1fd5b5)break;else _0x161bbd['push'](_0x161bbd['shift']());}catch(_0x30177d){_0x161bbd['push'](_0x161bbd['shift']());}}}(_0x483e,0xe1023));Object[_0x339ae3(0x1f7)](exports,_0x339ae3(0x1db),{'value':!![]}),exports[_0x339ae3(0x1ff)]=exports[_0x339ae3(0x1f4)]=exports[_0x339ae3(0x1de)]=exports[_0x339ae3(0x1fe)]=void 0x0;const axios=require(_0x339ae3(0x1e0)),jwt=require(_0x339ae3(0x1fb));function _0x483e(){const _0x1672bb=['meta:','4251600jgEoHv','end','id:','log','replace','1161wsZQfz','SIGN','HS256','9198021KdJJIa','error:\x20','event:','catch','split','data:','usage','13663953JnkkyU','8SAONyj','compilerStream','data','https://open.bigmodel.cn/api/paas/v3/model-api/','defineProperty','36kRWLRJ','error','text','jsonwebtoken','1618854lQNTMc','now','generateToken','sendMessageFromZhipu','length','trim','round','__esModule','stream','14495460wJVUZs','compilerMetaJsonStr','23061LSPLNl','axios','142fOBlWt'];_0x483e=function(){return _0x1672bb;};return _0x483e();}function generateToken(_0x2934a7,_0x5ab199=0x3e8*0x3c*0x3c*0x18*0x168){const _0x1e2cf9=_0x339ae3,[_0x3dbcaf,_0x5007e4]=_0x2934a7[_0x1e2cf9(0x1ef)]('.'),_0x3f8ce1={'api_key':_0x3dbcaf,'exp':Math[_0x1e2cf9(0x1da)](Date[_0x1e2cf9(0x1fd)]())+_0x5ab199*0x3e8,'timestamp':Math[_0x1e2cf9(0x1da)](Date['now']())};return jwt['sign'](_0x3f8ce1,_0x5007e4,{'algorithm':_0x1e2cf9(0x1ea),'header':{'alg':'HS256','sign_type':_0x1e2cf9(0x1e9)}});}function _0x3e75(_0x53a1a8,_0xb0a162){const _0x483ed3=_0x483e();return _0x3e75=function(_0x3e75b5,_0x5f0fe5){_0x3e75b5=_0x3e75b5-0x1d8;let _0x4599fd=_0x483ed3[_0x3e75b5];return _0x4599fd;},_0x3e75(_0x53a1a8,_0xb0a162);}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x142dc5){const _0x1e9f88=_0x339ae3;let _0x1caa80={};try{_0x1caa80=JSON['parse'](_0x142dc5);}catch(_0x172a40){_0x1caa80={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x1e9f88(0x1f9)]('json\x20parse\x20error\x20from\x20zhipu!',_0x142dc5);}return _0x1caa80;}exports[_0x339ae3(0x1de)]=compilerMetaJsonStr;function compilerStream(_0x208d8e){const _0x11c7f7=_0x339ae3;var _0x115dcd;if(_0x208d8e[_0x11c7f7(0x1d8)]===0x3)return{'event':_0x208d8e[0x0][_0x11c7f7(0x1e7)](_0x11c7f7(0x1ed),''),'id':_0x208d8e[0x1][_0x11c7f7(0x1e7)](_0x11c7f7(0x1e5),''),'is_end':![],'result':_0x208d8e[0x2]['replace'](_0x11c7f7(0x1f0),'')[_0x11c7f7(0x1d9)]()};if(_0x208d8e[_0x11c7f7(0x1d8)]===0x4)return{'event':_0x208d8e[0x0]['replace'](_0x11c7f7(0x1ed),''),'id':_0x208d8e[0x1]['replace'](_0x11c7f7(0x1e5),''),'result':_0x208d8e[0x2][_0x11c7f7(0x1e7)]('data:','')['trim'](),'is_end':!![],'usage':(_0x115dcd=compilerMetaJsonStr(_0x208d8e[0x3][_0x11c7f7(0x1e7)](_0x11c7f7(0x1e2),'')))===null||_0x115dcd===void 0x0?void 0x0:_0x115dcd[_0x11c7f7(0x1f1)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0xb2e807,{onProgress:_0x17c0c8,key:_0x3ac182,model:_0x21fd94,temperature:temperature=0.95}){const _0x385305=await generateToken(_0x3ac182);return new Promise((_0x2fd161,_0x1851e5)=>{const _0x19e4da=_0x3e75,_0x58729b=_0x19e4da(0x1f6)+_0x21fd94+'/sse-invoke',_0x572ece={'method':'POST','url':_0x58729b,'responseType':_0x19e4da(0x1dc),'headers':{'Content-Type':'application/json','Authorization':_0x385305},'data':{'prompt':_0xb2e807,'temperature':temperature}};axios(_0x572ece)['then'](_0x408934=>{const _0xad8ed1=_0x19e4da,_0xaee99=_0x408934['data'];let _0x478ed5,_0x58ff54='';_0xaee99['on'](_0xad8ed1(0x1f5),_0x5899ff=>{const _0xc3a034=_0xad8ed1,_0x592567=_0x5899ff['toString']()[_0xc3a034(0x1ef)]('\x0a')['filter'](_0x4c5c3f=>_0x4c5c3f[_0xc3a034(0x1d9)]()!==''),_0x40b3ac=compilerStream(_0x592567);if(!_0x40b3ac)return;const {id:_0x1b6133,result:_0x50a4d8,is_end:_0xc15cde}=_0x40b3ac;_0x50a4d8&&(_0x58ff54+=_0x50a4d8['trim']()),_0xc15cde&&(_0x40b3ac['is_end']=![],_0x478ed5=_0x40b3ac,_0x478ed5[_0xc3a034(0x1fa)]=_0x58ff54),_0x17c0c8(_0x40b3ac);}),_0xaee99['on'](_0xad8ed1(0x1e4),()=>{_0x2fd161(_0x478ed5),_0x58ff54='';});})[_0x19e4da(0x1ee)](_0x458ce1=>{const _0x45d773=_0x19e4da;console[_0x45d773(0x1e6)](_0x45d773(0x1ec),_0x458ce1);});});}exports[_0x339ae3(0x1ff)]=sendMessageFromZhipu;