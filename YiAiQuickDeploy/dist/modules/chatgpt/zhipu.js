'use strict';const _0x2ccc18=_0x5c8d;(function(_0xd20b6f,_0x4350c2){const _0x3393e2=_0x5c8d,_0x4c302f=_0xd20b6f();while(!![]){try{const _0x28d0a6=-parseInt(_0x3393e2(0x1af))/0x1*(-parseInt(_0x3393e2(0x1a0))/0x2)+parseInt(_0x3393e2(0x1a2))/0x3*(-parseInt(_0x3393e2(0x1b2))/0x4)+-parseInt(_0x3393e2(0x1bf))/0x5*(-parseInt(_0x3393e2(0x1b7))/0x6)+parseInt(_0x3393e2(0x1c7))/0x7*(parseInt(_0x3393e2(0x1be))/0x8)+parseInt(_0x3393e2(0x1ac))/0x9+-parseInt(_0x3393e2(0x1b6))/0xa*(parseInt(_0x3393e2(0x1c9))/0xb)+-parseInt(_0x3393e2(0x1b0))/0xc;if(_0x28d0a6===_0x4350c2)break;else _0x4c302f['push'](_0x4c302f['shift']());}catch(_0x347c27){_0x4c302f['push'](_0x4c302f['shift']());}}}(_0x3602,0xcf846));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['sendMessageFromZhipu']=exports[_0x2ccc18(0x1c2)]=exports[_0x2ccc18(0x1ab)]=exports[_0x2ccc18(0x1a4)]=void 0x0;const axios=require('axios'),jwt=require(_0x2ccc18(0x1ad));function _0x3602(){const _0x570d17=['event:','20lJwTAa','6OUQoOb','application/json','text','end','usage','replace','log','2870136pVpNxS','2544265PETxcL','HS256','data:','compilerStream','is_end','split','stream','https://open.bigmodel.cn/api/paas/v3/model-api/','21HaHZDU','parse','991793ScmFwx','data','sign','trim','2055660HLXXuI','filter','6REHBgf','/sse-invoke','generateToken','now','error','SIGN','json\x20parse\x20error\x20from\x20zhipu!','round','length','compilerMetaJsonStr','7216299qxXZsC','jsonwebtoken','then','1UBcDDb','24215004pYxdpY','catch','733124VNsSWq','meta:','POST'];_0x3602=function(){return _0x570d17;};return _0x3602();}function generateToken(_0x51b7b1,_0x202543=0x3e8*0x3c*0x3c*0x18*0x168){const _0x1b1455=_0x2ccc18,[_0x39f3b0,_0x43887e]=_0x51b7b1[_0x1b1455(0x1c4)]('.'),_0x40d448={'api_key':_0x39f3b0,'exp':Math[_0x1b1455(0x1a9)](Date[_0x1b1455(0x1a5)]())+_0x202543*0x3e8,'timestamp':Math[_0x1b1455(0x1a9)](Date[_0x1b1455(0x1a5)]())};return jwt[_0x1b1455(0x19e)](_0x40d448,_0x43887e,{'algorithm':_0x1b1455(0x1c0),'header':{'alg':'HS256','sign_type':_0x1b1455(0x1a7)}});}function _0x5c8d(_0x1120c5,_0x14476c){const _0x36020f=_0x3602();return _0x5c8d=function(_0x5c8d02,_0x565c7a){_0x5c8d02=_0x5c8d02-0x19d;let _0x714c5c=_0x36020f[_0x5c8d02];return _0x714c5c;},_0x5c8d(_0x1120c5,_0x14476c);}exports[_0x2ccc18(0x1a4)]=generateToken;function compilerMetaJsonStr(_0x28654b){const _0x36b470=_0x2ccc18;let _0x3e0ebf={};try{_0x3e0ebf=JSON[_0x36b470(0x1c8)](_0x28654b);}catch(_0x5af84f){_0x3e0ebf={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x36b470(0x1a6)](_0x36b470(0x1a8),_0x28654b);}return _0x3e0ebf;}exports[_0x2ccc18(0x1ab)]=compilerMetaJsonStr;function compilerStream(_0x11279f){const _0x52efed=_0x2ccc18;var _0x139d61;if(_0x11279f[_0x52efed(0x1aa)]===0x3)return{'event':_0x11279f[0x0]['replace'](_0x52efed(0x1b5),''),'id':_0x11279f[0x1]['replace']('id:',''),'is_end':![],'result':_0x11279f[0x2]['replace']('data:','')[_0x52efed(0x19f)]()};if(_0x11279f[_0x52efed(0x1aa)]===0x4)return{'event':_0x11279f[0x0]['replace'](_0x52efed(0x1b5),''),'id':_0x11279f[0x1][_0x52efed(0x1bc)]('id:',''),'result':_0x11279f[0x2][_0x52efed(0x1bc)](_0x52efed(0x1c1),'')['trim'](),'is_end':!![],'usage':(_0x139d61=compilerMetaJsonStr(_0x11279f[0x3]['replace'](_0x52efed(0x1b3),'')))===null||_0x139d61===void 0x0?void 0x0:_0x139d61[_0x52efed(0x1bb)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x178bba,{onProgress:_0x329a6a,key:_0x159157,model:_0x7d4ccf,temperature:temperature=0.95}){const _0x267bee=await generateToken(_0x159157);return new Promise((_0x2b03ad,_0x548522)=>{const _0x1e81dd=_0x5c8d,_0x3b279a=_0x1e81dd(0x1c6)+_0x7d4ccf+_0x1e81dd(0x1a3),_0x1380c8={'method':_0x1e81dd(0x1b4),'url':_0x3b279a,'responseType':_0x1e81dd(0x1c5),'headers':{'Content-Type':_0x1e81dd(0x1b8),'Authorization':_0x267bee},'data':{'prompt':_0x178bba,'temperature':temperature}};axios(_0x1380c8)[_0x1e81dd(0x1ae)](_0x30501d=>{const _0x1f0f4b=_0x1e81dd,_0xdd52f=_0x30501d[_0x1f0f4b(0x19d)];let _0x129e36,_0x32589e='';_0xdd52f['on'](_0x1f0f4b(0x19d),_0x245066=>{const _0x397e41=_0x1f0f4b,_0x2b724f=_0x245066['toString']()[_0x397e41(0x1c4)]('\x0a')[_0x397e41(0x1a1)](_0x3415bc=>_0x3415bc[_0x397e41(0x19f)]()!==''),_0x2557a8=compilerStream(_0x2b724f);if(!_0x2557a8)return;const {id:_0x44b8b1,result:_0x421aa5,is_end:_0x12d246}=_0x2557a8;_0x421aa5&&(_0x32589e+=_0x421aa5[_0x397e41(0x19f)]()),_0x12d246&&(_0x2557a8[_0x397e41(0x1c3)]=![],_0x129e36=_0x2557a8,_0x129e36[_0x397e41(0x1b9)]=_0x32589e),_0x329a6a(_0x2557a8);}),_0xdd52f['on'](_0x1f0f4b(0x1ba),()=>{_0x2b03ad(_0x129e36),_0x32589e='';});})[_0x1e81dd(0x1b1)](_0x2fdf6a=>{const _0x43339b=_0x1e81dd;console[_0x43339b(0x1bd)]('error:\x20',_0x2fdf6a);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;