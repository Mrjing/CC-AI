'use strict';const _0xfb331e=_0x432c;function _0x432c(_0xc66fe5,_0xc80972){const _0x15e547=_0x15e5();return _0x432c=function(_0x432c08,_0x47ddb7){_0x432c08=_0x432c08-0x134;let _0xa28251=_0x15e547[_0x432c08];return _0xa28251;},_0x432c(_0xc66fe5,_0xc80972);}(function(_0x315b69,_0x51332d){const _0x37ebe5=_0x432c,_0x20e068=_0x315b69();while(!![]){try{const _0x2fa078=-parseInt(_0x37ebe5(0x13b))/0x1+parseInt(_0x37ebe5(0x159))/0x2+-parseInt(_0x37ebe5(0x148))/0x3*(-parseInt(_0x37ebe5(0x13c))/0x4)+parseInt(_0x37ebe5(0x151))/0x5+parseInt(_0x37ebe5(0x139))/0x6*(parseInt(_0x37ebe5(0x13a))/0x7)+parseInt(_0x37ebe5(0x149))/0x8*(-parseInt(_0x37ebe5(0x14a))/0x9)+parseInt(_0x37ebe5(0x143))/0xa;if(_0x2fa078===_0x51332d)break;else _0x20e068['push'](_0x20e068['shift']());}catch(_0x5c993d){_0x20e068['push'](_0x20e068['shift']());}}}(_0x15e5,0xeee65));Object[_0xfb331e(0x155)](exports,_0xfb331e(0x141),{'value':!![]}),exports[_0xfb331e(0x153)]=exports['compilerStream']=exports[_0xfb331e(0x138)]=exports[_0xfb331e(0x15a)]=void 0x0;const axios=require(_0xfb331e(0x142)),jwt=require(_0xfb331e(0x14d));function generateToken(_0x10272d,_0x26c9ba=0x3e8*0x3c*0x3c*0x18*0x168){const _0x91ecd0=_0xfb331e,[_0x5a5274,_0x20fcbf]=_0x10272d[_0x91ecd0(0x146)]('.'),_0x65d34={'api_key':_0x5a5274,'exp':Math[_0x91ecd0(0x137)](Date['now']())+_0x26c9ba*0x3e8,'timestamp':Math[_0x91ecd0(0x137)](Date[_0x91ecd0(0x14b)]())};return jwt['sign'](_0x65d34,_0x20fcbf,{'algorithm':_0x91ecd0(0x147),'header':{'alg':_0x91ecd0(0x147),'sign_type':'SIGN'}});}exports[_0xfb331e(0x15a)]=generateToken;function compilerMetaJsonStr(_0x44f39f){const _0x4e4945=_0xfb331e;let _0x5df862={};try{_0x5df862=JSON['parse'](_0x44f39f);}catch(_0x1b088f){_0x5df862={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console['error'](_0x4e4945(0x157),_0x44f39f);}return _0x5df862;}function _0x15e5(){const _0x49622a=['json\x20parse\x20error\x20from\x20zhipu!','usage','2959988bJgVjk','generateToken','filter','data','event:','round','compilerMetaJsonStr','8185260MAsgya','7JjKNnj','1441599zIhgZH','8YxvCsA','replace','/sse-invoke','error:\x20','https://open.bigmodel.cn/api/paas/v3/model-api/','__esModule','axios','2616520LudqcP','catch','data:','split','HS256','167658zYdVlA','6657320DvGZdp','9fCGPXI','now','length','jsonwebtoken','application/json','text','id:','173345wDloLY','meta:','sendMessageFromZhipu','compilerStream','defineProperty','trim'];_0x15e5=function(){return _0x49622a;};return _0x15e5();}exports[_0xfb331e(0x138)]=compilerMetaJsonStr;function compilerStream(_0x39965e){const _0x2e1250=_0xfb331e;var _0x31ae59;if(_0x39965e[_0x2e1250(0x14c)]===0x3)return{'event':_0x39965e[0x0][_0x2e1250(0x13d)](_0x2e1250(0x136),''),'id':_0x39965e[0x1][_0x2e1250(0x13d)](_0x2e1250(0x150),''),'is_end':![],'result':_0x39965e[0x2][_0x2e1250(0x13d)](_0x2e1250(0x145),'')['trim']()};if(_0x39965e[_0x2e1250(0x14c)]===0x4)return{'event':_0x39965e[0x0][_0x2e1250(0x13d)](_0x2e1250(0x136),''),'id':_0x39965e[0x1]['replace']('id:',''),'result':_0x39965e[0x2]['replace'](_0x2e1250(0x145),'')[_0x2e1250(0x156)](),'is_end':!![],'usage':(_0x31ae59=compilerMetaJsonStr(_0x39965e[0x3][_0x2e1250(0x13d)](_0x2e1250(0x152),'')))===null||_0x31ae59===void 0x0?void 0x0:_0x31ae59[_0x2e1250(0x158)]};}exports[_0xfb331e(0x154)]=compilerStream;async function sendMessageFromZhipu(_0x2c1d2f,{onProgress:_0x16f3c2,key:_0x508586,model:_0x1a7d8b,temperature:temperature=0.95}){const _0x2cd062=await generateToken(_0x508586);return new Promise((_0x1a879c,_0x49d7fb)=>{const _0x46e557=_0x432c,_0x17d977=_0x46e557(0x140)+_0x1a7d8b+_0x46e557(0x13e),_0x4450fc={'method':'POST','url':_0x17d977,'responseType':'stream','headers':{'Content-Type':_0x46e557(0x14e),'Authorization':_0x2cd062},'data':{'prompt':_0x2c1d2f,'temperature':temperature}};axios(_0x4450fc)['then'](_0x1f3126=>{const _0x213694=_0x46e557,_0x7732f8=_0x1f3126[_0x213694(0x135)];let _0x2afdf0,_0x5ec62c='';_0x7732f8['on'](_0x213694(0x135),_0x148b40=>{const _0x2b8a50=_0x213694,_0x45a318=_0x148b40['toString']()[_0x2b8a50(0x146)]('\x0a')[_0x2b8a50(0x134)](_0x4b2952=>_0x4b2952[_0x2b8a50(0x156)]()!==''),_0x2a2d5c=compilerStream(_0x45a318);if(!_0x2a2d5c)return;const {id:_0x88e701,result:_0x54217e,is_end:_0x2164ef}=_0x2a2d5c;_0x54217e&&(_0x5ec62c+=_0x54217e[_0x2b8a50(0x156)]()),_0x2164ef&&(_0x2a2d5c['is_end']=![],_0x2afdf0=_0x2a2d5c,_0x2afdf0[_0x2b8a50(0x14f)]=_0x5ec62c),_0x16f3c2(_0x2a2d5c);}),_0x7732f8['on']('end',()=>{_0x1a879c(_0x2afdf0),_0x5ec62c='';});})[_0x46e557(0x144)](_0x247a11=>{const _0x3fe515=_0x46e557;console['log'](_0x3fe515(0x13f),_0x247a11);});});}exports[_0xfb331e(0x153)]=sendMessageFromZhipu;