'use strict';const _0x29e650=_0x479f;(function(_0x5c83f9,_0x181930){const _0x1cffb4=_0x479f,_0x1aa994=_0x5c83f9();while(!![]){try{const _0x5181d7=-parseInt(_0x1cffb4(0x19a))/0x1+parseInt(_0x1cffb4(0x183))/0x2*(parseInt(_0x1cffb4(0x1aa))/0x3)+-parseInt(_0x1cffb4(0x1a2))/0x4+-parseInt(_0x1cffb4(0x182))/0x5+-parseInt(_0x1cffb4(0x1ab))/0x6+-parseInt(_0x1cffb4(0x18b))/0x7+parseInt(_0x1cffb4(0x198))/0x8;if(_0x5181d7===_0x181930)break;else _0x1aa994['push'](_0x1aa994['shift']());}catch(_0x147770){_0x1aa994['push'](_0x1aa994['shift']());}}}(_0x141e,0x84917));Object['defineProperty'](exports,_0x29e650(0x19d),{'value':!![]}),exports[_0x29e650(0x1a6)]=exports[_0x29e650(0x181)]=exports[_0x29e650(0x1a5)]=exports[_0x29e650(0x190)]=void 0x0;const axios=require(_0x29e650(0x1a7)),jwt=require(_0x29e650(0x196));function _0x141e(){const _0x905d8a=['error','sign','event:','generateToken','meta:','stream','POST','toString','length','jsonwebtoken','now','16929336ZbAVYi','parse','685350fxnECp','application/json','id:','__esModule','https://open.bigmodel.cn/api/paas/v3/model-api/','end','round','error:\x20','3169108KRHmWD','/sse-invoke','json\x20parse\x20error\x20from\x20zhipu!','compilerMetaJsonStr','sendMessageFromZhipu','axios','then','log','1401303LIQWGx','2299866onPkWI','trim','data:','replace','compilerStream','339930WNJhpV','2PbGKYk','usage','data','split','catch','filter','SIGN','is_end','779415Wwlkos','HS256'];_0x141e=function(){return _0x905d8a;};return _0x141e();}function generateToken(_0xd5901d,_0x4e6a11=0x3e8*0x3c*0x3c*0x18*0x168){const _0x126b34=_0x29e650,[_0x50eb5d,_0x4947b3]=_0xd5901d[_0x126b34(0x186)]('.'),_0x384e9b={'api_key':_0x50eb5d,'exp':Math[_0x126b34(0x1a0)](Date[_0x126b34(0x197)]())+_0x4e6a11*0x3e8,'timestamp':Math[_0x126b34(0x1a0)](Date[_0x126b34(0x197)]())};return jwt[_0x126b34(0x18e)](_0x384e9b,_0x4947b3,{'algorithm':'HS256','header':{'alg':_0x126b34(0x18c),'sign_type':_0x126b34(0x189)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x4ccf9a){const _0x530148=_0x29e650;let _0x18c69b={};try{_0x18c69b=JSON[_0x530148(0x199)](_0x4ccf9a);}catch(_0x293659){_0x18c69b={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x530148(0x18d)](_0x530148(0x1a4),_0x4ccf9a);}return _0x18c69b;}exports[_0x29e650(0x1a5)]=compilerMetaJsonStr;function _0x479f(_0x57381f,_0x3ea809){const _0x141e6d=_0x141e();return _0x479f=function(_0x479f7e,_0x416fdd){_0x479f7e=_0x479f7e-0x17f;let _0x26b2d7=_0x141e6d[_0x479f7e];return _0x26b2d7;},_0x479f(_0x57381f,_0x3ea809);}function compilerStream(_0xb2756c){const _0x510cec=_0x29e650;var _0x5c1746;if(_0xb2756c['length']===0x3)return{'event':_0xb2756c[0x0]['replace']('event:',''),'id':_0xb2756c[0x1]['replace'](_0x510cec(0x19c),''),'is_end':![],'result':_0xb2756c[0x2][_0x510cec(0x180)](_0x510cec(0x17f),'')[_0x510cec(0x1ac)]()};if(_0xb2756c[_0x510cec(0x195)]===0x4)return{'event':_0xb2756c[0x0][_0x510cec(0x180)](_0x510cec(0x18f),''),'id':_0xb2756c[0x1]['replace'](_0x510cec(0x19c),''),'result':_0xb2756c[0x2]['replace']('data:','')[_0x510cec(0x1ac)](),'is_end':!![],'usage':(_0x5c1746=compilerMetaJsonStr(_0xb2756c[0x3][_0x510cec(0x180)](_0x510cec(0x191),'')))===null||_0x5c1746===void 0x0?void 0x0:_0x5c1746[_0x510cec(0x184)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x38fc9f,{onProgress:_0x2abd09,key:_0x424377,model:_0x1c27f6,temperature:temperature=0.95}){const _0x2e9dcf=await generateToken(_0x424377);return new Promise((_0x3dff91,_0x15bc54)=>{const _0x37c383=_0x479f,_0x518161=_0x37c383(0x19e)+_0x1c27f6+_0x37c383(0x1a3),_0x4230f4={'method':_0x37c383(0x193),'url':_0x518161,'responseType':_0x37c383(0x192),'headers':{'Content-Type':_0x37c383(0x19b),'Authorization':_0x2e9dcf},'data':{'prompt':_0x38fc9f,'temperature':temperature}};axios(_0x4230f4)[_0x37c383(0x1a8)](_0x46adb2=>{const _0x5bd5c6=_0x37c383,_0x23515a=_0x46adb2[_0x5bd5c6(0x185)];let _0x452961,_0x2bd9c6='';_0x23515a['on'](_0x5bd5c6(0x185),_0x9b3bec=>{const _0x2f70d3=_0x5bd5c6,_0x4b760e=_0x9b3bec[_0x2f70d3(0x194)]()[_0x2f70d3(0x186)]('\x0a')[_0x2f70d3(0x188)](_0xeb4ae1=>_0xeb4ae1['trim']()!==''),_0xefca82=compilerStream(_0x4b760e);if(!_0xefca82)return;const {id:_0x5be575,result:_0x43efc5,is_end:_0x2d3223}=_0xefca82;_0x43efc5&&(_0x2bd9c6+=_0x43efc5[_0x2f70d3(0x1ac)]()),_0x2d3223&&(_0xefca82[_0x2f70d3(0x18a)]=![],_0x452961=_0xefca82,_0x452961['text']=_0x2bd9c6),_0x2abd09(_0xefca82);}),_0x23515a['on'](_0x5bd5c6(0x19f),()=>{_0x3dff91(_0x452961),_0x2bd9c6='';});})[_0x37c383(0x187)](_0x383e15=>{const _0x25e6a2=_0x37c383;console[_0x25e6a2(0x1a9)](_0x25e6a2(0x1a1),_0x383e15);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;