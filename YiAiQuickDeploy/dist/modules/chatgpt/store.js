'use strict';const _0x1bad8c=_0x56d9;(function(_0x3f3187,_0x4e3a33){const _0xb431e5=_0x56d9,_0x7a79e6=_0x3f3187();while(!![]){try{const _0x3c5a40=-parseInt(_0xb431e5(0x125))/0x1+-parseInt(_0xb431e5(0x144))/0x2+-parseInt(_0xb431e5(0x128))/0x3*(-parseInt(_0xb431e5(0x11e))/0x4)+-parseInt(_0xb431e5(0x124))/0x5+-parseInt(_0xb431e5(0x118))/0x6+parseInt(_0xb431e5(0x138))/0x7+parseInt(_0xb431e5(0x147))/0x8;if(_0x3c5a40===_0x4e3a33)break;else _0x7a79e6['push'](_0x7a79e6['shift']());}catch(_0x200d7c){_0x7a79e6['push'](_0x7a79e6['shift']());}}}(_0x35fe,0x201d5));function _0x56d9(_0x5e9a55,_0x2d60ae){const _0x35feed=_0x35fe();return _0x56d9=function(_0x56d971,_0x18e30f){_0x56d971=_0x56d971-0x113;let _0x5d335f=_0x35feed[_0x56d971];return _0x5d335f;},_0x56d9(_0x5e9a55,_0x2d60ae);}Object[_0x1bad8c(0x13e)](exports,'__esModule',{'value':!![]}),exports[_0x1bad8c(0x130)]=void 0x0;const uuid_1=require(_0x1bad8c(0x143)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0x1bad8c(0x145)])(_0x1bad8c(0x12b));class NineStore{constructor(_0x119d0b){const _0x3ef1c2=_0x1bad8c,{store:_0x53be31,namespace:_0xe483d9,expires:_0x263d0e}=this[_0x3ef1c2(0x119)](_0x119d0b);this[_0x3ef1c2(0x12f)]=_0x53be31,this['namespace']=_0xe483d9,this[_0x3ef1c2(0x117)]=_0x263d0e;}[_0x1bad8c(0x119)](_0x302525){const _0x186055=_0x1bad8c,{store:_0x5401a3,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x186055(0x113)}=_0x302525;return{'store':_0x5401a3,'namespace':namespace,'expires':expires};}[_0x1bad8c(0x139)](_0x2f87f7){return this['namespace']?this['namespace']+'-'+_0x2f87f7:_0x2f87f7;}async['getData'](_0x3b4502){const _0x293494=_0x1bad8c,_0x2dfb9e=await this[_0x293494(0x12f)][_0x293494(0x133)](_0x3b4502);return _0x2dfb9e;}async[_0x1bad8c(0x129)](_0x12102f,_0x308138=this[_0x1bad8c(0x117)]){const _0x2491a1=_0x1bad8c;await this[_0x2491a1(0x12f)][_0x2491a1(0x141)](_0x12102f['id'],_0x12102f,_0x308138);}async[_0x1bad8c(0x120)](_0x55a980,_0x4e04da){const _0x9adb78=_0x1bad8c;let {maxRounds:_0x1cd2b6,maxModelToken:_0x16de0c,maxResponseTokens:_0x5a7825,systemMessage:systemMessage='',name:_0x5ce3cc,imageUrl:_0x30dc10,model:_0x1d7028,activeModel:_0x1d86e4}=_0x4e04da,{parentMessageId:_0x2230b3}=_0x4e04da,_0x5695ae=[],_0xafcb97=0x0;if(systemMessage){const _0x4fbbf4=[_0x9adb78(0x115),_0x9adb78(0x13c),_0x9adb78(0x121)],_0x20b8c9=_0x1d86e4&&_0x4fbbf4[_0x9adb78(0x11b)](_0x30ece9=>_0x1d86e4[_0x9adb78(0x131)](_0x30ece9));_0x20b8c9?(_0x5695ae[_0x9adb78(0x11f)]({'role':_0x9adb78(0x146),'content':systemMessage,'name':_0x5ce3cc}),_0x5695ae['push']({'role':_0x9adb78(0x12e),'content':'好的','name':_0x5ce3cc})):_0x5695ae[_0x9adb78(0x11f)]({'role':'system','content':systemMessage,'name':_0x5ce3cc});}const _0x5543d0=_0x5695ae[_0x9adb78(0x127)];let _0x2b4251=0x0;if(_0x1d86e4===_0x9adb78(0x13f)&&_0x30dc10){const _0x12bbb3=[{'type':_0x9adb78(0x136),'text':_0x55a980},{'type':_0x9adb78(0x137),'image_url':{'url':_0x30dc10}}];_0x5695ae[_0x9adb78(0x11f)]({'role':_0x9adb78(0x146),'content':_0x12bbb3,'name':_0x5ce3cc});}else _0x1d7028===_0x9adb78(0x11a)&&_0x30dc10&&(_0x55a980=_0x30dc10+'\x0a'+_0x55a980),_0x5695ae[_0x9adb78(0x11f)]({'role':_0x9adb78(0x146),'content':_0x55a980,'name':_0x5ce3cc});let _0x4c6bbf=_0x5695ae;do{if(!_0x2230b3)break;const _0x541002=await this[_0x9adb78(0x13b)](_0x2230b3);if(!_0x541002)break;const {text:_0x482003,name:_0x1c9c80,role:_0x2c483b,imageUrl:_0x55132f}=_0x541002;let _0x4dbd74=_0x482003;_0x55132f&&(_0x1d86e4==='gpt-4-vision-preview'&&(_0x4dbd74=[{'type':_0x9adb78(0x136),'text':_0x482003},{'type':'image_url','image_url':{'url':_0x55132f}}]));_0x4c6bbf=_0x4c6bbf['slice'](0x0,_0x5543d0)[_0x9adb78(0x12d)]([{'role':_0x2c483b,'content':_0x4dbd74,'name':_0x1c9c80},..._0x4c6bbf[_0x9adb78(0x11d)](_0x5543d0)]),_0x2b4251++;if(_0x1cd2b6&&_0x2b4251>=_0x1cd2b6)break;if(_0x16de0c&&_0x5a7825){const _0x4ec545=_0x16de0c-_0x5a7825;_0xafcb97=await this[_0x9adb78(0x142)](_0x4c6bbf);const _0x29263b=_0xafcb97+0xc8<=_0x4ec545;!_0x29263b&&(_0x4c6bbf=this[_0x9adb78(0x13a)](_0x4c6bbf,_0x4ec545,systemMessage));}_0x2230b3=_0x541002[_0x9adb78(0x114)];}while(!![]);const _0x43fb5f=Math['max'](0x1,Math[_0x9adb78(0x123)](_0x16de0c-_0xafcb97,_0x5a7825));return console[_0x9adb78(0x122)](_0x9adb78(0x132),_0x4c6bbf['length'],_0xafcb97),{'context':_0x4c6bbf,'round':_0x4c6bbf['length'],'historyToken':_0xafcb97};}[_0x1bad8c(0x142)](_0x1afafc){const _0x545a45=_0x1bad8c;let _0x3fadbf=_0x1afafc[_0x545a45(0x13d)]((_0x4b109f,_0x390c9f)=>{const _0x288ea6=_0x545a45;if(Array['isArray'](_0x390c9f['content'])){const _0x3b922b=_0x390c9f['content']['filter'](_0xb29f1d=>_0xb29f1d[_0x288ea6(0x126)]===_0x288ea6(0x136))[_0x288ea6(0x12c)](_0x5d367a=>_0x5d367a['text'])[_0x288ea6(0x11c)]('\x20');return _0x4b109f+_0x3b922b;}else return _0x4b109f+(_0x390c9f[_0x288ea6(0x12a)]||'');},'');return _0x3fadbf=_0x3fadbf[_0x545a45(0x116)](/<\|endoftext\|>/g,''),tokenizer[_0x545a45(0x140)](_0x3fadbf)[_0x545a45(0x127)];}[_0x1bad8c(0x13a)](_0x55a832,_0x5724da,_0x49c36d){const _0xec2db2=_0x1bad8c,_0x350c7e=this[_0xec2db2(0x142)](_0x55a832);if(_0x350c7e<=_0x5724da)return _0x55a832;return _0x55a832[_0xec2db2(0x135)](_0x49c36d?0x1:0x0,0x1),this[_0xec2db2(0x13a)](_0x55a832,_0x5724da,_0x49c36d);}[_0x1bad8c(0x134)](){return(0x0,uuid_1['v4'])();}}exports[_0x1bad8c(0x130)]=NineStore;function _0x35fe(){const _0x4a820c=['content','cl100k_base','map','concat','assistant','store','NineStore','includes','本次携带上下文的长度','get','getUuid','splice','text','image_url','603106cUUmTd','generateKey','_recursivePruning','getData','ERNIE','reduce','defineProperty','gpt-4-vision-preview','encode','set','_getTokenCount','uuid','507256vwdszU','get_encoding','user','4650224lHROTG','chat','parentMessageId','gemini-pro','replace','expires','1350408uPtXrY','formatOptions','gpt-4-all','some','join','slice','1544NVpWaa','push','buildMessageFromParentMessageId','hunyuan','log','min','196130dNBEST','214061Rcxkbs','type','length','1524bMBdDS','setData'];_0x35fe=function(){return _0x4a820c;};return _0x35fe();}