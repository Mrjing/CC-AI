'use strict';function _0xd21a(_0x573397,_0x207e0b){const _0x2699a0=_0x2699();return _0xd21a=function(_0xd21a7d,_0x431b89){_0xd21a7d=_0xd21a7d-0xa8;let _0x84bb3b=_0x2699a0[_0xd21a7d];return _0x84bb3b;},_0xd21a(_0x573397,_0x207e0b);}const _0x40ee8c=_0xd21a;(function(_0x2c7bdb,_0x31709f){const _0x2b4caf=_0xd21a,_0x3828f8=_0x2c7bdb();while(!![]){try{const _0x27a3ab=parseInt(_0x2b4caf(0xc1))/0x1*(-parseInt(_0x2b4caf(0xd6))/0x2)+parseInt(_0x2b4caf(0xbe))/0x3+parseInt(_0x2b4caf(0xbb))/0x4+parseInt(_0x2b4caf(0xc5))/0x5+parseInt(_0x2b4caf(0xd5))/0x6+parseInt(_0x2b4caf(0xb0))/0x7+parseInt(_0x2b4caf(0xac))/0x8*(-parseInt(_0x2b4caf(0xd1))/0x9);if(_0x27a3ab===_0x31709f)break;else _0x3828f8['push'](_0x3828f8['shift']());}catch(_0x5da892){_0x3828f8['push'](_0x3828f8['shift']());}}}(_0x2699,0x71916));Object[_0x40ee8c(0xda)](exports,_0x40ee8c(0xcc),{'value':!![]}),exports[_0x40ee8c(0xb4)]=void 0x0;const uuid_1=require(_0x40ee8c(0xa9)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0x40ee8c(0xaa)])('cl100k_base');class NineStore{constructor(_0x223289){const _0x12dc5a=_0x40ee8c,{store:_0xc09242,namespace:_0x4be2b6,expires:_0x24a61c}=this['formatOptions'](_0x223289);this[_0x12dc5a(0xb5)]=_0xc09242,this[_0x12dc5a(0xc3)]=_0x4be2b6,this['expires']=_0x24a61c;}[_0x40ee8c(0xc9)](_0x52292a){const _0x15d88b=_0x40ee8c,{store:_0xca695e,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x15d88b(0xcb)}=_0x52292a;return{'store':_0xca695e,'namespace':namespace,'expires':expires};}['generateKey'](_0x33be06){const _0x142634=_0x40ee8c;return this[_0x142634(0xc3)]?this[_0x142634(0xc3)]+'-'+_0x33be06:_0x33be06;}async[_0x40ee8c(0xbc)](_0x373373){const _0x33c53c=_0x40ee8c,_0x4068ab=await this['store'][_0x33c53c(0xbd)](_0x373373);return _0x4068ab;}async[_0x40ee8c(0xc4)](_0x1b549e,_0x146b23=this[_0x40ee8c(0xc2)]){const _0x4a16c0=_0x40ee8c;await this[_0x4a16c0(0xb5)][_0x4a16c0(0xb7)](_0x1b549e['id'],_0x1b549e,_0x146b23);}async[_0x40ee8c(0xca)](_0xe671ff,_0x339b0c){const _0x263260=_0x40ee8c;let {maxRounds:_0x432933,maxModelToken:_0x1c29ae,maxResponseTokens:_0x43636d,systemMessage:systemMessage='',name:_0x1a6c7e,imageUrl:_0x4cc9d5,model:_0x386ed1,activeModel:_0x59d441}=_0x339b0c,{parentMessageId:_0xd93887}=_0x339b0c,_0x45ea33=[],_0x43d16e=0x0;if(systemMessage){const _0x54f016=[_0x263260(0xa8),_0x263260(0xce),_0x263260(0xc8)],_0x13cc74=_0x59d441&&_0x54f016['some'](_0x4367b2=>_0x59d441[_0x263260(0xd9)](_0x4367b2));_0x13cc74?(_0x45ea33[_0x263260(0xba)]({'role':'user','content':systemMessage,'name':_0x1a6c7e}),_0x45ea33['push']({'role':_0x263260(0xc0),'content':'好的','name':_0x1a6c7e})):_0x45ea33[_0x263260(0xba)]({'role':_0x263260(0xb1),'content':systemMessage,'name':_0x1a6c7e});}const _0x26af7b=_0x45ea33['length'];let _0x573c8d=0x0;if(_0x59d441===_0x263260(0xcd)&&_0x4cc9d5){const _0x32fdac=[{'type':_0x263260(0xb9),'text':_0xe671ff},{'type':_0x263260(0xb2),'image_url':{'url':_0x4cc9d5}}];_0x45ea33[_0x263260(0xba)]({'role':_0x263260(0xb8),'content':_0x32fdac,'name':_0x1a6c7e});}else _0x386ed1===_0x263260(0xd0)&&_0x4cc9d5&&(_0xe671ff=_0x4cc9d5+'\x0a'+_0xe671ff),_0x45ea33[_0x263260(0xba)]({'role':_0x263260(0xb8),'content':_0xe671ff,'name':_0x1a6c7e});let _0x4b3f21=_0x45ea33;do{if(!_0xd93887)break;const _0x3f5ef5=await this[_0x263260(0xbc)](_0xd93887);if(!_0x3f5ef5)break;const {text:_0x4e3827,name:_0x160fe5,role:_0x3b40c2,imageUrl:_0x380d04}=_0x3f5ef5;let _0x5d4767=_0x4e3827;_0x380d04&&(_0x59d441===_0x263260(0xcd)&&(_0x5d4767=[{'type':_0x263260(0xb9),'text':_0x4e3827},{'type':_0x263260(0xb2),'image_url':{'url':_0x380d04}}]));_0x4b3f21=_0x4b3f21[_0x263260(0xdc)](0x0,_0x26af7b)[_0x263260(0xae)]([{'role':_0x3b40c2,'content':_0x5d4767,'name':_0x160fe5},..._0x4b3f21[_0x263260(0xdc)](_0x26af7b)]),_0x573c8d++;if(_0x432933&&_0x573c8d>=_0x432933)break;if(_0x1c29ae&&_0x43636d){const _0x4d6a3f=_0x1c29ae-_0x43636d;_0x43d16e=await this[_0x263260(0xd2)](_0x4b3f21);const _0x178ceb=_0x43d16e+0xc8<=_0x4d6a3f;!_0x178ceb&&(_0x4b3f21=this[_0x263260(0xd3)](_0x4b3f21,_0x4d6a3f,systemMessage));}_0xd93887=_0x3f5ef5[_0x263260(0xc6)];}while(!![]);const _0x74785f=Math[_0x263260(0xc7)](0x1,Math[_0x263260(0xb3)](_0x1c29ae-_0x43d16e,_0x43636d));return console['log'](_0x263260(0xd7),_0x4b3f21[_0x263260(0xab)],_0x43d16e),{'context':_0x4b3f21,'round':_0x4b3f21[_0x263260(0xab)],'historyToken':_0x43d16e};}['_getTokenCount'](_0x5387ef){const _0x3957cd=_0x40ee8c;let _0x1fc606=_0x5387ef['reduce']((_0x7cba62,_0x329e25)=>{const _0x496052=_0xd21a;if(Array[_0x496052(0xb6)](_0x329e25[_0x496052(0xd4)])){const _0x5c1ea4=_0x329e25[_0x496052(0xd4)]['filter'](_0x3b369b=>_0x3b369b[_0x496052(0xdb)]===_0x496052(0xb9))[_0x496052(0xd8)](_0x2949ef=>_0x2949ef[_0x496052(0xb9)])[_0x496052(0xbf)]('\x20');return _0x7cba62+_0x5c1ea4;}else return _0x7cba62+(_0x329e25[_0x496052(0xd4)]||'');},'');return _0x1fc606=_0x1fc606[_0x3957cd(0xcf)](/<\|endoftext\|>/g,''),tokenizer[_0x3957cd(0xad)](_0x1fc606)[_0x3957cd(0xab)];}[_0x40ee8c(0xd3)](_0x1d0334,_0x24b6a0,_0x4c2042){const _0x4c6ae9=_0x40ee8c,_0x1dcd2a=this['_getTokenCount'](_0x1d0334);if(_0x1dcd2a<=_0x24b6a0)return _0x1d0334;return _0x1d0334[_0x4c6ae9(0xaf)](_0x4c2042?0x1:0x0,0x1),this[_0x4c6ae9(0xd3)](_0x1d0334,_0x24b6a0,_0x4c2042);}['getUuid'](){return(0x0,uuid_1['v4'])();}}function _0x2699(){const _0x381201=['min','NineStore','store','isArray','set','user','text','push','1145016srPUqH','getData','get','2726466OmIiYH','join','assistant','65206oVbDYM','expires','namespace','setData','4092920bwvVlP','parentMessageId','max','hunyuan','formatOptions','buildMessageFromParentMessageId','chat','__esModule','gpt-4-vision-preview','ERNIE','replace','gpt-4-all','9XXLZGg','_getTokenCount','_recursivePruning','content','4907364exNYTd','22EPEXJt','本次携带上下文的长度','map','includes','defineProperty','type','slice','gemini-pro','uuid','get_encoding','length','13594384tdSJkf','encode','concat','splice','351288WTDDDv','system','image_url'];_0x2699=function(){return _0x381201;};return _0x2699();}exports[_0x40ee8c(0xb4)]=NineStore;