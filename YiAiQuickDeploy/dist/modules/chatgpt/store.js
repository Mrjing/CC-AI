'use strict';const _0x3033ec=_0x1459;(function(_0xb6fcf7,_0x37d214){const _0x3b9c0e=_0x1459,_0x3cd1b7=_0xb6fcf7();while(!![]){try{const _0x539549=-parseInt(_0x3b9c0e(0x171))/0x1*(-parseInt(_0x3b9c0e(0x188))/0x2)+parseInt(_0x3b9c0e(0x16f))/0x3*(parseInt(_0x3b9c0e(0x16b))/0x4)+-parseInt(_0x3b9c0e(0x168))/0x5+-parseInt(_0x3b9c0e(0x17c))/0x6*(parseInt(_0x3b9c0e(0x169))/0x7)+-parseInt(_0x3b9c0e(0x164))/0x8*(-parseInt(_0x3b9c0e(0x190))/0x9)+parseInt(_0x3b9c0e(0x183))/0xa*(parseInt(_0x3b9c0e(0x18c))/0xb)+parseInt(_0x3b9c0e(0x172))/0xc*(-parseInt(_0x3b9c0e(0x178))/0xd);if(_0x539549===_0x37d214)break;else _0x3cd1b7['push'](_0x3cd1b7['shift']());}catch(_0x3e1ea4){_0x3cd1b7['push'](_0x3cd1b7['shift']());}}}(_0x32a7,0xebe62));function _0x32a7(){const _0x46a575=['NineStore','formatOptions','image_url','522687eRaein','concat','chat','reduce','15550074tvjVam','_getTokenCount','getUuid','set','expires','includes','max','gpt-4-vision-preview','assistant','8FXBSFb','gemini-pro','replace','some','3651380AVZGQe','5507481Hdcerh','parentMessageId','1632yxMVYB','text','get','getData','3897jmxsTB','min','1kKNtjr','12LoAVbY','本次携带上下文的长度','slice','_recursivePruning','__esModule','user','10419097iKneLA','filter','encode','map','6EFjMhE','splice','join','length','store','system','push','30CkJOex','ERNIE','namespace','cl100k_base','defineProperty','1768882YxoUxR'];_0x32a7=function(){return _0x46a575;};return _0x32a7();}function _0x1459(_0x113a2f,_0x423594){const _0x32a717=_0x32a7();return _0x1459=function(_0x145971,_0x88253f){_0x145971=_0x145971-0x15e;let _0x2e2a9b=_0x32a717[_0x145971];return _0x2e2a9b;},_0x1459(_0x113a2f,_0x423594);}Object[_0x3033ec(0x187)](exports,_0x3033ec(0x176),{'value':!![]}),exports['NineStore']=void 0x0;const uuid_1=require('uuid'),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1['get_encoding'])(_0x3033ec(0x186));class NineStore{constructor(_0x29f6fb){const _0x1f39b2=_0x3033ec,{store:_0x837a97,namespace:_0x1b595d,expires:_0x248b61}=this['formatOptions'](_0x29f6fb);this[_0x1f39b2(0x180)]=_0x837a97,this[_0x1f39b2(0x185)]=_0x1b595d,this[_0x1f39b2(0x15f)]=_0x248b61;}[_0x3033ec(0x18a)](_0x40effc){const _0x81f8a5=_0x3033ec,{store:_0x125a33,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x81f8a5(0x18e)}=_0x40effc;return{'store':_0x125a33,'namespace':namespace,'expires':expires};}['generateKey'](_0x24d40c){return this['namespace']?this['namespace']+'-'+_0x24d40c:_0x24d40c;}async[_0x3033ec(0x16e)](_0xf8dd5d){const _0x54a8dd=_0x3033ec,_0x3aa0e3=await this['store'][_0x54a8dd(0x16d)](_0xf8dd5d);return _0x3aa0e3;}async['setData'](_0x362c1e,_0x48053c=this[_0x3033ec(0x15f)]){const _0x48ecfb=_0x3033ec;await this[_0x48ecfb(0x180)][_0x48ecfb(0x15e)](_0x362c1e['id'],_0x362c1e,_0x48053c);}async['buildMessageFromParentMessageId'](_0x3ab037,_0x229008){const _0x2f3276=_0x3033ec;let {maxRounds:_0x268ec1,maxModelToken:_0x2dd0ff,maxResponseTokens:_0x2195d9,systemMessage:systemMessage='',name:_0x461b1b,imageUrl:_0x2e13f3,model:_0x1e74b5,activeModel:_0x24de29}=_0x229008,{parentMessageId:_0x25772f}=_0x229008,_0x4d4095=[],_0x595e14=0x0;if(systemMessage){const _0x12af59=[_0x2f3276(0x165),_0x2f3276(0x184),'hunyuan'],_0x31d749=_0x24de29&&_0x12af59[_0x2f3276(0x167)](_0x346c03=>_0x24de29[_0x2f3276(0x160)](_0x346c03));_0x31d749?(_0x4d4095[_0x2f3276(0x182)]({'role':_0x2f3276(0x177),'content':systemMessage,'name':_0x461b1b}),_0x4d4095[_0x2f3276(0x182)]({'role':_0x2f3276(0x163),'content':'好的','name':_0x461b1b})):_0x4d4095[_0x2f3276(0x182)]({'role':_0x2f3276(0x181),'content':systemMessage,'name':_0x461b1b});}const _0x4d99f7=_0x4d4095['length'];let _0x58cb16=0x0;if(_0x24de29===_0x2f3276(0x162)&&_0x2e13f3){const _0x5ac87e=[{'type':_0x2f3276(0x16c),'text':_0x3ab037},{'type':'image_url','image_url':{'url':_0x2e13f3}}];_0x4d4095[_0x2f3276(0x182)]({'role':'user','content':_0x5ac87e,'name':_0x461b1b});}else _0x1e74b5==='gpt-4-all'&&_0x2e13f3&&(_0x3ab037=_0x2e13f3+'\x0a'+_0x3ab037),_0x4d4095['push']({'role':_0x2f3276(0x177),'content':_0x3ab037,'name':_0x461b1b});let _0x2b2f6c=_0x4d4095;do{if(!_0x25772f)break;const _0xfdc54d=await this['getData'](_0x25772f);if(!_0xfdc54d)break;const {text:_0x11c851,name:_0x5362bf,role:_0x56f09e,imageUrl:_0x4aba5d}=_0xfdc54d;let _0x27dc9f=_0x11c851;_0x4aba5d&&(_0x24de29===_0x2f3276(0x162)&&(_0x27dc9f=[{'type':_0x2f3276(0x16c),'text':_0x11c851},{'type':_0x2f3276(0x18b),'image_url':{'url':_0x4aba5d}}]));_0x2b2f6c=_0x2b2f6c[_0x2f3276(0x174)](0x0,_0x4d99f7)[_0x2f3276(0x18d)]([{'role':_0x56f09e,'content':_0x27dc9f,'name':_0x5362bf},..._0x2b2f6c['slice'](_0x4d99f7)]),_0x58cb16++;if(_0x268ec1&&_0x58cb16>=_0x268ec1)break;if(_0x2dd0ff&&_0x2195d9){const _0x40026b=_0x2dd0ff-_0x2195d9;_0x595e14=await this[_0x2f3276(0x191)](_0x2b2f6c);const _0xf4875e=_0x595e14+0xc8<=_0x40026b;!_0xf4875e&&(_0x2b2f6c=this[_0x2f3276(0x175)](_0x2b2f6c,_0x40026b,systemMessage));}_0x25772f=_0xfdc54d[_0x2f3276(0x16a)];}while(!![]);const _0x3900d8=Math[_0x2f3276(0x161)](0x1,Math[_0x2f3276(0x170)](_0x2dd0ff-_0x595e14,_0x2195d9));return console['log'](_0x2f3276(0x173),_0x2b2f6c[_0x2f3276(0x17f)],_0x595e14),{'context':_0x2b2f6c,'round':_0x2b2f6c[_0x2f3276(0x17f)],'historyToken':_0x595e14};}[_0x3033ec(0x191)](_0x261c77){const _0x462a99=_0x3033ec;let _0x4de9f8=_0x261c77[_0x462a99(0x18f)]((_0x7ccc39,_0x23cab2)=>{const _0x57074c=_0x462a99;if(Array['isArray'](_0x23cab2['content'])){const _0x16b40a=_0x23cab2['content'][_0x57074c(0x179)](_0x2718ef=>_0x2718ef['type']===_0x57074c(0x16c))[_0x57074c(0x17b)](_0x1a7d09=>_0x1a7d09[_0x57074c(0x16c)])[_0x57074c(0x17e)]('\x20');return _0x7ccc39+_0x16b40a;}else return _0x7ccc39+(_0x23cab2['content']||'');},'');return _0x4de9f8=_0x4de9f8[_0x462a99(0x166)](/<\|endoftext\|>/g,''),tokenizer[_0x462a99(0x17a)](_0x4de9f8)[_0x462a99(0x17f)];}['_recursivePruning'](_0x228c66,_0x5833b6,_0x359734){const _0x4a742e=_0x3033ec,_0x42c604=this[_0x4a742e(0x191)](_0x228c66);if(_0x42c604<=_0x5833b6)return _0x228c66;return _0x228c66[_0x4a742e(0x17d)](_0x359734?0x1:0x0,0x1),this[_0x4a742e(0x175)](_0x228c66,_0x5833b6,_0x359734);}[_0x3033ec(0x192)](){return(0x0,uuid_1['v4'])();}}exports[_0x3033ec(0x189)]=NineStore;