'use strict';const _0x588da5=_0xae18;(function(_0x5c6e1a,_0x5cfe6e){const _0x5e5907=_0xae18,_0x2806c0=_0x5c6e1a();while(!![]){try{const _0x193053=parseInt(_0x5e5907(0xd8))/0x1*(-parseInt(_0x5e5907(0xd7))/0x2)+-parseInt(_0x5e5907(0xf0))/0x3+parseInt(_0x5e5907(0xf8))/0x4*(-parseInt(_0x5e5907(0xc8))/0x5)+parseInt(_0x5e5907(0xcc))/0x6+parseInt(_0x5e5907(0xdc))/0x7*(parseInt(_0x5e5907(0xe7))/0x8)+parseInt(_0x5e5907(0xd0))/0x9+-parseInt(_0x5e5907(0xee))/0xa;if(_0x193053===_0x5cfe6e)break;else _0x2806c0['push'](_0x2806c0['shift']());}catch(_0x18b1d7){_0x2806c0['push'](_0x2806c0['shift']());}}}(_0x13e5,0xeb15d));Object[_0x588da5(0xf1)](exports,'__esModule',{'value':!![]}),exports[_0x588da5(0xf7)]=void 0x0;const uuid_1=require(_0x588da5(0xe9)),tiktoken_1=require(_0x588da5(0xce)),tokenizer=(0x0,tiktoken_1[_0x588da5(0xf4)])(_0x588da5(0xed));function _0xae18(_0x251f8a,_0x5eeb89){const _0x13e5f8=_0x13e5();return _0xae18=function(_0xae185e,_0x56ea48){_0xae185e=_0xae185e-0xc8;let _0x30180e=_0x13e5f8[_0xae185e];return _0x30180e;},_0xae18(_0x251f8a,_0x5eeb89);}class NineStore{constructor(_0x14fd67){const _0x260ad4=_0x588da5,{store:_0x642e83,namespace:_0x27ddfa,expires:_0x3511b5}=this[_0x260ad4(0xcf)](_0x14fd67);this['store']=_0x642e83,this['namespace']=_0x27ddfa,this[_0x260ad4(0xf9)]=_0x3511b5;}[_0x588da5(0xcf)](_0x2c8ac0){const _0x9ad10a=_0x588da5,{store:_0x3ecb32,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x9ad10a(0xe5)}=_0x2c8ac0;return{'store':_0x3ecb32,'namespace':namespace,'expires':expires};}[_0x588da5(0xdb)](_0x5b1b82){const _0x489c0c=_0x588da5;return this[_0x489c0c(0xf2)]?this[_0x489c0c(0xf2)]+'-'+_0x5b1b82:_0x5b1b82;}async[_0x588da5(0xd1)](_0x1d882e){const _0x1395c2=_0x588da5,_0x3a0af5=await this[_0x1395c2(0xeb)]['get'](_0x1d882e);return _0x3a0af5;}async[_0x588da5(0xe0)](_0x5ac592,_0x49eabb=this[_0x588da5(0xf9)]){const _0x1f7e2d=_0x588da5;await this[_0x1f7e2d(0xeb)][_0x1f7e2d(0xec)](_0x5ac592['id'],_0x5ac592,_0x49eabb);}async['buildMessageFromParentMessageId'](_0x25d3f9,_0x586465){const _0x3e9816=_0x588da5;let {maxRounds:_0x4b2329,maxModelToken:_0x5bba23,maxResponseTokens:_0x5c9d6c,systemMessage:systemMessage='',name:_0x1255d6,imageUrl:_0x21cf83,model:_0x2be3fc,activeModel:_0x595183}=_0x586465,{parentMessageId:_0x1f470e}=_0x586465,_0x3edd72=[],_0x4c1b0e=0x0;if(systemMessage){const _0x4e58dc=['gemini-pro',_0x3e9816(0xe4),'hunyuan'],_0x2e36f5=_0x595183&&_0x4e58dc['some'](_0x30f6e3=>_0x595183[_0x3e9816(0xf3)](_0x30f6e3));_0x2e36f5?(_0x3edd72[_0x3e9816(0xe3)]({'role':_0x3e9816(0xd5),'content':systemMessage,'name':_0x1255d6}),_0x3edd72[_0x3e9816(0xe3)]({'role':_0x3e9816(0xf6),'content':'好的','name':_0x1255d6})):_0x3edd72[_0x3e9816(0xe3)]({'role':_0x3e9816(0xde),'content':systemMessage,'name':_0x1255d6});}const _0x1bd354=_0x3edd72[_0x3e9816(0xd6)];let _0x2f44bb=0x0;if(_0x595183==='gpt-4-vision-preview'&&_0x21cf83){const _0x18e7c8=[{'type':_0x3e9816(0xdf),'text':_0x25d3f9},{'type':_0x3e9816(0xcd),'image_url':{'url':_0x21cf83}}];_0x3edd72[_0x3e9816(0xe3)]({'role':_0x3e9816(0xd5),'content':_0x18e7c8,'name':_0x1255d6});}else _0x2be3fc===_0x3e9816(0xe1)&&_0x21cf83&&(_0x25d3f9=_0x21cf83+'\x0a'+_0x25d3f9),_0x3edd72[_0x3e9816(0xe3)]({'role':_0x3e9816(0xd5),'content':_0x25d3f9,'name':_0x1255d6});let _0x5a561c=_0x3edd72;do{if(!_0x1f470e)break;const _0x2d3a77=await this[_0x3e9816(0xd1)](_0x1f470e);if(!_0x2d3a77)break;const {text:_0x50b6f9,name:_0x660886,role:_0x13c5e7,imageUrl:_0x54c330}=_0x2d3a77;let _0x45bd49=_0x50b6f9;_0x54c330&&(_0x595183===_0x3e9816(0xd9)&&(_0x45bd49=[{'type':'text','text':_0x50b6f9},{'type':'image_url','image_url':{'url':_0x54c330}}]));_0x5a561c=_0x5a561c['slice'](0x0,_0x1bd354)[_0x3e9816(0xd4)]([{'role':_0x13c5e7,'content':_0x45bd49,'name':_0x660886},..._0x5a561c['slice'](_0x1bd354)]),_0x2f44bb++;if(_0x4b2329&&_0x2f44bb>=_0x4b2329)break;if(_0x5bba23&&_0x5c9d6c){const _0xc6cb8f=_0x5bba23-_0x5c9d6c;_0x4c1b0e=await this[_0x3e9816(0xc9)](_0x5a561c);const _0xe8d8fd=_0x4c1b0e+0xc8<=_0xc6cb8f;!_0xe8d8fd&&(_0x5a561c=this[_0x3e9816(0xd2)](_0x5a561c,_0xc6cb8f,systemMessage));}_0x1f470e=_0x2d3a77[_0x3e9816(0xea)];}while(!![]);const _0x24a774=Math['max'](0x1,Math[_0x3e9816(0xe8)](_0x5bba23-_0x4c1b0e,_0x5c9d6c));return console[_0x3e9816(0xef)](_0x3e9816(0xda),_0x5a561c[_0x3e9816(0xd6)],_0x4c1b0e),{'context':_0x5a561c,'round':_0x5a561c[_0x3e9816(0xd6)],'historyToken':_0x4c1b0e};}['_getTokenCount'](_0x439084){const _0x1780be=_0x588da5;let _0x59eb94=_0x439084[_0x1780be(0xcb)]((_0x210bb2,_0x3d460f)=>{const _0x24980c=_0x1780be;if(Array[_0x24980c(0xd3)](_0x3d460f[_0x24980c(0xdd)])){const _0x605687=_0x3d460f[_0x24980c(0xdd)][_0x24980c(0xe6)](_0x28fd67=>_0x28fd67[_0x24980c(0xf5)]===_0x24980c(0xdf))['map'](_0x13cb17=>_0x13cb17[_0x24980c(0xdf)])[_0x24980c(0xe2)]('\x20');return _0x210bb2+_0x605687;}else return _0x210bb2+(_0x3d460f[_0x24980c(0xdd)]||'');},'');return _0x59eb94=_0x59eb94['replace'](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x59eb94)[_0x1780be(0xd6)];}['_recursivePruning'](_0x23bccd,_0x1240d7,_0x5f1497){const _0x4bed67=_0x588da5,_0xcef57c=this[_0x4bed67(0xc9)](_0x23bccd);if(_0xcef57c<=_0x1240d7)return _0x23bccd;return _0x23bccd[_0x4bed67(0xca)](_0x5f1497?0x1:0x0,0x1),this[_0x4bed67(0xd2)](_0x23bccd,_0x1240d7,_0x5f1497);}['getUuid'](){return(0x0,uuid_1['v4'])();}}function _0x13e5(){const _0x1d817e=['system','text','setData','gpt-4-all','join','push','ERNIE','chat','filter','8uzIBvZ','min','uuid','parentMessageId','store','set','cl100k_base','5455130fvCvEt','log','280038KriBDH','defineProperty','namespace','includes','get_encoding','type','assistant','NineStore','12sVDCXc','expires','1977610BDsnil','_getTokenCount','splice','reduce','10520772WEmwgR','image_url','@dqbd/tiktoken','formatOptions','6867909bjczYD','getData','_recursivePruning','isArray','concat','user','length','731280BFrlFA','1uXvyKV','gpt-4-vision-preview','本次携带上下文的长度','generateKey','4461877caWraQ','content'];_0x13e5=function(){return _0x1d817e;};return _0x13e5();}exports['NineStore']=NineStore;