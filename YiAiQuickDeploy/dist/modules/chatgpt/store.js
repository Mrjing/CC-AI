'use strict';const _0x23de18=_0x2962;(function(_0x151d2b,_0x1d4d47){const _0x3c4872=_0x2962,_0x189c76=_0x151d2b();while(!![]){try{const _0x22484c=-parseInt(_0x3c4872(0x17b))/0x1+-parseInt(_0x3c4872(0x16a))/0x2*(parseInt(_0x3c4872(0x174))/0x3)+parseInt(_0x3c4872(0x16b))/0x4*(-parseInt(_0x3c4872(0x18f))/0x5)+parseInt(_0x3c4872(0x184))/0x6+-parseInt(_0x3c4872(0x17f))/0x7+parseInt(_0x3c4872(0x16e))/0x8*(parseInt(_0x3c4872(0x165))/0x9)+parseInt(_0x3c4872(0x187))/0xa;if(_0x22484c===_0x1d4d47)break;else _0x189c76['push'](_0x189c76['shift']());}catch(_0x34bfc3){_0x189c76['push'](_0x189c76['shift']());}}}(_0xd079,0x6ac5e));Object[_0x23de18(0x16c)](exports,_0x23de18(0x178),{'value':!![]}),exports['NineStore']=void 0x0;function _0x2962(_0x19850f,_0x34db51){const _0xd07924=_0xd079();return _0x2962=function(_0x296270,_0x4b0626){_0x296270=_0x296270-0x162;let _0x5b38b9=_0xd07924[_0x296270];return _0x5b38b9;},_0x2962(_0x19850f,_0x34db51);}const uuid_1=require(_0x23de18(0x173)),tiktoken_1=require(_0x23de18(0x17e)),tokenizer=(0x0,tiktoken_1[_0x23de18(0x18d)])(_0x23de18(0x17d));class NineStore{constructor(_0xe1b6d1){const _0xc516ba=_0x23de18,{store:_0x299126,namespace:_0x343d67,expires:_0x118119}=this[_0xc516ba(0x17a)](_0xe1b6d1);this[_0xc516ba(0x186)]=_0x299126,this[_0xc516ba(0x16d)]=_0x343d67,this[_0xc516ba(0x164)]=_0x118119;}[_0x23de18(0x17a)](_0x430cf8){const {store:_0x228a73,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x430cf8;return{'store':_0x228a73,'namespace':namespace,'expires':expires};}[_0x23de18(0x193)](_0x377059){const _0x25872e=_0x23de18;return this[_0x25872e(0x16d)]?this['namespace']+'-'+_0x377059:_0x377059;}async['getData'](_0x2a46b0){const _0x4acd96=_0x23de18,_0x274912=await this[_0x4acd96(0x186)][_0x4acd96(0x176)](_0x2a46b0);return _0x274912;}async[_0x23de18(0x167)](_0x272e4c,_0x38e80b=this[_0x23de18(0x164)]){const _0xeaf192=_0x23de18;await this['store'][_0xeaf192(0x183)](_0x272e4c['id'],_0x272e4c,_0x38e80b);}async[_0x23de18(0x18e)](_0x5ac9a4,_0x268fed){const _0x42b529=_0x23de18;let {maxRounds:_0x27bacd,maxModelToken:_0x4d38d5,maxResponseTokens:_0x4e1876,systemMessage:systemMessage='',name:_0x691dac,imageUrl:_0x1257a6,model:_0x52ffc6,activeModel:_0x4c83a6}=_0x268fed,{parentMessageId:_0x9fe04f}=_0x268fed,_0xa63596=[],_0x162a8c=0x0;if(systemMessage){const _0x312542=['gemini-pro',_0x42b529(0x169),_0x42b529(0x18b)],_0x4f475e=_0x4c83a6&&_0x312542[_0x42b529(0x18c)](_0x4975a5=>_0x4c83a6[_0x42b529(0x194)](_0x4975a5));_0x4f475e?(_0xa63596[_0x42b529(0x181)]({'role':_0x42b529(0x18a),'content':systemMessage,'name':_0x691dac}),_0xa63596[_0x42b529(0x181)]({'role':_0x42b529(0x191),'content':'好的','name':_0x691dac})):_0xa63596[_0x42b529(0x181)]({'role':'system','content':systemMessage,'name':_0x691dac});}const _0x59860e=_0xa63596['length'];let _0x22ae31=0x0;if(_0x4c83a6===_0x42b529(0x185)&&_0x1257a6){const _0x584c20=[{'type':_0x42b529(0x188),'text':_0x5ac9a4},{'type':_0x42b529(0x180),'image_url':{'url':_0x1257a6}}];_0xa63596['push']({'role':_0x42b529(0x18a),'content':_0x584c20,'name':_0x691dac});}else _0x52ffc6===_0x42b529(0x192)&&_0x1257a6&&(_0x5ac9a4=_0x1257a6+'\x0a'+_0x5ac9a4),_0xa63596[_0x42b529(0x181)]({'role':_0x42b529(0x18a),'content':_0x5ac9a4,'name':_0x691dac});let _0x47b061=_0xa63596;do{if(!_0x9fe04f)break;const _0x37e57f=await this['getData'](_0x9fe04f);if(!_0x37e57f)break;const {text:_0x547720,name:_0xe38a10,role:_0x49f8d3,imageUrl:_0x1f503d}=_0x37e57f;let _0x470237=_0x547720;_0x1f503d&&(_0x4c83a6===_0x42b529(0x185)&&(_0x470237=[{'type':_0x42b529(0x188),'text':_0x547720},{'type':_0x42b529(0x180),'image_url':{'url':_0x1f503d}}]));_0x47b061=_0x47b061['slice'](0x0,_0x59860e)['concat']([{'role':_0x49f8d3,'content':_0x470237,'name':_0xe38a10},..._0x47b061[_0x42b529(0x16f)](_0x59860e)]),_0x22ae31++;if(_0x27bacd&&_0x22ae31>=_0x27bacd)break;if(_0x4d38d5&&_0x4e1876){const _0xa548e9=_0x4d38d5-_0x4e1876;_0x162a8c=await this[_0x42b529(0x163)](_0x47b061);const _0x5cbe54=_0x162a8c+0xc8<=_0xa548e9;!_0x5cbe54&&(_0x47b061=this[_0x42b529(0x162)](_0x47b061,_0xa548e9,systemMessage));}_0x9fe04f=_0x37e57f[_0x42b529(0x175)];}while(!![]);const _0x203515=Math[_0x42b529(0x182)](0x1,Math['min'](_0x4d38d5-_0x162a8c,_0x4e1876));return console[_0x42b529(0x168)](_0x42b529(0x189),_0x47b061[_0x42b529(0x190)],_0x162a8c),{'context':_0x47b061,'round':_0x47b061[_0x42b529(0x190)],'historyToken':_0x162a8c};}['_getTokenCount'](_0x2c360c){const _0x459fb7=_0x23de18;let _0x1ad382=_0x2c360c['reduce']((_0x5885e9,_0x4ababe)=>{const _0x3ca3cb=_0x2962;if(Array[_0x3ca3cb(0x171)](_0x4ababe[_0x3ca3cb(0x172)])){const _0x2d2fde=_0x4ababe[_0x3ca3cb(0x172)][_0x3ca3cb(0x195)](_0x20e16e=>_0x20e16e[_0x3ca3cb(0x166)]===_0x3ca3cb(0x188))['map'](_0x22a3f0=>_0x22a3f0[_0x3ca3cb(0x188)])[_0x3ca3cb(0x17c)]('\x20');return _0x5885e9+_0x2d2fde;}else return _0x5885e9+(_0x4ababe[_0x3ca3cb(0x172)]||'');},'');return _0x1ad382=_0x1ad382['replace'](/<\|endoftext\|>/g,''),tokenizer[_0x459fb7(0x170)](_0x1ad382)[_0x459fb7(0x190)];}[_0x23de18(0x162)](_0x5aaa9e,_0x2e1874,_0x5e564b){const _0x53479d=_0x23de18,_0x43fcb6=this[_0x53479d(0x163)](_0x5aaa9e);if(_0x43fcb6<=_0x2e1874)return _0x5aaa9e;return _0x5aaa9e['splice'](_0x5e564b?0x1:0x0,0x1),this[_0x53479d(0x162)](_0x5aaa9e,_0x2e1874,_0x5e564b);}[_0x23de18(0x177)](){return(0x0,uuid_1['v4'])();}}exports[_0x23de18(0x179)]=NineStore;function _0xd079(){const _0x5dc538=['some','get_encoding','buildMessageFromParentMessageId','872105NNUupM','length','assistant','gpt-4-all','generateKey','includes','filter','_recursivePruning','_getTokenCount','expires','358713VBAuiT','type','setData','log','ERNIE','294EZAGKp','16slyrGd','defineProperty','namespace','56bjGUIw','slice','encode','isArray','content','uuid','2847BfTvcH','parentMessageId','get','getUuid','__esModule','NineStore','formatOptions','545771PGklIH','join','cl100k_base','@dqbd/tiktoken','3892840dsZnvj','image_url','push','max','set','87600pPUwum','gpt-4-vision-preview','store','20828210dZjBNh','text','本次携带上下文的长度','user','hunyuan'];_0xd079=function(){return _0x5dc538;};return _0xd079();}