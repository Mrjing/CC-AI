'use strict';const _0x1b2dcc=_0x7500;(function(_0x3ad36e,_0xe4ec60){const _0x3e96d9=_0x7500,_0x145059=_0x3ad36e();while(!![]){try{const _0x435026=parseInt(_0x3e96d9(0x159))/0x1+parseInt(_0x3e96d9(0x141))/0x2+parseInt(_0x3e96d9(0x152))/0x3+-parseInt(_0x3e96d9(0x169))/0x4+-parseInt(_0x3e96d9(0x147))/0x5+-parseInt(_0x3e96d9(0x164))/0x6*(-parseInt(_0x3e96d9(0x146))/0x7)+-parseInt(_0x3e96d9(0x161))/0x8;if(_0x435026===_0xe4ec60)break;else _0x145059['push'](_0x145059['shift']());}catch(_0xbc04e6){_0x145059['push'](_0x145059['shift']());}}}(_0x5f22,0x5d108));Object[_0x1b2dcc(0x170)](exports,_0x1b2dcc(0x140),{'value':!![]}),exports[_0x1b2dcc(0x14f)]=void 0x0;const uuid_1=require(_0x1b2dcc(0x13d)),tiktoken_1=require(_0x1b2dcc(0x174)),tokenizer=(0x0,tiktoken_1[_0x1b2dcc(0x145)])(_0x1b2dcc(0x16b));function _0x5f22(){const _0x3d8fa7=['217sSWSBK','2961985FtOTYe','splice','length','replace','isArray','chat','max','setData','NineStore','reduce','concat','1802685RXFZhK','encode','buildMessageFromParentMessageId','push','slice','filter','text','556060BznYBZ','set','gemini-pro','generateKey','_recursivePruning','image_url','get','store','4866216wOzOEO','gpt-4-all','hunyuan','118950HoUvos','join','map','min','本次携带上下文的长度','1507932rbzafW','parentMessageId','cl100k_base','getUuid','gpt-4-vision-preview','user','content','defineProperty','expires','getData','namespace','@dqbd/tiktoken','_getTokenCount','uuid','some','system','__esModule','374638arCpXt','log','assistant','formatOptions','get_encoding'];_0x5f22=function(){return _0x3d8fa7;};return _0x5f22();}class NineStore{constructor(_0x3dc81e){const _0x38d8a2=_0x1b2dcc,{store:_0x12e496,namespace:_0x164df7,expires:_0x1be446}=this[_0x38d8a2(0x144)](_0x3dc81e);this['store']=_0x12e496,this['namespace']=_0x164df7,this[_0x38d8a2(0x171)]=_0x1be446;}[_0x1b2dcc(0x144)](_0xfbf423){const _0x3e2752=_0x1b2dcc,{store:_0x10f949,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x3e2752(0x14c)}=_0xfbf423;return{'store':_0x10f949,'namespace':namespace,'expires':expires};}[_0x1b2dcc(0x15c)](_0x447f53){const _0x3357ed=_0x1b2dcc;return this[_0x3357ed(0x173)]?this[_0x3357ed(0x173)]+'-'+_0x447f53:_0x447f53;}async[_0x1b2dcc(0x172)](_0x58238f){const _0x37f153=_0x1b2dcc,_0x35a3ac=await this[_0x37f153(0x160)][_0x37f153(0x15f)](_0x58238f);return _0x35a3ac;}async[_0x1b2dcc(0x14e)](_0x2a8f34,_0x3550cf=this[_0x1b2dcc(0x171)]){const _0x1242ab=_0x1b2dcc;await this[_0x1242ab(0x160)][_0x1242ab(0x15a)](_0x2a8f34['id'],_0x2a8f34,_0x3550cf);}async[_0x1b2dcc(0x154)](_0xc5082d,_0xacc1b5){const _0x4ec3f2=_0x1b2dcc;let {maxRounds:_0x3d0ad3,maxModelToken:_0x53aadf,maxResponseTokens:_0x193b5c,systemMessage:systemMessage='',name:_0x1d25b6,imageUrl:_0x2e847a,model:_0x1c4545,activeModel:_0x5c8724}=_0xacc1b5,{parentMessageId:_0x2715a5}=_0xacc1b5,_0x3beb93=[],_0x169e6d=0x0;if(systemMessage){const _0x126498=[_0x4ec3f2(0x15b),'ERNIE',_0x4ec3f2(0x163)],_0x2a2297=_0x5c8724&&_0x126498[_0x4ec3f2(0x13e)](_0x5cd539=>_0x5c8724['includes'](_0x5cd539));_0x2a2297?(_0x3beb93[_0x4ec3f2(0x155)]({'role':_0x4ec3f2(0x16e),'content':systemMessage,'name':_0x1d25b6}),_0x3beb93['push']({'role':_0x4ec3f2(0x143),'content':'好的','name':_0x1d25b6})):_0x3beb93[_0x4ec3f2(0x155)]({'role':_0x4ec3f2(0x13f),'content':systemMessage,'name':_0x1d25b6});}const _0x4a4272=_0x3beb93['length'];let _0x3bb5e9=0x0;if(_0x5c8724==='gpt-4-vision-preview'&&_0x2e847a){const _0x439ade=[{'type':'text','text':_0xc5082d},{'type':_0x4ec3f2(0x15e),'image_url':{'url':_0x2e847a}}];_0x3beb93[_0x4ec3f2(0x155)]({'role':'user','content':_0x439ade,'name':_0x1d25b6});}else _0x1c4545===_0x4ec3f2(0x162)&&_0x2e847a&&(_0xc5082d=_0x2e847a+'\x0a'+_0xc5082d),_0x3beb93[_0x4ec3f2(0x155)]({'role':'user','content':_0xc5082d,'name':_0x1d25b6});let _0x538b54=_0x3beb93;do{if(!_0x2715a5)break;const _0x543212=await this[_0x4ec3f2(0x172)](_0x2715a5);if(!_0x543212)break;const {text:_0x552fa5,name:_0x524875,role:_0x361922,imageUrl:_0x2537a4}=_0x543212;let _0x1ec4b1=_0x552fa5;_0x2537a4&&(_0x5c8724===_0x4ec3f2(0x16d)&&(_0x1ec4b1=[{'type':_0x4ec3f2(0x158),'text':_0x552fa5},{'type':_0x4ec3f2(0x15e),'image_url':{'url':_0x2537a4}}]));_0x538b54=_0x538b54[_0x4ec3f2(0x156)](0x0,_0x4a4272)[_0x4ec3f2(0x151)]([{'role':_0x361922,'content':_0x1ec4b1,'name':_0x524875},..._0x538b54[_0x4ec3f2(0x156)](_0x4a4272)]),_0x3bb5e9++;if(_0x3d0ad3&&_0x3bb5e9>=_0x3d0ad3)break;if(_0x53aadf&&_0x193b5c){const _0x5b0cca=_0x53aadf-_0x193b5c;_0x169e6d=await this[_0x4ec3f2(0x13c)](_0x538b54);const _0x3720e3=_0x169e6d+0xc8<=_0x5b0cca;!_0x3720e3&&(_0x538b54=this[_0x4ec3f2(0x15d)](_0x538b54,_0x5b0cca,systemMessage));}_0x2715a5=_0x543212[_0x4ec3f2(0x16a)];}while(!![]);const _0x269585=Math[_0x4ec3f2(0x14d)](0x1,Math[_0x4ec3f2(0x167)](_0x53aadf-_0x169e6d,_0x193b5c));return console[_0x4ec3f2(0x142)](_0x4ec3f2(0x168),_0x538b54['length'],_0x169e6d),{'context':_0x538b54,'round':_0x538b54[_0x4ec3f2(0x149)],'historyToken':_0x169e6d};}[_0x1b2dcc(0x13c)](_0x42dce2){const _0x41be9f=_0x1b2dcc;let _0x46874e=_0x42dce2[_0x41be9f(0x150)]((_0x31b698,_0x518b50)=>{const _0x4452ec=_0x41be9f;if(Array[_0x4452ec(0x14b)](_0x518b50[_0x4452ec(0x16f)])){const _0x5c30db=_0x518b50[_0x4452ec(0x16f)][_0x4452ec(0x157)](_0x1cdd51=>_0x1cdd51['type']===_0x4452ec(0x158))[_0x4452ec(0x166)](_0x1f2d9a=>_0x1f2d9a[_0x4452ec(0x158)])[_0x4452ec(0x165)]('\x20');return _0x31b698+_0x5c30db;}else return _0x31b698+(_0x518b50['content']||'');},'');return _0x46874e=_0x46874e[_0x41be9f(0x14a)](/<\|endoftext\|>/g,''),tokenizer[_0x41be9f(0x153)](_0x46874e)[_0x41be9f(0x149)];}[_0x1b2dcc(0x15d)](_0x1e4b6d,_0xc2b95,_0x162541){const _0x51b7aa=_0x1b2dcc,_0x70c976=this[_0x51b7aa(0x13c)](_0x1e4b6d);if(_0x70c976<=_0xc2b95)return _0x1e4b6d;return _0x1e4b6d[_0x51b7aa(0x148)](_0x162541?0x1:0x0,0x1),this['_recursivePruning'](_0x1e4b6d,_0xc2b95,_0x162541);}[_0x1b2dcc(0x16c)](){return(0x0,uuid_1['v4'])();}}function _0x7500(_0x2c20e0,_0x51247e){const _0x5f224f=_0x5f22();return _0x7500=function(_0x7500e1,_0xc2014e){_0x7500e1=_0x7500e1-0x13c;let _0x5cce20=_0x5f224f[_0x7500e1];return _0x5cce20;},_0x7500(_0x2c20e0,_0x51247e);}exports[_0x1b2dcc(0x14f)]=NineStore;