'use strict';const _0x524a75=_0x436a;function _0x436a(_0x2f5df7,_0x1082f8){const _0xa7d158=_0xa7d1();return _0x436a=function(_0x436ab0,_0x879be3){_0x436ab0=_0x436ab0-0x97;let _0x18ee72=_0xa7d158[_0x436ab0];return _0x18ee72;},_0x436a(_0x2f5df7,_0x1082f8);}(function(_0x5245e3,_0x5e6f39){const _0x9d7809=_0x436a,_0x9abd1b=_0x5245e3();while(!![]){try{const _0x391d0d=-parseInt(_0x9d7809(0x9d))/0x1+-parseInt(_0x9d7809(0xd0))/0x2*(-parseInt(_0x9d7809(0xa3))/0x3)+parseInt(_0x9d7809(0xe7))/0x4+parseInt(_0x9d7809(0xab))/0x5*(parseInt(_0x9d7809(0xbe))/0x6)+parseInt(_0x9d7809(0x103))/0x7+parseInt(_0x9d7809(0xbd))/0x8*(parseInt(_0x9d7809(0xf0))/0x9)+-parseInt(_0x9d7809(0xcf))/0xa;if(_0x391d0d===_0x5e6f39)break;else _0x9abd1b['push'](_0x9abd1b['shift']());}catch(_0xc17b15){_0x9abd1b['push'](_0x9abd1b['shift']());}}}(_0xa7d1,0x6b38e));function _0xa7d1(){const _0x34b415=['百度云检测','***','match','1999652afhLjz','ViolationLogEntity','敏感词不存在,请检查您的提交信息','__decorate','HttpException','userId','log','decorate','username','102141ZKaaMf','join','data','findOne','loadBadWords','save','getSensitiveConfig','的内容、我们已对您的账户进行标记、请合规使用！','execute','../user/user.entity','../../common/utils','DESC','Repository','BadwordsService','forEach','queryBadWords','@nestjs/typeorm','violationLogEntity','HttpStatus','165669eETIMV','Like','添加敏感词成功','update','检测失败','stringify','metadata','checkBadWords','hideString','__param','BAD_REQUEST','find','length','578913SxkEes','InjectRepository','GlobalConfigService','violationCount','delete','badWordsEntity','27capPag','NineAi检测','map','avatar','nineaiCheckBadWords','findAndCount','includes','onModuleInit','82065aeDeub','您提交的内容中包含','checkBadWordsByConfig','的信息、我们已对您账号进行标记、请合规使用！','application/x-www-form-urlencoded','createQueryBuilder','UserEntity','addBadWord','Injectable','word_list','where','category','delBadWords','typeOriginCn','getOwnPropertyDescriptor','object','更新敏感词成功','customSensitiveWords','104iPHvzo','96mWKTUN','baiduTextAccessToken','敏感词已存在,请检查您的提交信息','formarTips','extractContent','./badwords.entity','set','axios','updateBadWords','userEntity','recordUserBadWords','baiduCheckBadWords','super','defineProperty','function','userInfo','__metadata','7475990cRACOb','184882MABatp','敏感词已经存在了、请勿重复添加','ASC','application/json','您提交的信息中包含','word','email','__esModule','status','baidu','./violationLog.entity','post','default','error:\x20','../globalConfig/globalConfig.service','affected','badWords','globalConfigService','msg','typeorm'];_0xa7d1=function(){return _0x34b415;};return _0xa7d1();}var __decorate=this&&this[_0x524a75(0xea)]||function(_0x2bae71,_0x2858fa,_0x532005,_0xe6180e){const _0x1864be=_0x524a75;var _0x229aa7=arguments['length'],_0x5dff8f=_0x229aa7<0x3?_0x2858fa:_0xe6180e===null?_0xe6180e=Object[_0x1864be(0xb9)](_0x2858fa,_0x532005):_0xe6180e,_0x1eeefe;if(typeof Reflect===_0x1864be(0xba)&&typeof Reflect[_0x1864be(0xee)]===_0x1864be(0xcc))_0x5dff8f=Reflect[_0x1864be(0xee)](_0x2bae71,_0x2858fa,_0x532005,_0xe6180e);else{for(var _0x531f16=_0x2bae71['length']-0x1;_0x531f16>=0x0;_0x531f16--)if(_0x1eeefe=_0x2bae71[_0x531f16])_0x5dff8f=(_0x229aa7<0x3?_0x1eeefe(_0x5dff8f):_0x229aa7>0x3?_0x1eeefe(_0x2858fa,_0x532005,_0x5dff8f):_0x1eeefe(_0x2858fa,_0x532005))||_0x5dff8f;}return _0x229aa7>0x3&&_0x5dff8f&&Object[_0x1864be(0xcb)](_0x2858fa,_0x532005,_0x5dff8f),_0x5dff8f;},__metadata=this&&this[_0x524a75(0xce)]||function(_0x180ab8,_0x57a23f){const _0x2d644b=_0x524a75;if(typeof Reflect===_0x2d644b(0xba)&&typeof Reflect[_0x2d644b(0x109)]===_0x2d644b(0xcc))return Reflect[_0x2d644b(0x109)](_0x180ab8,_0x57a23f);},__param=this&&this[_0x524a75(0x99)]||function(_0xe7b2fd,_0x10687f){return function(_0xf62f58,_0x41ebd4){_0x10687f(_0xf62f58,_0x41ebd4,_0xe7b2fd);};};Object[_0x524a75(0xcb)](exports,_0x524a75(0xd7),{'value':!![]}),exports[_0x524a75(0xfd)]=void 0x0;const globalConfig_service_1=require(_0x524a75(0xde)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x524a75(0xc3)),typeorm_1=require(_0x524a75(0xe3)),typeorm_2=require(_0x524a75(0x100)),axios_1=require(_0x524a75(0xc5)),violationLog_entity_1=require(_0x524a75(0xda)),user_entity_1=require(_0x524a75(0xf9)),utils_1=require(_0x524a75(0xfa));let BadwordsService=class BadwordsService{constructor(_0x7c2541,_0x1eebff,_0x38a0cc,_0x38a3b3){const _0x256f14=_0x524a75;this[_0x256f14(0xa2)]=_0x7c2541,this['violationLogEntity']=_0x1eebff,this[_0x256f14(0xc7)]=_0x38a0cc,this[_0x256f14(0xe1)]=_0x38a3b3,this[_0x256f14(0xe0)]=[];}async[_0x524a75(0xaa)](){const _0x44e2a6=_0x524a75;this[_0x44e2a6(0xf4)]();}async[_0x524a75(0xbc)](_0x2786b0,_0x36f4c5){const _0x2ab75e=_0x524a75,_0x576383=[];for(let _0x48f590=0x0;_0x48f590<this['badWords'][_0x2ab75e(0x9c)];_0x48f590++){const _0x37a564=this[_0x2ab75e(0xe0)][_0x48f590];_0x2786b0[_0x2ab75e(0xa9)](_0x37a564)&&_0x576383['push'](_0x37a564);}if(_0x576383['length']){await this[_0x2ab75e(0xc8)](_0x36f4c5,_0x2786b0,_0x576383,['自定义'],'自定义检测');const _0x33ad02='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x33ad02,common_1['HttpStatus'][_0x2ab75e(0x9a)]);}}async[_0x524a75(0x97)](_0x15da65,_0x430294){const _0x1c9896=_0x524a75,_0x2b9ad8=await this[_0x1c9896(0xe1)][_0x1c9896(0xf6)]();_0x2b9ad8&&await this[_0x1c9896(0xad)](_0x15da65,_0x2b9ad8,_0x430294),await this[_0x1c9896(0xbc)](_0x15da65,_0x430294);}async[_0x524a75(0xad)](_0x271eed,_0x5abf6d,_0x118523){const _0x4f8e60=_0x524a75,{useType:_0x176d66}=_0x5abf6d;_0x176d66===_0x4f8e60(0xd9)&&await this[_0x4f8e60(0xc9)](_0x271eed,_0x5abf6d[_0x4f8e60(0xbf)],_0x118523),_0x176d66==='nineai'&&await this[_0x4f8e60(0xa7)](_0x271eed,_0x5abf6d,_0x118523);}[_0x524a75(0xc2)](_0xf94f21){const _0x2b177d=_0x524a75,_0x2c34b1=/存在(.*?)不合规/,_0x3547cd=_0xf94f21[_0x2b177d(0xe6)](_0x2c34b1);return _0x3547cd?_0x3547cd[0x1]:'';}async[_0x524a75(0xc9)](_0x30dca8,_0x169fd2,_0xb3901c){const _0x54d9ff=_0x524a75;if(!_0x169fd2)return;const _0x5bf90f='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x169fd2+'}',_0x249d09={'Content-Type':_0x54d9ff(0xaf),'Accept':_0x54d9ff(0xd3)},_0x72e2d5=await axios_1[_0x54d9ff(0xdc)][_0x54d9ff(0xdb)](_0x5bf90f,{'text':_0x30dca8},{'headers':_0x249d09}),{conclusion:_0x1c195c,error_code:_0x1ebd21,error_msg:_0xc4dd1f,conclusionType:_0x2b3cdd,data:_0x914a80}=_0x72e2d5['data'];_0x1ebd21&&console[_0x54d9ff(0xed)]('百度文本检测出现错误、请查看配置信息:\x20',_0xc4dd1f);if(_0x2b3cdd!==0x1){const _0x3ff396=[...new Set(_0x914a80['map'](_0x440bf3=>this['extractContent'](_0x440bf3[_0x54d9ff(0xe2)])))];await this[_0x54d9ff(0xc8)](_0xb3901c,_0x30dca8,[_0x54d9ff(0xe5)],_0x3ff396,_0x54d9ff(0xe4));const _0x1db6b6=_0x54d9ff(0xd4)+_0x3ff396['join'](',')+_0x54d9ff(0xf7);throw new common_1['HttpException'](_0x1db6b6,common_1[_0x54d9ff(0x102)]['BAD_REQUEST']);}}async['nineaiCheckBadWords'](_0x5aabfa,_0x260112,_0x4ff4c2){const _0x4c0792=_0x524a75;var _0x16afe4;const {nineaiBuiltInSensitiveApiBase:_0x3f1950,nineaiBuiltInSensitiveAuthKey:_0x2cab62}=_0x260112;if(!_0x3f1950||!_0x2cab62)return;const _0x5e4da9=await axios_1[_0x4c0792(0xdc)][_0x4c0792(0xdb)](_0x3f1950,{'content':_0x5aabfa},{'headers':{'Content-Type':'application/json','Authorization':_0x2cab62}});if(!_0x5e4da9[_0x4c0792(0xf2)])return;if(_0x5e4da9['data']['code']!=='0'){const {msg:msg=_0x4c0792(0x107)}=_0x5e4da9[_0x4c0792(0xf2)];throw new common_1[(_0x4c0792(0xeb))]('敏感词检测\x20|\x20'+msg,common_1[_0x4c0792(0x102)][_0x4c0792(0x9a)]);}if(_0x5e4da9['data'][_0x4c0792(0xb4)]&&((_0x16afe4=_0x5e4da9['data'][_0x4c0792(0xb4)])===null||_0x16afe4===void 0x0?void 0x0:_0x16afe4[_0x4c0792(0x9c)])){const _0x1ad160=[...new Set(_0x5e4da9[_0x4c0792(0xf2)][_0x4c0792(0xb4)][_0x4c0792(0xa5)](_0x57f2f4=>_0x57f2f4['keyword']))],_0x386665=[...new Set(_0x5e4da9[_0x4c0792(0xf2)][_0x4c0792(0xb4)][_0x4c0792(0xa5)](_0x527679=>_0x527679[_0x4c0792(0xb6)]))];await this[_0x4c0792(0xc8)](_0x4ff4c2,_0x5aabfa,_0x1ad160,_0x386665,_0x4c0792(0xa4));const _0x57d76a=this[_0x4c0792(0xc1)](_0x5e4da9[_0x4c0792(0xf2)]['word_list']);throw new common_1['HttpException'](_0x57d76a,common_1[_0x4c0792(0x102)][_0x4c0792(0x9a)]);}}[_0x524a75(0xc1)](_0x2e8b65){const _0x3bfd19=_0x524a75,_0x4fb3dc=_0x2e8b65[_0x3bfd19(0xa5)](_0x42b97e=>_0x42b97e['category']),_0x6b5543=[...new Set(_0x4fb3dc)];return _0x3bfd19(0xac)+_0x6b5543[_0x3bfd19(0xf1)](',')+_0x3bfd19(0xae);}async[_0x524a75(0xf4)](){const _0x5713ab=_0x524a75,_0x3426f4=await this[_0x5713ab(0xa2)][_0x5713ab(0x9b)]({'where':{'status':0x1},'select':[_0x5713ab(0xd5)]});this[_0x5713ab(0xe0)]=_0x3426f4[_0x5713ab(0xa5)](_0x521985=>_0x521985[_0x5713ab(0xd5)]);}async[_0x524a75(0xff)](_0x1e271f){const _0x11c52e=_0x524a75,{page:page=0x1,size:size=0x1f4,word:_0x4668d6,status:_0x2fb5a1}=_0x1e271f,_0x69e5e1={};[0x0,0x1,'0','1'][_0x11c52e(0xa9)](_0x2fb5a1)&&(_0x69e5e1[_0x11c52e(0xd8)]=_0x2fb5a1),_0x4668d6&&(_0x69e5e1[_0x11c52e(0xd5)]=(0x0,typeorm_1[_0x11c52e(0x104)])('%'+_0x4668d6+'%'));const [_0x5d5481,_0x21681e]=await this[_0x11c52e(0xa2)][_0x11c52e(0xa8)]({'where':_0x69e5e1,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x11c52e(0xd2)}});return{'rows':_0x5d5481,'count':_0x21681e};}async[_0x524a75(0xb7)](_0x35735a){const _0x2bcb72=_0x524a75,_0x498040=await this[_0x2bcb72(0xa2)][_0x2bcb72(0xf3)]({'where':{'id':_0x35735a['id']}});if(!_0x498040)throw new common_1['HttpException'](_0x2bcb72(0xe9),common_1[_0x2bcb72(0x102)][_0x2bcb72(0x9a)]);const _0x15c088=await this['badWordsEntity'][_0x2bcb72(0xa1)]({'id':_0x35735a['id']});if(_0x15c088[_0x2bcb72(0xdf)]>0x0)return await this[_0x2bcb72(0xf4)](),'删除敏感词成功';else throw new common_1[(_0x2bcb72(0xeb))]('删除敏感词失败',common_1[_0x2bcb72(0x102)][_0x2bcb72(0x9a)]);}async[_0x524a75(0xc6)](_0x4d9932){const _0x36b6dc=_0x524a75,{id:_0x3ee811,word:_0x1f8cd8,status:_0x39f9d5}=_0x4d9932,_0x2462e3=await this['badWordsEntity'][_0x36b6dc(0xf3)]({'where':{'word':_0x1f8cd8}});if(_0x2462e3)throw new common_1[(_0x36b6dc(0xeb))](_0x36b6dc(0xd1),common_1[_0x36b6dc(0x102)]['BAD_REQUEST']);const _0x5cbd48=await this['badWordsEntity']['update']({'id':_0x3ee811},{'word':_0x1f8cd8,'status':_0x39f9d5});if(_0x5cbd48[_0x36b6dc(0xdf)]>0x0)return await this[_0x36b6dc(0xf4)](),_0x36b6dc(0xbb);else throw new common_1[(_0x36b6dc(0xeb))]('更新敏感词失败',common_1['HttpStatus'][_0x36b6dc(0x9a)]);}async[_0x524a75(0xb2)](_0xa5e0fd){const _0x1b3c0f=_0x524a75,{word:_0x16edee}=_0xa5e0fd,_0x5972e1=await this[_0x1b3c0f(0xa2)]['findOne']({'where':{'word':_0x16edee}});if(_0x5972e1)throw new common_1[(_0x1b3c0f(0xeb))](_0x1b3c0f(0xc0),common_1[_0x1b3c0f(0x102)][_0x1b3c0f(0x9a)]);return await this['badWordsEntity'][_0x1b3c0f(0xf5)]({'word':_0x16edee}),await this['loadBadWords'](),_0x1b3c0f(0x105);}async[_0x524a75(0xc8)](_0x3da1b6,_0xc8f66d,_0x138aec,_0x496a6f,_0x41a1d8){const _0x43ba02=_0x524a75,_0x22b220={'userId':_0x3da1b6,'content':_0xc8f66d,'words':JSON[_0x43ba02(0x108)](_0x138aec),'typeCn':JSON['stringify'](_0x496a6f),'typeOriginCn':_0x41a1d8};try{await this['userEntity'][_0x43ba02(0xb0)]()[_0x43ba02(0x106)](user_entity_1[_0x43ba02(0xb1)])[_0x43ba02(0xc4)]({'violationCount':()=>'violationCount\x20+\x201'})[_0x43ba02(0xb5)]('id\x20=\x20:userId',{'userId':_0x3da1b6})[_0x43ba02(0xf8)](),await this['violationLogEntity'][_0x43ba02(0xf5)](_0x22b220);}catch(_0x479658){console['log'](_0x43ba02(0xdd),_0x479658);}}async['violation'](_0x521ce3,_0xbf5ad7){const _0xd531ac=_0x524a75,{role:_0x4f6754}=_0x521ce3['user'],{page:page=0x1,size:size=0xa,userId:_0x434971,typeOriginCn:_0x6d2079}=_0xbf5ad7,_0x404667={};_0x434971&&(_0x404667[_0xd531ac(0xec)]=_0x434971),_0x6d2079&&(_0x404667[_0xd531ac(0xb8)]=_0x6d2079);const [_0x4344c5,_0x581c68]=await this[_0xd531ac(0x101)][_0xd531ac(0xa8)]({'where':_0x404667,'skip':(page-0x1)*size,'take':size,'order':{'id':_0xd531ac(0xfb)}}),_0x6f6c78=[...new Set(_0x4344c5[_0xd531ac(0xa5)](_0x21b799=>_0x21b799[_0xd531ac(0xec)]))],_0xbd1ea3=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x6f6c78)},'select':['id',_0xd531ac(0xa6),_0xd531ac(0xef),'email',_0xd531ac(0xa0),_0xd531ac(0xd8)]});return _0x4344c5[_0xd531ac(0xfe)](_0x37f491=>{const _0x2765a1=_0xd531ac,_0x57a0d4=_0xbd1ea3['find'](_0x431cc2=>_0x431cc2['id']===_0x37f491['userId']);_0x4f6754!==_0x2765a1(0xca)&&(_0x57a0d4[_0x2765a1(0xd6)]=(0x0,utils_1[_0x2765a1(0x98)])(_0x57a0d4[_0x2765a1(0xd6)])),_0x37f491[_0x2765a1(0xcd)]=_0x57a0d4;}),{'rows':_0x4344c5,'count':_0x581c68};}};BadwordsService=__decorate([(0x0,common_1[_0x524a75(0xb3)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x524a75(0x9e)])(violationLog_entity_1[_0x524a75(0xe8)])),__param(0x2,(0x0,typeorm_2[_0x524a75(0x9e)])(user_entity_1[_0x524a75(0xb1)])),__metadata('design:paramtypes',[typeorm_1[_0x524a75(0xfc)],typeorm_1['Repository'],typeorm_1[_0x524a75(0xfc)],globalConfig_service_1[_0x524a75(0x9f)]])],BadwordsService),exports['BadwordsService']=BadwordsService;