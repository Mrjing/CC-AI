'use strict';const _0x58f81f=_0x3712;(function(_0xeaf4d4,_0x3eee96){const _0x18020d=_0x3712,_0x1d2de7=_0xeaf4d4();while(!![]){try{const _0x4e63b8=parseInt(_0x18020d(0x179))/0x1+-parseInt(_0x18020d(0x189))/0x2+parseInt(_0x18020d(0x198))/0x3*(parseInt(_0x18020d(0x16d))/0x4)+-parseInt(_0x18020d(0x181))/0x5*(-parseInt(_0x18020d(0x16a))/0x6)+parseInt(_0x18020d(0x173))/0x7*(-parseInt(_0x18020d(0x163))/0x8)+parseInt(_0x18020d(0x188))/0x9+parseInt(_0x18020d(0x164))/0xa*(parseInt(_0x18020d(0x143))/0xb);if(_0x4e63b8===_0x3eee96)break;else _0x1d2de7['push'](_0x1d2de7['shift']());}catch(_0x5b935b){_0x1d2de7['push'](_0x1d2de7['shift']());}}}(_0x2b19,0xa7196));var __decorate=this&&this['__decorate']||function(_0x13b192,_0xb8f5cf,_0x2f5cbf,_0xd43e6e){const _0x322ee3=_0x3712;var _0x2b8974=arguments[_0x322ee3(0x157)],_0x238a2d=_0x2b8974<0x3?_0xb8f5cf:_0xd43e6e===null?_0xd43e6e=Object['getOwnPropertyDescriptor'](_0xb8f5cf,_0x2f5cbf):_0xd43e6e,_0x41e3b8;if(typeof Reflect===_0x322ee3(0x15a)&&typeof Reflect['decorate']===_0x322ee3(0x185))_0x238a2d=Reflect[_0x322ee3(0x172)](_0x13b192,_0xb8f5cf,_0x2f5cbf,_0xd43e6e);else{for(var _0x78bd05=_0x13b192[_0x322ee3(0x157)]-0x1;_0x78bd05>=0x0;_0x78bd05--)if(_0x41e3b8=_0x13b192[_0x78bd05])_0x238a2d=(_0x2b8974<0x3?_0x41e3b8(_0x238a2d):_0x2b8974>0x3?_0x41e3b8(_0xb8f5cf,_0x2f5cbf,_0x238a2d):_0x41e3b8(_0xb8f5cf,_0x2f5cbf))||_0x238a2d;}return _0x2b8974>0x3&&_0x238a2d&&Object['defineProperty'](_0xb8f5cf,_0x2f5cbf,_0x238a2d),_0x238a2d;},__metadata=this&&this[_0x58f81f(0x1a0)]||function(_0x6ef6cc,_0x3d4c1a){const _0x22e993=_0x58f81f;if(typeof Reflect===_0x22e993(0x15a)&&typeof Reflect['metadata']===_0x22e993(0x185))return Reflect['metadata'](_0x6ef6cc,_0x3d4c1a);},__param=this&&this[_0x58f81f(0x1a2)]||function(_0x1ed82e,_0x2825a2){return function(_0x14b7f7,_0x216fa9){_0x2825a2(_0x14b7f7,_0x216fa9,_0x1ed82e);};};Object[_0x58f81f(0x1a8)](exports,'__esModule',{'value':!![]}),exports[_0x58f81f(0x15f)]=void 0x0;const globalConfig_service_1=require(_0x58f81f(0x19e)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x58f81f(0x166)),typeorm_1=require(_0x58f81f(0x19c)),typeorm_2=require(_0x58f81f(0x18b)),axios_1=require(_0x58f81f(0x153)),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require(_0x58f81f(0x13a)),utils_1=require('../../common/utils');function _0x3712(_0x53008e,_0x5058d){const _0x2b1928=_0x2b19();return _0x3712=function(_0x371219,_0x1157a1){_0x371219=_0x371219-0x13a;let _0x2f624a=_0x2b1928[_0x371219];return _0x2f624a;},_0x3712(_0x53008e,_0x5058d);}let BadwordsService=class BadwordsService{constructor(_0x29be15,_0x5429d5,_0x20a1f5,_0x32532f){const _0x42af46=_0x58f81f;this[_0x42af46(0x167)]=_0x29be15,this[_0x42af46(0x1a7)]=_0x5429d5,this['userEntity']=_0x20a1f5,this['globalConfigService']=_0x32532f,this['badWords']=[];}async[_0x58f81f(0x194)](){const _0x1575cb=_0x58f81f;this[_0x1575cb(0x178)]();}async['customSensitiveWords'](_0x24cc63,_0x2a445b){const _0x3295d9=_0x58f81f,_0x4d5e1d=[];for(let _0x4afb96=0x0;_0x4afb96<this[_0x3295d9(0x190)][_0x3295d9(0x157)];_0x4afb96++){const _0x7c4565=this[_0x3295d9(0x190)][_0x4afb96];_0x24cc63['includes'](_0x7c4565)&&_0x4d5e1d['push'](_0x7c4565);}if(_0x4d5e1d[_0x3295d9(0x157)]){await this[_0x3295d9(0x13f)](_0x2a445b,_0x24cc63,_0x4d5e1d,[_0x3295d9(0x15c)],_0x3295d9(0x16f));const _0x163c20=_0x3295d9(0x182);throw new common_1[(_0x3295d9(0x191))](_0x163c20,common_1[_0x3295d9(0x15b)][_0x3295d9(0x147)]);}}async[_0x58f81f(0x17d)](_0x150f7c,_0xef74c9){const _0xae51ff=_0x58f81f,_0x21122a=await this['globalConfigService'][_0xae51ff(0x148)]();_0x21122a&&await this[_0xae51ff(0x16e)](_0x150f7c,_0x21122a,_0xef74c9),await this[_0xae51ff(0x17b)](_0x150f7c,_0xef74c9);}async[_0x58f81f(0x16e)](_0x33a1ff,_0xda1347,_0x238336){const _0x14b723=_0x58f81f,{useType:_0x3e6b5e}=_0xda1347;_0x3e6b5e===_0x14b723(0x141)&&await this['baiduCheckBadWords'](_0x33a1ff,_0xda1347[_0x14b723(0x196)],_0x238336),_0x3e6b5e==='nineai'&&await this[_0x14b723(0x165)](_0x33a1ff,_0xda1347,_0x238336);}[_0x58f81f(0x19f)](_0x925447){const _0x5dff5f=/存在(.*?)不合规/,_0x43ed6b=_0x925447['match'](_0x5dff5f);return _0x43ed6b?_0x43ed6b[0x1]:'';}async[_0x58f81f(0x15d)](_0xabdee8,_0xb5d6b1,_0x165c28){const _0x4832f7=_0x58f81f;if(!_0xb5d6b1)return;const _0x47c4bb=_0x4832f7(0x14a)+_0xb5d6b1+'}',_0x1842dc={'Content-Type':_0x4832f7(0x170),'Accept':'application/json'},_0x174404=await axios_1[_0x4832f7(0x13c)][_0x4832f7(0x14f)](_0x47c4bb,{'text':_0xabdee8},{'headers':_0x1842dc}),{conclusion:_0x32d63b,error_code:_0x466ba2,error_msg:_0x2d09db,conclusionType:_0x4717ac,data:_0x323ea7}=_0x174404[_0x4832f7(0x160)];_0x466ba2&&console[_0x4832f7(0x168)](_0x4832f7(0x169),_0x2d09db);if(_0x4717ac!==0x1){const _0x33946d=[...new Set(_0x323ea7[_0x4832f7(0x17e)](_0x300916=>this[_0x4832f7(0x19f)](_0x300916[_0x4832f7(0x152)])))];await this[_0x4832f7(0x13f)](_0x165c28,_0xabdee8,[_0x4832f7(0x176)],_0x33946d,_0x4832f7(0x18f));const _0x23ccb7=_0x4832f7(0x18c)+_0x33946d[_0x4832f7(0x197)](',')+_0x4832f7(0x19a);throw new common_1['HttpException'](_0x23ccb7,common_1[_0x4832f7(0x15b)][_0x4832f7(0x147)]);}}async['nineaiCheckBadWords'](_0x37c88b,_0x218d7c,_0x12b44d){const _0x51724c=_0x58f81f;var _0x25e521;const {nineaiBuiltInSensitiveApiBase:_0x7bb413,nineaiBuiltInSensitiveAuthKey:_0x2273dc}=_0x218d7c;if(!_0x7bb413||!_0x2273dc)return;const _0x5034a2=await axios_1[_0x51724c(0x13c)][_0x51724c(0x14f)](_0x7bb413,{'content':_0x37c88b},{'headers':{'Content-Type':_0x51724c(0x149),'Authorization':_0x2273dc}});if(!_0x5034a2['data'])return;if(_0x5034a2[_0x51724c(0x160)][_0x51724c(0x146)]!=='0'){const {msg:msg=_0x51724c(0x14c)}=_0x5034a2['data'];throw new common_1[(_0x51724c(0x191))](_0x51724c(0x19b)+msg,common_1['HttpStatus'][_0x51724c(0x147)]);}if(_0x5034a2['data'][_0x51724c(0x18d)]&&((_0x25e521=_0x5034a2[_0x51724c(0x160)][_0x51724c(0x18d)])===null||_0x25e521===void 0x0?void 0x0:_0x25e521[_0x51724c(0x157)])){const _0x4918a7=[...new Set(_0x5034a2[_0x51724c(0x160)]['word_list'][_0x51724c(0x17e)](_0x2a5698=>_0x2a5698[_0x51724c(0x1ae)]))],_0x43a987=[...new Set(_0x5034a2['data']['word_list'][_0x51724c(0x17e)](_0x1da483=>_0x1da483[_0x51724c(0x186)]))];await this['recordUserBadWords'](_0x12b44d,_0x37c88b,_0x4918a7,_0x43a987,_0x51724c(0x16b));const _0x43597a=this[_0x51724c(0x180)](_0x5034a2[_0x51724c(0x160)][_0x51724c(0x18d)]);throw new common_1['HttpException'](_0x43597a,common_1[_0x51724c(0x15b)][_0x51724c(0x147)]);}}[_0x58f81f(0x180)](_0x452f02){const _0x2449df=_0x58f81f,_0xb335a7=_0x452f02[_0x2449df(0x17e)](_0x5d75cc=>_0x5d75cc[_0x2449df(0x186)]),_0xaff1e6=[...new Set(_0xb335a7)];return _0x2449df(0x1a6)+_0xaff1e6[_0x2449df(0x197)](',')+_0x2449df(0x161);}async[_0x58f81f(0x178)](){const _0x5ccb37=_0x58f81f,_0xa6bc06=await this[_0x5ccb37(0x167)][_0x5ccb37(0x159)]({'where':{'status':0x1},'select':['word']});this['badWords']=_0xa6bc06['map'](_0x146383=>_0x146383[_0x5ccb37(0x184)]);}async[_0x58f81f(0x150)](_0x33ef96){const _0x50696f=_0x58f81f,{page:page=0x1,size:size=0x1f4,word:_0x340810,status:_0x3b92a5}=_0x33ef96,_0x7601a3={};[0x0,0x1,'0','1'][_0x50696f(0x13b)](_0x3b92a5)&&(_0x7601a3['status']=_0x3b92a5),_0x340810&&(_0x7601a3[_0x50696f(0x184)]=(0x0,typeorm_1['Like'])('%'+_0x340810+'%'));const [_0x1bd47a,_0x3ab232]=await this['badWordsEntity'][_0x50696f(0x195)]({'where':_0x7601a3,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x50696f(0x171)}});return{'rows':_0x1bd47a,'count':_0x3ab232};}async[_0x58f81f(0x1a3)](_0x223d44){const _0x492a83=_0x58f81f,_0x5ba3c1=await this[_0x492a83(0x167)][_0x492a83(0x13d)]({'where':{'id':_0x223d44['id']}});if(!_0x5ba3c1)throw new common_1[(_0x492a83(0x191))](_0x492a83(0x1a5),common_1[_0x492a83(0x15b)][_0x492a83(0x147)]);const _0x3c00c3=await this[_0x492a83(0x167)][_0x492a83(0x17f)]({'id':_0x223d44['id']});if(_0x3c00c3['affected']>0x0)return await this['loadBadWords'](),_0x492a83(0x151);else throw new common_1[(_0x492a83(0x191))](_0x492a83(0x1ac),common_1[_0x492a83(0x15b)][_0x492a83(0x147)]);}async[_0x58f81f(0x142)](_0x3e969e){const _0x5d99f1=_0x58f81f,{id:_0x3d2c0c,word:_0x30aa47,status:_0x3c6049}=_0x3e969e,_0x252f4c=await this[_0x5d99f1(0x167)]['findOne']({'where':{'word':_0x30aa47}});if(_0x252f4c)throw new common_1['HttpException']('敏感词已经存在了、请勿重复添加',common_1[_0x5d99f1(0x15b)][_0x5d99f1(0x147)]);const _0x538c5=await this[_0x5d99f1(0x167)]['update']({'id':_0x3d2c0c},{'word':_0x30aa47,'status':_0x3c6049});if(_0x538c5[_0x5d99f1(0x145)]>0x0)return await this[_0x5d99f1(0x178)](),_0x5d99f1(0x156);else throw new common_1[(_0x5d99f1(0x191))](_0x5d99f1(0x155),common_1[_0x5d99f1(0x15b)][_0x5d99f1(0x147)]);}async[_0x58f81f(0x1af)](_0x957459){const _0x2e6a0a=_0x58f81f,{word:_0x11d5f6}=_0x957459,_0x126af1=await this[_0x2e6a0a(0x167)][_0x2e6a0a(0x13d)]({'where':{'word':_0x11d5f6}});if(_0x126af1)throw new common_1['HttpException'](_0x2e6a0a(0x17a),common_1[_0x2e6a0a(0x15b)][_0x2e6a0a(0x147)]);return await this[_0x2e6a0a(0x167)][_0x2e6a0a(0x192)]({'word':_0x11d5f6}),await this['loadBadWords'](),_0x2e6a0a(0x1a1);}async['recordUserBadWords'](_0x3fdbec,_0x9b5bd5,_0x435a59,_0xace9ca,_0x4053b3){const _0x417b86=_0x58f81f,_0x59155e={'userId':_0x3fdbec,'content':_0x9b5bd5,'words':JSON[_0x417b86(0x14d)](_0x435a59),'typeCn':JSON[_0x417b86(0x14d)](_0xace9ca),'typeOriginCn':_0x4053b3};try{await this[_0x417b86(0x193)][_0x417b86(0x1ad)]()[_0x417b86(0x14b)](user_entity_1[_0x417b86(0x174)])[_0x417b86(0x158)]({'violationCount':()=>_0x417b86(0x16c)})[_0x417b86(0x154)](_0x417b86(0x14e),{'userId':_0x3fdbec})[_0x417b86(0x19d)](),await this[_0x417b86(0x1a7)][_0x417b86(0x192)](_0x59155e);}catch(_0x83e9a0){console['log'](_0x417b86(0x15e),_0x83e9a0);}}async[_0x58f81f(0x187)](_0x585eeb,_0x20e2d4){const _0x119348=_0x58f81f,{role:_0x567d69}=_0x585eeb[_0x119348(0x1ab)],{page:page=0x1,size:size=0xa,userId:_0x2efa82,typeOriginCn:_0x3041e9}=_0x20e2d4,_0x37fd37={};_0x2efa82&&(_0x37fd37[_0x119348(0x18e)]=_0x2efa82),_0x3041e9&&(_0x37fd37[_0x119348(0x13e)]=_0x3041e9);const [_0x1beea1,_0x1f98aa]=await this[_0x119348(0x1a7)][_0x119348(0x195)]({'where':_0x37fd37,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x448efa=[...new Set(_0x1beea1[_0x119348(0x17e)](_0x3b7572=>_0x3b7572[_0x119348(0x18e)]))],_0xc72c44=await this['userEntity'][_0x119348(0x159)]({'where':{'id':(0x0,typeorm_1['In'])(_0x448efa)},'select':['id',_0x119348(0x17c),'username','email',_0x119348(0x162),_0x119348(0x144)]});return _0x1beea1['forEach'](_0x2a7026=>{const _0x5b8ef3=_0x119348,_0x13b859=_0xc72c44['find'](_0x4e56ac=>_0x4e56ac['id']===_0x2a7026[_0x5b8ef3(0x18e)]);_0x567d69!==_0x5b8ef3(0x140)&&(_0x13b859[_0x5b8ef3(0x183)]=(0x0,utils_1['hideString'])(_0x13b859[_0x5b8ef3(0x183)])),_0x2a7026[_0x5b8ef3(0x177)]=_0x13b859;}),{'rows':_0x1beea1,'count':_0x1f98aa};}};BadwordsService=__decorate([(0x0,common_1[_0x58f81f(0x1aa)])(),__param(0x0,(0x0,typeorm_2[_0x58f81f(0x175)])(badwords_entity_1[_0x58f81f(0x18a)])),__param(0x1,(0x0,typeorm_2[_0x58f81f(0x175)])(violationLog_entity_1[_0x58f81f(0x199)])),__param(0x2,(0x0,typeorm_2[_0x58f81f(0x175)])(user_entity_1[_0x58f81f(0x174)])),__metadata(_0x58f81f(0x1a9),[typeorm_1[_0x58f81f(0x1a4)],typeorm_1[_0x58f81f(0x1a4)],typeorm_1[_0x58f81f(0x1a4)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0x58f81f(0x15f)]=BadwordsService;function _0x2b19(){const _0x3e4862=['extractContent','__metadata','添加敏感词成功','__param','delBadWords','Repository','敏感词不存在,请检查您的提交信息','您提交的内容中包含','violationLogEntity','defineProperty','design:paramtypes','Injectable','user','删除敏感词失败','createQueryBuilder','keyword','addBadWord','../user/user.entity','includes','default','findOne','typeOriginCn','recordUserBadWords','super','baidu','updateBadWords','11XGAjBV','status','affected','code','BAD_REQUEST','getSensitiveConfig','application/json','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','update','检测失败','stringify','id\x20=\x20:userId','post','queryBadWords','删除敏感词成功','msg','axios','where','更新敏感词失败','更新敏感词成功','length','set','find','object','HttpStatus','自定义','baiduCheckBadWords','error:\x20','BadwordsService','data','的信息、我们已对您账号进行标记、请合规使用！','violationCount','1032YlzAqE','784390RkClvy','nineaiCheckBadWords','./badwords.entity','badWordsEntity','log','百度文本检测出现错误、请查看配置信息:\x20','1676274ygKrOX','NineAi检测','violationCount\x20+\x201','4vacRsB','checkBadWordsByConfig','自定义检测','application/x-www-form-urlencoded','ASC','decorate','48328hhomyU','UserEntity','InjectRepository','***','userInfo','loadBadWords','741478rpNaPu','敏感词已存在,请检查您的提交信息','customSensitiveWords','avatar','checkBadWords','map','delete','formarTips','15ossydA','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','email','word','function','category','violation','1154556RsWQHg','1263178srvcZr','BadWordsEntity','@nestjs/typeorm','您提交的信息中包含','word_list','userId','百度云检测','badWords','HttpException','save','userEntity','onModuleInit','findAndCount','baiduTextAccessToken','join','1260915MhQxKO','ViolationLogEntity','的内容、我们已对您的账户进行标记、请合规使用！','敏感词检测\x20|\x20','typeorm','execute','../globalConfig/globalConfig.service'];_0x2b19=function(){return _0x3e4862;};return _0x2b19();}