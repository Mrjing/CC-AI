'use strict';const _0x4dde6c=_0x204c;(function(_0x1b70e0,_0x16cfc0){const _0x270165=_0x204c,_0x303b0e=_0x1b70e0();while(!![]){try{const _0x266656=parseInt(_0x270165(0x195))/0x1*(parseInt(_0x270165(0x16f))/0x2)+-parseInt(_0x270165(0x146))/0x3*(-parseInt(_0x270165(0x159))/0x4)+parseInt(_0x270165(0x151))/0x5*(-parseInt(_0x270165(0x16e))/0x6)+parseInt(_0x270165(0x170))/0x7+-parseInt(_0x270165(0x135))/0x8+parseInt(_0x270165(0x183))/0x9*(parseInt(_0x270165(0x17a))/0xa)+-parseInt(_0x270165(0x178))/0xb;if(_0x266656===_0x16cfc0)break;else _0x303b0e['push'](_0x303b0e['shift']());}catch(_0x366b36){_0x303b0e['push'](_0x303b0e['shift']());}}}(_0x5ea2,0x50eb9));var __decorate=this&&this[_0x4dde6c(0x186)]||function(_0x1ed6a8,_0x5433c4,_0x28f4f7,_0x5db2ca){const _0x3a047d=_0x4dde6c;var _0x10f3fd=arguments[_0x3a047d(0x13d)],_0x1a70f4=_0x10f3fd<0x3?_0x5433c4:_0x5db2ca===null?_0x5db2ca=Object['getOwnPropertyDescriptor'](_0x5433c4,_0x28f4f7):_0x5db2ca,_0x35c99a;if(typeof Reflect===_0x3a047d(0x197)&&typeof Reflect[_0x3a047d(0x147)]==='function')_0x1a70f4=Reflect[_0x3a047d(0x147)](_0x1ed6a8,_0x5433c4,_0x28f4f7,_0x5db2ca);else{for(var _0x3aa15f=_0x1ed6a8[_0x3a047d(0x13d)]-0x1;_0x3aa15f>=0x0;_0x3aa15f--)if(_0x35c99a=_0x1ed6a8[_0x3aa15f])_0x1a70f4=(_0x10f3fd<0x3?_0x35c99a(_0x1a70f4):_0x10f3fd>0x3?_0x35c99a(_0x5433c4,_0x28f4f7,_0x1a70f4):_0x35c99a(_0x5433c4,_0x28f4f7))||_0x1a70f4;}return _0x10f3fd>0x3&&_0x1a70f4&&Object[_0x3a047d(0x13c)](_0x5433c4,_0x28f4f7,_0x1a70f4),_0x1a70f4;},__metadata=this&&this[_0x4dde6c(0x148)]||function(_0x4fa0b0,_0x1d8617){const _0x51a629=_0x4dde6c;if(typeof Reflect===_0x51a629(0x197)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x4fa0b0,_0x1d8617);},__param=this&&this['__param']||function(_0x15c2c4,_0x46540e){return function(_0x240255,_0x1c50eb){_0x46540e(_0x240255,_0x1c50eb,_0x15c2c4);};};Object[_0x4dde6c(0x13c)](exports,_0x4dde6c(0x171),{'value':!![]}),exports[_0x4dde6c(0x172)]=void 0x0;function _0x204c(_0x11071c,_0x4e8063){const _0x5ea2c3=_0x5ea2();return _0x204c=function(_0x204cb4,_0x4a2fb3){_0x204cb4=_0x204cb4-0x12d;let _0x3d45bd=_0x5ea2c3[_0x204cb4];return _0x3d45bd;},_0x204c(_0x11071c,_0x4e8063);}const globalConfig_service_1=require(_0x4dde6c(0x193)),common_1=require(_0x4dde6c(0x130)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x4dde6c(0x177)),typeorm_2=require(_0x4dde6c(0x152)),axios_1=require(_0x4dde6c(0x144)),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require('../user/user.entity'),utils_1=require('../../common/utils');let BadwordsService=class BadwordsService{constructor(_0x1b409e,_0x4a1cbf,_0xdcad3e,_0x3a213e){const _0x58e795=_0x4dde6c;this[_0x58e795(0x138)]=_0x1b409e,this[_0x58e795(0x17b)]=_0x4a1cbf,this[_0x58e795(0x158)]=_0xdcad3e,this[_0x58e795(0x167)]=_0x3a213e,this['badWords']=[];}async[_0x4dde6c(0x184)](){const _0x22e814=_0x4dde6c;this[_0x22e814(0x169)]();}async[_0x4dde6c(0x12e)](_0x25ecae,_0x25ce97){const _0x4bf2e0=_0x4dde6c,_0x2ffb37=[];for(let _0x21626b=0x0;_0x21626b<this[_0x4bf2e0(0x161)][_0x4bf2e0(0x13d)];_0x21626b++){const _0x5d6139=this['badWords'][_0x21626b];_0x25ecae[_0x4bf2e0(0x16d)](_0x5d6139)&&_0x2ffb37[_0x4bf2e0(0x141)](_0x5d6139);}if(_0x2ffb37[_0x4bf2e0(0x13d)]){await this[_0x4bf2e0(0x149)](_0x25ce97,_0x25ecae,_0x2ffb37,[_0x4bf2e0(0x12f)],_0x4bf2e0(0x18b));const _0x4bee64='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x4bee64,common_1[_0x4bf2e0(0x191)]['BAD_REQUEST']);}}async['checkBadWords'](_0xce2bf5,_0x35a885){const _0xf03150=_0x4dde6c,_0x71cf3d=await this[_0xf03150(0x167)][_0xf03150(0x15a)]();_0x71cf3d&&await this[_0xf03150(0x15f)](_0xce2bf5,_0x71cf3d,_0x35a885),await this[_0xf03150(0x12e)](_0xce2bf5,_0x35a885);}async[_0x4dde6c(0x15f)](_0x1a5fc1,_0x496836,_0x5edcb8){const _0x94361a=_0x4dde6c,{useType:_0x3bd62a}=_0x496836;_0x3bd62a===_0x94361a(0x136)&&await this['baiduCheckBadWords'](_0x1a5fc1,_0x496836[_0x94361a(0x143)],_0x5edcb8),_0x3bd62a==='nineai'&&await this[_0x94361a(0x15b)](_0x1a5fc1,_0x496836,_0x5edcb8);}['extractContent'](_0x302f5c){const _0x4023c4=_0x4dde6c,_0x157d82=/存在(.*?)不合规/,_0x100226=_0x302f5c[_0x4023c4(0x14b)](_0x157d82);return _0x100226?_0x100226[0x1]:'';}async[_0x4dde6c(0x165)](_0x2d3353,_0x2d50d4,_0x9697cc){const _0x4f7a54=_0x4dde6c;if(!_0x2d50d4)return;const _0x51211e=_0x4f7a54(0x192)+_0x2d50d4+'}',_0x89406d={'Content-Type':_0x4f7a54(0x19f),'Accept':_0x4f7a54(0x145)},_0x388a12=await axios_1[_0x4f7a54(0x155)][_0x4f7a54(0x15c)](_0x51211e,{'text':_0x2d3353},{'headers':_0x89406d}),{conclusion:_0x8a76ec,error_code:_0x28cbcf,error_msg:_0x36d363,conclusionType:_0x1a8f94,data:_0x3ef04a}=_0x388a12['data'];_0x28cbcf&&console[_0x4f7a54(0x13a)](_0x4f7a54(0x14e),_0x36d363);if(_0x1a8f94!==0x1){const _0x4ea817=[...new Set(_0x3ef04a['map'](_0x3c476d=>this['extractContent'](_0x3c476d[_0x4f7a54(0x140)])))];await this[_0x4f7a54(0x149)](_0x9697cc,_0x2d3353,[_0x4f7a54(0x17d)],_0x4ea817,_0x4f7a54(0x162));const _0x51d9bf=_0x4f7a54(0x150)+_0x4ea817['join'](',')+_0x4f7a54(0x196);throw new common_1['HttpException'](_0x51d9bf,common_1[_0x4f7a54(0x191)][_0x4f7a54(0x13b)]);}}async['nineaiCheckBadWords'](_0x5100ff,_0x53716b,_0x64e506){const _0x3c756f=_0x4dde6c;var _0x290e4a;const {nineaiBuiltInSensitiveApiBase:_0x402132,nineaiBuiltInSensitiveAuthKey:_0x5a9c74}=_0x53716b;if(!_0x402132||!_0x5a9c74)return;const _0x3a0aac=await axios_1[_0x3c756f(0x155)]['post'](_0x402132,{'content':_0x5100ff},{'headers':{'Content-Type':'application/json','Authorization':_0x5a9c74}});if(!_0x3a0aac[_0x3c756f(0x18e)])return;if(_0x3a0aac['data'][_0x3c756f(0x16b)]!=='0'){const {msg:msg=_0x3c756f(0x134)}=_0x3a0aac[_0x3c756f(0x18e)];throw new common_1[(_0x3c756f(0x190))](_0x3c756f(0x14f)+msg,common_1[_0x3c756f(0x191)]['BAD_REQUEST']);}if(_0x3a0aac[_0x3c756f(0x18e)][_0x3c756f(0x175)]&&((_0x290e4a=_0x3a0aac[_0x3c756f(0x18e)][_0x3c756f(0x175)])===null||_0x290e4a===void 0x0?void 0x0:_0x290e4a[_0x3c756f(0x13d)])){const _0x654e09=[...new Set(_0x3a0aac[_0x3c756f(0x18e)][_0x3c756f(0x175)][_0x3c756f(0x185)](_0x2f471c=>_0x2f471c[_0x3c756f(0x15d)]))],_0x55cfe3=[...new Set(_0x3a0aac[_0x3c756f(0x18e)][_0x3c756f(0x175)][_0x3c756f(0x185)](_0x3ade4f=>_0x3ade4f[_0x3c756f(0x163)]))];await this[_0x3c756f(0x149)](_0x64e506,_0x5100ff,_0x654e09,_0x55cfe3,_0x3c756f(0x18d));const _0x3ee8cc=this[_0x3c756f(0x133)](_0x3a0aac[_0x3c756f(0x18e)][_0x3c756f(0x175)]);throw new common_1[(_0x3c756f(0x190))](_0x3ee8cc,common_1['HttpStatus'][_0x3c756f(0x13b)]);}}[_0x4dde6c(0x133)](_0x5b6a9c){const _0x289d4f=_0x4dde6c,_0x1609f1=_0x5b6a9c[_0x289d4f(0x185)](_0xd41f0d=>_0xd41f0d['category']),_0x45b895=[...new Set(_0x1609f1)];return _0x289d4f(0x174)+_0x45b895[_0x289d4f(0x13e)](',')+_0x289d4f(0x18c);}async[_0x4dde6c(0x169)](){const _0x161c63=_0x4dde6c,_0x23df45=await this[_0x161c63(0x138)][_0x161c63(0x15e)]({'where':{'status':0x1},'select':[_0x161c63(0x14c)]});this[_0x161c63(0x161)]=_0x23df45[_0x161c63(0x185)](_0x1a30c2=>_0x1a30c2[_0x161c63(0x14c)]);}async[_0x4dde6c(0x198)](_0x1586f9){const _0x3fe5bd=_0x4dde6c,{page:page=0x1,size:size=0x1f4,word:_0x1bbae9,status:_0x1b07a5}=_0x1586f9,_0x13a71d={};[0x0,0x1,'0','1']['includes'](_0x1b07a5)&&(_0x13a71d[_0x3fe5bd(0x187)]=_0x1b07a5),_0x1bbae9&&(_0x13a71d[_0x3fe5bd(0x14c)]=(0x0,typeorm_1[_0x3fe5bd(0x18a)])('%'+_0x1bbae9+'%'));const [_0x55a8a4,_0x13b63d]=await this[_0x3fe5bd(0x138)]['findAndCount']({'where':_0x13a71d,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3fe5bd(0x180)}});return{'rows':_0x55a8a4,'count':_0x13b63d};}async[_0x4dde6c(0x179)](_0x56d619){const _0x37a069=_0x4dde6c,_0x2dab23=await this[_0x37a069(0x138)][_0x37a069(0x156)]({'where':{'id':_0x56d619['id']}});if(!_0x2dab23)throw new common_1['HttpException'](_0x37a069(0x139),common_1[_0x37a069(0x191)][_0x37a069(0x13b)]);const _0x1b794a=await this['badWordsEntity'][_0x37a069(0x173)]({'id':_0x56d619['id']});if(_0x1b794a['affected']>0x0)return await this[_0x37a069(0x169)](),_0x37a069(0x157);else throw new common_1[(_0x37a069(0x190))](_0x37a069(0x13f),common_1[_0x37a069(0x191)][_0x37a069(0x13b)]);}async[_0x4dde6c(0x19e)](_0x54b510){const _0x8ed939=_0x4dde6c,{id:_0x824f6,word:_0x248145,status:_0x478ed8}=_0x54b510,_0x242cae=await this['badWordsEntity'][_0x8ed939(0x156)]({'where':{'word':_0x248145}});if(_0x242cae)throw new common_1['HttpException']('敏感词已经存在了、请勿重复添加',common_1[_0x8ed939(0x191)][_0x8ed939(0x13b)]);const _0x597c9d=await this[_0x8ed939(0x138)][_0x8ed939(0x132)]({'id':_0x824f6},{'word':_0x248145,'status':_0x478ed8});if(_0x597c9d[_0x8ed939(0x14d)]>0x0)return await this['loadBadWords'](),'更新敏感词成功';else throw new common_1[(_0x8ed939(0x190))](_0x8ed939(0x194),common_1[_0x8ed939(0x191)][_0x8ed939(0x13b)]);}async[_0x4dde6c(0x164)](_0x4fa41f){const _0xcbfd86=_0x4dde6c,{word:_0x2f1680}=_0x4fa41f,_0x29aa9c=await this['badWordsEntity'][_0xcbfd86(0x156)]({'where':{'word':_0x2f1680}});if(_0x29aa9c)throw new common_1[(_0xcbfd86(0x190))](_0xcbfd86(0x18f),common_1[_0xcbfd86(0x191)]['BAD_REQUEST']);return await this[_0xcbfd86(0x138)][_0xcbfd86(0x168)]({'word':_0x2f1680}),await this[_0xcbfd86(0x169)](),'添加敏感词成功';}async[_0x4dde6c(0x149)](_0x7f6d78,_0x531a3b,_0x3e0e2f,_0x5c0e89,_0x569295){const _0x1d8570=_0x4dde6c,_0x28eb47={'userId':_0x7f6d78,'content':_0x531a3b,'words':JSON['stringify'](_0x3e0e2f),'typeCn':JSON[_0x1d8570(0x199)](_0x5c0e89),'typeOriginCn':_0x569295};try{await this['userEntity'][_0x1d8570(0x176)]()['update'](user_entity_1[_0x1d8570(0x17e)])[_0x1d8570(0x12d)]({'violationCount':()=>_0x1d8570(0x14a)})['where'](_0x1d8570(0x181),{'userId':_0x7f6d78})['execute'](),await this[_0x1d8570(0x17b)][_0x1d8570(0x168)](_0x28eb47);}catch(_0xdf38da){console['log'](_0x1d8570(0x17f),_0xdf38da);}}async['violation'](_0x2f2afc,_0x5f12c9){const _0x4397ab=_0x4dde6c,{role:_0x24d661}=_0x2f2afc[_0x4397ab(0x16a)],{page:page=0x1,size:size=0xa,userId:_0x130e2b,typeOriginCn:_0x21de90}=_0x5f12c9,_0x13d727={};_0x130e2b&&(_0x13d727[_0x4397ab(0x154)]=_0x130e2b),_0x21de90&&(_0x13d727[_0x4397ab(0x137)]=_0x21de90);const [_0x333524,_0x1872b1]=await this[_0x4397ab(0x17b)][_0x4397ab(0x17c)]({'where':_0x13d727,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4397ab(0x19b)}}),_0x46780f=[...new Set(_0x333524[_0x4397ab(0x185)](_0x58564a=>_0x58564a[_0x4397ab(0x154)]))],_0xb90270=await this[_0x4397ab(0x158)][_0x4397ab(0x15e)]({'where':{'id':(0x0,typeorm_1['In'])(_0x46780f)},'select':['id',_0x4397ab(0x153),_0x4397ab(0x1a0),_0x4397ab(0x142),_0x4397ab(0x19d),_0x4397ab(0x187)]});return _0x333524[_0x4397ab(0x188)](_0x52c001=>{const _0x4ba87e=_0x4397ab,_0x54ac36=_0xb90270[_0x4ba87e(0x15e)](_0x398859=>_0x398859['id']===_0x52c001['userId']);_0x24d661!==_0x4ba87e(0x160)&&(_0x54ac36['email']=(0x0,utils_1[_0x4ba87e(0x182)])(_0x54ac36[_0x4ba87e(0x142)])),_0x52c001[_0x4ba87e(0x189)]=_0x54ac36;}),{'rows':_0x333524,'count':_0x1872b1};}};BadwordsService=__decorate([(0x0,common_1[_0x4dde6c(0x131)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x4dde6c(0x16c)])),__param(0x1,(0x0,typeorm_2[_0x4dde6c(0x166)])(violationLog_entity_1[_0x4dde6c(0x19c)])),__param(0x2,(0x0,typeorm_2['InjectRepository'])(user_entity_1[_0x4dde6c(0x17e)])),__metadata('design:paramtypes',[typeorm_1['Repository'],typeorm_1[_0x4dde6c(0x19a)],typeorm_1[_0x4dde6c(0x19a)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports['BadwordsService']=BadwordsService;function _0x5ea2(){const _0x489415=['typeOriginCn','badWordsEntity','敏感词不存在,请检查您的提交信息','log','BAD_REQUEST','defineProperty','length','join','删除敏感词失败','msg','push','email','baiduTextAccessToken','axios','application/json','7902jvidOK','decorate','__metadata','recordUserBadWords','violationCount\x20+\x201','match','word','affected','百度文本检测出现错误、请查看配置信息:\x20','敏感词检测\x20|\x20','您提交的信息中包含','6225yChAdO','@nestjs/typeorm','avatar','userId','default','findOne','删除敏感词成功','userEntity','620sdZbCP','getSensitiveConfig','nineaiCheckBadWords','post','keyword','find','checkBadWordsByConfig','super','badWords','百度云检测','category','addBadWord','baiduCheckBadWords','InjectRepository','globalConfigService','save','loadBadWords','user','code','BadWordsEntity','includes','96SYNfnn','302dQFKEZ','4447695QoPLOJ','__esModule','BadwordsService','delete','您提交的内容中包含','word_list','createQueryBuilder','typeorm','5564218vmIwId','delBadWords','6770BPfelj','violationLogEntity','findAndCount','***','UserEntity','error:\x20','ASC','id\x20=\x20:userId','hideString','1791dmiBYW','onModuleInit','map','__decorate','status','forEach','userInfo','Like','自定义检测','的信息、我们已对您账号进行标记、请合规使用！','NineAi检测','data','敏感词已存在,请检查您的提交信息','HttpException','HttpStatus','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','../globalConfig/globalConfig.service','更新敏感词失败','315ZqDFuP','的内容、我们已对您的账户进行标记、请合规使用！','object','queryBadWords','stringify','Repository','DESC','ViolationLogEntity','violationCount','updateBadWords','application/x-www-form-urlencoded','username','set','customSensitiveWords','自定义','@nestjs/common','Injectable','update','formarTips','检测失败','2949888niKNxD','baidu'];_0x5ea2=function(){return _0x489415;};return _0x5ea2();}