'use strict';const _0x4df87c=_0x5233;(function(_0x32b775,_0xc1271){const _0x5830b1=_0x5233,_0x4251c9=_0x32b775();while(!![]){try{const _0x56cf7b=-parseInt(_0x5830b1(0xe6))/0x1*(parseInt(_0x5830b1(0x8b))/0x2)+parseInt(_0x5830b1(0xb6))/0x3*(-parseInt(_0x5830b1(0xe0))/0x4)+-parseInt(_0x5830b1(0xd5))/0x5*(-parseInt(_0x5830b1(0xb2))/0x6)+parseInt(_0x5830b1(0xbd))/0x7+-parseInt(_0x5830b1(0x88))/0x8*(-parseInt(_0x5830b1(0x8a))/0x9)+parseInt(_0x5830b1(0xe9))/0xa*(parseInt(_0x5830b1(0xe1))/0xb)+parseInt(_0x5830b1(0xb7))/0xc*(-parseInt(_0x5830b1(0x8c))/0xd);if(_0x56cf7b===_0xc1271)break;else _0x4251c9['push'](_0x4251c9['shift']());}catch(_0x2b8f0e){_0x4251c9['push'](_0x4251c9['shift']());}}}(_0x89ce,0x67e22));var __decorate=this&&this[_0x4df87c(0x89)]||function(_0x4066b1,_0x5470da,_0x161bde,_0x1a29de){const _0x2f21a3=_0x4df87c;var _0x459548=arguments[_0x2f21a3(0x91)],_0x266cd9=_0x459548<0x3?_0x5470da:_0x1a29de===null?_0x1a29de=Object[_0x2f21a3(0xa3)](_0x5470da,_0x161bde):_0x1a29de,_0xa95499;if(typeof Reflect===_0x2f21a3(0x9d)&&typeof Reflect[_0x2f21a3(0x84)]===_0x2f21a3(0xf7))_0x266cd9=Reflect[_0x2f21a3(0x84)](_0x4066b1,_0x5470da,_0x161bde,_0x1a29de);else{for(var _0x3ee091=_0x4066b1['length']-0x1;_0x3ee091>=0x0;_0x3ee091--)if(_0xa95499=_0x4066b1[_0x3ee091])_0x266cd9=(_0x459548<0x3?_0xa95499(_0x266cd9):_0x459548>0x3?_0xa95499(_0x5470da,_0x161bde,_0x266cd9):_0xa95499(_0x5470da,_0x161bde))||_0x266cd9;}return _0x459548>0x3&&_0x266cd9&&Object['defineProperty'](_0x5470da,_0x161bde,_0x266cd9),_0x266cd9;},__metadata=this&&this[_0x4df87c(0xee)]||function(_0x4c54f9,_0x548bb9){const _0x4c0687=_0x4df87c;if(typeof Reflect===_0x4c0687(0x9d)&&typeof Reflect[_0x4c0687(0xcd)]===_0x4c0687(0xf7))return Reflect[_0x4c0687(0xcd)](_0x4c54f9,_0x548bb9);},__param=this&&this['__param']||function(_0x3e7e5a,_0x1d8eaa){return function(_0x287120,_0x116cad){_0x1d8eaa(_0x287120,_0x116cad,_0x3e7e5a);};};Object['defineProperty'](exports,_0x4df87c(0xc9),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x4df87c(0xa9)),common_1=require(_0x4df87c(0xba)),badwords_entity_1=require(_0x4df87c(0x92)),typeorm_1=require(_0x4df87c(0xaa)),typeorm_2=require(_0x4df87c(0xf4)),axios_1=require(_0x4df87c(0xdb)),violationLog_entity_1=require(_0x4df87c(0xa8)),user_entity_1=require('../user/user.entity'),utils_1=require(_0x4df87c(0xb5));function _0x5233(_0x2eda99,_0x9e58fc){const _0x89ce0e=_0x89ce();return _0x5233=function(_0x52337e,_0xfa4bdd){_0x52337e=_0x52337e-0x83;let _0x46f249=_0x89ce0e[_0x52337e];return _0x46f249;},_0x5233(_0x2eda99,_0x9e58fc);}let BadwordsService=class BadwordsService{constructor(_0x1210a2,_0x301cde,_0x41a2e8,_0x4f0bc4){const _0x23f38f=_0x4df87c;this['badWordsEntity']=_0x1210a2,this[_0x23f38f(0xaf)]=_0x301cde,this[_0x23f38f(0x9b)]=_0x41a2e8,this[_0x23f38f(0xec)]=_0x4f0bc4,this['badWords']=[];}async[_0x4df87c(0xd0)](){this['loadBadWords']();}async[_0x4df87c(0xd1)](_0x4365d2,_0x5015f6){const _0x1eb6ee=_0x4df87c,_0x57d0da=[];for(let _0x587c8e=0x0;_0x587c8e<this[_0x1eb6ee(0xa5)]['length'];_0x587c8e++){const _0x9c5792=this[_0x1eb6ee(0xa5)][_0x587c8e];_0x4365d2[_0x1eb6ee(0x8e)](_0x9c5792)&&_0x57d0da[_0x1eb6ee(0xa7)](_0x9c5792);}if(_0x57d0da[_0x1eb6ee(0x91)]){await this['recordUserBadWords'](_0x5015f6,_0x4365d2,_0x57d0da,[_0x1eb6ee(0xd8)],_0x1eb6ee(0x86));const _0x56befe=_0x1eb6ee(0xd2);throw new common_1[(_0x1eb6ee(0xc6))](_0x56befe,common_1[_0x1eb6ee(0xc5)][_0x1eb6ee(0xbb)]);}}async[_0x4df87c(0xd7)](_0x211772,_0x2ae60c){const _0x2755e3=_0x4df87c,_0x2ea523=await this[_0x2755e3(0xec)]['getSensitiveConfig']();_0x2ea523&&await this[_0x2755e3(0xdf)](_0x211772,_0x2ea523,_0x2ae60c),await this[_0x2755e3(0xd1)](_0x211772,_0x2ae60c);}async[_0x4df87c(0xdf)](_0xbe271a,_0x18e46d,_0x31c037){const _0x3664fd=_0x4df87c,{useType:_0x1367d8}=_0x18e46d;_0x1367d8===_0x3664fd(0x98)&&await this[_0x3664fd(0xa1)](_0xbe271a,_0x18e46d['baiduTextAccessToken'],_0x31c037),_0x1367d8==='nineai'&&await this[_0x3664fd(0xea)](_0xbe271a,_0x18e46d,_0x31c037);}[_0x4df87c(0xe5)](_0x389949){const _0x2c4498=_0x4df87c,_0x1c7b6c=/存在(.*?)不合规/,_0x3feede=_0x389949[_0x2c4498(0xf0)](_0x1c7b6c);return _0x3feede?_0x3feede[0x1]:'';}async[_0x4df87c(0xa1)](_0x1ebafd,_0x7efd6d,_0x4480e8){const _0x41ffdc=_0x4df87c;if(!_0x7efd6d)return;const _0x3fddf9=_0x41ffdc(0xc1)+_0x7efd6d+'}',_0x2732d6={'Content-Type':_0x41ffdc(0x85),'Accept':'application/json'},_0x348b63=await axios_1[_0x41ffdc(0xe2)][_0x41ffdc(0xd6)](_0x3fddf9,{'text':_0x1ebafd},{'headers':_0x2732d6}),{conclusion:_0x3f7c63,error_code:_0x506c19,error_msg:_0x5bfb51,conclusionType:_0x592d9a,data:_0x57aacd}=_0x348b63[_0x41ffdc(0xbc)];_0x506c19&&console[_0x41ffdc(0xc0)](_0x41ffdc(0xcf),_0x5bfb51);if(_0x592d9a!==0x1){const _0x3aa522=[...new Set(_0x57aacd[_0x41ffdc(0xae)](_0x44530d=>this[_0x41ffdc(0xe5)](_0x44530d['msg'])))];await this['recordUserBadWords'](_0x4480e8,_0x1ebafd,[_0x41ffdc(0xce)],_0x3aa522,_0x41ffdc(0xef));const _0x48cb62=_0x41ffdc(0x90)+_0x3aa522[_0x41ffdc(0xc7)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x48cb62,common_1[_0x41ffdc(0xc5)][_0x41ffdc(0xbb)]);}}async[_0x4df87c(0xea)](_0xdedc05,_0x101a50,_0x3e23f6){const _0x1db23f=_0x4df87c;var _0x58c192;const {nineaiBuiltInSensitiveApiBase:_0x400734,nineaiBuiltInSensitiveAuthKey:_0xfe1050}=_0x101a50;if(!_0x400734||!_0xfe1050)return;const _0x4affb3=await axios_1[_0x1db23f(0xe2)][_0x1db23f(0xd6)](_0x400734,{'content':_0xdedc05},{'headers':{'Content-Type':_0x1db23f(0x99),'Authorization':_0xfe1050}});if(!_0x4affb3['data'])return;if(_0x4affb3[_0x1db23f(0xbc)][_0x1db23f(0xab)]!=='0'){const {msg:msg=_0x1db23f(0x87)}=_0x4affb3[_0x1db23f(0xbc)];throw new common_1[(_0x1db23f(0xc6))](_0x1db23f(0xde)+msg,common_1[_0x1db23f(0xc5)]['BAD_REQUEST']);}if(_0x4affb3[_0x1db23f(0xbc)]['word_list']&&((_0x58c192=_0x4affb3[_0x1db23f(0xbc)][_0x1db23f(0x9a)])===null||_0x58c192===void 0x0?void 0x0:_0x58c192[_0x1db23f(0x91)])){const _0x2e19ab=[...new Set(_0x4affb3['data'][_0x1db23f(0x9a)][_0x1db23f(0xae)](_0x3fd02b=>_0x3fd02b[_0x1db23f(0x9f)]))],_0x437b74=[...new Set(_0x4affb3[_0x1db23f(0xbc)][_0x1db23f(0x9a)][_0x1db23f(0xae)](_0x236f37=>_0x236f37['category']))];await this[_0x1db23f(0x93)](_0x3e23f6,_0xdedc05,_0x2e19ab,_0x437b74,_0x1db23f(0xeb));const _0x26fbde=this[_0x1db23f(0xe8)](_0x4affb3[_0x1db23f(0xbc)][_0x1db23f(0x9a)]);throw new common_1['HttpException'](_0x26fbde,common_1[_0x1db23f(0xc5)]['BAD_REQUEST']);}}[_0x4df87c(0xe8)](_0x5b1046){const _0x27484c=_0x4df87c,_0x15cd75=_0x5b1046[_0x27484c(0xae)](_0x2efd15=>_0x2efd15['category']),_0x462468=[...new Set(_0x15cd75)];return _0x27484c(0xdd)+_0x462468[_0x27484c(0xc7)](',')+_0x27484c(0x94);}async[_0x4df87c(0xb9)](){const _0x2e9ba8=_0x4df87c,_0x30c004=await this[_0x2e9ba8(0xa0)][_0x2e9ba8(0xc8)]({'where':{'status':0x1},'select':[_0x2e9ba8(0xf5)]});this['badWords']=_0x30c004['map'](_0xe905de=>_0xe905de[_0x2e9ba8(0xf5)]);}async['queryBadWords'](_0x58684d){const _0x5c3015=_0x4df87c,{page:page=0x1,size:size=0x1f4,word:_0x1e30ac,status:_0x29afac}=_0x58684d,_0x5cc507={};[0x0,0x1,'0','1'][_0x5c3015(0x8e)](_0x29afac)&&(_0x5cc507['status']=_0x29afac),_0x1e30ac&&(_0x5cc507[_0x5c3015(0xf5)]=(0x0,typeorm_1[_0x5c3015(0xd4)])('%'+_0x1e30ac+'%'));const [_0x233acc,_0x144b3b]=await this[_0x5c3015(0xa0)][_0x5c3015(0xe3)]({'where':_0x5cc507,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x233acc,'count':_0x144b3b};}async[_0x4df87c(0xb4)](_0x19668c){const _0x58aebf=_0x4df87c,_0x521cfe=await this['badWordsEntity'][_0x58aebf(0xc2)]({'where':{'id':_0x19668c['id']}});if(!_0x521cfe)throw new common_1[(_0x58aebf(0xc6))](_0x58aebf(0xda),common_1['HttpStatus'][_0x58aebf(0xbb)]);const _0x22e124=await this[_0x58aebf(0xa0)][_0x58aebf(0xf1)]({'id':_0x19668c['id']});if(_0x22e124[_0x58aebf(0xca)]>0x0)return await this[_0x58aebf(0xb9)](),_0x58aebf(0xed);else throw new common_1[(_0x58aebf(0xc6))](_0x58aebf(0x96),common_1[_0x58aebf(0xc5)][_0x58aebf(0xbb)]);}async[_0x4df87c(0x9e)](_0x283f75){const _0x32c5cc=_0x4df87c,{id:_0x46c640,word:_0x2a0737,status:_0x12167d}=_0x283f75,_0x3833f7=await this[_0x32c5cc(0xa0)][_0x32c5cc(0xc2)]({'where':{'word':_0x2a0737}});if(_0x3833f7)throw new common_1[(_0x32c5cc(0xc6))](_0x32c5cc(0xad),common_1[_0x32c5cc(0xc5)][_0x32c5cc(0xbb)]);const _0x1a75f8=await this[_0x32c5cc(0xa0)][_0x32c5cc(0x9c)]({'id':_0x46c640},{'word':_0x2a0737,'status':_0x12167d});if(_0x1a75f8['affected']>0x0)return await this[_0x32c5cc(0xb9)](),_0x32c5cc(0xc4);else throw new common_1['HttpException'](_0x32c5cc(0xdc),common_1[_0x32c5cc(0xc5)][_0x32c5cc(0xbb)]);}async[_0x4df87c(0xb8)](_0x4a685b){const _0x512faa=_0x4df87c,{word:_0x1b0b7f}=_0x4a685b,_0x312375=await this[_0x512faa(0xa0)][_0x512faa(0xc2)]({'where':{'word':_0x1b0b7f}});if(_0x312375)throw new common_1[(_0x512faa(0xc6))](_0x512faa(0xd3),common_1[_0x512faa(0xc5)][_0x512faa(0xbb)]);return await this[_0x512faa(0xa0)][_0x512faa(0xb0)]({'word':_0x1b0b7f}),await this[_0x512faa(0xb9)](),_0x512faa(0xb3);}async['recordUserBadWords'](_0xda245,_0x2d5430,_0x1a2b84,_0x511ad3,_0x336eb3){const _0xb8b690=_0x4df87c,_0x316c58={'userId':_0xda245,'content':_0x2d5430,'words':JSON['stringify'](_0x1a2b84),'typeCn':JSON['stringify'](_0x511ad3),'typeOriginCn':_0x336eb3};try{await this['userEntity']['createQueryBuilder']()[_0xb8b690(0x9c)](user_entity_1['UserEntity'])['set']({'violationCount':()=>_0xb8b690(0xe7)})[_0xb8b690(0xa2)](_0xb8b690(0xb1),{'userId':_0xda245})[_0xb8b690(0x8f)](),await this[_0xb8b690(0xaf)][_0xb8b690(0xb0)](_0x316c58);}catch(_0x668cc9){console['log'](_0xb8b690(0xd9),_0x668cc9);}}async[_0x4df87c(0xe4)](_0x46da05,_0x890b47){const _0x3fd3eb=_0x4df87c,{role:_0x2e4ec9}=_0x46da05['user'],{page:page=0x1,size:size=0xa,userId:_0x4613b8,typeOriginCn:_0x3c91f9}=_0x890b47,_0x3bd4d4={};_0x4613b8&&(_0x3bd4d4[_0x3fd3eb(0xc3)]=_0x4613b8),_0x3c91f9&&(_0x3bd4d4[_0x3fd3eb(0x83)]=_0x3c91f9);const [_0x5588c2,_0x45941f]=await this[_0x3fd3eb(0xaf)][_0x3fd3eb(0xe3)]({'where':_0x3bd4d4,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3fd3eb(0x8d)}}),_0xa74574=[...new Set(_0x5588c2[_0x3fd3eb(0xae)](_0x2af515=>_0x2af515[_0x3fd3eb(0xc3)]))],_0x5d6871=await this[_0x3fd3eb(0x9b)][_0x3fd3eb(0xc8)]({'where':{'id':(0x0,typeorm_1['In'])(_0xa74574)},'select':['id','avatar','username','email',_0x3fd3eb(0xcb),_0x3fd3eb(0xbf)]});return _0x5588c2[_0x3fd3eb(0xf6)](_0x31839e=>{const _0x357e79=_0x3fd3eb,_0x3037eb=_0x5d6871[_0x357e79(0xc8)](_0x1ded76=>_0x1ded76['id']===_0x31839e[_0x357e79(0xc3)]);_0x2e4ec9!==_0x357e79(0xf2)&&(_0x3037eb[_0x357e79(0xf3)]=(0x0,utils_1[_0x357e79(0xac)])(_0x3037eb[_0x357e79(0xf3)])),_0x31839e['userInfo']=_0x3037eb;}),{'rows':_0x5588c2,'count':_0x45941f};}};function _0x89ce(){const _0x2aa295=['checkBadWordsByConfig','8084pcGGpD','11aHUKeZ','default','findAndCount','violation','extractContent','2lkdFkD','violationCount\x20+\x201','formarTips','2354010VbSsAp','nineaiCheckBadWords','NineAi检测','globalConfigService','删除敏感词成功','__metadata','百度云检测','match','delete','super','email','@nestjs/typeorm','word','forEach','function','typeOriginCn','decorate','application/x-www-form-urlencoded','自定义检测','检测失败','46808jccFHi','__decorate','1143NLiUCJ','207970wlasGA','458484AlUXTD','DESC','includes','execute','您提交的信息中包含','length','./badwords.entity','recordUserBadWords','的信息、我们已对您账号进行标记、请合规使用！','Repository','删除敏感词失败','BadWordsEntity','baidu','application/json','word_list','userEntity','update','object','updateBadWords','keyword','badWordsEntity','baiduCheckBadWords','where','getOwnPropertyDescriptor','Injectable','badWords','UserEntity','push','./violationLog.entity','../globalConfig/globalConfig.service','typeorm','code','hideString','敏感词已经存在了、请勿重复添加','map','violationLogEntity','save','id\x20=\x20:userId','138yLYLQS','添加敏感词成功','delBadWords','../../common/utils','1167QuUWdJ','72Bxnpbw','addBadWord','loadBadWords','@nestjs/common','BAD_REQUEST','data','4373166XKbNuC','InjectRepository','status','log','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','findOne','userId','更新敏感词成功','HttpStatus','HttpException','join','find','__esModule','affected','violationCount','design:paramtypes','metadata','***','百度文本检测出现错误、请查看配置信息:\x20','onModuleInit','customSensitiveWords','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','敏感词已存在,请检查您的提交信息','Like','6095NhiNgz','post','checkBadWords','自定义','error:\x20','敏感词不存在,请检查您的提交信息','axios','更新敏感词失败','您提交的内容中包含','敏感词检测\x20|\x20'];_0x89ce=function(){return _0x2aa295;};return _0x89ce();}BadwordsService=__decorate([(0x0,common_1[_0x4df87c(0xa4)])(),__param(0x0,(0x0,typeorm_2[_0x4df87c(0xbe)])(badwords_entity_1[_0x4df87c(0x97)])),__param(0x1,(0x0,typeorm_2[_0x4df87c(0xbe)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x4df87c(0xbe)])(user_entity_1[_0x4df87c(0xa6)])),__metadata(_0x4df87c(0xcc),[typeorm_1[_0x4df87c(0x95)],typeorm_1['Repository'],typeorm_1[_0x4df87c(0x95)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports['BadwordsService']=BadwordsService;