'use strict';const _0x377182=_0x40a4;(function(_0x1f71fe,_0x7e023e){const _0x857eef=_0x40a4,_0x41aa42=_0x1f71fe();while(!![]){try{const _0x262690=parseInt(_0x857eef(0x11f))/0x1*(parseInt(_0x857eef(0xf4))/0x2)+parseInt(_0x857eef(0x13c))/0x3+-parseInt(_0x857eef(0x11a))/0x4+-parseInt(_0x857eef(0xff))/0x5*(parseInt(_0x857eef(0x124))/0x6)+-parseInt(_0x857eef(0x127))/0x7*(-parseInt(_0x857eef(0x115))/0x8)+parseInt(_0x857eef(0xd2))/0x9+-parseInt(_0x857eef(0x108))/0xa;if(_0x262690===_0x7e023e)break;else _0x41aa42['push'](_0x41aa42['shift']());}catch(_0x5c43a3){_0x41aa42['push'](_0x41aa42['shift']());}}}(_0xbd28,0x9c17b));function _0x40a4(_0x562b11,_0x478ac9){const _0xbd2832=_0xbd28();return _0x40a4=function(_0x40a468,_0x358080){_0x40a468=_0x40a468-0xd2;let _0x3b0be9=_0xbd2832[_0x40a468];return _0x3b0be9;},_0x40a4(_0x562b11,_0x478ac9);}var __decorate=this&&this['__decorate']||function(_0x31acf7,_0x1c6296,_0x4b33cf,_0x327c56){const _0x142190=_0x40a4;var _0x4ec859=arguments['length'],_0x50afc1=_0x4ec859<0x3?_0x1c6296:_0x327c56===null?_0x327c56=Object[_0x142190(0xe5)](_0x1c6296,_0x4b33cf):_0x327c56,_0xb68c6b;if(typeof Reflect===_0x142190(0x103)&&typeof Reflect['decorate']===_0x142190(0x12d))_0x50afc1=Reflect[_0x142190(0x139)](_0x31acf7,_0x1c6296,_0x4b33cf,_0x327c56);else{for(var _0x1edb44=_0x31acf7[_0x142190(0x100)]-0x1;_0x1edb44>=0x0;_0x1edb44--)if(_0xb68c6b=_0x31acf7[_0x1edb44])_0x50afc1=(_0x4ec859<0x3?_0xb68c6b(_0x50afc1):_0x4ec859>0x3?_0xb68c6b(_0x1c6296,_0x4b33cf,_0x50afc1):_0xb68c6b(_0x1c6296,_0x4b33cf))||_0x50afc1;}return _0x4ec859>0x3&&_0x50afc1&&Object['defineProperty'](_0x1c6296,_0x4b33cf,_0x50afc1),_0x50afc1;},__metadata=this&&this[_0x377182(0xe3)]||function(_0xed6f15,_0x1f6b5a){const _0x140626=_0x377182;if(typeof Reflect===_0x140626(0x103)&&typeof Reflect['metadata']===_0x140626(0x12d))return Reflect[_0x140626(0xf5)](_0xed6f15,_0x1f6b5a);},__param=this&&this[_0x377182(0x12a)]||function(_0x1a4300,_0x145a79){return function(_0x3deeea,_0x5a8eb6){_0x145a79(_0x3deeea,_0x5a8eb6,_0x1a4300);};};function _0xbd28(){const _0xa7c6=['user','post','9920619zvXKud','ViolationLogEntity','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','../user/user.entity','forEach','createQueryBuilder','HttpException','loadBadWords','badWords','error:\x20','word_list','delete','default','stringify','affected','nineaiCheckBadWords','删除敏感词失败','__metadata','super','getOwnPropertyDescriptor','keyword','globalConfigService','map','delBadWords','recordUserBadWords','UserEntity','violationLogEntity','avatar','的内容、我们已对您的账户进行标记、请合规使用！','log','./violationLog.entity','category','violationCount\x20+\x201','GlobalConfigService','4GMzXNg','metadata','删除敏感词成功','design:paramtypes','checkBadWordsByConfig','您提交的内容中包含','更新敏感词成功','status','findAndCount','execute','defineProperty','40JGqAKs','length','push','application/x-www-form-urlencoded','object','formarTips','find','@nestjs/common','application/json','12113910exGMMj','join','extractContent','Like','badWordsEntity','id\x20=\x20:userId','userId','email','where','hideString','set','match','username','3400008wOJBZd','checkBadWords','data','敏感词已存在,请检查您的提交信息','../../common/utils','568548vsEODF','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','save','自定义','BadwordsService','178964JJFZbF','自定义检测','nineai','word','添加敏感词成功','65352HSKmrP','typeorm','敏感词已经存在了、请勿重复添加','7DRMPDy','baiduCheckBadWords','@nestjs/typeorm','__param','findOne','../globalConfig/globalConfig.service','function','update','customSensitiveWords','BAD_REQUEST','userEntity','violation','NineAi检测','includes','./badwords.entity','typeOriginCn','Injectable','Repository','decorate','ASC','InjectRepository','584397iEamrt','DESC','HttpStatus','violationCount','queryBadWords','您提交的信息中包含','百度云检测'];_0xbd28=function(){return _0xa7c6;};return _0xbd28();}Object[_0x377182(0xfe)](exports,'__esModule',{'value':!![]}),exports[_0x377182(0x11e)]=void 0x0;const globalConfig_service_1=require(_0x377182(0x12c)),common_1=require(_0x377182(0x106)),badwords_entity_1=require(_0x377182(0x135)),typeorm_1=require(_0x377182(0x125)),typeorm_2=require(_0x377182(0x129)),axios_1=require('axios'),violationLog_entity_1=require(_0x377182(0xf0)),user_entity_1=require(_0x377182(0xd5)),utils_1=require(_0x377182(0x119));let BadwordsService=class BadwordsService{constructor(_0x121c8f,_0x2ac486,_0x2525ac,_0x4994ef){const _0x592615=_0x377182;this[_0x592615(0x10c)]=_0x121c8f,this[_0x592615(0xec)]=_0x2ac486,this[_0x592615(0x131)]=_0x2525ac,this[_0x592615(0xe7)]=_0x4994ef,this['badWords']=[];}async['onModuleInit'](){this['loadBadWords']();}async[_0x377182(0x12f)](_0x1b42a9,_0x3d5719){const _0x5d904a=_0x377182,_0x1897c6=[];for(let _0x20121c=0x0;_0x20121c<this[_0x5d904a(0xda)][_0x5d904a(0x100)];_0x20121c++){const _0x11d26b=this[_0x5d904a(0xda)][_0x20121c];_0x1b42a9['includes'](_0x11d26b)&&_0x1897c6[_0x5d904a(0x101)](_0x11d26b);}if(_0x1897c6[_0x5d904a(0x100)]){await this['recordUserBadWords'](_0x3d5719,_0x1b42a9,_0x1897c6,[_0x5d904a(0x11d)],_0x5d904a(0x120));const _0xe323f6=_0x5d904a(0xd4);throw new common_1[(_0x5d904a(0xd8))](_0xe323f6,common_1['HttpStatus'][_0x5d904a(0x130)]);}}async[_0x377182(0x116)](_0x244fe4,_0x424a6e){const _0x5292fc=_0x377182,_0x3516c4=await this[_0x5292fc(0xe7)]['getSensitiveConfig']();_0x3516c4&&await this['checkBadWordsByConfig'](_0x244fe4,_0x3516c4,_0x424a6e),await this[_0x5292fc(0x12f)](_0x244fe4,_0x424a6e);}async[_0x377182(0xf8)](_0x566e90,_0x3ced5e,_0x57cb6b){const _0x6f077e=_0x377182,{useType:_0x3c8710}=_0x3ced5e;_0x3c8710==='baidu'&&await this[_0x6f077e(0x128)](_0x566e90,_0x3ced5e['baiduTextAccessToken'],_0x57cb6b),_0x3c8710===_0x6f077e(0x121)&&await this[_0x6f077e(0xe1)](_0x566e90,_0x3ced5e,_0x57cb6b);}[_0x377182(0x10a)](_0x232793){const _0x2f799d=_0x377182,_0x3fdd90=/存在(.*?)不合规/,_0x3c6deb=_0x232793[_0x2f799d(0x113)](_0x3fdd90);return _0x3c6deb?_0x3c6deb[0x1]:'';}async[_0x377182(0x128)](_0x1f6af0,_0x473206,_0x2f5e70){const _0x1981e7=_0x377182;if(!_0x473206)return;const _0x3c2627=_0x1981e7(0x11b)+_0x473206+'}',_0x326cbd={'Content-Type':_0x1981e7(0x102),'Accept':_0x1981e7(0x107)},_0x1d35ca=await axios_1[_0x1981e7(0xde)][_0x1981e7(0x144)](_0x3c2627,{'text':_0x1f6af0},{'headers':_0x326cbd}),{conclusion:_0x23cf1d,error_code:_0x56dac0,error_msg:_0x5d841f,conclusionType:_0x1be669,data:_0x3dbefc}=_0x1d35ca[_0x1981e7(0x117)];_0x56dac0&&console['log']('百度文本检测出现错误、请查看配置信息:\x20',_0x5d841f);if(_0x1be669!==0x1){const _0x2c0ee0=[...new Set(_0x3dbefc[_0x1981e7(0xe8)](_0x43b950=>this['extractContent'](_0x43b950['msg'])))];await this[_0x1981e7(0xea)](_0x2f5e70,_0x1f6af0,['***'],_0x2c0ee0,_0x1981e7(0x142));const _0xf42b4c=_0x1981e7(0x141)+_0x2c0ee0[_0x1981e7(0x109)](',')+_0x1981e7(0xee);throw new common_1['HttpException'](_0xf42b4c,common_1[_0x1981e7(0x13e)][_0x1981e7(0x130)]);}}async[_0x377182(0xe1)](_0x30850f,_0x54f9bc,_0x586330){const _0x4016e4=_0x377182;var _0x27df82;const {nineaiBuiltInSensitiveApiBase:_0xb9d13e,nineaiBuiltInSensitiveAuthKey:_0x2e3467}=_0x54f9bc;if(!_0xb9d13e||!_0x2e3467)return;const _0x19cdbc=await axios_1[_0x4016e4(0xde)]['post'](_0xb9d13e,{'content':_0x30850f},{'headers':{'Content-Type':_0x4016e4(0x107),'Authorization':_0x2e3467}});if(!_0x19cdbc[_0x4016e4(0x117)])return;if(_0x19cdbc[_0x4016e4(0x117)]['code']!=='0'){const {msg:msg='检测失败'}=_0x19cdbc[_0x4016e4(0x117)];throw new common_1[(_0x4016e4(0xd8))]('敏感词检测\x20|\x20'+msg,common_1[_0x4016e4(0x13e)][_0x4016e4(0x130)]);}if(_0x19cdbc[_0x4016e4(0x117)]['word_list']&&((_0x27df82=_0x19cdbc[_0x4016e4(0x117)][_0x4016e4(0xdc)])===null||_0x27df82===void 0x0?void 0x0:_0x27df82[_0x4016e4(0x100)])){const _0x11d9d7=[...new Set(_0x19cdbc['data'][_0x4016e4(0xdc)][_0x4016e4(0xe8)](_0xac2e12=>_0xac2e12[_0x4016e4(0xe6)]))],_0x12d254=[...new Set(_0x19cdbc[_0x4016e4(0x117)][_0x4016e4(0xdc)][_0x4016e4(0xe8)](_0x1d5387=>_0x1d5387[_0x4016e4(0xf1)]))];await this['recordUserBadWords'](_0x586330,_0x30850f,_0x11d9d7,_0x12d254,_0x4016e4(0x133));const _0x31f686=this['formarTips'](_0x19cdbc[_0x4016e4(0x117)][_0x4016e4(0xdc)]);throw new common_1[(_0x4016e4(0xd8))](_0x31f686,common_1[_0x4016e4(0x13e)][_0x4016e4(0x130)]);}}[_0x377182(0x104)](_0x45e505){const _0x53b3fc=_0x377182,_0x300cdd=_0x45e505[_0x53b3fc(0xe8)](_0xed7ad3=>_0xed7ad3[_0x53b3fc(0xf1)]),_0x49b46d=[...new Set(_0x300cdd)];return _0x53b3fc(0xf9)+_0x49b46d[_0x53b3fc(0x109)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x377182(0xd9)](){const _0x1c8a5c=_0x377182,_0x43b5b1=await this[_0x1c8a5c(0x10c)][_0x1c8a5c(0x105)]({'where':{'status':0x1},'select':[_0x1c8a5c(0x122)]});this[_0x1c8a5c(0xda)]=_0x43b5b1['map'](_0x5f227c=>_0x5f227c[_0x1c8a5c(0x122)]);}async[_0x377182(0x140)](_0x173d0e){const _0x18698e=_0x377182,{page:page=0x1,size:size=0x1f4,word:_0x224b20,status:_0x3a0a8b}=_0x173d0e,_0x3a1e5f={};[0x0,0x1,'0','1'][_0x18698e(0x134)](_0x3a0a8b)&&(_0x3a1e5f['status']=_0x3a0a8b),_0x224b20&&(_0x3a1e5f[_0x18698e(0x122)]=(0x0,typeorm_1[_0x18698e(0x10b)])('%'+_0x224b20+'%'));const [_0x4b3ed9,_0x24e9d6]=await this[_0x18698e(0x10c)][_0x18698e(0xfc)]({'where':_0x3a1e5f,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x18698e(0x13a)}});return{'rows':_0x4b3ed9,'count':_0x24e9d6};}async[_0x377182(0xe9)](_0x521e1c){const _0x209c2d=_0x377182,_0x43ab0d=await this[_0x209c2d(0x10c)]['findOne']({'where':{'id':_0x521e1c['id']}});if(!_0x43ab0d)throw new common_1[(_0x209c2d(0xd8))]('敏感词不存在,请检查您的提交信息',common_1['HttpStatus'][_0x209c2d(0x130)]);const _0x4ee80b=await this[_0x209c2d(0x10c)][_0x209c2d(0xdd)]({'id':_0x521e1c['id']});if(_0x4ee80b[_0x209c2d(0xe0)]>0x0)return await this['loadBadWords'](),_0x209c2d(0xf6);else throw new common_1[(_0x209c2d(0xd8))](_0x209c2d(0xe2),common_1['HttpStatus'][_0x209c2d(0x130)]);}async['updateBadWords'](_0x46808b){const _0x5031b5=_0x377182,{id:_0x1577e2,word:_0x1fdd06,status:_0x55c965}=_0x46808b,_0x4d6bb1=await this['badWordsEntity'][_0x5031b5(0x12b)]({'where':{'word':_0x1fdd06}});if(_0x4d6bb1)throw new common_1[(_0x5031b5(0xd8))](_0x5031b5(0x126),common_1[_0x5031b5(0x13e)][_0x5031b5(0x130)]);const _0xd064b7=await this['badWordsEntity'][_0x5031b5(0x12e)]({'id':_0x1577e2},{'word':_0x1fdd06,'status':_0x55c965});if(_0xd064b7['affected']>0x0)return await this[_0x5031b5(0xd9)](),_0x5031b5(0xfa);else throw new common_1['HttpException']('更新敏感词失败',common_1[_0x5031b5(0x13e)][_0x5031b5(0x130)]);}async['addBadWord'](_0x401b68){const _0x22b3ef=_0x377182,{word:_0x3aa08c}=_0x401b68,_0x1c5ab2=await this['badWordsEntity'][_0x22b3ef(0x12b)]({'where':{'word':_0x3aa08c}});if(_0x1c5ab2)throw new common_1[(_0x22b3ef(0xd8))](_0x22b3ef(0x118),common_1[_0x22b3ef(0x13e)][_0x22b3ef(0x130)]);return await this[_0x22b3ef(0x10c)][_0x22b3ef(0x11c)]({'word':_0x3aa08c}),await this['loadBadWords'](),_0x22b3ef(0x123);}async['recordUserBadWords'](_0x393ae1,_0xab60b0,_0x2e4b39,_0x3a1e1e,_0x2b9ded){const _0x289eca=_0x377182,_0x4edf16={'userId':_0x393ae1,'content':_0xab60b0,'words':JSON['stringify'](_0x2e4b39),'typeCn':JSON[_0x289eca(0xdf)](_0x3a1e1e),'typeOriginCn':_0x2b9ded};try{await this[_0x289eca(0x131)][_0x289eca(0xd7)]()[_0x289eca(0x12e)](user_entity_1[_0x289eca(0xeb)])[_0x289eca(0x112)]({'violationCount':()=>_0x289eca(0xf2)})[_0x289eca(0x110)](_0x289eca(0x10d),{'userId':_0x393ae1})[_0x289eca(0xfd)](),await this[_0x289eca(0xec)][_0x289eca(0x11c)](_0x4edf16);}catch(_0x383e31){console[_0x289eca(0xef)](_0x289eca(0xdb),_0x383e31);}}async[_0x377182(0x132)](_0x1879e7,_0x7186f2){const _0x4b1d0a=_0x377182,{role:_0xbe34c8}=_0x1879e7[_0x4b1d0a(0x143)],{page:page=0x1,size:size=0xa,userId:_0x43c23f,typeOriginCn:_0x2e48d9}=_0x7186f2,_0x3b0497={};_0x43c23f&&(_0x3b0497[_0x4b1d0a(0x10e)]=_0x43c23f),_0x2e48d9&&(_0x3b0497[_0x4b1d0a(0x136)]=_0x2e48d9);const [_0x5725e3,_0x109b3e]=await this[_0x4b1d0a(0xec)][_0x4b1d0a(0xfc)]({'where':_0x3b0497,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4b1d0a(0x13d)}}),_0xe10c90=[...new Set(_0x5725e3[_0x4b1d0a(0xe8)](_0x2fc736=>_0x2fc736['userId']))],_0x68fe24=await this[_0x4b1d0a(0x131)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0xe10c90)},'select':['id',_0x4b1d0a(0xed),_0x4b1d0a(0x114),_0x4b1d0a(0x10f),_0x4b1d0a(0x13f),_0x4b1d0a(0xfb)]});return _0x5725e3[_0x4b1d0a(0xd6)](_0x55aea2=>{const _0x1c0a28=_0x4b1d0a,_0x49c34a=_0x68fe24['find'](_0x356bbe=>_0x356bbe['id']===_0x55aea2[_0x1c0a28(0x10e)]);_0xbe34c8!==_0x1c0a28(0xe4)&&(_0x49c34a[_0x1c0a28(0x10f)]=(0x0,utils_1[_0x1c0a28(0x111)])(_0x49c34a[_0x1c0a28(0x10f)])),_0x55aea2['userInfo']=_0x49c34a;}),{'rows':_0x5725e3,'count':_0x109b3e};}};BadwordsService=__decorate([(0x0,common_1[_0x377182(0x137)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x377182(0x13b)])(violationLog_entity_1[_0x377182(0xd3)])),__param(0x2,(0x0,typeorm_2['InjectRepository'])(user_entity_1['UserEntity'])),__metadata(_0x377182(0xf7),[typeorm_1['Repository'],typeorm_1[_0x377182(0x138)],typeorm_1['Repository'],globalConfig_service_1[_0x377182(0xf3)]])],BadwordsService),exports[_0x377182(0x11e)]=BadwordsService;