'use strict';const _0x3cded0=_0x1791;(function(_0x3adde0,_0x1aaec1){const _0x298c53=_0x1791,_0x103834=_0x3adde0();while(!![]){try{const _0x53e587=parseInt(_0x298c53(0xa5))/0x1*(-parseInt(_0x298c53(0xc1))/0x2)+-parseInt(_0x298c53(0xa0))/0x3+-parseInt(_0x298c53(0xa7))/0x4*(parseInt(_0x298c53(0x98))/0x5)+parseInt(_0x298c53(0xae))/0x6*(parseInt(_0x298c53(0x92))/0x7)+parseInt(_0x298c53(0x7d))/0x8+parseInt(_0x298c53(0x8c))/0x9*(parseInt(_0x298c53(0xbf))/0xa)+parseInt(_0x298c53(0x8a))/0xb;if(_0x53e587===_0x1aaec1)break;else _0x103834['push'](_0x103834['shift']());}catch(_0x27a0c9){_0x103834['push'](_0x103834['shift']());}}}(_0x1f21,0x68bab));function _0x1791(_0x348c8c,_0xfb8c53){const _0x1f210b=_0x1f21();return _0x1791=function(_0x17917f,_0x225c3c){_0x17917f=_0x17917f-0x6d;let _0x49871e=_0x1f210b[_0x17917f];return _0x49871e;},_0x1791(_0x348c8c,_0xfb8c53);}var __decorate=this&&this[_0x3cded0(0x7c)]||function(_0x591ed9,_0x3abd40,_0x2ef799,_0x36f6f2){const _0x8bd655=_0x3cded0;var _0x31ce93=arguments[_0x8bd655(0x93)],_0x4efabd=_0x31ce93<0x3?_0x3abd40:_0x36f6f2===null?_0x36f6f2=Object[_0x8bd655(0xcd)](_0x3abd40,_0x2ef799):_0x36f6f2,_0x3e37f6;if(typeof Reflect==='object'&&typeof Reflect[_0x8bd655(0xc4)]===_0x8bd655(0xd5))_0x4efabd=Reflect[_0x8bd655(0xc4)](_0x591ed9,_0x3abd40,_0x2ef799,_0x36f6f2);else{for(var _0x545e7b=_0x591ed9[_0x8bd655(0x93)]-0x1;_0x545e7b>=0x0;_0x545e7b--)if(_0x3e37f6=_0x591ed9[_0x545e7b])_0x4efabd=(_0x31ce93<0x3?_0x3e37f6(_0x4efabd):_0x31ce93>0x3?_0x3e37f6(_0x3abd40,_0x2ef799,_0x4efabd):_0x3e37f6(_0x3abd40,_0x2ef799))||_0x4efabd;}return _0x31ce93>0x3&&_0x4efabd&&Object['defineProperty'](_0x3abd40,_0x2ef799,_0x4efabd),_0x4efabd;},__metadata=this&&this[_0x3cded0(0x74)]||function(_0x47780b,_0xd799dc){const _0x16de05=_0x3cded0;if(typeof Reflect===_0x16de05(0xda)&&typeof Reflect[_0x16de05(0xaa)]==='function')return Reflect['metadata'](_0x47780b,_0xd799dc);},__param=this&&this[_0x3cded0(0x8e)]||function(_0x2a3737,_0x226326){return function(_0x3f11a5,_0x6e2f2f){_0x226326(_0x3f11a5,_0x6e2f2f,_0x2a3737);};};Object[_0x3cded0(0xa6)](exports,_0x3cded0(0x9b),{'value':!![]}),exports[_0x3cded0(0xcf)]=void 0x0;const globalConfig_service_1=require(_0x3cded0(0xa9)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x3cded0(0xb8)),typeorm_1=require('typeorm'),typeorm_2=require(_0x3cded0(0xb6)),axios_1=require('axios'),violationLog_entity_1=require(_0x3cded0(0x6e)),user_entity_1=require(_0x3cded0(0xba)),utils_1=require(_0x3cded0(0xca));let BadwordsService=class BadwordsService{constructor(_0x125e7f,_0x16806b,_0x24f97a,_0x54a73b){const _0x220ce9=_0x3cded0;this[_0x220ce9(0x75)]=_0x125e7f,this[_0x220ce9(0x85)]=_0x16806b,this[_0x220ce9(0x95)]=_0x24f97a,this[_0x220ce9(0xa1)]=_0x54a73b,this[_0x220ce9(0x7b)]=[];}async[_0x3cded0(0xd0)](){this['loadBadWords']();}async['customSensitiveWords'](_0x3b6971,_0x52318e){const _0x2c6de6=_0x3cded0,_0x4e5ed2=[];for(let _0x2da9ef=0x0;_0x2da9ef<this['badWords']['length'];_0x2da9ef++){const _0x127540=this[_0x2c6de6(0x7b)][_0x2da9ef];_0x3b6971[_0x2c6de6(0xbd)](_0x127540)&&_0x4e5ed2[_0x2c6de6(0xb3)](_0x127540);}if(_0x4e5ed2[_0x2c6de6(0x93)]){await this[_0x2c6de6(0xcc)](_0x52318e,_0x3b6971,_0x4e5ed2,[_0x2c6de6(0x82)],_0x2c6de6(0x8b));const _0x51bdd5=_0x2c6de6(0x7a);throw new common_1[(_0x2c6de6(0x8f))](_0x51bdd5,common_1['HttpStatus'][_0x2c6de6(0xc2)]);}}async[_0x3cded0(0x80)](_0x975685,_0x1797bb){const _0x9c0d81=_0x3cded0,_0xe7a54a=await this[_0x9c0d81(0xa1)][_0x9c0d81(0xb5)]();_0xe7a54a&&await this[_0x9c0d81(0xb1)](_0x975685,_0xe7a54a,_0x1797bb),await this[_0x9c0d81(0xd3)](_0x975685,_0x1797bb);}async[_0x3cded0(0xb1)](_0x15ac30,_0x3f60c1,_0x1ad24c){const _0x3b8483=_0x3cded0,{useType:_0xf20d32}=_0x3f60c1;_0xf20d32===_0x3b8483(0xb0)&&await this[_0x3b8483(0xac)](_0x15ac30,_0x3f60c1[_0x3b8483(0xad)],_0x1ad24c),_0xf20d32==='nineai'&&await this[_0x3b8483(0xde)](_0x15ac30,_0x3f60c1,_0x1ad24c);}[_0x3cded0(0xaf)](_0x47d1af){const _0x4cc98a=_0x3cded0,_0xa33bae=/存在(.*?)不合规/,_0x618939=_0x47d1af[_0x4cc98a(0xc9)](_0xa33bae);return _0x618939?_0x618939[0x1]:'';}async[_0x3cded0(0xac)](_0x13ba27,_0x5b26d5,_0x53b7cb){const _0x5509c7=_0x3cded0;if(!_0x5b26d5)return;const _0x5a1fc4=_0x5509c7(0x9f)+_0x5b26d5+'}',_0x435295={'Content-Type':_0x5509c7(0xb7),'Accept':_0x5509c7(0xb2)},_0x1a64c4=await axios_1[_0x5509c7(0xc5)][_0x5509c7(0x7e)](_0x5a1fc4,{'text':_0x13ba27},{'headers':_0x435295}),{conclusion:_0x5596d1,error_code:_0x254276,error_msg:_0x33f744,conclusionType:_0x66e8d5,data:_0xde7d1}=_0x1a64c4['data'];_0x254276&&console[_0x5509c7(0xab)]('百度文本检测出现错误、请查看配置信息:\x20',_0x33f744);if(_0x66e8d5!==0x1){const _0x2719f3=[...new Set(_0xde7d1['map'](_0x1e44ac=>this[_0x5509c7(0xaf)](_0x1e44ac[_0x5509c7(0xd9)])))];await this[_0x5509c7(0xcc)](_0x53b7cb,_0x13ba27,['***'],_0x2719f3,'百度云检测');const _0x3e1d0a=_0x5509c7(0xb9)+_0x2719f3[_0x5509c7(0xc3)](',')+_0x5509c7(0xbc);throw new common_1[(_0x5509c7(0x8f))](_0x3e1d0a,common_1['HttpStatus'][_0x5509c7(0xc2)]);}}async[_0x3cded0(0xde)](_0x3d0269,_0x46181f,_0x33499b){const _0x5d40ac=_0x3cded0;var _0x15b4a6;const {nineaiBuiltInSensitiveApiBase:_0x1a0117,nineaiBuiltInSensitiveAuthKey:_0x184060}=_0x46181f;if(!_0x1a0117||!_0x184060)return;const _0x42b85d=await axios_1[_0x5d40ac(0xc5)][_0x5d40ac(0x7e)](_0x1a0117,{'content':_0x3d0269},{'headers':{'Content-Type':_0x5d40ac(0xb2),'Authorization':_0x184060}});if(!_0x42b85d[_0x5d40ac(0xdb)])return;if(_0x42b85d[_0x5d40ac(0xdb)]['code']!=='0'){const {msg:msg=_0x5d40ac(0x9a)}=_0x42b85d[_0x5d40ac(0xdb)];throw new common_1[(_0x5d40ac(0x8f))](_0x5d40ac(0x8d)+msg,common_1[_0x5d40ac(0xc8)][_0x5d40ac(0xc2)]);}if(_0x42b85d[_0x5d40ac(0xdb)][_0x5d40ac(0x96)]&&((_0x15b4a6=_0x42b85d['data'][_0x5d40ac(0x96)])===null||_0x15b4a6===void 0x0?void 0x0:_0x15b4a6[_0x5d40ac(0x93)])){const _0x2468c0=[...new Set(_0x42b85d[_0x5d40ac(0xdb)][_0x5d40ac(0x96)]['map'](_0x1a26a2=>_0x1a26a2[_0x5d40ac(0x87)]))],_0x460744=[...new Set(_0x42b85d[_0x5d40ac(0xdb)][_0x5d40ac(0x96)][_0x5d40ac(0x7f)](_0xc44eee=>_0xc44eee[_0x5d40ac(0xdc)]))];await this[_0x5d40ac(0xcc)](_0x33499b,_0x3d0269,_0x2468c0,_0x460744,_0x5d40ac(0x78));const _0x5e6cd1=this[_0x5d40ac(0x73)](_0x42b85d[_0x5d40ac(0xdb)]['word_list']);throw new common_1[(_0x5d40ac(0x8f))](_0x5e6cd1,common_1['HttpStatus'][_0x5d40ac(0xc2)]);}}['formarTips'](_0x1c67bd){const _0x236691=_0x3cded0,_0x25582e=_0x1c67bd[_0x236691(0x7f)](_0x1e453b=>_0x1e453b[_0x236691(0xdc)]),_0x45a92c=[...new Set(_0x25582e)];return _0x236691(0xa8)+_0x45a92c[_0x236691(0xc3)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async['loadBadWords'](){const _0x341adf=_0x3cded0,_0x16bd86=await this[_0x341adf(0x75)][_0x341adf(0x72)]({'where':{'status':0x1},'select':['word']});this[_0x341adf(0x7b)]=_0x16bd86[_0x341adf(0x7f)](_0x272404=>_0x272404['word']);}async['queryBadWords'](_0x48a589){const _0x4bd95a=_0x3cded0,{page:page=0x1,size:size=0x1f4,word:_0xa639d5,status:_0x49b1d9}=_0x48a589,_0x2c5c34={};[0x0,0x1,'0','1'][_0x4bd95a(0xbd)](_0x49b1d9)&&(_0x2c5c34[_0x4bd95a(0x84)]=_0x49b1d9),_0xa639d5&&(_0x2c5c34['word']=(0x0,typeorm_1['Like'])('%'+_0xa639d5+'%'));const [_0x7956ea,_0x3e4be7]=await this[_0x4bd95a(0x75)][_0x4bd95a(0xce)]({'where':_0x2c5c34,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x7956ea,'count':_0x3e4be7};}async[_0x3cded0(0x91)](_0x494721){const _0x32d00b=_0x3cded0,_0x54df7f=await this[_0x32d00b(0x75)][_0x32d00b(0x6f)]({'where':{'id':_0x494721['id']}});if(!_0x54df7f)throw new common_1[(_0x32d00b(0x8f))](_0x32d00b(0xd6),common_1[_0x32d00b(0xc8)][_0x32d00b(0xc2)]);const _0x14e552=await this[_0x32d00b(0x75)][_0x32d00b(0xbb)]({'id':_0x494721['id']});if(_0x14e552[_0x32d00b(0xd4)]>0x0)return await this['loadBadWords'](),_0x32d00b(0x99);else throw new common_1[(_0x32d00b(0x8f))](_0x32d00b(0x6d),common_1[_0x32d00b(0xc8)]['BAD_REQUEST']);}async[_0x3cded0(0x83)](_0x19c502){const _0x9b747=_0x3cded0,{id:_0x3575a3,word:_0x1b0276,status:_0x22a75f}=_0x19c502,_0x2d5cf3=await this[_0x9b747(0x75)]['findOne']({'where':{'word':_0x1b0276}});if(_0x2d5cf3)throw new common_1['HttpException'](_0x9b747(0xc7),common_1[_0x9b747(0xc8)]['BAD_REQUEST']);const _0x521f61=await this[_0x9b747(0x75)][_0x9b747(0x88)]({'id':_0x3575a3},{'word':_0x1b0276,'status':_0x22a75f});if(_0x521f61[_0x9b747(0xd4)]>0x0)return await this[_0x9b747(0xd8)](),'更新敏感词成功';else throw new common_1['HttpException'](_0x9b747(0xa4),common_1[_0x9b747(0xc8)][_0x9b747(0xc2)]);}async[_0x3cded0(0xc0)](_0x3ecc4a){const _0x1a3148=_0x3cded0,{word:_0x30a576}=_0x3ecc4a,_0xa8a388=await this[_0x1a3148(0x75)][_0x1a3148(0x6f)]({'where':{'word':_0x30a576}});if(_0xa8a388)throw new common_1['HttpException']('敏感词已存在,请检查您的提交信息',common_1[_0x1a3148(0xc8)][_0x1a3148(0xc2)]);return await this[_0x1a3148(0x75)][_0x1a3148(0xc6)]({'word':_0x30a576}),await this[_0x1a3148(0xd8)](),_0x1a3148(0xdd);}async['recordUserBadWords'](_0x1eb36f,_0x4b4022,_0x2edf43,_0x7e849e,_0xf301d8){const _0x5a3051=_0x3cded0,_0x139548={'userId':_0x1eb36f,'content':_0x4b4022,'words':JSON[_0x5a3051(0xd1)](_0x2edf43),'typeCn':JSON[_0x5a3051(0xd1)](_0x7e849e),'typeOriginCn':_0xf301d8};try{await this[_0x5a3051(0x95)]['createQueryBuilder']()['update'](user_entity_1['UserEntity'])['set']({'violationCount':()=>'violationCount\x20+\x201'})[_0x5a3051(0xd2)](_0x5a3051(0x70),{'userId':_0x1eb36f})[_0x5a3051(0x9e)](),await this[_0x5a3051(0x85)]['save'](_0x139548);}catch(_0xa6e8ff){console[_0x5a3051(0xab)](_0x5a3051(0x71),_0xa6e8ff);}}async[_0x3cded0(0x77)](_0x25d5d7,_0x32279a){const _0x529f04=_0x3cded0,{role:_0x39c35b}=_0x25d5d7[_0x529f04(0xcb)],{page:page=0x1,size:size=0xa,userId:_0x1387b8,typeOriginCn:_0x4a1c9b}=_0x32279a,_0x7ad4fa={};_0x1387b8&&(_0x7ad4fa[_0x529f04(0x86)]=_0x1387b8),_0x4a1c9b&&(_0x7ad4fa[_0x529f04(0x94)]=_0x4a1c9b);const [_0x49a583,_0x322e9f]=await this['violationLogEntity'][_0x529f04(0xce)]({'where':_0x7ad4fa,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x529f04(0xa2)}}),_0x275042=[...new Set(_0x49a583[_0x529f04(0x7f)](_0x438d07=>_0x438d07[_0x529f04(0x86)]))],_0x440fa4=await this['userEntity'][_0x529f04(0x72)]({'where':{'id':(0x0,typeorm_1['In'])(_0x275042)},'select':['id',_0x529f04(0x97),'username','email',_0x529f04(0xb4),_0x529f04(0x84)]});return _0x49a583['forEach'](_0x381e33=>{const _0x187b57=_0x529f04,_0x39538d=_0x440fa4[_0x187b57(0x72)](_0x595743=>_0x595743['id']===_0x381e33['userId']);_0x39c35b!==_0x187b57(0x89)&&(_0x39538d[_0x187b57(0x81)]=(0x0,utils_1[_0x187b57(0x90)])(_0x39538d['email'])),_0x381e33['userInfo']=_0x39538d;}),{'rows':_0x49a583,'count':_0x322e9f};}};function _0x1f21(){const _0x525ad4=['ViolationLogEntity','InjectRepository','execute','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','1253097RlhfWJ','globalConfigService','DESC','UserEntity','更新敏感词失败','5769LKLcfT','defineProperty','6236vhwUaD','您提交的内容中包含','../globalConfig/globalConfig.service','metadata','log','baiduCheckBadWords','baiduTextAccessToken','4410DNrGGW','extractContent','baidu','checkBadWordsByConfig','application/json','push','violationCount','getSensitiveConfig','@nestjs/typeorm','application/x-www-form-urlencoded','./badwords.entity','您提交的信息中包含','../user/user.entity','delete','的内容、我们已对您的账户进行标记、请合规使用！','includes','Injectable','485710sLSwdf','addBadWord','118HHSyzr','BAD_REQUEST','join','decorate','default','save','敏感词已经存在了、请勿重复添加','HttpStatus','match','../../common/utils','user','recordUserBadWords','getOwnPropertyDescriptor','findAndCount','BadwordsService','onModuleInit','stringify','where','customSensitiveWords','affected','function','敏感词不存在,请检查您的提交信息','Repository','loadBadWords','msg','object','data','category','添加敏感词成功','nineaiCheckBadWords','删除敏感词失败','./violationLog.entity','findOne','id\x20=\x20:userId','error:\x20','find','formarTips','__metadata','badWordsEntity','BadWordsEntity','violation','NineAi检测','GlobalConfigService','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','badWords','__decorate','6299408Vgypid','post','map','checkBadWords','email','自定义','updateBadWords','status','violationLogEntity','userId','keyword','update','super','1468236KXnoaJ','自定义检测','63wuNHcA','敏感词检测\x20|\x20','__param','HttpException','hideString','delBadWords','2667IEalYK','length','typeOriginCn','userEntity','word_list','avatar','1135dAnwDu','删除敏感词成功','检测失败','__esModule'];_0x1f21=function(){return _0x525ad4;};return _0x1f21();}BadwordsService=__decorate([(0x0,common_1[_0x3cded0(0xbe)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x3cded0(0x76)])),__param(0x1,(0x0,typeorm_2[_0x3cded0(0x9d)])(violationLog_entity_1[_0x3cded0(0x9c)])),__param(0x2,(0x0,typeorm_2[_0x3cded0(0x9d)])(user_entity_1[_0x3cded0(0xa3)])),__metadata('design:paramtypes',[typeorm_1['Repository'],typeorm_1[_0x3cded0(0xd7)],typeorm_1[_0x3cded0(0xd7)],globalConfig_service_1[_0x3cded0(0x79)]])],BadwordsService),exports[_0x3cded0(0xcf)]=BadwordsService;