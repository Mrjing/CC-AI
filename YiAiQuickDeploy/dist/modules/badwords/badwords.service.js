'use strict';const _0x48cdc6=_0xf689;function _0x1b7c(){const _0x26834e=['set','code','getOwnPropertyDescriptor','find','status','queryBadWords','loadBadWords','typeOriginCn','3976624WsFtBo','7558947SnGEkz','__decorate','nineaiCheckBadWords','HttpException','__metadata','百度文本检测出现错误、请查看配置信息:\x20','2lozkHz','../../common/utils','badWords','3027285WWeWLq','BAD_REQUEST','defineProperty','18iLxhhF','log','1700390Knodbh','updateBadWords','decorate','violationCount\x20+\x201','更新敏感词成功','axios','onModuleInit','NineAi检测','save','violationLogEntity','findOne','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','敏感词已存在,请检查您的提交信息','checkBadWords','Repository','敏感词检测\x20|\x20','map','badWordsEntity','keyword','error:\x20','baiduCheckBadWords','update','violationCount','getSensitiveConfig','添加敏感词成功','hideString','检测失败','599706vIVWtp','affected','word_list','baidu','user','./badwords.entity','__esModule','where','data','userEntity','自定义','1140XdqidB','checkBadWordsByConfig','globalConfigService','userId','7876IZAziC','BadwordsService','nineai','application/json','HttpStatus','Injectable','word','typeorm','id\x20=\x20:userId','userInfo','post','BadWordsEntity','的信息、我们已对您账号进行标记、请合规使用！','GlobalConfigService','violation','删除敏感词失败','function','的内容、我们已对您的账户进行标记、请合规使用！','customSensitiveWords','application/x-www-form-urlencoded','delete','email','default','recordUserBadWords','formarTips','category','join','自定义检测','avatar','delBadWords','InjectRepository','2560138XWicHV','object','Like','design:paramtypes','username','6wraEpA','metadata','forEach','msg','createQueryBuilder','删除敏感词成功','../user/user.entity','UserEntity','findAndCount','length'];_0x1b7c=function(){return _0x26834e;};return _0x1b7c();}(function(_0xc1c97a,_0x4255f4){const _0x24b626=_0xf689,_0x242be0=_0xc1c97a();while(!![]){try{const _0x57a122=parseInt(_0x24b626(0xec))/0x1*(parseInt(_0x24b626(0xc9))/0x2)+parseInt(_0x24b626(0x88))/0x3*(-parseInt(_0x24b626(0x8c))/0x4)+parseInt(_0x24b626(0xcc))/0x5+-parseInt(_0x24b626(0xb0))/0x6*(parseInt(_0x24b626(0xab))/0x7)+-parseInt(_0x24b626(0xc2))/0x8+-parseInt(_0x24b626(0xcf))/0x9*(-parseInt(_0x24b626(0xd1))/0xa)+parseInt(_0x24b626(0xc3))/0xb;if(_0x57a122===_0x4255f4)break;else _0x242be0['push'](_0x242be0['shift']());}catch(_0x11d0d4){_0x242be0['push'](_0x242be0['shift']());}}}(_0x1b7c,0x97b4a));var __decorate=this&&this[_0x48cdc6(0xc4)]||function(_0x2ac948,_0x53592c,_0x411f95,_0x20fb01){const _0x282d84=_0x48cdc6;var _0x529716=arguments[_0x282d84(0xb9)],_0x1eb8e6=_0x529716<0x3?_0x53592c:_0x20fb01===null?_0x20fb01=Object[_0x282d84(0xbc)](_0x53592c,_0x411f95):_0x20fb01,_0x5cca4d;if(typeof Reflect===_0x282d84(0xac)&&typeof Reflect[_0x282d84(0xd3)]===_0x282d84(0x9c))_0x1eb8e6=Reflect[_0x282d84(0xd3)](_0x2ac948,_0x53592c,_0x411f95,_0x20fb01);else{for(var _0x40ccaf=_0x2ac948[_0x282d84(0xb9)]-0x1;_0x40ccaf>=0x0;_0x40ccaf--)if(_0x5cca4d=_0x2ac948[_0x40ccaf])_0x1eb8e6=(_0x529716<0x3?_0x5cca4d(_0x1eb8e6):_0x529716>0x3?_0x5cca4d(_0x53592c,_0x411f95,_0x1eb8e6):_0x5cca4d(_0x53592c,_0x411f95))||_0x1eb8e6;}return _0x529716>0x3&&_0x1eb8e6&&Object[_0x282d84(0xce)](_0x53592c,_0x411f95,_0x1eb8e6),_0x1eb8e6;},__metadata=this&&this[_0x48cdc6(0xc7)]||function(_0x9da7fb,_0x226700){const _0x4bf4e6=_0x48cdc6;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x4bf4e6(0x9c))return Reflect[_0x4bf4e6(0xb1)](_0x9da7fb,_0x226700);},__param=this&&this['__param']||function(_0xe75dbb,_0x212c08){return function(_0x46f40e,_0x468bb4){_0x212c08(_0x46f40e,_0x468bb4,_0xe75dbb);};};Object[_0x48cdc6(0xce)](exports,_0x48cdc6(0x83),{'value':!![]}),exports[_0x48cdc6(0x8d)]=void 0x0;const globalConfig_service_1=require('../globalConfig/globalConfig.service'),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x48cdc6(0x82)),typeorm_1=require(_0x48cdc6(0x93)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x48cdc6(0xd6)),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require(_0x48cdc6(0xb6)),utils_1=require(_0x48cdc6(0xca));let BadwordsService=class BadwordsService{constructor(_0x551ee5,_0x35c158,_0x4e470f,_0x9a783e){const _0x107a44=_0x48cdc6;this['badWordsEntity']=_0x551ee5,this[_0x107a44(0xda)]=_0x35c158,this[_0x107a44(0x86)]=_0x4e470f,this[_0x107a44(0x8a)]=_0x9a783e,this[_0x107a44(0xcb)]=[];}async[_0x48cdc6(0xd7)](){const _0x58f702=_0x48cdc6;this[_0x58f702(0xc0)]();}async[_0x48cdc6(0x9e)](_0x134f31,_0xbd1213){const _0x597b98=_0x48cdc6,_0x9c27d5=[];for(let _0x3ff53a=0x0;_0x3ff53a<this[_0x597b98(0xcb)][_0x597b98(0xb9)];_0x3ff53a++){const _0x183c44=this[_0x597b98(0xcb)][_0x3ff53a];_0x134f31['includes'](_0x183c44)&&_0x9c27d5['push'](_0x183c44);}if(_0x9c27d5[_0x597b98(0xb9)]){await this[_0x597b98(0xa3)](_0xbd1213,_0x134f31,_0x9c27d5,[_0x597b98(0x87)],_0x597b98(0xa7));const _0x4db9da=_0x597b98(0xdc);throw new common_1['HttpException'](_0x4db9da,common_1[_0x597b98(0x90)]['BAD_REQUEST']);}}async[_0x48cdc6(0xde)](_0x301632,_0x4e1a17){const _0x43b960=_0x48cdc6,_0x5a7697=await this[_0x43b960(0x8a)][_0x43b960(0xe8)]();_0x5a7697&&await this['checkBadWordsByConfig'](_0x301632,_0x5a7697,_0x4e1a17),await this[_0x43b960(0x9e)](_0x301632,_0x4e1a17);}async[_0x48cdc6(0x89)](_0x202323,_0x5e902a,_0xb60942){const _0x17c24e=_0x48cdc6,{useType:_0x412192}=_0x5e902a;_0x412192===_0x17c24e(0x80)&&await this['baiduCheckBadWords'](_0x202323,_0x5e902a['baiduTextAccessToken'],_0xb60942),_0x412192===_0x17c24e(0x8e)&&await this[_0x17c24e(0xc5)](_0x202323,_0x5e902a,_0xb60942);}['extractContent'](_0x58459b){const _0x4d94c3=/存在(.*?)不合规/,_0x1e5b2b=_0x58459b['match'](_0x4d94c3);return _0x1e5b2b?_0x1e5b2b[0x1]:'';}async[_0x48cdc6(0xe5)](_0x23a5e2,_0x59d43e,_0x44150c){const _0x3fb564=_0x48cdc6;if(!_0x59d43e)return;const _0x2df10c='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x59d43e+'}',_0xd2850c={'Content-Type':_0x3fb564(0x9f),'Accept':'application/json'},_0x454541=await axios_1[_0x3fb564(0xa2)][_0x3fb564(0x96)](_0x2df10c,{'text':_0x23a5e2},{'headers':_0xd2850c}),{conclusion:_0x41f0d8,error_code:_0x16fce1,error_msg:_0x272445,conclusionType:_0x500f89,data:_0x2aef31}=_0x454541[_0x3fb564(0x85)];_0x16fce1&&console[_0x3fb564(0xd0)](_0x3fb564(0xc8),_0x272445);if(_0x500f89!==0x1){const _0x28d99d=[...new Set(_0x2aef31['map'](_0x1be783=>this['extractContent'](_0x1be783[_0x3fb564(0xb3)])))];await this['recordUserBadWords'](_0x44150c,_0x23a5e2,['***'],_0x28d99d,'百度云检测');const _0x2f5892='您提交的信息中包含'+_0x28d99d[_0x3fb564(0xa6)](',')+_0x3fb564(0x9d);throw new common_1['HttpException'](_0x2f5892,common_1[_0x3fb564(0x90)][_0x3fb564(0xcd)]);}}async[_0x48cdc6(0xc5)](_0x9e692a,_0x242c51,_0x5f0df1){const _0x16175c=_0x48cdc6;var _0x5c61fe;const {nineaiBuiltInSensitiveApiBase:_0x301a1,nineaiBuiltInSensitiveAuthKey:_0x468c84}=_0x242c51;if(!_0x301a1||!_0x468c84)return;const _0x50573b=await axios_1[_0x16175c(0xa2)][_0x16175c(0x96)](_0x301a1,{'content':_0x9e692a},{'headers':{'Content-Type':_0x16175c(0x8f),'Authorization':_0x468c84}});if(!_0x50573b[_0x16175c(0x85)])return;if(_0x50573b['data'][_0x16175c(0xbb)]!=='0'){const {msg:msg=_0x16175c(0xeb)}=_0x50573b[_0x16175c(0x85)];throw new common_1['HttpException'](_0x16175c(0xe0)+msg,common_1[_0x16175c(0x90)][_0x16175c(0xcd)]);}if(_0x50573b[_0x16175c(0x85)][_0x16175c(0x7f)]&&((_0x5c61fe=_0x50573b[_0x16175c(0x85)][_0x16175c(0x7f)])===null||_0x5c61fe===void 0x0?void 0x0:_0x5c61fe['length'])){const _0x318af7=[...new Set(_0x50573b[_0x16175c(0x85)][_0x16175c(0x7f)][_0x16175c(0xe1)](_0x5032ee=>_0x5032ee[_0x16175c(0xe3)]))],_0x4c76c6=[...new Set(_0x50573b[_0x16175c(0x85)][_0x16175c(0x7f)]['map'](_0x258665=>_0x258665[_0x16175c(0xa5)]))];await this['recordUserBadWords'](_0x5f0df1,_0x9e692a,_0x318af7,_0x4c76c6,_0x16175c(0xd8));const _0xd208c9=this['formarTips'](_0x50573b['data']['word_list']);throw new common_1[(_0x16175c(0xc6))](_0xd208c9,common_1[_0x16175c(0x90)][_0x16175c(0xcd)]);}}[_0x48cdc6(0xa4)](_0x35c648){const _0xe09e8d=_0x48cdc6,_0x15377d=_0x35c648[_0xe09e8d(0xe1)](_0x267ad2=>_0x267ad2[_0xe09e8d(0xa5)]),_0x86203e=[...new Set(_0x15377d)];return'您提交的内容中包含'+_0x86203e[_0xe09e8d(0xa6)](',')+_0xe09e8d(0x98);}async[_0x48cdc6(0xc0)](){const _0x1c57a6=_0x48cdc6,_0x44c73d=await this[_0x1c57a6(0xe2)][_0x1c57a6(0xbd)]({'where':{'status':0x1},'select':[_0x1c57a6(0x92)]});this[_0x1c57a6(0xcb)]=_0x44c73d[_0x1c57a6(0xe1)](_0x2fa22c=>_0x2fa22c[_0x1c57a6(0x92)]);}async[_0x48cdc6(0xbf)](_0x54d751){const _0x1cb932=_0x48cdc6,{page:page=0x1,size:size=0x1f4,word:_0x3d93ce,status:_0x1cfcac}=_0x54d751,_0x21cfe9={};[0x0,0x1,'0','1']['includes'](_0x1cfcac)&&(_0x21cfe9['status']=_0x1cfcac),_0x3d93ce&&(_0x21cfe9[_0x1cb932(0x92)]=(0x0,typeorm_1[_0x1cb932(0xad)])('%'+_0x3d93ce+'%'));const [_0x3236e3,_0x2a5f9d]=await this[_0x1cb932(0xe2)][_0x1cb932(0xb8)]({'where':_0x21cfe9,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x3236e3,'count':_0x2a5f9d};}async[_0x48cdc6(0xa9)](_0x3f6235){const _0x5159be=_0x48cdc6,_0xffc6eb=await this['badWordsEntity']['findOne']({'where':{'id':_0x3f6235['id']}});if(!_0xffc6eb)throw new common_1[(_0x5159be(0xc6))]('敏感词不存在,请检查您的提交信息',common_1[_0x5159be(0x90)]['BAD_REQUEST']);const _0x263456=await this[_0x5159be(0xe2)][_0x5159be(0xa0)]({'id':_0x3f6235['id']});if(_0x263456[_0x5159be(0xed)]>0x0)return await this['loadBadWords'](),_0x5159be(0xb5);else throw new common_1[(_0x5159be(0xc6))](_0x5159be(0x9b),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x48cdc6(0xd2)](_0x23960c){const _0x49b66e=_0x48cdc6,{id:_0x4d5dc,word:_0x5da9ad,status:_0x234ab9}=_0x23960c,_0xa322e1=await this[_0x49b66e(0xe2)]['findOne']({'where':{'word':_0x5da9ad}});if(_0xa322e1)throw new common_1[(_0x49b66e(0xc6))]('敏感词已经存在了、请勿重复添加',common_1[_0x49b66e(0x90)][_0x49b66e(0xcd)]);const _0x44f92f=await this[_0x49b66e(0xe2)][_0x49b66e(0xe6)]({'id':_0x4d5dc},{'word':_0x5da9ad,'status':_0x234ab9});if(_0x44f92f[_0x49b66e(0xed)]>0x0)return await this[_0x49b66e(0xc0)](),_0x49b66e(0xd5);else throw new common_1[(_0x49b66e(0xc6))]('更新敏感词失败',common_1[_0x49b66e(0x90)][_0x49b66e(0xcd)]);}async['addBadWord'](_0x58222d){const _0x3047bd=_0x48cdc6,{word:_0x262bcf}=_0x58222d,_0x162b3c=await this[_0x3047bd(0xe2)][_0x3047bd(0xdb)]({'where':{'word':_0x262bcf}});if(_0x162b3c)throw new common_1[(_0x3047bd(0xc6))](_0x3047bd(0xdd),common_1[_0x3047bd(0x90)]['BAD_REQUEST']);return await this['badWordsEntity']['save']({'word':_0x262bcf}),await this['loadBadWords'](),_0x3047bd(0xe9);}async[_0x48cdc6(0xa3)](_0x29249f,_0x1e1318,_0x1b216b,_0x1a67b6,_0x5d5569){const _0x3c5e58=_0x48cdc6,_0x35468f={'userId':_0x29249f,'content':_0x1e1318,'words':JSON['stringify'](_0x1b216b),'typeCn':JSON['stringify'](_0x1a67b6),'typeOriginCn':_0x5d5569};try{await this['userEntity'][_0x3c5e58(0xb4)]()['update'](user_entity_1[_0x3c5e58(0xb7)])[_0x3c5e58(0xba)]({'violationCount':()=>_0x3c5e58(0xd4)})[_0x3c5e58(0x84)](_0x3c5e58(0x94),{'userId':_0x29249f})['execute'](),await this[_0x3c5e58(0xda)][_0x3c5e58(0xd9)](_0x35468f);}catch(_0x4c0f08){console[_0x3c5e58(0xd0)](_0x3c5e58(0xe4),_0x4c0f08);}}async[_0x48cdc6(0x9a)](_0x43e744,_0x10737e){const _0x1ed4a7=_0x48cdc6,{role:_0x4e28c1}=_0x43e744[_0x1ed4a7(0x81)],{page:page=0x1,size:size=0xa,userId:_0x98a562,typeOriginCn:_0x53f1fe}=_0x10737e,_0x4a4024={};_0x98a562&&(_0x4a4024[_0x1ed4a7(0x8b)]=_0x98a562),_0x53f1fe&&(_0x4a4024[_0x1ed4a7(0xc1)]=_0x53f1fe);const [_0x55ae74,_0x1af454]=await this[_0x1ed4a7(0xda)][_0x1ed4a7(0xb8)]({'where':_0x4a4024,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x55d362=[...new Set(_0x55ae74[_0x1ed4a7(0xe1)](_0x41ff86=>_0x41ff86['userId']))],_0x4f4b0b=await this['userEntity'][_0x1ed4a7(0xbd)]({'where':{'id':(0x0,typeorm_1['In'])(_0x55d362)},'select':['id',_0x1ed4a7(0xa8),_0x1ed4a7(0xaf),_0x1ed4a7(0xa1),_0x1ed4a7(0xe7),_0x1ed4a7(0xbe)]});return _0x55ae74[_0x1ed4a7(0xb2)](_0x2054b7=>{const _0x2163ba=_0x1ed4a7,_0x2aa144=_0x4f4b0b[_0x2163ba(0xbd)](_0x392a34=>_0x392a34['id']===_0x2054b7[_0x2163ba(0x8b)]);_0x4e28c1!=='super'&&(_0x2aa144['email']=(0x0,utils_1[_0x2163ba(0xea)])(_0x2aa144[_0x2163ba(0xa1)])),_0x2054b7[_0x2163ba(0x95)]=_0x2aa144;}),{'rows':_0x55ae74,'count':_0x1af454};}};function _0xf689(_0x5ed0ad,_0x29895c){const _0x1b7ce4=_0x1b7c();return _0xf689=function(_0xf68936,_0x2d8192){_0xf68936=_0xf68936-0x7f;let _0x589964=_0x1b7ce4[_0xf68936];return _0x589964;},_0xf689(_0x5ed0ad,_0x29895c);}BadwordsService=__decorate([(0x0,common_1[_0x48cdc6(0x91)])(),__param(0x0,(0x0,typeorm_2[_0x48cdc6(0xaa)])(badwords_entity_1[_0x48cdc6(0x97)])),__param(0x1,(0x0,typeorm_2[_0x48cdc6(0xaa)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x48cdc6(0xaa)])(user_entity_1[_0x48cdc6(0xb7)])),__metadata(_0x48cdc6(0xae),[typeorm_1[_0x48cdc6(0xdf)],typeorm_1[_0x48cdc6(0xdf)],typeorm_1[_0x48cdc6(0xdf)],globalConfig_service_1[_0x48cdc6(0x99)]])],BadwordsService),exports[_0x48cdc6(0x8d)]=BadwordsService;