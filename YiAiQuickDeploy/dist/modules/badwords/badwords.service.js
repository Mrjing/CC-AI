'use strict';const _0x67b093=_0x4ca3;(function(_0x434397,_0x318694){const _0x1560c9=_0x4ca3,_0x18f14b=_0x434397();while(!![]){try{const _0x31e2db=-parseInt(_0x1560c9(0x1e0))/0x1*(parseInt(_0x1560c9(0x1f1))/0x2)+parseInt(_0x1560c9(0x1b6))/0x3+-parseInt(_0x1560c9(0x199))/0x4*(-parseInt(_0x1560c9(0x1cb))/0x5)+parseInt(_0x1560c9(0x1ff))/0x6+-parseInt(_0x1560c9(0x1dd))/0x7*(parseInt(_0x1560c9(0x1fe))/0x8)+parseInt(_0x1560c9(0x1f7))/0x9+parseInt(_0x1560c9(0x1b0))/0xa*(-parseInt(_0x1560c9(0x1b4))/0xb);if(_0x31e2db===_0x318694)break;else _0x18f14b['push'](_0x18f14b['shift']());}catch(_0x1374f4){_0x18f14b['push'](_0x18f14b['shift']());}}}(_0x2c07,0x9fed8));function _0x2c07(){const _0x2835c2=['3129895LneluS','../../common/utils','userId','./badwords.entity','word_list','userInfo','您提交的内容中包含','badWordsEntity','user','violationCount\x20+\x201','更新敏感词成功','recordUserBadWords','百度云检测','super','DESC','Injectable','id\x20=\x20:userId','avatar','260638qzZEFD','category','__param','771667OSwvOW','自定义','log','violationLogEntity','敏感词已存在,请检查您的提交信息','error:\x20','delete','HttpStatus','../user/user.entity','NineAi检测','where','stringify','getOwnPropertyDescriptor','data','forEach','删除敏感词失败','queryBadWords','2DkCgTB','word','find','自定义检测','检测失败','@nestjs/common','859860MtfqSo','metadata','match','code','function','findAndCount','checkBadWords','24GawwUG','2631438pVqTqd','onModuleInit','的内容、我们已对您的账户进行标记、请合规使用！','Like','typeOriginCn','affected','Repository','includes','HttpException','checkBadWordsByConfig','execute','badWords','map','更新敏感词失败','4HaCXYW','百度文本检测出现错误、请查看配置信息:\x20','baidu','globalConfigService','keyword','./violationLog.entity','敏感词已经存在了、请勿重复添加','的信息、我们已对您账号进行标记、请合规使用！','nineaiCheckBadWords','extractContent','violationCount','添加敏感词成功','design:paramtypes','decorate','delBadWords','__metadata','post','join','customSensitiveWords','application/json','default','getSensitiveConfig','createQueryBuilder','30SmnImo','baiduTextAccessToken','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','敏感词不存在,请检查您的提交信息','1269147FFmINM','email','2173416BdwbVR','ASC','GlobalConfigService','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','formarTips','UserEntity','***','../globalConfig/globalConfig.service','hideString','InjectRepository','loadBadWords','findOne','update','status','object','baiduCheckBadWords','length','userEntity','BAD_REQUEST','defineProperty','您提交的信息中包含'];_0x2c07=function(){return _0x2835c2;};return _0x2c07();}var __decorate=this&&this['__decorate']||function(_0xfc0469,_0x851a83,_0x31d631,_0x2c8b65){const _0x48adf2=_0x4ca3;var _0x1b0069=arguments[_0x48adf2(0x1c6)],_0x5bcf77=_0x1b0069<0x3?_0x851a83:_0x2c8b65===null?_0x2c8b65=Object[_0x48adf2(0x1ec)](_0x851a83,_0x31d631):_0x2c8b65,_0x46ef1c;if(typeof Reflect===_0x48adf2(0x1c4)&&typeof Reflect[_0x48adf2(0x1a6)]===_0x48adf2(0x1fb))_0x5bcf77=Reflect[_0x48adf2(0x1a6)](_0xfc0469,_0x851a83,_0x31d631,_0x2c8b65);else{for(var _0x4ffcc7=_0xfc0469[_0x48adf2(0x1c6)]-0x1;_0x4ffcc7>=0x0;_0x4ffcc7--)if(_0x46ef1c=_0xfc0469[_0x4ffcc7])_0x5bcf77=(_0x1b0069<0x3?_0x46ef1c(_0x5bcf77):_0x1b0069>0x3?_0x46ef1c(_0x851a83,_0x31d631,_0x5bcf77):_0x46ef1c(_0x851a83,_0x31d631))||_0x5bcf77;}return _0x1b0069>0x3&&_0x5bcf77&&Object[_0x48adf2(0x1c9)](_0x851a83,_0x31d631,_0x5bcf77),_0x5bcf77;},__metadata=this&&this[_0x67b093(0x1a8)]||function(_0x44f92a,_0x10e108){const _0x3f78a6=_0x67b093;if(typeof Reflect===_0x3f78a6(0x1c4)&&typeof Reflect[_0x3f78a6(0x1f8)]===_0x3f78a6(0x1fb))return Reflect['metadata'](_0x44f92a,_0x10e108);},__param=this&&this[_0x67b093(0x1df)]||function(_0x47db62,_0x56c84a){return function(_0xd7c223,_0xb457b8){_0x56c84a(_0xd7c223,_0xb457b8,_0x47db62);};};function _0x4ca3(_0x2837ab,_0x45f8f0){const _0x2c07b1=_0x2c07();return _0x4ca3=function(_0x4ca381,_0x3d65ab){_0x4ca381=_0x4ca381-0x195;let _0x5d6ac8=_0x2c07b1[_0x4ca381];return _0x5d6ac8;},_0x4ca3(_0x2837ab,_0x45f8f0);}Object[_0x67b093(0x1c9)](exports,'__esModule',{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x67b093(0x1bd)),common_1=require(_0x67b093(0x1f6)),badwords_entity_1=require(_0x67b093(0x1ce)),typeorm_1=require('typeorm'),typeorm_2=require('@nestjs/typeorm'),axios_1=require('axios'),violationLog_entity_1=require(_0x67b093(0x19e)),user_entity_1=require(_0x67b093(0x1e8)),utils_1=require(_0x67b093(0x1cc));let BadwordsService=class BadwordsService{constructor(_0x5a0154,_0x25b34f,_0xcd1a5f,_0x446d5a){const _0x5a38fd=_0x67b093;this[_0x5a38fd(0x1d2)]=_0x5a0154,this['violationLogEntity']=_0x25b34f,this[_0x5a38fd(0x1c7)]=_0xcd1a5f,this[_0x5a38fd(0x19c)]=_0x446d5a,this['badWords']=[];}async[_0x67b093(0x200)](){const _0x3c4fa7=_0x67b093;this[_0x3c4fa7(0x1c0)]();}async[_0x67b093(0x1ab)](_0x4557aa,_0x5793f7){const _0xfdf28e=_0x67b093,_0x37f847=[];for(let _0x3a98fd=0x0;_0x3a98fd<this[_0xfdf28e(0x196)][_0xfdf28e(0x1c6)];_0x3a98fd++){const _0x5111b7=this[_0xfdf28e(0x196)][_0x3a98fd];_0x4557aa['includes'](_0x5111b7)&&_0x37f847['push'](_0x5111b7);}if(_0x37f847[_0xfdf28e(0x1c6)]){await this[_0xfdf28e(0x1d6)](_0x5793f7,_0x4557aa,_0x37f847,[_0xfdf28e(0x1e1)],_0xfdf28e(0x1f4));const _0x2fd28e=_0xfdf28e(0x1b2);throw new common_1['HttpException'](_0x2fd28e,common_1['HttpStatus'][_0xfdf28e(0x1c8)]);}}async[_0x67b093(0x1fd)](_0x3eb577,_0x19c04f){const _0x518ec8=_0x67b093,_0x3fa218=await this[_0x518ec8(0x19c)][_0x518ec8(0x1ae)]();_0x3fa218&&await this[_0x518ec8(0x208)](_0x3eb577,_0x3fa218,_0x19c04f),await this[_0x518ec8(0x1ab)](_0x3eb577,_0x19c04f);}async[_0x67b093(0x208)](_0x2cdb1a,_0x33cfef,_0x12cc62){const _0x1e68db=_0x67b093,{useType:_0x5f082f}=_0x33cfef;_0x5f082f===_0x1e68db(0x19b)&&await this[_0x1e68db(0x1c5)](_0x2cdb1a,_0x33cfef[_0x1e68db(0x1b1)],_0x12cc62),_0x5f082f==='nineai'&&await this[_0x1e68db(0x1a1)](_0x2cdb1a,_0x33cfef,_0x12cc62);}[_0x67b093(0x1a2)](_0x29ee28){const _0x37f33d=_0x67b093,_0xbff500=/存在(.*?)不合规/,_0x314da9=_0x29ee28[_0x37f33d(0x1f9)](_0xbff500);return _0x314da9?_0x314da9[0x1]:'';}async[_0x67b093(0x1c5)](_0x4697ea,_0x323224,_0x12e8f6){const _0x1583b8=_0x67b093;if(!_0x323224)return;const _0x202174=_0x1583b8(0x1b9)+_0x323224+'}',_0x3cf36f={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x1583b8(0x1ac)},_0x5639f7=await axios_1[_0x1583b8(0x1ad)][_0x1583b8(0x1a9)](_0x202174,{'text':_0x4697ea},{'headers':_0x3cf36f}),{conclusion:_0x356ff1,error_code:_0x55911c,error_msg:_0x26182f,conclusionType:_0x4fba66,data:_0x287bc7}=_0x5639f7[_0x1583b8(0x1ed)];_0x55911c&&console[_0x1583b8(0x1e2)](_0x1583b8(0x19a),_0x26182f);if(_0x4fba66!==0x1){const _0x5f2c2a=[...new Set(_0x287bc7[_0x1583b8(0x197)](_0x4b4a6a=>this[_0x1583b8(0x1a2)](_0x4b4a6a['msg'])))];await this[_0x1583b8(0x1d6)](_0x12e8f6,_0x4697ea,[_0x1583b8(0x1bc)],_0x5f2c2a,_0x1583b8(0x1d7));const _0x418e78=_0x1583b8(0x1ca)+_0x5f2c2a['join'](',')+_0x1583b8(0x201);throw new common_1[(_0x1583b8(0x207))](_0x418e78,common_1[_0x1583b8(0x1e7)][_0x1583b8(0x1c8)]);}}async[_0x67b093(0x1a1)](_0x460d62,_0x88fe3f,_0x2a789c){const _0x30f552=_0x67b093;var _0x4d94b2;const {nineaiBuiltInSensitiveApiBase:_0x2a65c4,nineaiBuiltInSensitiveAuthKey:_0x2d5fb2}=_0x88fe3f;if(!_0x2a65c4||!_0x2d5fb2)return;const _0x213ac4=await axios_1['default'][_0x30f552(0x1a9)](_0x2a65c4,{'content':_0x460d62},{'headers':{'Content-Type':_0x30f552(0x1ac),'Authorization':_0x2d5fb2}});if(!_0x213ac4[_0x30f552(0x1ed)])return;if(_0x213ac4['data'][_0x30f552(0x1fa)]!=='0'){const {msg:msg=_0x30f552(0x1f5)}=_0x213ac4[_0x30f552(0x1ed)];throw new common_1[(_0x30f552(0x207))]('敏感词检测\x20|\x20'+msg,common_1[_0x30f552(0x1e7)][_0x30f552(0x1c8)]);}if(_0x213ac4[_0x30f552(0x1ed)]['word_list']&&((_0x4d94b2=_0x213ac4[_0x30f552(0x1ed)][_0x30f552(0x1cf)])===null||_0x4d94b2===void 0x0?void 0x0:_0x4d94b2['length'])){const _0x1fc571=[...new Set(_0x213ac4[_0x30f552(0x1ed)]['word_list']['map'](_0x5147d9=>_0x5147d9[_0x30f552(0x19d)]))],_0x2cc39c=[...new Set(_0x213ac4[_0x30f552(0x1ed)]['word_list']['map'](_0x2aa606=>_0x2aa606['category']))];await this[_0x30f552(0x1d6)](_0x2a789c,_0x460d62,_0x1fc571,_0x2cc39c,_0x30f552(0x1e9));const _0x2c745a=this[_0x30f552(0x1ba)](_0x213ac4[_0x30f552(0x1ed)][_0x30f552(0x1cf)]);throw new common_1[(_0x30f552(0x207))](_0x2c745a,common_1[_0x30f552(0x1e7)][_0x30f552(0x1c8)]);}}[_0x67b093(0x1ba)](_0x421a09){const _0x4d6101=_0x67b093,_0x36255d=_0x421a09[_0x4d6101(0x197)](_0x3833e5=>_0x3833e5[_0x4d6101(0x1de)]),_0x1097ff=[...new Set(_0x36255d)];return _0x4d6101(0x1d1)+_0x1097ff[_0x4d6101(0x1aa)](',')+_0x4d6101(0x1a0);}async[_0x67b093(0x1c0)](){const _0x15ae7e=_0x67b093,_0x5a65da=await this[_0x15ae7e(0x1d2)][_0x15ae7e(0x1f3)]({'where':{'status':0x1},'select':[_0x15ae7e(0x1f2)]});this['badWords']=_0x5a65da[_0x15ae7e(0x197)](_0x28c473=>_0x28c473[_0x15ae7e(0x1f2)]);}async[_0x67b093(0x1f0)](_0x39b40e){const _0xc7370=_0x67b093,{page:page=0x1,size:size=0x1f4,word:_0x3eb33d,status:_0x2cc15c}=_0x39b40e,_0x18fc2e={};[0x0,0x1,'0','1'][_0xc7370(0x206)](_0x2cc15c)&&(_0x18fc2e[_0xc7370(0x1c3)]=_0x2cc15c),_0x3eb33d&&(_0x18fc2e[_0xc7370(0x1f2)]=(0x0,typeorm_1[_0xc7370(0x202)])('%'+_0x3eb33d+'%'));const [_0x344c60,_0xab5187]=await this[_0xc7370(0x1d2)][_0xc7370(0x1fc)]({'where':_0x18fc2e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0xc7370(0x1b7)}});return{'rows':_0x344c60,'count':_0xab5187};}async[_0x67b093(0x1a7)](_0x3527e1){const _0x42a07e=_0x67b093,_0x4c94a8=await this[_0x42a07e(0x1d2)]['findOne']({'where':{'id':_0x3527e1['id']}});if(!_0x4c94a8)throw new common_1[(_0x42a07e(0x207))](_0x42a07e(0x1b3),common_1['HttpStatus']['BAD_REQUEST']);const _0x5bc424=await this[_0x42a07e(0x1d2)][_0x42a07e(0x1e6)]({'id':_0x3527e1['id']});if(_0x5bc424[_0x42a07e(0x204)]>0x0)return await this[_0x42a07e(0x1c0)](),'删除敏感词成功';else throw new common_1[(_0x42a07e(0x207))](_0x42a07e(0x1ef),common_1[_0x42a07e(0x1e7)]['BAD_REQUEST']);}async['updateBadWords'](_0x2826e2){const _0x3c22c6=_0x67b093,{id:_0x5d00c4,word:_0x5e1555,status:_0x4ff9d2}=_0x2826e2,_0x5f5671=await this['badWordsEntity'][_0x3c22c6(0x1c1)]({'where':{'word':_0x5e1555}});if(_0x5f5671)throw new common_1[(_0x3c22c6(0x207))](_0x3c22c6(0x19f),common_1['HttpStatus'][_0x3c22c6(0x1c8)]);const _0x2b6046=await this['badWordsEntity'][_0x3c22c6(0x1c2)]({'id':_0x5d00c4},{'word':_0x5e1555,'status':_0x4ff9d2});if(_0x2b6046[_0x3c22c6(0x204)]>0x0)return await this[_0x3c22c6(0x1c0)](),_0x3c22c6(0x1d5);else throw new common_1['HttpException'](_0x3c22c6(0x198),common_1['HttpStatus']['BAD_REQUEST']);}async['addBadWord'](_0x341f3a){const _0x20c922=_0x67b093,{word:_0xc67ce}=_0x341f3a,_0x515918=await this[_0x20c922(0x1d2)][_0x20c922(0x1c1)]({'where':{'word':_0xc67ce}});if(_0x515918)throw new common_1[(_0x20c922(0x207))](_0x20c922(0x1e4),common_1[_0x20c922(0x1e7)][_0x20c922(0x1c8)]);return await this['badWordsEntity']['save']({'word':_0xc67ce}),await this[_0x20c922(0x1c0)](),_0x20c922(0x1a4);}async[_0x67b093(0x1d6)](_0x3dc3c7,_0x4d9b72,_0x4ed3b4,_0x3a292a,_0xb286d){const _0x36db58=_0x67b093,_0x4d0c16={'userId':_0x3dc3c7,'content':_0x4d9b72,'words':JSON[_0x36db58(0x1eb)](_0x4ed3b4),'typeCn':JSON[_0x36db58(0x1eb)](_0x3a292a),'typeOriginCn':_0xb286d};try{await this[_0x36db58(0x1c7)][_0x36db58(0x1af)]()['update'](user_entity_1[_0x36db58(0x1bb)])['set']({'violationCount':()=>_0x36db58(0x1d4)})[_0x36db58(0x1ea)](_0x36db58(0x1db),{'userId':_0x3dc3c7})[_0x36db58(0x195)](),await this[_0x36db58(0x1e3)]['save'](_0x4d0c16);}catch(_0x15873e){console[_0x36db58(0x1e2)](_0x36db58(0x1e5),_0x15873e);}}async['violation'](_0x31ee65,_0x472747){const _0x5d0d8d=_0x67b093,{role:_0x20524b}=_0x31ee65[_0x5d0d8d(0x1d3)],{page:page=0x1,size:size=0xa,userId:_0x2910bb,typeOriginCn:_0xb52592}=_0x472747,_0x1b3991={};_0x2910bb&&(_0x1b3991[_0x5d0d8d(0x1cd)]=_0x2910bb),_0xb52592&&(_0x1b3991[_0x5d0d8d(0x203)]=_0xb52592);const [_0x4af318,_0x43198c]=await this['violationLogEntity'][_0x5d0d8d(0x1fc)]({'where':_0x1b3991,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5d0d8d(0x1d9)}}),_0x44436f=[...new Set(_0x4af318['map'](_0x3296e3=>_0x3296e3[_0x5d0d8d(0x1cd)]))],_0x2739d7=await this[_0x5d0d8d(0x1c7)][_0x5d0d8d(0x1f3)]({'where':{'id':(0x0,typeorm_1['In'])(_0x44436f)},'select':['id',_0x5d0d8d(0x1dc),'username',_0x5d0d8d(0x1b5),_0x5d0d8d(0x1a3),'status']});return _0x4af318[_0x5d0d8d(0x1ee)](_0x577fc0=>{const _0x5d4854=_0x5d0d8d,_0x9be952=_0x2739d7[_0x5d4854(0x1f3)](_0x3a9d12=>_0x3a9d12['id']===_0x577fc0['userId']);_0x20524b!==_0x5d4854(0x1d8)&&(_0x9be952[_0x5d4854(0x1b5)]=(0x0,utils_1[_0x5d4854(0x1be)])(_0x9be952[_0x5d4854(0x1b5)])),_0x577fc0[_0x5d4854(0x1d0)]=_0x9be952;}),{'rows':_0x4af318,'count':_0x43198c};}};BadwordsService=__decorate([(0x0,common_1[_0x67b093(0x1da)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x67b093(0x1bf)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x67b093(0x1bf)])(user_entity_1['UserEntity'])),__metadata(_0x67b093(0x1a5),[typeorm_1[_0x67b093(0x205)],typeorm_1[_0x67b093(0x205)],typeorm_1[_0x67b093(0x205)],globalConfig_service_1[_0x67b093(0x1b8)]])],BadwordsService),exports['BadwordsService']=BadwordsService;