'use strict';function _0x2e54(){const _0x62a7a3=['violation','getSensitiveConfig','includes','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','updateBadWords','globalConfigService','find','nineai','baidu','12277544oiJLoW','userId','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','./violationLog.entity','update','@nestjs/common','application/json','更新敏感词失败','delete','map','error:\x20','./badwords.entity','extractContent','baiduTextAccessToken','__param','4239645RfPRUP','category','createQueryBuilder','InjectRepository','super','length','nineaiCheckBadWords','敏感词已经存在了、请勿重复添加','execute','code','ViolationLogEntity','30KIEoic','word_list','userEntity','affected','status','Like','DESC','user','formarTips','hideString','__decorate','您提交的内容中包含','更新敏感词成功','violationLogEntity','delBadWords','queryBadWords','ASC','1221773iEZjEC','object','207964FBSOfC','977494vacbTw','decorate','stringify','design:paramtypes','loadBadWords','敏感词已存在,请检查您的提交信息','forEach','typeOriginCn','badWordsEntity','getOwnPropertyDescriptor','HttpException','__esModule','join','metadata','../globalConfig/globalConfig.service','***','BAD_REQUEST','function','删除敏感词失败','post','checkBadWords','where','自定义检测','findOne','1326753NHUeYZ','typeorm','set','axios','violationCount','recordUserBadWords','application/x-www-form-urlencoded','添加敏感词成功','@nestjs/typeorm','customSensitiveWords','badWords','的信息、我们已对您账号进行标记、请合规使用！','HttpStatus','id\x20=\x20:userId','敏感词不存在,请检查您的提交信息','UserEntity','../../common/utils','avatar','userInfo','检测失败','删除敏感词成功','百度文本检测出现错误、请查看配置信息:\x20','save','自定义','email','word','BadwordsService','Injectable','keyword','602976bCtvvC','log','defineProperty','data','__metadata','baiduCheckBadWords','msg','Repository','findAndCount'];_0x2e54=function(){return _0x62a7a3;};return _0x2e54();}const _0x227289=_0x57ee;(function(_0x26bec2,_0x5e87a4){const _0xe829e=_0x57ee,_0x59121e=_0x26bec2();while(!![]){try{const _0x224eca=parseInt(_0xe829e(0x142))/0x1+-parseInt(_0xe829e(0x12a))/0x2+-parseInt(_0xe829e(0x15f))/0x3+-parseInt(_0xe829e(0x129))/0x4+parseInt(_0xe829e(0x10b))/0x5+parseInt(_0xe829e(0x116))/0x6*(parseInt(_0xe829e(0x127))/0x7)+-parseInt(_0xe829e(0xfc))/0x8;if(_0x224eca===_0x5e87a4)break;else _0x59121e['push'](_0x59121e['shift']());}catch(_0x4a7085){_0x59121e['push'](_0x59121e['shift']());}}}(_0x2e54,0xbc38a));function _0x57ee(_0x5ea435,_0x2f74d1){const _0x2e5408=_0x2e54();return _0x57ee=function(_0x57ee7a,_0x4f8a7b){_0x57ee7a=_0x57ee7a-0xee;let _0x31e06e=_0x2e5408[_0x57ee7a];return _0x31e06e;},_0x57ee(_0x5ea435,_0x2f74d1);}var __decorate=this&&this[_0x227289(0x120)]||function(_0x56e118,_0x59b575,_0x1c6f55,_0x3f532b){const _0x289b61=_0x227289;var _0x428901=arguments['length'],_0x4946bb=_0x428901<0x3?_0x59b575:_0x3f532b===null?_0x3f532b=Object[_0x289b61(0x133)](_0x59b575,_0x1c6f55):_0x3f532b,_0x2ea362;if(typeof Reflect==='object'&&typeof Reflect[_0x289b61(0x12b)]===_0x289b61(0x13b))_0x4946bb=Reflect[_0x289b61(0x12b)](_0x56e118,_0x59b575,_0x1c6f55,_0x3f532b);else{for(var _0x278987=_0x56e118['length']-0x1;_0x278987>=0x0;_0x278987--)if(_0x2ea362=_0x56e118[_0x278987])_0x4946bb=(_0x428901<0x3?_0x2ea362(_0x4946bb):_0x428901>0x3?_0x2ea362(_0x59b575,_0x1c6f55,_0x4946bb):_0x2ea362(_0x59b575,_0x1c6f55))||_0x4946bb;}return _0x428901>0x3&&_0x4946bb&&Object[_0x289b61(0x161)](_0x59b575,_0x1c6f55,_0x4946bb),_0x4946bb;},__metadata=this&&this[_0x227289(0xee)]||function(_0x2f8aa6,_0x2c66e9){const _0x47907e=_0x227289;if(typeof Reflect===_0x47907e(0x128)&&typeof Reflect[_0x47907e(0x137)]===_0x47907e(0x13b))return Reflect[_0x47907e(0x137)](_0x2f8aa6,_0x2c66e9);},__param=this&&this[_0x227289(0x10a)]||function(_0x48b1b9,_0x2892c1){return function(_0x2293a4,_0x550757){_0x2892c1(_0x2293a4,_0x550757,_0x48b1b9);};};Object[_0x227289(0x161)](exports,_0x227289(0x135),{'value':!![]}),exports[_0x227289(0x15c)]=void 0x0;const globalConfig_service_1=require(_0x227289(0x138)),common_1=require(_0x227289(0x101)),badwords_entity_1=require(_0x227289(0x107)),typeorm_1=require(_0x227289(0x143)),typeorm_2=require(_0x227289(0x14a)),axios_1=require(_0x227289(0x145)),violationLog_entity_1=require(_0x227289(0xff)),user_entity_1=require('../user/user.entity'),utils_1=require(_0x227289(0x152));let BadwordsService=class BadwordsService{constructor(_0x380e10,_0x69bb5e,_0x2e38dc,_0x527e37){const _0x2dce0d=_0x227289;this[_0x2dce0d(0x132)]=_0x380e10,this[_0x2dce0d(0x123)]=_0x69bb5e,this[_0x2dce0d(0x118)]=_0x2e38dc,this[_0x2dce0d(0xf8)]=_0x527e37,this[_0x2dce0d(0x14c)]=[];}async['onModuleInit'](){const _0x1ad96b=_0x227289;this[_0x1ad96b(0x12e)]();}async[_0x227289(0x14b)](_0x55350e,_0x27af29){const _0x489a22=_0x227289,_0x28e2da=[];for(let _0x2e1f63=0x0;_0x2e1f63<this['badWords'][_0x489a22(0x110)];_0x2e1f63++){const _0x1da9b6=this[_0x489a22(0x14c)][_0x2e1f63];_0x55350e[_0x489a22(0xf5)](_0x1da9b6)&&_0x28e2da['push'](_0x1da9b6);}if(_0x28e2da[_0x489a22(0x110)]){await this[_0x489a22(0x147)](_0x27af29,_0x55350e,_0x28e2da,[_0x489a22(0x159)],_0x489a22(0x140));const _0x268fdf=_0x489a22(0xfe);throw new common_1[(_0x489a22(0x134))](_0x268fdf,common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x227289(0x13e)](_0x3ec1f3,_0x5cb365){const _0x220b85=_0x227289,_0x3de6cf=await this[_0x220b85(0xf8)][_0x220b85(0xf4)]();_0x3de6cf&&await this['checkBadWordsByConfig'](_0x3ec1f3,_0x3de6cf,_0x5cb365),await this[_0x220b85(0x14b)](_0x3ec1f3,_0x5cb365);}async['checkBadWordsByConfig'](_0x5186b0,_0x23a2b7,_0x24ea63){const _0x5b25a3=_0x227289,{useType:_0x33b104}=_0x23a2b7;_0x33b104===_0x5b25a3(0xfb)&&await this[_0x5b25a3(0xef)](_0x5186b0,_0x23a2b7[_0x5b25a3(0x109)],_0x24ea63),_0x33b104===_0x5b25a3(0xfa)&&await this[_0x5b25a3(0x111)](_0x5186b0,_0x23a2b7,_0x24ea63);}[_0x227289(0x108)](_0x175677){const _0x37b680=/存在(.*?)不合规/,_0xb320a7=_0x175677['match'](_0x37b680);return _0xb320a7?_0xb320a7[0x1]:'';}async[_0x227289(0xef)](_0x3fadf0,_0x585a01,_0x29b35f){const _0x32242e=_0x227289;if(!_0x585a01)return;const _0x3ab55d=_0x32242e(0xf6)+_0x585a01+'}',_0x111f1c={'Content-Type':_0x32242e(0x148),'Accept':'application/json'},_0x4c31b=await axios_1['default']['post'](_0x3ab55d,{'text':_0x3fadf0},{'headers':_0x111f1c}),{conclusion:_0x203bbc,error_code:_0x569e9a,error_msg:_0x485497,conclusionType:_0x3da56b,data:_0xca4d8b}=_0x4c31b[_0x32242e(0x162)];_0x569e9a&&console[_0x32242e(0x160)](_0x32242e(0x157),_0x485497);if(_0x3da56b!==0x1){const _0x1930cb=[...new Set(_0xca4d8b[_0x32242e(0x105)](_0x241659=>this['extractContent'](_0x241659[_0x32242e(0xf0)])))];await this[_0x32242e(0x147)](_0x29b35f,_0x3fadf0,[_0x32242e(0x139)],_0x1930cb,'百度云检测');const _0x21c9dd='您提交的信息中包含'+_0x1930cb[_0x32242e(0x136)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x32242e(0x134))](_0x21c9dd,common_1[_0x32242e(0x14e)][_0x32242e(0x13a)]);}}async['nineaiCheckBadWords'](_0x52576f,_0x373c23,_0x1770eb){const _0x37e4ef=_0x227289;var _0x511a58;const {nineaiBuiltInSensitiveApiBase:_0x17249f,nineaiBuiltInSensitiveAuthKey:_0x825c1c}=_0x373c23;if(!_0x17249f||!_0x825c1c)return;const _0x598d47=await axios_1['default'][_0x37e4ef(0x13d)](_0x17249f,{'content':_0x52576f},{'headers':{'Content-Type':_0x37e4ef(0x102),'Authorization':_0x825c1c}});if(!_0x598d47[_0x37e4ef(0x162)])return;if(_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x114)]!=='0'){const {msg:msg=_0x37e4ef(0x155)}=_0x598d47[_0x37e4ef(0x162)];throw new common_1[(_0x37e4ef(0x134))]('敏感词检测\x20|\x20'+msg,common_1[_0x37e4ef(0x14e)][_0x37e4ef(0x13a)]);}if(_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x117)]&&((_0x511a58=_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x117)])===null||_0x511a58===void 0x0?void 0x0:_0x511a58[_0x37e4ef(0x110)])){const _0x275203=[...new Set(_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x117)]['map'](_0x158909=>_0x158909[_0x37e4ef(0x15e)]))],_0x4b6d13=[...new Set(_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x117)][_0x37e4ef(0x105)](_0x19e7fe=>_0x19e7fe[_0x37e4ef(0x10c)]))];await this[_0x37e4ef(0x147)](_0x1770eb,_0x52576f,_0x275203,_0x4b6d13,'NineAi检测');const _0x3d71a1=this[_0x37e4ef(0x11e)](_0x598d47[_0x37e4ef(0x162)][_0x37e4ef(0x117)]);throw new common_1[(_0x37e4ef(0x134))](_0x3d71a1,common_1[_0x37e4ef(0x14e)][_0x37e4ef(0x13a)]);}}['formarTips'](_0x207efd){const _0x51c7e7=_0x227289,_0x4186c6=_0x207efd[_0x51c7e7(0x105)](_0x30b9cb=>_0x30b9cb[_0x51c7e7(0x10c)]),_0x3e7db6=[...new Set(_0x4186c6)];return _0x51c7e7(0x121)+_0x3e7db6['join'](',')+_0x51c7e7(0x14d);}async[_0x227289(0x12e)](){const _0x586aac=_0x227289,_0x3f1287=await this['badWordsEntity']['find']({'where':{'status':0x1},'select':[_0x586aac(0x15b)]});this[_0x586aac(0x14c)]=_0x3f1287[_0x586aac(0x105)](_0x1ec5e5=>_0x1ec5e5[_0x586aac(0x15b)]);}async[_0x227289(0x125)](_0x3fdaa6){const _0x17a6dc=_0x227289,{page:page=0x1,size:size=0x1f4,word:_0x40058a,status:_0x29a151}=_0x3fdaa6,_0x40c973={};[0x0,0x1,'0','1'][_0x17a6dc(0xf5)](_0x29a151)&&(_0x40c973[_0x17a6dc(0x11a)]=_0x29a151),_0x40058a&&(_0x40c973[_0x17a6dc(0x15b)]=(0x0,typeorm_1[_0x17a6dc(0x11b)])('%'+_0x40058a+'%'));const [_0x1bebb9,_0x438493]=await this[_0x17a6dc(0x132)][_0x17a6dc(0xf2)]({'where':_0x40c973,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x17a6dc(0x126)}});return{'rows':_0x1bebb9,'count':_0x438493};}async[_0x227289(0x124)](_0x21f09f){const _0x39ae09=_0x227289,_0x5d7423=await this[_0x39ae09(0x132)]['findOne']({'where':{'id':_0x21f09f['id']}});if(!_0x5d7423)throw new common_1['HttpException'](_0x39ae09(0x150),common_1[_0x39ae09(0x14e)][_0x39ae09(0x13a)]);const _0x5dcdfb=await this[_0x39ae09(0x132)][_0x39ae09(0x104)]({'id':_0x21f09f['id']});if(_0x5dcdfb[_0x39ae09(0x119)]>0x0)return await this['loadBadWords'](),_0x39ae09(0x156);else throw new common_1['HttpException'](_0x39ae09(0x13c),common_1[_0x39ae09(0x14e)][_0x39ae09(0x13a)]);}async[_0x227289(0xf7)](_0x5d15c0){const _0x5e3eb1=_0x227289,{id:_0x385875,word:_0x331946,status:_0x4222cc}=_0x5d15c0,_0x25be6c=await this['badWordsEntity']['findOne']({'where':{'word':_0x331946}});if(_0x25be6c)throw new common_1[(_0x5e3eb1(0x134))](_0x5e3eb1(0x112),common_1['HttpStatus']['BAD_REQUEST']);const _0x237793=await this['badWordsEntity'][_0x5e3eb1(0x100)]({'id':_0x385875},{'word':_0x331946,'status':_0x4222cc});if(_0x237793[_0x5e3eb1(0x119)]>0x0)return await this['loadBadWords'](),_0x5e3eb1(0x122);else throw new common_1[(_0x5e3eb1(0x134))](_0x5e3eb1(0x103),common_1[_0x5e3eb1(0x14e)][_0x5e3eb1(0x13a)]);}async['addBadWord'](_0x5c3761){const _0x3757b7=_0x227289,{word:_0x78d6b5}=_0x5c3761,_0x582a50=await this[_0x3757b7(0x132)][_0x3757b7(0x141)]({'where':{'word':_0x78d6b5}});if(_0x582a50)throw new common_1['HttpException'](_0x3757b7(0x12f),common_1['HttpStatus'][_0x3757b7(0x13a)]);return await this[_0x3757b7(0x132)]['save']({'word':_0x78d6b5}),await this[_0x3757b7(0x12e)](),_0x3757b7(0x149);}async[_0x227289(0x147)](_0x4e6b9a,_0x1c789d,_0x237250,_0x309495,_0x2c7272){const _0x3767a1=_0x227289,_0x449cf3={'userId':_0x4e6b9a,'content':_0x1c789d,'words':JSON[_0x3767a1(0x12c)](_0x237250),'typeCn':JSON[_0x3767a1(0x12c)](_0x309495),'typeOriginCn':_0x2c7272};try{await this[_0x3767a1(0x118)][_0x3767a1(0x10d)]()[_0x3767a1(0x100)](user_entity_1[_0x3767a1(0x151)])[_0x3767a1(0x144)]({'violationCount':()=>'violationCount\x20+\x201'})[_0x3767a1(0x13f)](_0x3767a1(0x14f),{'userId':_0x4e6b9a})[_0x3767a1(0x113)](),await this[_0x3767a1(0x123)][_0x3767a1(0x158)](_0x449cf3);}catch(_0x2993b3){console[_0x3767a1(0x160)](_0x3767a1(0x106),_0x2993b3);}}async[_0x227289(0xf3)](_0xe1f24a,_0x8b5c87){const _0x55f5ee=_0x227289,{role:_0x36b7dd}=_0xe1f24a[_0x55f5ee(0x11d)],{page:page=0x1,size:size=0xa,userId:_0x3f138e,typeOriginCn:_0x5a5cc4}=_0x8b5c87,_0x479632={};_0x3f138e&&(_0x479632['userId']=_0x3f138e),_0x5a5cc4&&(_0x479632[_0x55f5ee(0x131)]=_0x5a5cc4);const [_0xc69996,_0x44d80f]=await this[_0x55f5ee(0x123)][_0x55f5ee(0xf2)]({'where':_0x479632,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x55f5ee(0x11c)}}),_0x497eef=[...new Set(_0xc69996[_0x55f5ee(0x105)](_0x38f200=>_0x38f200[_0x55f5ee(0xfd)]))],_0x1c3a12=await this[_0x55f5ee(0x118)][_0x55f5ee(0xf9)]({'where':{'id':(0x0,typeorm_1['In'])(_0x497eef)},'select':['id',_0x55f5ee(0x153),'username',_0x55f5ee(0x15a),_0x55f5ee(0x146),_0x55f5ee(0x11a)]});return _0xc69996[_0x55f5ee(0x130)](_0x399b1b=>{const _0x1aab2d=_0x55f5ee,_0x343a0f=_0x1c3a12[_0x1aab2d(0xf9)](_0x203a2c=>_0x203a2c['id']===_0x399b1b[_0x1aab2d(0xfd)]);_0x36b7dd!==_0x1aab2d(0x10f)&&(_0x343a0f[_0x1aab2d(0x15a)]=(0x0,utils_1[_0x1aab2d(0x11f)])(_0x343a0f['email'])),_0x399b1b[_0x1aab2d(0x154)]=_0x343a0f;}),{'rows':_0xc69996,'count':_0x44d80f};}};BadwordsService=__decorate([(0x0,common_1[_0x227289(0x15d)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x227289(0x115)])),__param(0x2,(0x0,typeorm_2[_0x227289(0x10e)])(user_entity_1[_0x227289(0x151)])),__metadata(_0x227289(0x12d),[typeorm_1[_0x227289(0xf1)],typeorm_1['Repository'],typeorm_1[_0x227289(0xf1)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0x227289(0x15c)]=BadwordsService;