'use strict';const _0x210085=_0x35bf;(function(_0x102ac0,_0x59632f){const _0x517f26=_0x35bf,_0x4cce1a=_0x102ac0();while(!![]){try{const _0x3f5336=-parseInt(_0x517f26(0x9d))/0x1*(-parseInt(_0x517f26(0x93))/0x2)+parseInt(_0x517f26(0x7b))/0x3+parseInt(_0x517f26(0xaa))/0x4*(parseInt(_0x517f26(0xa3))/0x5)+-parseInt(_0x517f26(0xcd))/0x6+-parseInt(_0x517f26(0xa1))/0x7*(-parseInt(_0x517f26(0x82))/0x8)+-parseInt(_0x517f26(0x96))/0x9*(-parseInt(_0x517f26(0xc8))/0xa)+-parseInt(_0x517f26(0xd1))/0xb*(parseInt(_0x517f26(0xe2))/0xc);if(_0x3f5336===_0x59632f)break;else _0x4cce1a['push'](_0x4cce1a['shift']());}catch(_0xa30d78){_0x4cce1a['push'](_0x4cce1a['shift']());}}}(_0x43ef,0x35a91));var __decorate=this&&this[_0x210085(0xad)]||function(_0x56252b,_0x55ca48,_0x4107fe,_0x55171b){const _0x4898ce=_0x210085;var _0x5a3edf=arguments[_0x4898ce(0x81)],_0x2263b0=_0x5a3edf<0x3?_0x55ca48:_0x55171b===null?_0x55171b=Object[_0x4898ce(0xe3)](_0x55ca48,_0x4107fe):_0x55171b,_0x8ce75c;if(typeof Reflect===_0x4898ce(0xed)&&typeof Reflect['decorate']==='function')_0x2263b0=Reflect[_0x4898ce(0xcc)](_0x56252b,_0x55ca48,_0x4107fe,_0x55171b);else{for(var _0xb2a5d2=_0x56252b[_0x4898ce(0x81)]-0x1;_0xb2a5d2>=0x0;_0xb2a5d2--)if(_0x8ce75c=_0x56252b[_0xb2a5d2])_0x2263b0=(_0x5a3edf<0x3?_0x8ce75c(_0x2263b0):_0x5a3edf>0x3?_0x8ce75c(_0x55ca48,_0x4107fe,_0x2263b0):_0x8ce75c(_0x55ca48,_0x4107fe))||_0x2263b0;}return _0x5a3edf>0x3&&_0x2263b0&&Object[_0x4898ce(0x8a)](_0x55ca48,_0x4107fe,_0x2263b0),_0x2263b0;},__metadata=this&&this['__metadata']||function(_0x525855,_0x226f40){const _0xd64296=_0x210085;if(typeof Reflect===_0xd64296(0xed)&&typeof Reflect[_0xd64296(0x97)]==='function')return Reflect[_0xd64296(0x97)](_0x525855,_0x226f40);},__param=this&&this['__param']||function(_0xa7aa12,_0x4071c6){return function(_0x11ddb7,_0xb13c67){_0x4071c6(_0x11ddb7,_0xb13c67,_0xa7aa12);};};Object[_0x210085(0x8a)](exports,'__esModule',{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x210085(0xa2)),common_1=require(_0x210085(0xaf)),badwords_entity_1=require(_0x210085(0xec)),typeorm_1=require(_0x210085(0x9c)),typeorm_2=require(_0x210085(0x95)),axios_1=require(_0x210085(0x90)),violationLog_entity_1=require(_0x210085(0xc7)),user_entity_1=require('../user/user.entity'),utils_1=require(_0x210085(0xeb));let BadwordsService=class BadwordsService{constructor(_0x911694,_0x36fc42,_0x121f29,_0x350df7){const _0x2ee9b2=_0x210085;this[_0x2ee9b2(0xc6)]=_0x911694,this[_0x2ee9b2(0xbf)]=_0x36fc42,this[_0x2ee9b2(0xd6)]=_0x121f29,this[_0x2ee9b2(0x8d)]=_0x350df7,this[_0x2ee9b2(0xb9)]=[];}async[_0x210085(0x9a)](){this['loadBadWords']();}async['customSensitiveWords'](_0x351053,_0x4d2c9a){const _0x464c1f=_0x210085,_0x5b6973=[];for(let _0x3e0162=0x0;_0x3e0162<this[_0x464c1f(0xb9)]['length'];_0x3e0162++){const _0x3970e8=this[_0x464c1f(0xb9)][_0x3e0162];_0x351053[_0x464c1f(0x9e)](_0x3970e8)&&_0x5b6973[_0x464c1f(0xdc)](_0x3970e8);}if(_0x5b6973[_0x464c1f(0x81)]){await this[_0x464c1f(0xc1)](_0x4d2c9a,_0x351053,_0x5b6973,[_0x464c1f(0xb0)],'自定义检测');const _0x16e535=_0x464c1f(0xc0);throw new common_1[(_0x464c1f(0x86))](_0x16e535,common_1[_0x464c1f(0x7f)]['BAD_REQUEST']);}}async[_0x210085(0xdd)](_0x300c63,_0x1b7571){const _0xe667b5=_0x210085,_0x10029d=await this[_0xe667b5(0x8d)][_0xe667b5(0xbe)]();_0x10029d&&await this[_0xe667b5(0x80)](_0x300c63,_0x10029d,_0x1b7571),await this[_0xe667b5(0xc3)](_0x300c63,_0x1b7571);}async['checkBadWordsByConfig'](_0x2009a5,_0x1387d5,_0x1750d6){const _0x478dff=_0x210085,{useType:_0x54adb9}=_0x1387d5;_0x54adb9==='baidu'&&await this[_0x478dff(0x88)](_0x2009a5,_0x1387d5[_0x478dff(0xde)],_0x1750d6),_0x54adb9==='nineai'&&await this[_0x478dff(0x98)](_0x2009a5,_0x1387d5,_0x1750d6);}[_0x210085(0x9b)](_0x86b818){const _0x518ac1=_0x210085,_0x44c852=/存在(.*?)不合规/,_0x586a3c=_0x86b818[_0x518ac1(0xac)](_0x44c852);return _0x586a3c?_0x586a3c[0x1]:'';}async['baiduCheckBadWords'](_0x5ebebb,_0x3eb4c3,_0x532ed8){const _0x4fc212=_0x210085;if(!_0x3eb4c3)return;const _0x584e20=_0x4fc212(0xe7)+_0x3eb4c3+'}',_0x4171a7={'Content-Type':_0x4fc212(0xab),'Accept':_0x4fc212(0xd5)},_0xc0d638=await axios_1[_0x4fc212(0x92)][_0x4fc212(0xea)](_0x584e20,{'text':_0x5ebebb},{'headers':_0x4171a7}),{conclusion:_0x49f4d7,error_code:_0x57a222,error_msg:_0x409f7a,conclusionType:_0x7c335e,data:_0x3fa7e4}=_0xc0d638['data'];_0x57a222&&console[_0x4fc212(0x84)](_0x4fc212(0xb5),_0x409f7a);if(_0x7c335e!==0x1){const _0x46597a=[...new Set(_0x3fa7e4[_0x4fc212(0x8c)](_0x28f609=>this[_0x4fc212(0x9b)](_0x28f609['msg'])))];await this[_0x4fc212(0xc1)](_0x532ed8,_0x5ebebb,[_0x4fc212(0x7e)],_0x46597a,_0x4fc212(0xe1));const _0x2d4385='您提交的信息中包含'+_0x46597a[_0x4fc212(0xd2)](',')+_0x4fc212(0xe0);throw new common_1[(_0x4fc212(0x86))](_0x2d4385,common_1[_0x4fc212(0x7f)][_0x4fc212(0x8b)]);}}async[_0x210085(0x98)](_0x2cb660,_0x121097,_0x12b15e){const _0x1c3774=_0x210085;var _0x5a95e0;const {nineaiBuiltInSensitiveApiBase:_0x3c9422,nineaiBuiltInSensitiveAuthKey:_0x16532e}=_0x121097;if(!_0x3c9422||!_0x16532e)return;const _0x5e70cb=await axios_1['default'][_0x1c3774(0xea)](_0x3c9422,{'content':_0x2cb660},{'headers':{'Content-Type':_0x1c3774(0xd5),'Authorization':_0x16532e}});if(!_0x5e70cb['data'])return;if(_0x5e70cb[_0x1c3774(0x91)][_0x1c3774(0xa0)]!=='0'){const {msg:msg=_0x1c3774(0xa7)}=_0x5e70cb[_0x1c3774(0x91)];throw new common_1[(_0x1c3774(0x86))](_0x1c3774(0xb1)+msg,common_1[_0x1c3774(0x7f)]['BAD_REQUEST']);}if(_0x5e70cb[_0x1c3774(0x91)]['word_list']&&((_0x5a95e0=_0x5e70cb[_0x1c3774(0x91)][_0x1c3774(0xb6)])===null||_0x5a95e0===void 0x0?void 0x0:_0x5a95e0[_0x1c3774(0x81)])){const _0x46a92c=[...new Set(_0x5e70cb[_0x1c3774(0x91)][_0x1c3774(0xb6)][_0x1c3774(0x8c)](_0x111f39=>_0x111f39[_0x1c3774(0xa4)]))],_0xb6704b=[...new Set(_0x5e70cb[_0x1c3774(0x91)][_0x1c3774(0xb6)]['map'](_0x1231c6=>_0x1231c6[_0x1c3774(0xae)]))];await this[_0x1c3774(0xc1)](_0x12b15e,_0x2cb660,_0x46a92c,_0xb6704b,'NineAi检测');const _0x292864=this[_0x1c3774(0xbb)](_0x5e70cb[_0x1c3774(0x91)][_0x1c3774(0xb6)]);throw new common_1[(_0x1c3774(0x86))](_0x292864,common_1['HttpStatus'][_0x1c3774(0x8b)]);}}[_0x210085(0xbb)](_0x246a78){const _0x573666=_0x210085,_0x3b0d37=_0x246a78[_0x573666(0x8c)](_0x36db9b=>_0x36db9b[_0x573666(0xae)]),_0x5a7391=[...new Set(_0x3b0d37)];return _0x573666(0x7c)+_0x5a7391[_0x573666(0xd2)](',')+_0x573666(0x8e);}async[_0x210085(0x87)](){const _0x436487=_0x210085,_0x12e603=await this[_0x436487(0xc6)][_0x436487(0xcf)]({'where':{'status':0x1},'select':[_0x436487(0xba)]});this['badWords']=_0x12e603[_0x436487(0x8c)](_0x3c68a0=>_0x3c68a0[_0x436487(0xba)]);}async[_0x210085(0xd4)](_0x33ec16){const _0x3fc23a=_0x210085,{page:page=0x1,size:size=0x1f4,word:_0x3a16c2,status:_0x508997}=_0x33ec16,_0x27709c={};[0x0,0x1,'0','1'][_0x3fc23a(0x9e)](_0x508997)&&(_0x27709c[_0x3fc23a(0x83)]=_0x508997),_0x3a16c2&&(_0x27709c[_0x3fc23a(0xba)]=(0x0,typeorm_1['Like'])('%'+_0x3a16c2+'%'));const [_0x34eab2,_0x2cdc61]=await this['badWordsEntity'][_0x3fc23a(0xc5)]({'where':_0x27709c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3fc23a(0x89)}});return{'rows':_0x34eab2,'count':_0x2cdc61};}async[_0x210085(0xbc)](_0x1eec68){const _0x502b43=_0x210085,_0x4027b6=await this[_0x502b43(0xc6)][_0x502b43(0x94)]({'where':{'id':_0x1eec68['id']}});if(!_0x4027b6)throw new common_1['HttpException'](_0x502b43(0xee),common_1[_0x502b43(0x7f)][_0x502b43(0x8b)]);const _0x3ba0d7=await this[_0x502b43(0xc6)]['delete']({'id':_0x1eec68['id']});if(_0x3ba0d7[_0x502b43(0xd9)]>0x0)return await this[_0x502b43(0x87)](),'删除敏感词成功';else throw new common_1['HttpException'](_0x502b43(0xd7),common_1['HttpStatus'][_0x502b43(0x8b)]);}async[_0x210085(0xca)](_0x2192fe){const _0x4b9714=_0x210085,{id:_0x50ac21,word:_0x4232db,status:_0x2888b2}=_0x2192fe,_0x949cb0=await this[_0x4b9714(0xc6)]['findOne']({'where':{'word':_0x4232db}});if(_0x949cb0)throw new common_1[(_0x4b9714(0x86))](_0x4b9714(0xa5),common_1['HttpStatus'][_0x4b9714(0x8b)]);const _0x163f47=await this['badWordsEntity'][_0x4b9714(0xb4)]({'id':_0x50ac21},{'word':_0x4232db,'status':_0x2888b2});if(_0x163f47['affected']>0x0)return await this[_0x4b9714(0x87)](),_0x4b9714(0xa6);else throw new common_1[(_0x4b9714(0x86))](_0x4b9714(0xbd),common_1[_0x4b9714(0x7f)][_0x4b9714(0x8b)]);}async['addBadWord'](_0x2cb4c1){const _0x5a6736=_0x210085,{word:_0x5026d5}=_0x2cb4c1,_0x3fe9ee=await this[_0x5a6736(0xc6)]['findOne']({'where':{'word':_0x5026d5}});if(_0x3fe9ee)throw new common_1[(_0x5a6736(0x86))]('敏感词已存在,请检查您的提交信息',common_1[_0x5a6736(0x7f)][_0x5a6736(0x8b)]);return await this[_0x5a6736(0xc6)]['save']({'word':_0x5026d5}),await this[_0x5a6736(0x87)](),_0x5a6736(0xce);}async[_0x210085(0xc1)](_0x1e5b24,_0x423926,_0x35f405,_0x5db10c,_0x4d3257){const _0x4be3b5=_0x210085,_0x257a25={'userId':_0x1e5b24,'content':_0x423926,'words':JSON['stringify'](_0x35f405),'typeCn':JSON[_0x4be3b5(0xdf)](_0x5db10c),'typeOriginCn':_0x4d3257};try{await this[_0x4be3b5(0xd6)][_0x4be3b5(0xc4)]()[_0x4be3b5(0xb4)](user_entity_1[_0x4be3b5(0xd8)])[_0x4be3b5(0xb2)]({'violationCount':()=>_0x4be3b5(0xd3)})[_0x4be3b5(0xe8)](_0x4be3b5(0xe9),{'userId':_0x1e5b24})[_0x4be3b5(0x99)](),await this[_0x4be3b5(0xbf)][_0x4be3b5(0xb8)](_0x257a25);}catch(_0x4f6f27){console[_0x4be3b5(0x84)]('error:\x20',_0x4f6f27);}}async[_0x210085(0xc2)](_0x5186c5,_0x2238b5){const _0x43a7a6=_0x210085,{role:_0x562d35}=_0x5186c5[_0x43a7a6(0xb7)],{page:page=0x1,size:size=0xa,userId:_0x24c7b5,typeOriginCn:_0x5d2e23}=_0x2238b5,_0x3bb823={};_0x24c7b5&&(_0x3bb823['userId']=_0x24c7b5),_0x5d2e23&&(_0x3bb823[_0x43a7a6(0xa9)]=_0x5d2e23);const [_0x202987,_0x5811d5]=await this[_0x43a7a6(0xbf)][_0x43a7a6(0xc5)]({'where':_0x3bb823,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x5e0ef1=[...new Set(_0x202987[_0x43a7a6(0x8c)](_0x2b299e=>_0x2b299e['userId']))],_0x3ef252=await this[_0x43a7a6(0xd6)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x5e0ef1)},'select':['id',_0x43a7a6(0x85),_0x43a7a6(0xd0),_0x43a7a6(0xe5),_0x43a7a6(0xa8),_0x43a7a6(0x83)]});return _0x202987[_0x43a7a6(0x7d)](_0x3d16b3=>{const _0x192989=_0x43a7a6,_0x2a619a=_0x3ef252[_0x192989(0xcf)](_0x277c73=>_0x277c73['id']===_0x3d16b3[_0x192989(0x9f)]);_0x562d35!==_0x192989(0x8f)&&(_0x2a619a['email']=(0x0,utils_1['hideString'])(_0x2a619a['email'])),_0x3d16b3['userInfo']=_0x2a619a;}),{'rows':_0x202987,'count':_0x5811d5};}};BadwordsService=__decorate([(0x0,common_1[_0x210085(0xe4)])(),__param(0x0,(0x0,typeorm_2[_0x210085(0xe6)])(badwords_entity_1[_0x210085(0xc9)])),__param(0x1,(0x0,typeorm_2[_0x210085(0xe6)])(violationLog_entity_1[_0x210085(0xdb)])),__param(0x2,(0x0,typeorm_2[_0x210085(0xe6)])(user_entity_1[_0x210085(0xd8)])),__metadata('design:paramtypes',[typeorm_1[_0x210085(0xda)],typeorm_1['Repository'],typeorm_1[_0x210085(0xda)],globalConfig_service_1[_0x210085(0xcb)]])],BadwordsService),exports[_0x210085(0xb3)]=BadwordsService;function _0x35bf(_0x6a519c,_0x271a68){const _0x43efc5=_0x43ef();return _0x35bf=function(_0x35bf1e,_0x1879e5){_0x35bf1e=_0x35bf1e-0x7b;let _0x2e6f09=_0x43efc5[_0x35bf1e];return _0x2e6f09;},_0x35bf(_0x6a519c,_0x271a68);}function _0x43ef(){const _0x1330b5=['default','2fVtOcH','findOne','@nestjs/typeorm','18RsSkJr','metadata','nineaiCheckBadWords','execute','onModuleInit','extractContent','typeorm','72649RBCbfn','includes','userId','code','19733aeeufr','../globalConfig/globalConfig.service','70tjnpno','keyword','敏感词已经存在了、请勿重复添加','更新敏感词成功','检测失败','violationCount','typeOriginCn','120780CZVCTy','application/x-www-form-urlencoded','match','__decorate','category','@nestjs/common','自定义','敏感词检测\x20|\x20','set','BadwordsService','update','百度文本检测出现错误、请查看配置信息:\x20','word_list','user','save','badWords','word','formarTips','delBadWords','更新敏感词失败','getSensitiveConfig','violationLogEntity','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','recordUserBadWords','violation','customSensitiveWords','createQueryBuilder','findAndCount','badWordsEntity','./violationLog.entity','2168430rlrFiO','BadWordsEntity','updateBadWords','GlobalConfigService','decorate','2382966efybWt','添加敏感词成功','find','username','1469281RDlcGT','join','violationCount\x20+\x201','queryBadWords','application/json','userEntity','删除敏感词失败','UserEntity','affected','Repository','ViolationLogEntity','push','checkBadWords','baiduTextAccessToken','stringify','的内容、我们已对您的账户进行标记、请合规使用！','百度云检测','60OIrLQU','getOwnPropertyDescriptor','Injectable','email','InjectRepository','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','where','id\x20=\x20:userId','post','../../common/utils','./badwords.entity','object','敏感词不存在,请检查您的提交信息','915006nTuiLH','您提交的内容中包含','forEach','***','HttpStatus','checkBadWordsByConfig','length','144OMWQBE','status','log','avatar','HttpException','loadBadWords','baiduCheckBadWords','ASC','defineProperty','BAD_REQUEST','map','globalConfigService','的信息、我们已对您账号进行标记、请合规使用！','super','axios','data'];_0x43ef=function(){return _0x1330b5;};return _0x43ef();}