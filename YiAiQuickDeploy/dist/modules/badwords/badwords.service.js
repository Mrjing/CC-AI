'use strict';const _0x10e134=_0x1ad0;function _0x1ad0(_0x29bf04,_0x46896c){const _0x4b07bd=_0x4b07();return _0x1ad0=function(_0x1ad0dd,_0x13f0d5){_0x1ad0dd=_0x1ad0dd-0x117;let _0x3e418a=_0x4b07bd[_0x1ad0dd];return _0x3e418a;},_0x1ad0(_0x29bf04,_0x46896c);}function _0x4b07(){const _0x101073=['检测失败','join','onModuleInit','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','添加敏感词成功','baiduCheckBadWords','decorate','badWordsEntity','BAD_REQUEST','ViolationLogEntity','DESC','violationCount','7ewMVrP','loadBadWords','删除敏感词失败','stringify','execute','baidu','length','百度文本检测出现错误、请查看配置信息:\x20','push','的内容、我们已对您的账户进行标记、请合规使用！','@nestjs/common','customSensitiveWords','typeOriginCn','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','log','defineProperty','userId','***','addBadWord','save','161060OSZwZM','userInfo','map','status','violationCount\x20+\x201','../../common/utils','36uItQPu','Like','768660sVuMtX','1494891DjgQpU','135545Uecghm','411886SjlIyU','category','checkBadWordsByConfig','5485896JVKLBL','username','formarTips','forEach','violation','email','data','您提交的信息中包含','globalConfigService','axios','../globalConfig/globalConfig.service','__decorate','6246736FJLFVy','word_list','InjectRepository','delBadWords','default','findAndCount','word','敏感词已经存在了、请勿重复添加','UserEntity','application/x-www-form-urlencoded','badWords','./badwords.entity','application/json','includes','user','super','error:\x20','BadwordsService','136zyuiln','敏感词检测\x20|\x20','hideString','更新敏感词失败','createQueryBuilder','44tqTEBS','2zCXirC','keyword','BadWordsEntity','更新敏感词成功','nineai','findOne','HttpStatus','getSensitiveConfig','NineAi检测','ASC','recordUserBadWords','自定义检测','敏感词已存在,请检查您的提交信息','删除敏感词成功','nineaiCheckBadWords','的信息、我们已对您账号进行标记、请合规使用！','affected','__esModule','敏感词不存在,请检查您的提交信息','match','__param','GlobalConfigService','./violationLog.entity','find','post','code','function','baiduTextAccessToken','您提交的内容中包含','@nestjs/typeorm','violationLogEntity','HttpException','object','getOwnPropertyDescriptor','Injectable','extractContent','Repository','userEntity','checkBadWords'];_0x4b07=function(){return _0x101073;};return _0x4b07();}(function(_0x39397a,_0xc324ac){const _0x492154=_0x1ad0,_0x2e6c03=_0x39397a();while(!![]){try{const _0x558968=-parseInt(_0x492154(0x13d))/0x1*(parseInt(_0x492154(0x18f))/0x2)+-parseInt(_0x492154(0x18d))/0x3+parseInt(_0x492154(0x137))/0x4*(parseInt(_0x492154(0x18e))/0x5)+parseInt(_0x492154(0x119))/0x6+-parseInt(_0x492154(0x170))/0x7*(parseInt(_0x492154(0x125))/0x8)+-parseInt(_0x492154(0x18a))/0x9*(-parseInt(_0x492154(0x184))/0xa)+-parseInt(_0x492154(0x13c))/0xb*(-parseInt(_0x492154(0x18c))/0xc);if(_0x558968===_0xc324ac)break;else _0x2e6c03['push'](_0x2e6c03['shift']());}catch(_0x534b2b){_0x2e6c03['push'](_0x2e6c03['shift']());}}}(_0x4b07,0x71ae9));var __decorate=this&&this[_0x10e134(0x124)]||function(_0xcf036d,_0x258b05,_0x449eca,_0xe2611a){const _0x5e856e=_0x10e134;var _0xd2b92f=arguments['length'],_0x3a9016=_0xd2b92f<0x3?_0x258b05:_0xe2611a===null?_0xe2611a=Object[_0x5e856e(0x15e)](_0x258b05,_0x449eca):_0xe2611a,_0x4f665f;if(typeof Reflect==='object'&&typeof Reflect[_0x5e856e(0x16a)]===_0x5e856e(0x157))_0x3a9016=Reflect[_0x5e856e(0x16a)](_0xcf036d,_0x258b05,_0x449eca,_0xe2611a);else{for(var _0x2f7f5b=_0xcf036d['length']-0x1;_0x2f7f5b>=0x0;_0x2f7f5b--)if(_0x4f665f=_0xcf036d[_0x2f7f5b])_0x3a9016=(_0xd2b92f<0x3?_0x4f665f(_0x3a9016):_0xd2b92f>0x3?_0x4f665f(_0x258b05,_0x449eca,_0x3a9016):_0x4f665f(_0x258b05,_0x449eca))||_0x3a9016;}return _0xd2b92f>0x3&&_0x3a9016&&Object[_0x5e856e(0x17f)](_0x258b05,_0x449eca,_0x3a9016),_0x3a9016;},__metadata=this&&this['__metadata']||function(_0x1e453a,_0x8bb452){const _0x1bab7d=_0x10e134;if(typeof Reflect===_0x1bab7d(0x15d)&&typeof Reflect['metadata']===_0x1bab7d(0x157))return Reflect['metadata'](_0x1e453a,_0x8bb452);},__param=this&&this[_0x10e134(0x151)]||function(_0x10943d,_0x2757a9){return function(_0x515428,_0x39c83d){_0x2757a9(_0x515428,_0x39c83d,_0x10943d);};};Object[_0x10e134(0x17f)](exports,_0x10e134(0x14e),{'value':!![]}),exports[_0x10e134(0x136)]=void 0x0;const globalConfig_service_1=require(_0x10e134(0x123)),common_1=require(_0x10e134(0x17a)),badwords_entity_1=require(_0x10e134(0x130)),typeorm_1=require('typeorm'),typeorm_2=require(_0x10e134(0x15a)),axios_1=require(_0x10e134(0x122)),violationLog_entity_1=require(_0x10e134(0x153)),user_entity_1=require('../user/user.entity'),utils_1=require(_0x10e134(0x189));let BadwordsService=class BadwordsService{constructor(_0x13f31c,_0x5a5e43,_0x310c7b,_0x48471b){const _0x13cff9=_0x10e134;this[_0x13cff9(0x16b)]=_0x13f31c,this[_0x13cff9(0x15b)]=_0x5a5e43,this[_0x13cff9(0x162)]=_0x310c7b,this[_0x13cff9(0x121)]=_0x48471b,this[_0x13cff9(0x12f)]=[];}async[_0x10e134(0x166)](){const _0x23f06f=_0x10e134;this[_0x23f06f(0x171)]();}async[_0x10e134(0x17b)](_0x24d993,_0x41ad0){const _0x4e4a81=_0x10e134,_0x420c08=[];for(let _0x54bced=0x0;_0x54bced<this['badWords'][_0x4e4a81(0x176)];_0x54bced++){const _0x2a57e4=this[_0x4e4a81(0x12f)][_0x54bced];_0x24d993['includes'](_0x2a57e4)&&_0x420c08[_0x4e4a81(0x178)](_0x2a57e4);}if(_0x420c08[_0x4e4a81(0x176)]){await this['recordUserBadWords'](_0x41ad0,_0x24d993,_0x420c08,['自定义'],_0x4e4a81(0x148));const _0x25c9f1=_0x4e4a81(0x17d);throw new common_1['HttpException'](_0x25c9f1,common_1['HttpStatus'][_0x4e4a81(0x16c)]);}}async[_0x10e134(0x163)](_0x55c80b,_0x552ccb){const _0x4b5967=_0x10e134,_0x556e56=await this[_0x4b5967(0x121)][_0x4b5967(0x144)]();_0x556e56&&await this[_0x4b5967(0x118)](_0x55c80b,_0x556e56,_0x552ccb),await this[_0x4b5967(0x17b)](_0x55c80b,_0x552ccb);}async[_0x10e134(0x118)](_0xda3bd,_0x3eb77a,_0x55ec0b){const _0x47ab56=_0x10e134,{useType:_0x19e97f}=_0x3eb77a;_0x19e97f===_0x47ab56(0x175)&&await this[_0x47ab56(0x169)](_0xda3bd,_0x3eb77a[_0x47ab56(0x158)],_0x55ec0b),_0x19e97f===_0x47ab56(0x141)&&await this[_0x47ab56(0x14b)](_0xda3bd,_0x3eb77a,_0x55ec0b);}[_0x10e134(0x160)](_0x516007){const _0x4080b7=_0x10e134,_0x2cbe0c=/存在(.*?)不合规/,_0x3e3156=_0x516007[_0x4080b7(0x150)](_0x2cbe0c);return _0x3e3156?_0x3e3156[0x1]:'';}async[_0x10e134(0x169)](_0x4f663b,_0x10d141,_0x3317b6){const _0x499965=_0x10e134;if(!_0x10d141)return;const _0x45dc3b=_0x499965(0x167)+_0x10d141+'}',_0x18839c={'Content-Type':_0x499965(0x12e),'Accept':_0x499965(0x131)},_0x77ce1a=await axios_1[_0x499965(0x129)][_0x499965(0x155)](_0x45dc3b,{'text':_0x4f663b},{'headers':_0x18839c}),{conclusion:_0x59d632,error_code:_0x5d5025,error_msg:_0x15b11a,conclusionType:_0x5526f7,data:_0x585c8d}=_0x77ce1a['data'];_0x5d5025&&console[_0x499965(0x17e)](_0x499965(0x177),_0x15b11a);if(_0x5526f7!==0x1){const _0x4ed67b=[...new Set(_0x585c8d[_0x499965(0x186)](_0x2ab0f4=>this['extractContent'](_0x2ab0f4['msg'])))];await this[_0x499965(0x147)](_0x3317b6,_0x4f663b,[_0x499965(0x181)],_0x4ed67b,'百度云检测');const _0x48a84d=_0x499965(0x120)+_0x4ed67b['join'](',')+_0x499965(0x179);throw new common_1[(_0x499965(0x15c))](_0x48a84d,common_1[_0x499965(0x143)][_0x499965(0x16c)]);}}async[_0x10e134(0x14b)](_0x21ba52,_0x4edf9e,_0x1a30f2){const _0x3ded23=_0x10e134;var _0x4425ea;const {nineaiBuiltInSensitiveApiBase:_0x253d49,nineaiBuiltInSensitiveAuthKey:_0x1de833}=_0x4edf9e;if(!_0x253d49||!_0x1de833)return;const _0x177f25=await axios_1[_0x3ded23(0x129)][_0x3ded23(0x155)](_0x253d49,{'content':_0x21ba52},{'headers':{'Content-Type':_0x3ded23(0x131),'Authorization':_0x1de833}});if(!_0x177f25[_0x3ded23(0x11f)])return;if(_0x177f25[_0x3ded23(0x11f)][_0x3ded23(0x156)]!=='0'){const {msg:msg=_0x3ded23(0x164)}=_0x177f25[_0x3ded23(0x11f)];throw new common_1['HttpException'](_0x3ded23(0x138)+msg,common_1[_0x3ded23(0x143)]['BAD_REQUEST']);}if(_0x177f25['data'][_0x3ded23(0x126)]&&((_0x4425ea=_0x177f25[_0x3ded23(0x11f)][_0x3ded23(0x126)])===null||_0x4425ea===void 0x0?void 0x0:_0x4425ea[_0x3ded23(0x176)])){const _0x535c7e=[...new Set(_0x177f25['data'][_0x3ded23(0x126)][_0x3ded23(0x186)](_0x85e04=>_0x85e04[_0x3ded23(0x13e)]))],_0x88a97d=[...new Set(_0x177f25['data'][_0x3ded23(0x126)][_0x3ded23(0x186)](_0x8d1c10=>_0x8d1c10['category']))];await this['recordUserBadWords'](_0x1a30f2,_0x21ba52,_0x535c7e,_0x88a97d,_0x3ded23(0x145));const _0x37df5b=this[_0x3ded23(0x11b)](_0x177f25[_0x3ded23(0x11f)][_0x3ded23(0x126)]);throw new common_1['HttpException'](_0x37df5b,common_1[_0x3ded23(0x143)][_0x3ded23(0x16c)]);}}[_0x10e134(0x11b)](_0x55b26c){const _0x4d59ed=_0x10e134,_0x4d1b76=_0x55b26c[_0x4d59ed(0x186)](_0x50c492=>_0x50c492[_0x4d59ed(0x117)]),_0x2bc1d2=[...new Set(_0x4d1b76)];return _0x4d59ed(0x159)+_0x2bc1d2[_0x4d59ed(0x165)](',')+_0x4d59ed(0x14c);}async[_0x10e134(0x171)](){const _0x5296fb=_0x10e134,_0x6ffafe=await this[_0x5296fb(0x16b)]['find']({'where':{'status':0x1},'select':['word']});this[_0x5296fb(0x12f)]=_0x6ffafe[_0x5296fb(0x186)](_0x54a89a=>_0x54a89a[_0x5296fb(0x12b)]);}async['queryBadWords'](_0x46dffc){const _0x2c1547=_0x10e134,{page:page=0x1,size:size=0x1f4,word:_0x278692,status:_0x2bfd00}=_0x46dffc,_0x27f30d={};[0x0,0x1,'0','1'][_0x2c1547(0x132)](_0x2bfd00)&&(_0x27f30d[_0x2c1547(0x187)]=_0x2bfd00),_0x278692&&(_0x27f30d[_0x2c1547(0x12b)]=(0x0,typeorm_1[_0x2c1547(0x18b)])('%'+_0x278692+'%'));const [_0x4ae125,_0x17fa5d]=await this[_0x2c1547(0x16b)][_0x2c1547(0x12a)]({'where':_0x27f30d,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x2c1547(0x146)}});return{'rows':_0x4ae125,'count':_0x17fa5d};}async[_0x10e134(0x128)](_0x40cd81){const _0x14243c=_0x10e134,_0x2f9fba=await this[_0x14243c(0x16b)][_0x14243c(0x142)]({'where':{'id':_0x40cd81['id']}});if(!_0x2f9fba)throw new common_1[(_0x14243c(0x15c))](_0x14243c(0x14f),common_1[_0x14243c(0x143)][_0x14243c(0x16c)]);const _0x8963d7=await this[_0x14243c(0x16b)]['delete']({'id':_0x40cd81['id']});if(_0x8963d7[_0x14243c(0x14d)]>0x0)return await this[_0x14243c(0x171)](),_0x14243c(0x14a);else throw new common_1['HttpException'](_0x14243c(0x172),common_1[_0x14243c(0x143)][_0x14243c(0x16c)]);}async['updateBadWords'](_0x19a479){const _0x4ed315=_0x10e134,{id:_0x15c72b,word:_0x2b3ac5,status:_0x226045}=_0x19a479,_0x21e626=await this[_0x4ed315(0x16b)]['findOne']({'where':{'word':_0x2b3ac5}});if(_0x21e626)throw new common_1[(_0x4ed315(0x15c))](_0x4ed315(0x12c),common_1[_0x4ed315(0x143)][_0x4ed315(0x16c)]);const _0x289b9a=await this['badWordsEntity']['update']({'id':_0x15c72b},{'word':_0x2b3ac5,'status':_0x226045});if(_0x289b9a['affected']>0x0)return await this[_0x4ed315(0x171)](),_0x4ed315(0x140);else throw new common_1[(_0x4ed315(0x15c))](_0x4ed315(0x13a),common_1[_0x4ed315(0x143)]['BAD_REQUEST']);}async[_0x10e134(0x182)](_0x4b1e53){const _0x1657fd=_0x10e134,{word:_0x9a71b2}=_0x4b1e53,_0x1b9998=await this[_0x1657fd(0x16b)][_0x1657fd(0x142)]({'where':{'word':_0x9a71b2}});if(_0x1b9998)throw new common_1[(_0x1657fd(0x15c))](_0x1657fd(0x149),common_1[_0x1657fd(0x143)][_0x1657fd(0x16c)]);return await this[_0x1657fd(0x16b)]['save']({'word':_0x9a71b2}),await this[_0x1657fd(0x171)](),_0x1657fd(0x168);}async['recordUserBadWords'](_0x583a89,_0x45c471,_0x9765b8,_0x356d46,_0x362b38){const _0x38398c=_0x10e134,_0x239fb3={'userId':_0x583a89,'content':_0x45c471,'words':JSON[_0x38398c(0x173)](_0x9765b8),'typeCn':JSON[_0x38398c(0x173)](_0x356d46),'typeOriginCn':_0x362b38};try{await this[_0x38398c(0x162)][_0x38398c(0x13b)]()['update'](user_entity_1['UserEntity'])['set']({'violationCount':()=>_0x38398c(0x188)})['where']('id\x20=\x20:userId',{'userId':_0x583a89})[_0x38398c(0x174)](),await this[_0x38398c(0x15b)][_0x38398c(0x183)](_0x239fb3);}catch(_0x1ce4ab){console[_0x38398c(0x17e)](_0x38398c(0x135),_0x1ce4ab);}}async[_0x10e134(0x11d)](_0x47d357,_0x3040cf){const _0x1a6af0=_0x10e134,{role:_0x227a9d}=_0x47d357[_0x1a6af0(0x133)],{page:page=0x1,size:size=0xa,userId:_0xb89c4e,typeOriginCn:_0x31cb81}=_0x3040cf,_0x17cfe3={};_0xb89c4e&&(_0x17cfe3[_0x1a6af0(0x180)]=_0xb89c4e),_0x31cb81&&(_0x17cfe3[_0x1a6af0(0x17c)]=_0x31cb81);const [_0x24a913,_0x15dce8]=await this[_0x1a6af0(0x15b)][_0x1a6af0(0x12a)]({'where':_0x17cfe3,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x1a6af0(0x16e)}}),_0xbb3455=[...new Set(_0x24a913[_0x1a6af0(0x186)](_0x12b8fd=>_0x12b8fd['userId']))],_0x36bdba=await this[_0x1a6af0(0x162)][_0x1a6af0(0x154)]({'where':{'id':(0x0,typeorm_1['In'])(_0xbb3455)},'select':['id','avatar',_0x1a6af0(0x11a),_0x1a6af0(0x11e),_0x1a6af0(0x16f),'status']});return _0x24a913[_0x1a6af0(0x11c)](_0x332891=>{const _0x4a0cd0=_0x1a6af0,_0x1aa5b2=_0x36bdba[_0x4a0cd0(0x154)](_0xff0182=>_0xff0182['id']===_0x332891[_0x4a0cd0(0x180)]);_0x227a9d!==_0x4a0cd0(0x134)&&(_0x1aa5b2['email']=(0x0,utils_1[_0x4a0cd0(0x139)])(_0x1aa5b2['email'])),_0x332891[_0x4a0cd0(0x185)]=_0x1aa5b2;}),{'rows':_0x24a913,'count':_0x15dce8};}};BadwordsService=__decorate([(0x0,common_1[_0x10e134(0x15f)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x10e134(0x13f)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x10e134(0x16d)])),__param(0x2,(0x0,typeorm_2[_0x10e134(0x127)])(user_entity_1[_0x10e134(0x12d)])),__metadata('design:paramtypes',[typeorm_1[_0x10e134(0x161)],typeorm_1[_0x10e134(0x161)],typeorm_1[_0x10e134(0x161)],globalConfig_service_1[_0x10e134(0x152)]])],BadwordsService),exports[_0x10e134(0x136)]=BadwordsService;