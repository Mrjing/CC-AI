'use strict';function _0x1c49(){const _0x3c69c6=['userInfo','Injectable','super','find','where','40476ZMkLVP','删除敏感词成功','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','6aKRCnX','defineProperty','6141825sVjAFb','keyword','badWords','set','./badwords.entity','affected','getSensitiveConfig','BAD_REQUEST','match','avatar','敏感词检测\x20|\x20','violationLogEntity','extractContent','log','百度文本检测出现错误、请查看配置信息:\x20','checkBadWords','save','GlobalConfigService','userEntity','DESC','的内容、我们已对您的账户进行标记、请合规使用！','violationCount','username','百度云检测','typeorm','getOwnPropertyDescriptor','default','9031pBsVFv','word','更新敏感词成功','customSensitiveWords','../user/user.entity','../globalConfig/globalConfig.service','violation','status','error:\x20','formarTips','nineaiCheckBadWords','createQueryBuilder','category','delete','BadWordsEntity','baidu','violationCount\x20+\x201','102HsQYcK','addBadWord','badWordsEntity','recordUserBadWords','msg','application/json','./violationLog.entity','forEach','7611125lmvOze','user','__decorate','post','BadwordsService','InjectRepository','删除敏感词失败','data','hideString','nineai','function','87202IirHot','敏感词已经存在了、请勿重复添加','metadata','map','join','push','baiduCheckBadWords','3420641cMbbri','敏感词已存在,请检查您的提交信息','loadBadWords','UserEntity','检测失败','length','87404FelHjA','checkBadWordsByConfig','@nestjs/typeorm','12EmdsUt','id\x20=\x20:userId','includes','userId','添加敏感词成功','findOne','ASC','findAndCount','axios','decorate','更新敏感词失败','@nestjs/common','globalConfigService','HttpStatus','email','__metadata','object','application/x-www-form-urlencoded','10459550QKEQvy','Like','word_list','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','HttpException','queryBadWords','update','8jWEpvd','delBadWords','__param','stringify','自定义','NineAi检测','baiduTextAccessToken','Repository'];_0x1c49=function(){return _0x3c69c6;};return _0x1c49();}const _0x599f49=_0x15c4;(function(_0x79b1a1,_0x779900){const _0x2dab10=_0x15c4,_0x37f2c2=_0x79b1a1();while(!![]){try{const _0x33a0f8=parseInt(_0x2dab10(0x170))/0x1*(-parseInt(_0x2dab10(0x12f))/0x2)+parseInt(_0x2dab10(0x15d))/0x3*(-parseInt(_0x2dab10(0x103))/0x4)+-parseInt(_0x2dab10(0x165))/0x5+-parseInt(_0x2dab10(0x106))/0x6*(-parseInt(_0x2dab10(0xfd))/0x7)+parseInt(_0x2dab10(0x11f))/0x8*(parseInt(_0x2dab10(0x131))/0x9)+-parseInt(_0x2dab10(0x118))/0xa+parseInt(_0x2dab10(0x14c))/0xb*(parseInt(_0x2dab10(0x12c))/0xc);if(_0x33a0f8===_0x779900)break;else _0x37f2c2['push'](_0x37f2c2['shift']());}catch(_0xaa1d7f){_0x37f2c2['push'](_0x37f2c2['shift']());}}}(_0x1c49,0xd10c8));var __decorate=this&&this[_0x599f49(0x167)]||function(_0x5eb300,_0x153e19,_0x9a031,_0x1bf8c1){const _0x2748b7=_0x599f49;var _0x2a9484=arguments[_0x2748b7(0x102)],_0x1aeafe=_0x2a9484<0x3?_0x153e19:_0x1bf8c1===null?_0x1bf8c1=Object[_0x2748b7(0x14a)](_0x153e19,_0x9a031):_0x1bf8c1,_0x8c5fb2;if(typeof Reflect===_0x2748b7(0x116)&&typeof Reflect['decorate']===_0x2748b7(0x16f))_0x1aeafe=Reflect[_0x2748b7(0x10f)](_0x5eb300,_0x153e19,_0x9a031,_0x1bf8c1);else{for(var _0x489a8f=_0x5eb300[_0x2748b7(0x102)]-0x1;_0x489a8f>=0x0;_0x489a8f--)if(_0x8c5fb2=_0x5eb300[_0x489a8f])_0x1aeafe=(_0x2a9484<0x3?_0x8c5fb2(_0x1aeafe):_0x2a9484>0x3?_0x8c5fb2(_0x153e19,_0x9a031,_0x1aeafe):_0x8c5fb2(_0x153e19,_0x9a031))||_0x1aeafe;}return _0x2a9484>0x3&&_0x1aeafe&&Object[_0x2748b7(0x130)](_0x153e19,_0x9a031,_0x1aeafe),_0x1aeafe;},__metadata=this&&this[_0x599f49(0x115)]||function(_0x5c0ae0,_0xb601ad){const _0x5c1338=_0x599f49;if(typeof Reflect==='object'&&typeof Reflect[_0x5c1338(0x172)]===_0x5c1338(0x16f))return Reflect['metadata'](_0x5c0ae0,_0xb601ad);},__param=this&&this[_0x599f49(0x121)]||function(_0x4ca614,_0x1f7f07){return function(_0x10ded9,_0x3869c5){_0x1f7f07(_0x10ded9,_0x3869c5,_0x4ca614);};};function _0x15c4(_0x48fb0a,_0x10e3c2){const _0x1c4998=_0x1c49();return _0x15c4=function(_0x15c41f,_0x5e8fc6){_0x15c41f=_0x15c41f-0xf9;let _0x4f9750=_0x1c4998[_0x15c41f];return _0x4f9750;},_0x15c4(_0x48fb0a,_0x10e3c2);}Object[_0x599f49(0x130)](exports,'__esModule',{'value':!![]}),exports[_0x599f49(0x169)]=void 0x0;const globalConfig_service_1=require(_0x599f49(0x151)),common_1=require(_0x599f49(0x111)),badwords_entity_1=require(_0x599f49(0x135)),typeorm_1=require(_0x599f49(0x149)),typeorm_2=require(_0x599f49(0x105)),axios_1=require(_0x599f49(0x10e)),violationLog_entity_1=require(_0x599f49(0x163)),user_entity_1=require(_0x599f49(0x150)),utils_1=require('../../common/utils');let BadwordsService=class BadwordsService{constructor(_0x388de1,_0x104790,_0x56219a,_0x3b3c3f){const _0x32983c=_0x599f49;this[_0x32983c(0x15f)]=_0x388de1,this[_0x32983c(0x13c)]=_0x104790,this[_0x32983c(0x143)]=_0x56219a,this[_0x32983c(0x112)]=_0x3b3c3f,this[_0x32983c(0x133)]=[];}async['onModuleInit'](){const _0x3f0b0e=_0x599f49;this[_0x3f0b0e(0xff)]();}async[_0x599f49(0x14f)](_0x4e5e38,_0x5c6850){const _0x46fea6=_0x599f49,_0x4b3a44=[];for(let _0x125c6b=0x0;_0x125c6b<this[_0x46fea6(0x133)][_0x46fea6(0x102)];_0x125c6b++){const _0x1a365e=this['badWords'][_0x125c6b];_0x4e5e38[_0x46fea6(0x108)](_0x1a365e)&&_0x4b3a44[_0x46fea6(0xfb)](_0x1a365e);}if(_0x4b3a44[_0x46fea6(0x102)]){await this['recordUserBadWords'](_0x5c6850,_0x4e5e38,_0x4b3a44,[_0x46fea6(0x123)],'自定义检测');const _0xde3dd=_0x46fea6(0x11b);throw new common_1[(_0x46fea6(0x11c))](_0xde3dd,common_1[_0x46fea6(0x113)]['BAD_REQUEST']);}}async[_0x599f49(0x140)](_0x8f6ec2,_0x5f1c6a){const _0x2b9141=_0x599f49,_0x2f944b=await this[_0x2b9141(0x112)][_0x2b9141(0x137)]();_0x2f944b&&await this[_0x2b9141(0x104)](_0x8f6ec2,_0x2f944b,_0x5f1c6a),await this[_0x2b9141(0x14f)](_0x8f6ec2,_0x5f1c6a);}async[_0x599f49(0x104)](_0x186c9d,_0xfd85de,_0x4b2763){const _0x5ddbd7=_0x599f49,{useType:_0x85b5d3}=_0xfd85de;_0x85b5d3===_0x5ddbd7(0x15b)&&await this[_0x5ddbd7(0xfc)](_0x186c9d,_0xfd85de[_0x5ddbd7(0x125)],_0x4b2763),_0x85b5d3===_0x5ddbd7(0x16e)&&await this['nineaiCheckBadWords'](_0x186c9d,_0xfd85de,_0x4b2763);}[_0x599f49(0x13d)](_0x2cd01f){const _0x2df0ae=_0x599f49,_0x554e13=/存在(.*?)不合规/,_0xccd36=_0x2cd01f[_0x2df0ae(0x139)](_0x554e13);return _0xccd36?_0xccd36[0x1]:'';}async[_0x599f49(0xfc)](_0x1bc58d,_0x260679,_0xfabc4b){const _0x3aaae9=_0x599f49;if(!_0x260679)return;const _0x1985e7=_0x3aaae9(0x12e)+_0x260679+'}',_0x447de3={'Content-Type':_0x3aaae9(0x117),'Accept':_0x3aaae9(0x162)},_0x1b223c=await axios_1[_0x3aaae9(0x14b)][_0x3aaae9(0x168)](_0x1985e7,{'text':_0x1bc58d},{'headers':_0x447de3}),{conclusion:_0x369201,error_code:_0xdace36,error_msg:_0x22f9fe,conclusionType:_0x4b9ba4,data:_0x7633b5}=_0x1b223c[_0x3aaae9(0x16c)];_0xdace36&&console[_0x3aaae9(0x13e)](_0x3aaae9(0x13f),_0x22f9fe);if(_0x4b9ba4!==0x1){const _0x5ca245=[...new Set(_0x7633b5['map'](_0x44a8a3=>this[_0x3aaae9(0x13d)](_0x44a8a3[_0x3aaae9(0x161)])))];await this[_0x3aaae9(0x160)](_0xfabc4b,_0x1bc58d,['***'],_0x5ca245,_0x3aaae9(0x148));const _0x296de7='您提交的信息中包含'+_0x5ca245[_0x3aaae9(0xfa)](',')+_0x3aaae9(0x145);throw new common_1[(_0x3aaae9(0x11c))](_0x296de7,common_1[_0x3aaae9(0x113)][_0x3aaae9(0x138)]);}}async[_0x599f49(0x156)](_0xce3997,_0x173e97,_0xa8156c){const _0x49bbb7=_0x599f49;var _0x1bbab5;const {nineaiBuiltInSensitiveApiBase:_0x2db052,nineaiBuiltInSensitiveAuthKey:_0x89d7c0}=_0x173e97;if(!_0x2db052||!_0x89d7c0)return;const _0x9111f9=await axios_1[_0x49bbb7(0x14b)]['post'](_0x2db052,{'content':_0xce3997},{'headers':{'Content-Type':_0x49bbb7(0x162),'Authorization':_0x89d7c0}});if(!_0x9111f9[_0x49bbb7(0x16c)])return;if(_0x9111f9[_0x49bbb7(0x16c)]['code']!=='0'){const {msg:msg=_0x49bbb7(0x101)}=_0x9111f9[_0x49bbb7(0x16c)];throw new common_1[(_0x49bbb7(0x11c))](_0x49bbb7(0x13b)+msg,common_1[_0x49bbb7(0x113)][_0x49bbb7(0x138)]);}if(_0x9111f9['data'][_0x49bbb7(0x11a)]&&((_0x1bbab5=_0x9111f9['data'][_0x49bbb7(0x11a)])===null||_0x1bbab5===void 0x0?void 0x0:_0x1bbab5[_0x49bbb7(0x102)])){const _0x1ef913=[...new Set(_0x9111f9[_0x49bbb7(0x16c)]['word_list']['map'](_0x50c2dc=>_0x50c2dc[_0x49bbb7(0x132)]))],_0x58f57c=[...new Set(_0x9111f9[_0x49bbb7(0x16c)][_0x49bbb7(0x11a)][_0x49bbb7(0xf9)](_0x65e149=>_0x65e149['category']))];await this['recordUserBadWords'](_0xa8156c,_0xce3997,_0x1ef913,_0x58f57c,_0x49bbb7(0x124));const _0x51cf9=this[_0x49bbb7(0x155)](_0x9111f9['data'][_0x49bbb7(0x11a)]);throw new common_1[(_0x49bbb7(0x11c))](_0x51cf9,common_1[_0x49bbb7(0x113)][_0x49bbb7(0x138)]);}}[_0x599f49(0x155)](_0x3f210d){const _0xa910aa=_0x599f49,_0x3ba842=_0x3f210d[_0xa910aa(0xf9)](_0x14ab7a=>_0x14ab7a[_0xa910aa(0x158)]),_0x520afb=[...new Set(_0x3ba842)];return'您提交的内容中包含'+_0x520afb[_0xa910aa(0xfa)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x599f49(0xff)](){const _0x2f36e0=_0x599f49,_0x32494b=await this['badWordsEntity']['find']({'where':{'status':0x1},'select':['word']});this[_0x2f36e0(0x133)]=_0x32494b[_0x2f36e0(0xf9)](_0x2d96d8=>_0x2d96d8[_0x2f36e0(0x14d)]);}async[_0x599f49(0x11d)](_0x2239fe){const _0x3a9b80=_0x599f49,{page:page=0x1,size:size=0x1f4,word:_0x1ad333,status:_0x379adf}=_0x2239fe,_0x1b2953={};[0x0,0x1,'0','1'][_0x3a9b80(0x108)](_0x379adf)&&(_0x1b2953[_0x3a9b80(0x153)]=_0x379adf),_0x1ad333&&(_0x1b2953[_0x3a9b80(0x14d)]=(0x0,typeorm_1[_0x3a9b80(0x119)])('%'+_0x1ad333+'%'));const [_0x53a444,_0x52f71c]=await this[_0x3a9b80(0x15f)][_0x3a9b80(0x10d)]({'where':_0x1b2953,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3a9b80(0x10c)}});return{'rows':_0x53a444,'count':_0x52f71c};}async[_0x599f49(0x120)](_0x14dc10){const _0x279f66=_0x599f49,_0x203a6a=await this[_0x279f66(0x15f)][_0x279f66(0x10b)]({'where':{'id':_0x14dc10['id']}});if(!_0x203a6a)throw new common_1[(_0x279f66(0x11c))]('敏感词不存在,请检查您的提交信息',common_1[_0x279f66(0x113)]['BAD_REQUEST']);const _0x1c6443=await this[_0x279f66(0x15f)][_0x279f66(0x159)]({'id':_0x14dc10['id']});if(_0x1c6443[_0x279f66(0x136)]>0x0)return await this[_0x279f66(0xff)](),_0x279f66(0x12d);else throw new common_1[(_0x279f66(0x11c))](_0x279f66(0x16b),common_1[_0x279f66(0x113)]['BAD_REQUEST']);}async['updateBadWords'](_0x2c4289){const _0x340455=_0x599f49,{id:_0x9ea3cf,word:_0x3045ab,status:_0x1bac20}=_0x2c4289,_0x215dd7=await this['badWordsEntity'][_0x340455(0x10b)]({'where':{'word':_0x3045ab}});if(_0x215dd7)throw new common_1[(_0x340455(0x11c))](_0x340455(0x171),common_1[_0x340455(0x113)]['BAD_REQUEST']);const _0x1a3b02=await this[_0x340455(0x15f)]['update']({'id':_0x9ea3cf},{'word':_0x3045ab,'status':_0x1bac20});if(_0x1a3b02[_0x340455(0x136)]>0x0)return await this[_0x340455(0xff)](),_0x340455(0x14e);else throw new common_1[(_0x340455(0x11c))](_0x340455(0x110),common_1[_0x340455(0x113)][_0x340455(0x138)]);}async[_0x599f49(0x15e)](_0x48ba3f){const _0x9b28fb=_0x599f49,{word:_0x24e149}=_0x48ba3f,_0x794b56=await this[_0x9b28fb(0x15f)][_0x9b28fb(0x10b)]({'where':{'word':_0x24e149}});if(_0x794b56)throw new common_1[(_0x9b28fb(0x11c))](_0x9b28fb(0xfe),common_1[_0x9b28fb(0x113)][_0x9b28fb(0x138)]);return await this[_0x9b28fb(0x15f)]['save']({'word':_0x24e149}),await this[_0x9b28fb(0xff)](),_0x9b28fb(0x10a);}async[_0x599f49(0x160)](_0x1e8728,_0x56eeda,_0x2ed2f1,_0x28aed4,_0x45fa85){const _0x3ded7a=_0x599f49,_0x3fb93a={'userId':_0x1e8728,'content':_0x56eeda,'words':JSON['stringify'](_0x2ed2f1),'typeCn':JSON[_0x3ded7a(0x122)](_0x28aed4),'typeOriginCn':_0x45fa85};try{await this[_0x3ded7a(0x143)][_0x3ded7a(0x157)]()[_0x3ded7a(0x11e)](user_entity_1['UserEntity'])[_0x3ded7a(0x134)]({'violationCount':()=>_0x3ded7a(0x15c)})[_0x3ded7a(0x12b)](_0x3ded7a(0x107),{'userId':_0x1e8728})['execute'](),await this[_0x3ded7a(0x13c)][_0x3ded7a(0x141)](_0x3fb93a);}catch(_0xe30783){console[_0x3ded7a(0x13e)](_0x3ded7a(0x154),_0xe30783);}}async[_0x599f49(0x152)](_0x33a5f4,_0x5d3431){const _0x343ae2=_0x599f49,{role:_0x3c0b0b}=_0x33a5f4[_0x343ae2(0x166)],{page:page=0x1,size:size=0xa,userId:_0x8cd6c9,typeOriginCn:_0x20672d}=_0x5d3431,_0x3491b1={};_0x8cd6c9&&(_0x3491b1[_0x343ae2(0x109)]=_0x8cd6c9),_0x20672d&&(_0x3491b1['typeOriginCn']=_0x20672d);const [_0x3c3339,_0x4e1287]=await this['violationLogEntity'][_0x343ae2(0x10d)]({'where':_0x3491b1,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x343ae2(0x144)}}),_0x51495b=[...new Set(_0x3c3339[_0x343ae2(0xf9)](_0x1a9fb2=>_0x1a9fb2['userId']))],_0x51a59a=await this['userEntity'][_0x343ae2(0x12a)]({'where':{'id':(0x0,typeorm_1['In'])(_0x51495b)},'select':['id',_0x343ae2(0x13a),_0x343ae2(0x147),'email',_0x343ae2(0x146),'status']});return _0x3c3339[_0x343ae2(0x164)](_0x104369=>{const _0x31d933=_0x343ae2,_0x47bd24=_0x51a59a[_0x31d933(0x12a)](_0x4932e8=>_0x4932e8['id']===_0x104369['userId']);_0x3c0b0b!==_0x31d933(0x129)&&(_0x47bd24[_0x31d933(0x114)]=(0x0,utils_1[_0x31d933(0x16d)])(_0x47bd24[_0x31d933(0x114)])),_0x104369[_0x31d933(0x127)]=_0x47bd24;}),{'rows':_0x3c3339,'count':_0x4e1287};}};BadwordsService=__decorate([(0x0,common_1[_0x599f49(0x128)])(),__param(0x0,(0x0,typeorm_2[_0x599f49(0x16a)])(badwords_entity_1[_0x599f49(0x15a)])),__param(0x1,(0x0,typeorm_2[_0x599f49(0x16a)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x599f49(0x16a)])(user_entity_1[_0x599f49(0x100)])),__metadata('design:paramtypes',[typeorm_1[_0x599f49(0x126)],typeorm_1['Repository'],typeorm_1['Repository'],globalConfig_service_1[_0x599f49(0x142)]])],BadwordsService),exports['BadwordsService']=BadwordsService;