'use strict';function _0x144e(){const _0x14b0df=['Repository','351psEnkk','appEntity','design:paramtypes','ModelsService','map','../models/models.service','__metadata','新对话','save','20626atAMwB','parse','defineProperty','ChatGroupEntity','delAll','11766vqQaFF','Injectable','find','appId','create','InjectRepository','8166040oioMrM','BAD_REQUEST','modelsService','__decorate','@nestjs/typeorm','function','./chatGroup.entity','length','ChatGroupService','includes','删除失败！','删除成功','getOwnPropertyDescriptor','getGroupInfoFromId','更新对话失败！','assign','decorate','keyType','appLogo','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','isSticky','undefined','41656GaxBeY','coverImg','30qswNOH','../app/app.entity','当前应用已经开启了一个对话无需新建了！','HttpException','532JrOzMM','update','typeorm','metadata','affected','count','HttpStatus','filter','DESC','query','12982941KeNbPI','27550540Dkqjyf','chatGroupEntity','__esModule','1203196UHNYxn','findOne','log','object','应用对话名称不能修改哟！','del','__param','非法操作、您在使用一个未启用的应用！','user','请先选择一个对话或者新加一个对话再操作！','title'];_0x144e=function(){return _0x14b0df;};return _0x144e();}const _0x2acc0b=_0x2464;(function(_0x1f2918,_0xb1c5ac){const _0x5ce418=_0x2464,_0x186a9a=_0x1f2918();while(!![]){try{const _0x19a028=-parseInt(_0x5ce418(0xe6))/0x1+parseInt(_0x5ce418(0xfb))/0x2*(-parseInt(_0x5ce418(0xf2))/0x3)+-parseInt(_0x5ce418(0xd2))/0x4*(parseInt(_0x5ce418(0xd4))/0x5)+-parseInt(_0x5ce418(0x100))/0x6*(-parseInt(_0x5ce418(0xd8))/0x7)+-parseInt(_0x5ce418(0x106))/0x8+parseInt(_0x5ce418(0xe2))/0x9+parseInt(_0x5ce418(0xe3))/0xa;if(_0x19a028===_0xb1c5ac)break;else _0x186a9a['push'](_0x186a9a['shift']());}catch(_0x4c03a8){_0x186a9a['push'](_0x186a9a['shift']());}}}(_0x144e,0xd064f));var __decorate=this&&this[_0x2acc0b(0x109)]||function(_0x24ff2e,_0x327929,_0x517de9,_0x432793){const _0x22624c=_0x2acc0b;var _0x378c9a=arguments['length'],_0x24cf5d=_0x378c9a<0x3?_0x327929:_0x432793===null?_0x432793=Object[_0x22624c(0x112)](_0x327929,_0x517de9):_0x432793,_0x5791fb;if(typeof Reflect===_0x22624c(0xe9)&&typeof Reflect['decorate']==='function')_0x24cf5d=Reflect[_0x22624c(0x116)](_0x24ff2e,_0x327929,_0x517de9,_0x432793);else{for(var _0x3d77d8=_0x24ff2e[_0x22624c(0x10d)]-0x1;_0x3d77d8>=0x0;_0x3d77d8--)if(_0x5791fb=_0x24ff2e[_0x3d77d8])_0x24cf5d=(_0x378c9a<0x3?_0x5791fb(_0x24cf5d):_0x378c9a>0x3?_0x5791fb(_0x327929,_0x517de9,_0x24cf5d):_0x5791fb(_0x327929,_0x517de9))||_0x24cf5d;}return _0x378c9a>0x3&&_0x24cf5d&&Object[_0x22624c(0xfd)](_0x327929,_0x517de9,_0x24cf5d),_0x24cf5d;},__metadata=this&&this[_0x2acc0b(0xf8)]||function(_0x447ab7,_0x251ac0){const _0x59e58a=_0x2acc0b;if(typeof Reflect===_0x59e58a(0xe9)&&typeof Reflect[_0x59e58a(0xdb)]===_0x59e58a(0x10b))return Reflect[_0x59e58a(0xdb)](_0x447ab7,_0x251ac0);},__param=this&&this[_0x2acc0b(0xec)]||function(_0x26a3cf,_0x8531d6){return function(_0x8a5e81,_0x1d87c3){_0x8531d6(_0x8a5e81,_0x1d87c3,_0x26a3cf);};};Object[_0x2acc0b(0xfd)](exports,_0x2acc0b(0xe5),{'value':!![]}),exports[_0x2acc0b(0x10e)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x2acc0b(0x10c)),typeorm_1=require(_0x2acc0b(0x10a)),typeorm_2=require(_0x2acc0b(0xda)),app_entity_1=require(_0x2acc0b(0xd5)),models_service_1=require(_0x2acc0b(0xf7));function _0x2464(_0x11210a,_0x250ca3){const _0x144ea2=_0x144e();return _0x2464=function(_0x246490,_0x2a46c5){_0x246490=_0x246490-0xce;let _0x31e68e=_0x144ea2[_0x246490];return _0x31e68e;},_0x2464(_0x11210a,_0x250ca3);}let ChatGroupService=class ChatGroupService{constructor(_0x5e4157,_0x5aa48e,_0x14788b){const _0x2971e7=_0x2acc0b;this[_0x2971e7(0xe4)]=_0x5e4157,this[_0x2971e7(0xf3)]=_0x5aa48e,this[_0x2971e7(0x108)]=_0x14788b;}async[_0x2acc0b(0x104)](_0xba8e2,_0x419a0e){const _0x1a12d8=_0x2acc0b,{id:_0x4257cc}=_0x419a0e[_0x1a12d8(0xee)],{appId:_0x9e4400}=_0xba8e2,_0x5c9af2={'title':_0x1a12d8(0xf9),'userId':_0x4257cc};if(_0x9e4400){const _0x190270=await this[_0x1a12d8(0xf3)][_0x1a12d8(0xe7)]({'where':{'id':_0x9e4400}});if(!_0x190270)throw new common_1['HttpException']('非法操作、您在使用一个不存在的应用！',common_1[_0x1a12d8(0xde)][_0x1a12d8(0x107)]);else{const {status:_0x1890d3,name:_0x4b27f8}=_0x190270,_0xbde9c8=await this['chatGroupEntity'][_0x1a12d8(0xdd)]({'where':{'userId':_0x4257cc,'appId':_0x9e4400,'isDelete':![]}});if(_0xbde9c8>0x0)throw new common_1[(_0x1a12d8(0xd7))](_0x1a12d8(0xd6),common_1['HttpStatus'][_0x1a12d8(0x107)]);if(![0x1,0x3,0x4,0x5][_0x1a12d8(0x10f)](_0x1890d3))throw new common_1['HttpException'](_0x1a12d8(0xed),common_1[_0x1a12d8(0xde)]['BAD_REQUEST']);_0x4b27f8&&(_0x5c9af2[_0x1a12d8(0xf0)]=_0x4b27f8),_0x9e4400&&(_0x5c9af2[_0x1a12d8(0x103)]=_0x9e4400);}}const _0x78590b=await this['modelsService']['getBaseConfig'](_0x9e4400);_0x9e4400&&(_0x78590b['appId']=_0x9e4400);if(!_0x78590b)throw new common_1['HttpException'](_0x1a12d8(0xcf),common_1['HttpStatus'][_0x1a12d8(0x107)]);return await this[_0x1a12d8(0xe4)][_0x1a12d8(0xfa)](Object[_0x1a12d8(0x115)](Object[_0x1a12d8(0x115)]({},_0x5c9af2),{'config':JSON['stringify'](_0x78590b)}));}async[_0x2acc0b(0xe1)](_0x43d3f8){const _0x53d99a=_0x2acc0b;try{const {id:_0x167954}=_0x43d3f8[_0x53d99a(0xee)],_0x434f72={'userId':_0x167954,'isDelete':![]},_0x4d0168=await this[_0x53d99a(0xe4)][_0x53d99a(0x102)]({'where':_0x434f72,'order':{'isSticky':_0x53d99a(0xe0),'id':_0x53d99a(0xe0)}}),_0x1d5c5b=_0x4d0168[_0x53d99a(0xdf)](_0x22cb71=>_0x22cb71[_0x53d99a(0x103)])[_0x53d99a(0xf6)](_0x538a54=>_0x538a54[_0x53d99a(0x103)]),_0x3fca64=await this['appEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x1d5c5b)}});return _0x4d0168[_0x53d99a(0xf6)](_0x1647a8=>{const _0x44bb35=_0x53d99a;var _0x2dca18;return _0x1647a8[_0x44bb35(0xce)]=(_0x2dca18=_0x3fca64[_0x44bb35(0x102)](_0x5e1694=>_0x5e1694['id']===_0x1647a8[_0x44bb35(0x103)]))===null||_0x2dca18===void 0x0?void 0x0:_0x2dca18[_0x44bb35(0xd3)],_0x1647a8;});}catch(_0x72c293){console[_0x53d99a(0xe8)]('error:\x20',_0x72c293);}}async[_0x2acc0b(0xd9)](_0x22ae79,_0x24950e){const _0x3be200=_0x2acc0b,{title:_0x5e450b,isSticky:_0x1c3543,groupId:_0x5621c4,config:_0x12fa37}=_0x22ae79,{id:_0x4f0a8d}=_0x24950e[_0x3be200(0xee)],_0x56d23f=await this[_0x3be200(0xe4)][_0x3be200(0xe7)]({'where':{'id':_0x5621c4,'userId':_0x4f0a8d}});if(!_0x56d23f)throw new common_1['HttpException'](_0x3be200(0xef),common_1[_0x3be200(0xde)][_0x3be200(0x107)]);const {appId:_0x528569}=_0x56d23f;if(_0x528569&&!_0x5e450b)try{const _0x5763bc=JSON[_0x3be200(0xfc)](_0x12fa37);if(Number(_0x5763bc[_0x3be200(0x117)])!==0x1)throw new common_1[(_0x3be200(0xd7))](_0x3be200(0xea),common_1[_0x3be200(0xde)]['BAD_REQUEST']);}catch(_0x219efa){}const _0x6a9d9b={};_0x5e450b&&(_0x6a9d9b[_0x3be200(0xf0)]=_0x5e450b),typeof _0x1c3543!==_0x3be200(0xd1)&&(_0x6a9d9b[_0x3be200(0xd0)]=_0x1c3543),_0x12fa37&&(_0x6a9d9b['config']=_0x12fa37);const _0xec1322=await this['chatGroupEntity']['update']({'id':_0x5621c4},_0x6a9d9b);if(_0xec1322[_0x3be200(0xdc)])return!![];else throw new common_1['HttpException'](_0x3be200(0x114),common_1[_0x3be200(0xde)][_0x3be200(0x107)]);}async[_0x2acc0b(0xeb)](_0x1b13bb,_0x2750ce){const _0x446766=_0x2acc0b,{groupId:_0x459a00}=_0x1b13bb,{id:_0x545bfd}=_0x2750ce[_0x446766(0xee)],_0x32f754=await this[_0x446766(0xe4)][_0x446766(0xe7)]({'where':{'id':_0x459a00,'userId':_0x545bfd}});if(!_0x32f754)throw new common_1[(_0x446766(0xd7))]('非法操作、您在删除一个非法资源！',common_1[_0x446766(0xde)]['BAD_REQUEST']);const _0x464bb7=await this['chatGroupEntity'][_0x446766(0xd9)]({'id':_0x459a00},{'isDelete':!![]});if(_0x464bb7[_0x446766(0xdc)])return _0x446766(0x111);else throw new common_1[(_0x446766(0xd7))](_0x446766(0x110),common_1[_0x446766(0xde)][_0x446766(0x107)]);}async[_0x2acc0b(0xff)](_0x1b9e2a){const _0x964e0a=_0x2acc0b,{id:_0x5a0551}=_0x1b9e2a['user'],_0x540062=await this[_0x964e0a(0xe4)][_0x964e0a(0xd9)]({'userId':_0x5a0551,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x540062['affected'])return'删除成功';else throw new common_1['HttpException'](_0x964e0a(0x110),common_1[_0x964e0a(0xde)][_0x964e0a(0x107)]);}async[_0x2acc0b(0x113)](_0x4a798f){const _0x333a8e=_0x2acc0b;if(!_0x4a798f)return;return await this[_0x333a8e(0xe4)][_0x333a8e(0xe7)]({'where':{'id':_0x4a798f}});}};ChatGroupService=__decorate([(0x0,common_1[_0x2acc0b(0x101)])(),__param(0x0,(0x0,typeorm_1[_0x2acc0b(0x105)])(chatGroup_entity_1[_0x2acc0b(0xfe)])),__param(0x1,(0x0,typeorm_1[_0x2acc0b(0x105)])(app_entity_1['AppEntity'])),__metadata(_0x2acc0b(0xf4),[typeorm_2[_0x2acc0b(0xf1)],typeorm_2['Repository'],models_service_1[_0x2acc0b(0xf5)]])],ChatGroupService),exports[_0x2acc0b(0x10e)]=ChatGroupService;