'use strict';function _0x262f(_0x87b4cf,_0xb91ea){const _0xdd0d33=_0xdd0d();return _0x262f=function(_0x262fba,_0x19535c){_0x262fba=_0x262fba-0x167;let _0x37b071=_0xdd0d33[_0x262fba];return _0x37b071;},_0x262f(_0x87b4cf,_0xb91ea);}function _0xdd0d(){const _0x176880=['error:\x20','HttpException','function','appEntity','删除失败！','length','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','title','非法操作、您在使用一个不存在的应用！','__decorate','user','InjectRepository','includes','BAD_REQUEST','chatGroupEntity','appLogo','11220781cgohfK','Repository','256352BVoVVr','create','design:paramtypes','del','ChatGroupEntity','非法操作、您在删除一个非法资源！','appId','coverImg','Injectable','decorate','ChatGroupService','filter','3tmClBa','DESC','update','parse','getGroupInfoFromId','defineProperty','91bKntId','stringify','4832228uqxRzD','20TFyaRz','object','ModelsService','isSticky','query','save','modelsService','应用对话名称不能修改哟！','2576061uVfcOH','@nestjs/typeorm','删除成功','102ifTcqP','assign','非法操作、您在使用一个未启用的应用！','@nestjs/common','12jSDsZm','count','map','delAll','AppEntity','请先选择一个对话或者新加一个对话再操作！','28289CmegZi','__esModule','41587351JadHIz','新对话','metadata','find','186795DLHXGr','更新对话失败！','88vnwPGD','HttpStatus','keyType','affected','findOne','../app/app.entity','typeorm','当前应用已经开启了一个对话无需新建了！'];_0xdd0d=function(){return _0x176880;};return _0xdd0d();}const _0x3caff2=_0x262f;(function(_0x2134a7,_0x58fd6e){const _0x1d56f5=_0x262f,_0x2cab5b=_0x2134a7();while(!![]){try{const _0x20cdb5=-parseInt(_0x1d56f5(0x196))/0x1*(-parseInt(_0x1d56f5(0x19e))/0x2)+parseInt(_0x1d56f5(0x178))/0x3*(parseInt(_0x1d56f5(0x180))/0x4)+-parseInt(_0x1d56f5(0x19c))/0x5*(parseInt(_0x1d56f5(0x18c))/0x6)+parseInt(_0x1d56f5(0x17e))/0x7*(parseInt(_0x1d56f5(0x16c))/0x8)+-parseInt(_0x1d56f5(0x189))/0x9*(-parseInt(_0x1d56f5(0x181))/0xa)+-parseInt(_0x1d56f5(0x16a))/0xb*(-parseInt(_0x1d56f5(0x190))/0xc)+-parseInt(_0x1d56f5(0x198))/0xd;if(_0x20cdb5===_0x58fd6e)break;else _0x2cab5b['push'](_0x2cab5b['shift']());}catch(_0x28aab2){_0x2cab5b['push'](_0x2cab5b['shift']());}}}(_0xdd0d,0x99420));var __decorate=this&&this[_0x3caff2(0x1af)]||function(_0x1e0917,_0x54d109,_0x3a6b09,_0x32cfea){const _0x5306ce=_0x3caff2;var _0x19d3a7=arguments['length'],_0xace721=_0x19d3a7<0x3?_0x54d109:_0x32cfea===null?_0x32cfea=Object['getOwnPropertyDescriptor'](_0x54d109,_0x3a6b09):_0x32cfea,_0xa36909;if(typeof Reflect==='object'&&typeof Reflect[_0x5306ce(0x175)]==='function')_0xace721=Reflect[_0x5306ce(0x175)](_0x1e0917,_0x54d109,_0x3a6b09,_0x32cfea);else{for(var _0x252d3c=_0x1e0917[_0x5306ce(0x1ab)]-0x1;_0x252d3c>=0x0;_0x252d3c--)if(_0xa36909=_0x1e0917[_0x252d3c])_0xace721=(_0x19d3a7<0x3?_0xa36909(_0xace721):_0x19d3a7>0x3?_0xa36909(_0x54d109,_0x3a6b09,_0xace721):_0xa36909(_0x54d109,_0x3a6b09))||_0xace721;}return _0x19d3a7>0x3&&_0xace721&&Object[_0x5306ce(0x17d)](_0x54d109,_0x3a6b09,_0xace721),_0xace721;},__metadata=this&&this['__metadata']||function(_0x40e428,_0x553619){const _0x54d42e=_0x3caff2;if(typeof Reflect===_0x54d42e(0x182)&&typeof Reflect['metadata']===_0x54d42e(0x1a8))return Reflect[_0x54d42e(0x19a)](_0x40e428,_0x553619);},__param=this&&this['__param']||function(_0x2c1377,_0x2ae9f1){return function(_0x361dd1,_0x430320){_0x2ae9f1(_0x361dd1,_0x430320,_0x2c1377);};};Object[_0x3caff2(0x17d)](exports,_0x3caff2(0x197),{'value':!![]}),exports[_0x3caff2(0x176)]=void 0x0;const common_1=require(_0x3caff2(0x18f)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x3caff2(0x18a)),typeorm_2=require(_0x3caff2(0x1a4)),app_entity_1=require(_0x3caff2(0x1a3)),models_service_1=require('../models/models.service');let ChatGroupService=class ChatGroupService{constructor(_0x3d698a,_0x5a57c1,_0x57b9df){const _0x5335fa=_0x3caff2;this[_0x5335fa(0x168)]=_0x3d698a,this[_0x5335fa(0x1a9)]=_0x5a57c1,this[_0x5335fa(0x187)]=_0x57b9df;}async[_0x3caff2(0x16d)](_0x29f02e,_0x10aca6){const _0x48423b=_0x3caff2,{id:_0xaa1c9b}=_0x10aca6['user'],{appId:_0x3c1069}=_0x29f02e,_0xe4faa5={'title':_0x48423b(0x199),'userId':_0xaa1c9b};if(_0x3c1069){const _0x3232cc=await this[_0x48423b(0x1a9)][_0x48423b(0x1a2)]({'where':{'id':_0x3c1069}});if(!_0x3232cc)throw new common_1[(_0x48423b(0x1a7))](_0x48423b(0x1ae),common_1[_0x48423b(0x19f)][_0x48423b(0x167)]);else{const {status:_0x4574c2,name:_0x7caec5}=_0x3232cc,_0x2a7a3f=await this[_0x48423b(0x168)][_0x48423b(0x191)]({'where':{'userId':_0xaa1c9b,'appId':_0x3c1069,'isDelete':![]}});if(_0x2a7a3f>0x0)throw new common_1[(_0x48423b(0x1a7))](_0x48423b(0x1a5),common_1['HttpStatus'][_0x48423b(0x167)]);if(![0x1,0x3,0x4,0x5][_0x48423b(0x1b2)](_0x4574c2))throw new common_1[(_0x48423b(0x1a7))](_0x48423b(0x18e),common_1['HttpStatus']['BAD_REQUEST']);_0x7caec5&&(_0xe4faa5[_0x48423b(0x1ad)]=_0x7caec5),_0x3c1069&&(_0xe4faa5['appId']=_0x3c1069);}}const _0x54916d=await this[_0x48423b(0x187)]['getBaseConfig'](_0x3c1069);_0x3c1069&&(_0x54916d['appId']=_0x3c1069);if(!_0x54916d)throw new common_1['HttpException'](_0x48423b(0x1ac),common_1['HttpStatus'][_0x48423b(0x167)]);return await this[_0x48423b(0x168)][_0x48423b(0x186)](Object[_0x48423b(0x18d)](Object[_0x48423b(0x18d)]({},_0xe4faa5),{'config':JSON[_0x48423b(0x17f)](_0x54916d)}));}async[_0x3caff2(0x185)](_0x4fa095){const _0x154909=_0x3caff2;try{const {id:_0x359bbd}=_0x4fa095[_0x154909(0x1b0)],_0x1f9fda={'userId':_0x359bbd,'isDelete':![]},_0x5ef3ff=await this[_0x154909(0x168)][_0x154909(0x19b)]({'where':_0x1f9fda,'order':{'isSticky':'DESC','id':_0x154909(0x179)}}),_0x1f9315=_0x5ef3ff[_0x154909(0x177)](_0x1fbfe2=>_0x1fbfe2[_0x154909(0x172)])[_0x154909(0x192)](_0xd68a20=>_0xd68a20['appId']),_0x5bc9a9=await this['appEntity'][_0x154909(0x19b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1f9315)}});return _0x5ef3ff[_0x154909(0x192)](_0x5a5526=>{const _0x4bba35=_0x154909;var _0x2e4196;return _0x5a5526[_0x4bba35(0x169)]=(_0x2e4196=_0x5bc9a9[_0x4bba35(0x19b)](_0x115e02=>_0x115e02['id']===_0x5a5526[_0x4bba35(0x172)]))===null||_0x2e4196===void 0x0?void 0x0:_0x2e4196[_0x4bba35(0x173)],_0x5a5526;});}catch(_0x2c0b65){console['log'](_0x154909(0x1a6),_0x2c0b65);}}async[_0x3caff2(0x17a)](_0x5a904f,_0x1bb5f1){const _0x527999=_0x3caff2,{title:_0x58d490,isSticky:_0x4a9b69,groupId:_0x4f38b1,config:_0x5df76e}=_0x5a904f,{id:_0x357854}=_0x1bb5f1[_0x527999(0x1b0)],_0x45a6dc=await this[_0x527999(0x168)][_0x527999(0x1a2)]({'where':{'id':_0x4f38b1,'userId':_0x357854}});if(!_0x45a6dc)throw new common_1[(_0x527999(0x1a7))](_0x527999(0x195),common_1[_0x527999(0x19f)][_0x527999(0x167)]);const {appId:_0x1dc057}=_0x45a6dc;if(_0x1dc057&&!_0x58d490)try{const _0x3bfcf9=JSON[_0x527999(0x17b)](_0x5df76e);if(Number(_0x3bfcf9[_0x527999(0x1a0)])!==0x1)throw new common_1[(_0x527999(0x1a7))](_0x527999(0x188),common_1[_0x527999(0x19f)][_0x527999(0x167)]);}catch(_0x2ff07a){}const _0x5b4bb4={};_0x58d490&&(_0x5b4bb4['title']=_0x58d490),typeof _0x4a9b69!=='undefined'&&(_0x5b4bb4[_0x527999(0x184)]=_0x4a9b69),_0x5df76e&&(_0x5b4bb4['config']=_0x5df76e);const _0xd47a2d=await this[_0x527999(0x168)][_0x527999(0x17a)]({'id':_0x4f38b1},_0x5b4bb4);if(_0xd47a2d[_0x527999(0x1a1)])return!![];else throw new common_1['HttpException'](_0x527999(0x19d),common_1[_0x527999(0x19f)][_0x527999(0x167)]);}async[_0x3caff2(0x16f)](_0x267d11,_0x9b53d2){const _0x5327ac=_0x3caff2,{groupId:_0x19d261}=_0x267d11,{id:_0x5a5542}=_0x9b53d2['user'],_0x1bbeeb=await this[_0x5327ac(0x168)][_0x5327ac(0x1a2)]({'where':{'id':_0x19d261,'userId':_0x5a5542}});if(!_0x1bbeeb)throw new common_1['HttpException'](_0x5327ac(0x171),common_1['HttpStatus'][_0x5327ac(0x167)]);const _0x4b9085=await this[_0x5327ac(0x168)]['update']({'id':_0x19d261},{'isDelete':!![]});if(_0x4b9085[_0x5327ac(0x1a1)])return _0x5327ac(0x18b);else throw new common_1['HttpException'](_0x5327ac(0x1aa),common_1[_0x5327ac(0x19f)]['BAD_REQUEST']);}async[_0x3caff2(0x193)](_0x5765b3){const _0x5a686e=_0x3caff2,{id:_0x282ff9}=_0x5765b3[_0x5a686e(0x1b0)],_0x5db71f=await this[_0x5a686e(0x168)]['update']({'userId':_0x282ff9,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x5db71f['affected'])return _0x5a686e(0x18b);else throw new common_1[(_0x5a686e(0x1a7))]('删除失败！',common_1[_0x5a686e(0x19f)][_0x5a686e(0x167)]);}async[_0x3caff2(0x17c)](_0x124452){const _0x53725=_0x3caff2;if(!_0x124452)return;return await this['chatGroupEntity'][_0x53725(0x1a2)]({'where':{'id':_0x124452}});}};ChatGroupService=__decorate([(0x0,common_1[_0x3caff2(0x174)])(),__param(0x0,(0x0,typeorm_1[_0x3caff2(0x1b1)])(chatGroup_entity_1[_0x3caff2(0x170)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x3caff2(0x194)])),__metadata(_0x3caff2(0x16e),[typeorm_2['Repository'],typeorm_2[_0x3caff2(0x16b)],models_service_1[_0x3caff2(0x183)]])],ChatGroupService),exports[_0x3caff2(0x176)]=ChatGroupService;