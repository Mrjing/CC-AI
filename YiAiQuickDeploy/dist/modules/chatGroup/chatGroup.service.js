'use strict';const _0x7b9537=_0x5173;(function(_0x506ef6,_0x1cdf07){const _0x56115c=_0x5173,_0x34514d=_0x506ef6();while(!![]){try{const _0x253ea5=parseInt(_0x56115c(0x108))/0x1*(-parseInt(_0x56115c(0x11a))/0x2)+parseInt(_0x56115c(0xfe))/0x3+parseInt(_0x56115c(0xf4))/0x4+-parseInt(_0x56115c(0xe9))/0x5*(parseInt(_0x56115c(0xf2))/0x6)+-parseInt(_0x56115c(0xf9))/0x7+-parseInt(_0x56115c(0xff))/0x8*(parseInt(_0x56115c(0x118))/0x9)+-parseInt(_0x56115c(0x102))/0xa*(parseInt(_0x56115c(0xf0))/0xb);if(_0x253ea5===_0x1cdf07)break;else _0x34514d['push'](_0x34514d['shift']());}catch(_0x3f8869){_0x34514d['push'](_0x34514d['shift']());}}}(_0x20ff,0xdbc0b));function _0x5173(_0x3dd000,_0x41d9c3){const _0x20ffb3=_0x20ff();return _0x5173=function(_0x51735e,_0x3c98bb){_0x51735e=_0x51735e-0xe0;let _0x58961c=_0x20ffb3[_0x51735e];return _0x58961c;},_0x5173(_0x3dd000,_0x41d9c3);}var __decorate=this&&this[_0x7b9537(0x11b)]||function(_0x5dabfa,_0x5f162b,_0x3045d4,_0x3eafe0){const _0x40c8cc=_0x7b9537;var _0x41711c=arguments['length'],_0x6845a7=_0x41711c<0x3?_0x5f162b:_0x3eafe0===null?_0x3eafe0=Object['getOwnPropertyDescriptor'](_0x5f162b,_0x3045d4):_0x3eafe0,_0x4bf9d0;if(typeof Reflect===_0x40c8cc(0xe7)&&typeof Reflect[_0x40c8cc(0x117)]===_0x40c8cc(0x10b))_0x6845a7=Reflect['decorate'](_0x5dabfa,_0x5f162b,_0x3045d4,_0x3eafe0);else{for(var _0x32c83f=_0x5dabfa[_0x40c8cc(0x11f)]-0x1;_0x32c83f>=0x0;_0x32c83f--)if(_0x4bf9d0=_0x5dabfa[_0x32c83f])_0x6845a7=(_0x41711c<0x3?_0x4bf9d0(_0x6845a7):_0x41711c>0x3?_0x4bf9d0(_0x5f162b,_0x3045d4,_0x6845a7):_0x4bf9d0(_0x5f162b,_0x3045d4))||_0x6845a7;}return _0x41711c>0x3&&_0x6845a7&&Object['defineProperty'](_0x5f162b,_0x3045d4,_0x6845a7),_0x6845a7;},__metadata=this&&this[_0x7b9537(0xef)]||function(_0x398da4,_0x36499c){const _0x359e87=_0x7b9537;if(typeof Reflect===_0x359e87(0xe7)&&typeof Reflect[_0x359e87(0x11c)]===_0x359e87(0x10b))return Reflect['metadata'](_0x398da4,_0x36499c);},__param=this&&this['__param']||function(_0x25cea9,_0xe64ad6){return function(_0x21a4f5,_0x2660c5){_0xe64ad6(_0x21a4f5,_0x2660c5,_0x25cea9);};};Object['defineProperty'](exports,_0x7b9537(0xf8),{'value':!![]}),exports[_0x7b9537(0xe4)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x7b9537(0xf6)),typeorm_1=require(_0x7b9537(0x111)),typeorm_2=require(_0x7b9537(0xf1)),app_entity_1=require(_0x7b9537(0x104)),models_service_1=require(_0x7b9537(0xe5));let ChatGroupService=class ChatGroupService{constructor(_0x44e9b9,_0x467647,_0x341c61){this['chatGroupEntity']=_0x44e9b9,this['appEntity']=_0x467647,this['modelsService']=_0x341c61;}async[_0x7b9537(0x112)](_0x48809f,_0x20b181){const _0x475bb8=_0x7b9537,{id:_0xe61a1b}=_0x20b181[_0x475bb8(0x103)],{appId:_0x29421c}=_0x48809f,_0x38f543={'title':'新对话','userId':_0xe61a1b};if(_0x29421c){const _0x455079=await this[_0x475bb8(0x105)][_0x475bb8(0x107)]({'where':{'id':_0x29421c}});if(!_0x455079)throw new common_1['HttpException'](_0x475bb8(0xf7),common_1['HttpStatus'][_0x475bb8(0xec)]);else{const {status:_0x396ed5,name:_0x25c012}=_0x455079,_0x2c2fa4=await this[_0x475bb8(0x113)]['count']({'where':{'userId':_0xe61a1b,'appId':_0x29421c,'isDelete':![]}});if(_0x2c2fa4>0x0)throw new common_1['HttpException'](_0x475bb8(0x119),common_1[_0x475bb8(0x106)][_0x475bb8(0xec)]);if(![0x1,0x3,0x4,0x5][_0x475bb8(0xfb)](_0x396ed5))throw new common_1['HttpException']('非法操作、您在使用一个未启用的应用！',common_1[_0x475bb8(0x106)][_0x475bb8(0xec)]);_0x25c012&&(_0x38f543[_0x475bb8(0x10f)]=_0x25c012),_0x29421c&&(_0x38f543[_0x475bb8(0xe1)]=_0x29421c);}}const _0x1c1094=await this[_0x475bb8(0xeb)][_0x475bb8(0x114)](_0x29421c);_0x29421c&&(_0x1c1094['appId']=_0x29421c);if(!_0x1c1094)throw new common_1['HttpException'](_0x475bb8(0xed),common_1['HttpStatus'][_0x475bb8(0xec)]);return await this[_0x475bb8(0x113)][_0x475bb8(0x109)](Object[_0x475bb8(0x115)](Object[_0x475bb8(0x115)]({},_0x38f543),{'config':JSON['stringify'](_0x1c1094)}));}async[_0x7b9537(0x11e)](_0xe67f1b){const _0x173d17=_0x7b9537;try{const {id:_0x4161a0}=_0xe67f1b['user'],_0x5300fd={'userId':_0x4161a0,'isDelete':![]},_0x65412b=await this[_0x173d17(0x113)]['find']({'where':_0x5300fd,'order':{'isSticky':_0x173d17(0xe2),'id':_0x173d17(0xe2)}}),_0x3b4d59=_0x65412b[_0x173d17(0xfc)](_0x3e3dd3=>_0x3e3dd3[_0x173d17(0xe1)])[_0x173d17(0xf3)](_0x181b51=>_0x181b51[_0x173d17(0xe1)]),_0x48a86f=await this[_0x173d17(0x105)][_0x173d17(0xe0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3b4d59)}});return _0x65412b[_0x173d17(0xf3)](_0x30b299=>{const _0x2471eb=_0x173d17;var _0x2421d3;return _0x30b299[_0x2471eb(0xea)]=(_0x2421d3=_0x48a86f['find'](_0x1ff31f=>_0x1ff31f['id']===_0x30b299[_0x2471eb(0xe1)]))===null||_0x2421d3===void 0x0?void 0x0:_0x2421d3[_0x2471eb(0x10a)],_0x30b299;});}catch(_0x5cd224){console[_0x173d17(0xfa)]('error:\x20',_0x5cd224);}}async[_0x7b9537(0xee)](_0xb8b46f,_0x5777c4){const _0x5a9593=_0x7b9537,{title:_0x4def9c,isSticky:_0x45f988,groupId:_0x2fe8dc,config:_0x2f8f53}=_0xb8b46f,{id:_0x44c728}=_0x5777c4[_0x5a9593(0x103)],_0x29182c=await this[_0x5a9593(0x113)][_0x5a9593(0x107)]({'where':{'id':_0x2fe8dc,'userId':_0x44c728}});if(!_0x29182c)throw new common_1[(_0x5a9593(0x10d))]('请先选择一个对话或者新加一个对话再操作！',common_1['HttpStatus'][_0x5a9593(0xec)]);const {appId:_0x520869}=_0x29182c;if(_0x520869&&!_0x4def9c)try{const _0xc0c8dd=JSON['parse'](_0x2f8f53);if(Number(_0xc0c8dd['keyType'])!==0x1)throw new common_1[(_0x5a9593(0x10d))](_0x5a9593(0x10e),common_1[_0x5a9593(0x106)][_0x5a9593(0xec)]);}catch(_0x2de145){}const _0x1cc1c5={};_0x4def9c&&(_0x1cc1c5['title']=_0x4def9c),typeof _0x45f988!==_0x5a9593(0xe6)&&(_0x1cc1c5['isSticky']=_0x45f988),_0x2f8f53&&(_0x1cc1c5[_0x5a9593(0xe8)]=_0x2f8f53);const _0x33a28a=await this[_0x5a9593(0x113)][_0x5a9593(0xee)]({'id':_0x2fe8dc},_0x1cc1c5);if(_0x33a28a['affected'])return!![];else throw new common_1['HttpException']('更新对话失败！',common_1[_0x5a9593(0x106)]['BAD_REQUEST']);}async['del'](_0x261ba3,_0x20c457){const _0x4c4d51=_0x7b9537,{groupId:_0x176c13}=_0x261ba3,{id:_0x30c84a}=_0x20c457[_0x4c4d51(0x103)],_0x30c9d8=await this[_0x4c4d51(0x113)][_0x4c4d51(0x107)]({'where':{'id':_0x176c13,'userId':_0x30c84a}});if(!_0x30c9d8)throw new common_1[(_0x4c4d51(0x10d))](_0x4c4d51(0x11d),common_1['HttpStatus'][_0x4c4d51(0xec)]);const _0x4293d2=await this[_0x4c4d51(0x113)]['update']({'id':_0x176c13},{'isDelete':!![]});if(_0x4293d2[_0x4c4d51(0x100)])return _0x4c4d51(0x120);else throw new common_1[(_0x4c4d51(0x10d))](_0x4c4d51(0x10c),common_1[_0x4c4d51(0x106)][_0x4c4d51(0xec)]);}async['delAll'](_0x4e0913){const _0x42976f=_0x7b9537,{id:_0x5b6d91}=_0x4e0913[_0x42976f(0x103)],_0x1a20cb=await this[_0x42976f(0x113)]['update']({'userId':_0x5b6d91,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x1a20cb[_0x42976f(0x100)])return _0x42976f(0x120);else throw new common_1[(_0x42976f(0x10d))](_0x42976f(0x10c),common_1[_0x42976f(0x106)][_0x42976f(0xec)]);}async[_0x7b9537(0x110)](_0x39579c){const _0x4213b8=_0x7b9537;if(!_0x39579c)return;return await this[_0x4213b8(0x113)]['findOne']({'where':{'id':_0x39579c}});}};function _0x20ff(){const _0x123732=['query','length','删除成功','find','appId','DESC','Repository','ChatGroupService','../models/models.service','undefined','object','config','266205rbxhdc','appLogo','modelsService','BAD_REQUEST','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','update','__metadata','11ANZuoz','typeorm','6RpOwtj','map','6418344WDxxtC','AppEntity','./chatGroup.entity','非法操作、您在使用一个不存在的应用！','__esModule','3459855klSecT','log','includes','filter','Injectable','4311027WtnLBM','393064wIbobs','affected','InjectRepository','1300030sUvKyQ','user','../app/app.entity','appEntity','HttpStatus','findOne','22WRJkYe','save','coverImg','function','删除失败！','HttpException','应用对话名称不能修改哟！','title','getGroupInfoFromId','@nestjs/typeorm','create','chatGroupEntity','getBaseConfig','assign','design:paramtypes','decorate','99lzgTGQ','当前应用已经开启了一个对话无需新建了！','83956JZsAdj','__decorate','metadata','非法操作、您在删除一个非法资源！'];_0x20ff=function(){return _0x123732;};return _0x20ff();}ChatGroupService=__decorate([(0x0,common_1[_0x7b9537(0xfd)])(),__param(0x0,(0x0,typeorm_1[_0x7b9537(0x101)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x7b9537(0xf5)])),__metadata(_0x7b9537(0x116),[typeorm_2['Repository'],typeorm_2[_0x7b9537(0xe3)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x7b9537(0xe4)]=ChatGroupService;