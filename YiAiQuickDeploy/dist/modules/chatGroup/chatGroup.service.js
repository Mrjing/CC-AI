'use strict';function _0x1c5c(_0x16c2e7,_0x4062af){const _0x351623=_0x3516();return _0x1c5c=function(_0x1c5c91,_0x2ca9ad){_0x1c5c91=_0x1c5c91-0x132;let _0x483a62=_0x351623[_0x1c5c91];return _0x483a62;},_0x1c5c(_0x16c2e7,_0x4062af);}const _0x517e71=_0x1c5c;function _0x3516(){const _0x17688c=['11eCCNMv','@nestjs/common','480701rgEDio','199570aoVgSr','HttpException','map','defineProperty','__decorate','affected','12RRQiNf','parse','Repository','user','873ZkNbvt','getOwnPropertyDescriptor','ChatGroupEntity','@nestjs/typeorm','../app/app.entity','query','HttpStatus','getBaseConfig','stringify','ChatGroupService','删除成功','../models/models.service','decorate','config','当前应用已经开启了一个对话无需新建了！','coverImg','keyType','update','find','appEntity','7AwpmSq','metadata','delAll','AppEntity','save','object','请先选择一个对话或者新加一个对话再操作！','chatGroupEntity','ModelsService','新对话','477669HDdLiX','./chatGroup.entity','非法操作、您在使用一个不存在的应用！','includes','__param','length','Injectable','title','BAD_REQUEST','undefined','isSticky','InjectRepository','error:\x20','__esModule','10672WgIwbP','85DXEkBO','typeorm','create','assign','filter','2690zaEYkh','14555qGmmim','function','log','design:paramtypes','更新对话失败！','findOne','164tZcjlc','删除失败！','499374uAwdZZ','DESC','appId'];_0x3516=function(){return _0x17688c;};return _0x3516();}(function(_0x1d2ca9,_0x36ef94){const _0x44853e=_0x1c5c,_0x27ec8e=_0x1d2ca9();while(!![]){try{const _0x2e7d66=-parseInt(_0x44853e(0x15b))/0x1*(-parseInt(_0x44853e(0x160))/0x2)+-parseInt(_0x44853e(0x14c))/0x3+parseInt(_0x44853e(0x167))/0x4*(parseInt(_0x44853e(0x161))/0x5)+-parseInt(_0x44853e(0x169))/0x6*(parseInt(_0x44853e(0x142))/0x7)+parseInt(_0x44853e(0x15a))/0x8*(parseInt(_0x44853e(0x179))/0x9)+parseInt(_0x44853e(0x16f))/0xa*(parseInt(_0x44853e(0x16c))/0xb)+parseInt(_0x44853e(0x175))/0xc*(-parseInt(_0x44853e(0x16e))/0xd);if(_0x2e7d66===_0x36ef94)break;else _0x27ec8e['push'](_0x27ec8e['shift']());}catch(_0x54b0ba){_0x27ec8e['push'](_0x27ec8e['shift']());}}}(_0x3516,0x194b2));var __decorate=this&&this[_0x517e71(0x173)]||function(_0xfdb499,_0x1c4f12,_0x4f7efd,_0x1c42e6){const _0x23d39a=_0x517e71;var _0xbff85f=arguments[_0x23d39a(0x151)],_0x64773f=_0xbff85f<0x3?_0x1c4f12:_0x1c42e6===null?_0x1c42e6=Object[_0x23d39a(0x17a)](_0x1c4f12,_0x4f7efd):_0x1c42e6,_0x2dcd5f;if(typeof Reflect===_0x23d39a(0x147)&&typeof Reflect[_0x23d39a(0x13a)]===_0x23d39a(0x162))_0x64773f=Reflect[_0x23d39a(0x13a)](_0xfdb499,_0x1c4f12,_0x4f7efd,_0x1c42e6);else{for(var _0x20c6ff=_0xfdb499[_0x23d39a(0x151)]-0x1;_0x20c6ff>=0x0;_0x20c6ff--)if(_0x2dcd5f=_0xfdb499[_0x20c6ff])_0x64773f=(_0xbff85f<0x3?_0x2dcd5f(_0x64773f):_0xbff85f>0x3?_0x2dcd5f(_0x1c4f12,_0x4f7efd,_0x64773f):_0x2dcd5f(_0x1c4f12,_0x4f7efd))||_0x64773f;}return _0xbff85f>0x3&&_0x64773f&&Object[_0x23d39a(0x172)](_0x1c4f12,_0x4f7efd,_0x64773f),_0x64773f;},__metadata=this&&this['__metadata']||function(_0x19f811,_0x33714b){const _0x2de655=_0x517e71;if(typeof Reflect==='object'&&typeof Reflect[_0x2de655(0x143)]==='function')return Reflect[_0x2de655(0x143)](_0x19f811,_0x33714b);},__param=this&&this[_0x517e71(0x150)]||function(_0x25fde8,_0x1d5fdf){return function(_0xec1395,_0x588007){_0x1d5fdf(_0xec1395,_0x588007,_0x25fde8);};};Object[_0x517e71(0x172)](exports,_0x517e71(0x159),{'value':!![]}),exports[_0x517e71(0x137)]=void 0x0;const common_1=require(_0x517e71(0x16d)),chatGroup_entity_1=require(_0x517e71(0x14d)),typeorm_1=require(_0x517e71(0x17c)),typeorm_2=require(_0x517e71(0x15c)),app_entity_1=require(_0x517e71(0x132)),models_service_1=require(_0x517e71(0x139));let ChatGroupService=class ChatGroupService{constructor(_0xf90dac,_0x248778,_0x40f0f0){const _0x57fef2=_0x517e71;this[_0x57fef2(0x149)]=_0xf90dac,this[_0x57fef2(0x141)]=_0x248778,this['modelsService']=_0x40f0f0;}async[_0x517e71(0x15d)](_0x196616,_0x2a1e52){const _0x57cbf7=_0x517e71,{id:_0x5ca9c0}=_0x2a1e52[_0x57cbf7(0x178)],{appId:_0x4426df}=_0x196616,_0x9c35bd={'title':_0x57cbf7(0x14b),'userId':_0x5ca9c0};if(_0x4426df){const _0x154ab1=await this[_0x57cbf7(0x141)][_0x57cbf7(0x166)]({'where':{'id':_0x4426df}});if(!_0x154ab1)throw new common_1['HttpException'](_0x57cbf7(0x14e),common_1[_0x57cbf7(0x134)][_0x57cbf7(0x154)]);else{const {status:_0x31af7f,name:_0x417880}=_0x154ab1,_0x4cb54c=await this[_0x57cbf7(0x149)]['count']({'where':{'userId':_0x5ca9c0,'appId':_0x4426df,'isDelete':![]}});if(_0x4cb54c>0x0)throw new common_1[(_0x57cbf7(0x170))](_0x57cbf7(0x13c),common_1[_0x57cbf7(0x134)][_0x57cbf7(0x154)]);if(![0x1,0x3,0x4,0x5][_0x57cbf7(0x14f)](_0x31af7f))throw new common_1[(_0x57cbf7(0x170))]('非法操作、您在使用一个未启用的应用！',common_1[_0x57cbf7(0x134)][_0x57cbf7(0x154)]);_0x417880&&(_0x9c35bd['title']=_0x417880),_0x4426df&&(_0x9c35bd[_0x57cbf7(0x16b)]=_0x4426df);}}const _0x422311=await this['modelsService'][_0x57cbf7(0x135)](_0x4426df);_0x4426df&&(_0x422311[_0x57cbf7(0x16b)]=_0x4426df);if(!_0x422311)throw new common_1['HttpException']('管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！',common_1[_0x57cbf7(0x134)][_0x57cbf7(0x154)]);return await this[_0x57cbf7(0x149)][_0x57cbf7(0x146)](Object[_0x57cbf7(0x15e)](Object['assign']({},_0x9c35bd),{'config':JSON[_0x57cbf7(0x136)](_0x422311)}));}async[_0x517e71(0x133)](_0x466c31){const _0x42859a=_0x517e71;try{const {id:_0x576bc5}=_0x466c31[_0x42859a(0x178)],_0x54a3f6={'userId':_0x576bc5,'isDelete':![]},_0x5af183=await this[_0x42859a(0x149)][_0x42859a(0x140)]({'where':_0x54a3f6,'order':{'isSticky':_0x42859a(0x16a),'id':'DESC'}}),_0x45b5a2=_0x5af183[_0x42859a(0x15f)](_0x194bf3=>_0x194bf3['appId'])[_0x42859a(0x171)](_0x53f970=>_0x53f970['appId']),_0x35caba=await this[_0x42859a(0x141)][_0x42859a(0x140)]({'where':{'id':(0x0,typeorm_2['In'])(_0x45b5a2)}});return _0x5af183[_0x42859a(0x171)](_0xc25659=>{const _0x2418d7=_0x42859a;var _0x34af1e;return _0xc25659['appLogo']=(_0x34af1e=_0x35caba[_0x2418d7(0x140)](_0x56541a=>_0x56541a['id']===_0xc25659[_0x2418d7(0x16b)]))===null||_0x34af1e===void 0x0?void 0x0:_0x34af1e[_0x2418d7(0x13d)],_0xc25659;});}catch(_0x20a318){console[_0x42859a(0x163)](_0x42859a(0x158),_0x20a318);}}async[_0x517e71(0x13f)](_0x4ae967,_0x548130){const _0x90d843=_0x517e71,{title:_0x4817eb,isSticky:_0x22a436,groupId:_0x4a032e,config:_0x47a1c8}=_0x4ae967,{id:_0x3ef69a}=_0x548130[_0x90d843(0x178)],_0x1c6479=await this[_0x90d843(0x149)]['findOne']({'where':{'id':_0x4a032e,'userId':_0x3ef69a}});if(!_0x1c6479)throw new common_1[(_0x90d843(0x170))](_0x90d843(0x148),common_1[_0x90d843(0x134)][_0x90d843(0x154)]);const {appId:_0x50bae8}=_0x1c6479;if(_0x50bae8&&!_0x4817eb)try{const _0x7720b9=JSON[_0x90d843(0x176)](_0x47a1c8);if(Number(_0x7720b9[_0x90d843(0x13e)])!==0x1)throw new common_1[(_0x90d843(0x170))]('应用对话名称不能修改哟！',common_1[_0x90d843(0x134)][_0x90d843(0x154)]);}catch(_0x3ba3d2){}const _0x53420c={};_0x4817eb&&(_0x53420c[_0x90d843(0x153)]=_0x4817eb),typeof _0x22a436!==_0x90d843(0x155)&&(_0x53420c[_0x90d843(0x156)]=_0x22a436),_0x47a1c8&&(_0x53420c[_0x90d843(0x13b)]=_0x47a1c8);const _0x11e0c8=await this[_0x90d843(0x149)][_0x90d843(0x13f)]({'id':_0x4a032e},_0x53420c);if(_0x11e0c8[_0x90d843(0x174)])return!![];else throw new common_1[(_0x90d843(0x170))](_0x90d843(0x165),common_1[_0x90d843(0x134)][_0x90d843(0x154)]);}async['del'](_0x428f75,_0x1c196c){const _0x540582=_0x517e71,{groupId:_0x3639b0}=_0x428f75,{id:_0x4c1dcf}=_0x1c196c[_0x540582(0x178)],_0x17cd36=await this[_0x540582(0x149)]['findOne']({'where':{'id':_0x3639b0,'userId':_0x4c1dcf}});if(!_0x17cd36)throw new common_1[(_0x540582(0x170))]('非法操作、您在删除一个非法资源！',common_1[_0x540582(0x134)]['BAD_REQUEST']);const _0x22e777=await this['chatGroupEntity'][_0x540582(0x13f)]({'id':_0x3639b0},{'isDelete':!![]});if(_0x22e777['affected'])return _0x540582(0x138);else throw new common_1[(_0x540582(0x170))]('删除失败！',common_1[_0x540582(0x134)][_0x540582(0x154)]);}async[_0x517e71(0x144)](_0x288b0a){const _0x2a1282=_0x517e71,{id:_0x5836a9}=_0x288b0a[_0x2a1282(0x178)],_0x37359f=await this[_0x2a1282(0x149)][_0x2a1282(0x13f)]({'userId':_0x5836a9,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x37359f['affected'])return'删除成功';else throw new common_1[(_0x2a1282(0x170))](_0x2a1282(0x168),common_1[_0x2a1282(0x134)][_0x2a1282(0x154)]);}async['getGroupInfoFromId'](_0xbf056a){const _0x41d024=_0x517e71;if(!_0xbf056a)return;return await this['chatGroupEntity'][_0x41d024(0x166)]({'where':{'id':_0xbf056a}});}};ChatGroupService=__decorate([(0x0,common_1[_0x517e71(0x152)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x517e71(0x17b)])),__param(0x1,(0x0,typeorm_1[_0x517e71(0x157)])(app_entity_1[_0x517e71(0x145)])),__metadata(_0x517e71(0x164),[typeorm_2['Repository'],typeorm_2[_0x517e71(0x177)],models_service_1[_0x517e71(0x14a)]])],ChatGroupService),exports[_0x517e71(0x137)]=ChatGroupService;