'use strict';const _0x114b68=_0x3d3d;function _0x3d3d(_0x2c7257,_0x316daa){const _0x22961e=_0x2296();return _0x3d3d=function(_0x3d3da7,_0x1a31fc){_0x3d3da7=_0x3d3da7-0x1b0;let _0x3477c3=_0x22961e[_0x3d3da7];return _0x3477c3;},_0x3d3d(_0x2c7257,_0x316daa);}(function(_0x4a1b85,_0x5c7e6f){const _0x5d2423=_0x3d3d,_0x526676=_0x4a1b85();while(!![]){try{const _0x2ec372=-parseInt(_0x5d2423(0x1f0))/0x1*(-parseInt(_0x5d2423(0x1e8))/0x2)+parseInt(_0x5d2423(0x1bc))/0x3+-parseInt(_0x5d2423(0x1cf))/0x4*(-parseInt(_0x5d2423(0x1e1))/0x5)+-parseInt(_0x5d2423(0x1ca))/0x6+-parseInt(_0x5d2423(0x1e5))/0x7+parseInt(_0x5d2423(0x1b6))/0x8+parseInt(_0x5d2423(0x1cb))/0x9*(-parseInt(_0x5d2423(0x1d9))/0xa);if(_0x2ec372===_0x5c7e6f)break;else _0x526676['push'](_0x526676['shift']());}catch(_0x13874c){_0x526676['push'](_0x526676['shift']());}}}(_0x2296,0xb987a));function _0x2296(){const _0x5c0934=['update','BAD_REQUEST','affected','非法操作、您在使用一个未启用的应用！','10INojkW','del','map','log','2935128SWlecd','save','./chatGroup.entity','91792eAleVt','Repository','config','HttpException','function','当前应用已经开启了一个对话无需新建了！','create','findOne','2qIhByQ','assign','title','find','metadata','Injectable','parse','8474240Ayzgnw','__param','../models/models.service','ChatGroupService','undefined','删除失败！','640518LcuKIR','InjectRepository','appEntity','stringify','AppEntity','getGroupInfoFromId','object','coverImg','HttpStatus','ModelsService','非法操作、您在删除一个非法资源！','defineProperty','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','user','1715736yuZWeu','2600478rFtBKb','count','DESC','modelsService','1934876RKggTK','error:\x20','新对话','../app/app.entity','filter','@nestjs/typeorm','chatGroupEntity','keyType','ChatGroupEntity','删除成功','30fLwsTQ','length','appId','query'];_0x2296=function(){return _0x5c0934;};return _0x2296();}var __decorate=this&&this['__decorate']||function(_0x3cd7d5,_0x29bac0,_0x1445a6,_0x102b77){const _0x194c45=_0x3d3d;var _0x18e446=arguments[_0x194c45(0x1da)],_0x1e8298=_0x18e446<0x3?_0x29bac0:_0x102b77===null?_0x102b77=Object['getOwnPropertyDescriptor'](_0x29bac0,_0x1445a6):_0x102b77,_0x59cda8;if(typeof Reflect===_0x194c45(0x1c2)&&typeof Reflect['decorate']==='function')_0x1e8298=Reflect['decorate'](_0x3cd7d5,_0x29bac0,_0x1445a6,_0x102b77);else{for(var _0x1bb673=_0x3cd7d5[_0x194c45(0x1da)]-0x1;_0x1bb673>=0x0;_0x1bb673--)if(_0x59cda8=_0x3cd7d5[_0x1bb673])_0x1e8298=(_0x18e446<0x3?_0x59cda8(_0x1e8298):_0x18e446>0x3?_0x59cda8(_0x29bac0,_0x1445a6,_0x1e8298):_0x59cda8(_0x29bac0,_0x1445a6))||_0x1e8298;}return _0x18e446>0x3&&_0x1e8298&&Object[_0x194c45(0x1c7)](_0x29bac0,_0x1445a6,_0x1e8298),_0x1e8298;},__metadata=this&&this['__metadata']||function(_0x4cbd5d,_0x34a347){const _0x4cc773=_0x3d3d;if(typeof Reflect===_0x4cc773(0x1c2)&&typeof Reflect[_0x4cc773(0x1b3)]===_0x4cc773(0x1ec))return Reflect[_0x4cc773(0x1b3)](_0x4cbd5d,_0x34a347);},__param=this&&this[_0x114b68(0x1b7)]||function(_0xc4bf22,_0x4bb0f3){return function(_0x5e39d4,_0x1f2a88){_0x4bb0f3(_0x5e39d4,_0x1f2a88,_0xc4bf22);};};Object[_0x114b68(0x1c7)](exports,'__esModule',{'value':!![]}),exports[_0x114b68(0x1b9)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x114b68(0x1e7)),typeorm_1=require(_0x114b68(0x1d4)),typeorm_2=require('typeorm'),app_entity_1=require(_0x114b68(0x1d2)),models_service_1=require(_0x114b68(0x1b8));let ChatGroupService=class ChatGroupService{constructor(_0xdadd3c,_0x1193a0,_0x3808f0){const _0x39261e=_0x114b68;this[_0x39261e(0x1d5)]=_0xdadd3c,this[_0x39261e(0x1be)]=_0x1193a0,this[_0x39261e(0x1ce)]=_0x3808f0;}async[_0x114b68(0x1ee)](_0x4b0fcc,_0x131f48){const _0x4f6ae5=_0x114b68,{id:_0x3669d8}=_0x131f48[_0x4f6ae5(0x1c9)],{appId:_0x5eaf7f}=_0x4b0fcc,_0x8f7398={'title':_0x4f6ae5(0x1d1),'userId':_0x3669d8};if(_0x5eaf7f){const _0x3f1d3f=await this[_0x4f6ae5(0x1be)][_0x4f6ae5(0x1ef)]({'where':{'id':_0x5eaf7f}});if(!_0x3f1d3f)throw new common_1['HttpException']('非法操作、您在使用一个不存在的应用！',common_1[_0x4f6ae5(0x1c4)][_0x4f6ae5(0x1de)]);else{const {status:_0x4a767f,name:_0x343818}=_0x3f1d3f,_0x51f9d7=await this['chatGroupEntity'][_0x4f6ae5(0x1cc)]({'where':{'userId':_0x3669d8,'appId':_0x5eaf7f,'isDelete':![]}});if(_0x51f9d7>0x0)throw new common_1[(_0x4f6ae5(0x1eb))](_0x4f6ae5(0x1ed),common_1[_0x4f6ae5(0x1c4)][_0x4f6ae5(0x1de)]);if(![0x1,0x3,0x4,0x5]['includes'](_0x4a767f))throw new common_1[(_0x4f6ae5(0x1eb))](_0x4f6ae5(0x1e0),common_1[_0x4f6ae5(0x1c4)]['BAD_REQUEST']);_0x343818&&(_0x8f7398[_0x4f6ae5(0x1b1)]=_0x343818),_0x5eaf7f&&(_0x8f7398['appId']=_0x5eaf7f);}}const _0x5cc0c5=await this[_0x4f6ae5(0x1ce)]['getBaseConfig'](_0x5eaf7f);_0x5eaf7f&&(_0x5cc0c5[_0x4f6ae5(0x1db)]=_0x5eaf7f);if(!_0x5cc0c5)throw new common_1['HttpException'](_0x4f6ae5(0x1c8),common_1['HttpStatus'][_0x4f6ae5(0x1de)]);return await this[_0x4f6ae5(0x1d5)][_0x4f6ae5(0x1e6)](Object[_0x4f6ae5(0x1b0)](Object[_0x4f6ae5(0x1b0)]({},_0x8f7398),{'config':JSON[_0x4f6ae5(0x1bf)](_0x5cc0c5)}));}async[_0x114b68(0x1dc)](_0x404599){const _0x212e56=_0x114b68;try{const {id:_0x2bf2ce}=_0x404599[_0x212e56(0x1c9)],_0x486707={'userId':_0x2bf2ce,'isDelete':![]},_0x3f8bbc=await this[_0x212e56(0x1d5)][_0x212e56(0x1b2)]({'where':_0x486707,'order':{'isSticky':_0x212e56(0x1cd),'id':_0x212e56(0x1cd)}}),_0x34c1ed=_0x3f8bbc[_0x212e56(0x1d3)](_0x51a974=>_0x51a974['appId'])[_0x212e56(0x1e3)](_0x4e289c=>_0x4e289c[_0x212e56(0x1db)]),_0x580264=await this[_0x212e56(0x1be)][_0x212e56(0x1b2)]({'where':{'id':(0x0,typeorm_2['In'])(_0x34c1ed)}});return _0x3f8bbc['map'](_0x185c3b=>{const _0x4de4c9=_0x212e56;var _0x5d370c;return _0x185c3b['appLogo']=(_0x5d370c=_0x580264[_0x4de4c9(0x1b2)](_0x284816=>_0x284816['id']===_0x185c3b[_0x4de4c9(0x1db)]))===null||_0x5d370c===void 0x0?void 0x0:_0x5d370c[_0x4de4c9(0x1c3)],_0x185c3b;});}catch(_0x6b485){console[_0x212e56(0x1e4)](_0x212e56(0x1d0),_0x6b485);}}async[_0x114b68(0x1dd)](_0x5cd54d,_0x1373c5){const _0xf0e42a=_0x114b68,{title:_0x1e5639,isSticky:_0x3e2393,groupId:_0x4654a7,config:_0x2a93fa}=_0x5cd54d,{id:_0x1ef941}=_0x1373c5[_0xf0e42a(0x1c9)],_0x1c81c9=await this[_0xf0e42a(0x1d5)]['findOne']({'where':{'id':_0x4654a7,'userId':_0x1ef941}});if(!_0x1c81c9)throw new common_1['HttpException']('请先选择一个对话或者新加一个对话再操作！',common_1[_0xf0e42a(0x1c4)][_0xf0e42a(0x1de)]);const {appId:_0x2c9b69}=_0x1c81c9;if(_0x2c9b69&&!_0x1e5639)try{const _0x35ad3b=JSON[_0xf0e42a(0x1b5)](_0x2a93fa);if(Number(_0x35ad3b[_0xf0e42a(0x1d6)])!==0x1)throw new common_1[(_0xf0e42a(0x1eb))]('应用对话名称不能修改哟！',common_1[_0xf0e42a(0x1c4)][_0xf0e42a(0x1de)]);}catch(_0x215e77){}const _0x1dc12d={};_0x1e5639&&(_0x1dc12d[_0xf0e42a(0x1b1)]=_0x1e5639),typeof _0x3e2393!==_0xf0e42a(0x1ba)&&(_0x1dc12d['isSticky']=_0x3e2393),_0x2a93fa&&(_0x1dc12d[_0xf0e42a(0x1ea)]=_0x2a93fa);const _0x26df2e=await this[_0xf0e42a(0x1d5)][_0xf0e42a(0x1dd)]({'id':_0x4654a7},_0x1dc12d);if(_0x26df2e['affected'])return!![];else throw new common_1[(_0xf0e42a(0x1eb))]('更新对话失败！',common_1[_0xf0e42a(0x1c4)][_0xf0e42a(0x1de)]);}async[_0x114b68(0x1e2)](_0x2f16f8,_0x39967b){const _0x1fb69a=_0x114b68,{groupId:_0x426a0d}=_0x2f16f8,{id:_0x20e30f}=_0x39967b[_0x1fb69a(0x1c9)],_0x2a378e=await this[_0x1fb69a(0x1d5)][_0x1fb69a(0x1ef)]({'where':{'id':_0x426a0d,'userId':_0x20e30f}});if(!_0x2a378e)throw new common_1[(_0x1fb69a(0x1eb))](_0x1fb69a(0x1c6),common_1[_0x1fb69a(0x1c4)]['BAD_REQUEST']);const _0x4b3d02=await this[_0x1fb69a(0x1d5)][_0x1fb69a(0x1dd)]({'id':_0x426a0d},{'isDelete':!![]});if(_0x4b3d02[_0x1fb69a(0x1df)])return _0x1fb69a(0x1d8);else throw new common_1[(_0x1fb69a(0x1eb))]('删除失败！',common_1[_0x1fb69a(0x1c4)][_0x1fb69a(0x1de)]);}async['delAll'](_0xe9b3ab){const _0x499151=_0x114b68,{id:_0x43b92a}=_0xe9b3ab[_0x499151(0x1c9)],_0x515c29=await this['chatGroupEntity'][_0x499151(0x1dd)]({'userId':_0x43b92a,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x515c29[_0x499151(0x1df)])return _0x499151(0x1d8);else throw new common_1[(_0x499151(0x1eb))](_0x499151(0x1bb),common_1[_0x499151(0x1c4)][_0x499151(0x1de)]);}async[_0x114b68(0x1c1)](_0x4020b1){const _0x4cbcf5=_0x114b68;if(!_0x4020b1)return;return await this[_0x4cbcf5(0x1d5)][_0x4cbcf5(0x1ef)]({'where':{'id':_0x4020b1}});}};ChatGroupService=__decorate([(0x0,common_1[_0x114b68(0x1b4)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x114b68(0x1d7)])),__param(0x1,(0x0,typeorm_1[_0x114b68(0x1bd)])(app_entity_1[_0x114b68(0x1c0)])),__metadata('design:paramtypes',[typeorm_2[_0x114b68(0x1e9)],typeorm_2[_0x114b68(0x1e9)],models_service_1[_0x114b68(0x1c5)]])],ChatGroupService),exports[_0x114b68(0x1b9)]=ChatGroupService;