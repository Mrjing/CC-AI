'use strict';const _0x44ecc0=_0x883e;(function(_0x31a3fe,_0x3ffaba){const _0x1fee1b=_0x883e,_0x7025c1=_0x31a3fe();while(!![]){try{const _0x5e498f=-parseInt(_0x1fee1b(0xc8))/0x1+-parseInt(_0x1fee1b(0xd5))/0x2+-parseInt(_0x1fee1b(0xce))/0x3*(parseInt(_0x1fee1b(0xe7))/0x4)+parseInt(_0x1fee1b(0xde))/0x5+-parseInt(_0x1fee1b(0xe5))/0x6+-parseInt(_0x1fee1b(0xc2))/0x7+parseInt(_0x1fee1b(0xbc))/0x8;if(_0x5e498f===_0x3ffaba)break;else _0x7025c1['push'](_0x7025c1['shift']());}catch(_0x189066){_0x7025c1['push'](_0x7025c1['shift']());}}}(_0x3bc9,0x8f74c));var __decorate=this&&this[_0x44ecc0(0xb1)]||function(_0x490a0f,_0x1f5e91,_0x3f61d5,_0x2374db){const _0x4abae0=_0x44ecc0;var _0xecae0e=arguments['length'],_0x137eb5=_0xecae0e<0x3?_0x1f5e91:_0x2374db===null?_0x2374db=Object['getOwnPropertyDescriptor'](_0x1f5e91,_0x3f61d5):_0x2374db,_0x354e71;if(typeof Reflect==='object'&&typeof Reflect[_0x4abae0(0xea)]===_0x4abae0(0xc3))_0x137eb5=Reflect[_0x4abae0(0xea)](_0x490a0f,_0x1f5e91,_0x3f61d5,_0x2374db);else{for(var _0x4d9be0=_0x490a0f[_0x4abae0(0xbf)]-0x1;_0x4d9be0>=0x0;_0x4d9be0--)if(_0x354e71=_0x490a0f[_0x4d9be0])_0x137eb5=(_0xecae0e<0x3?_0x354e71(_0x137eb5):_0xecae0e>0x3?_0x354e71(_0x1f5e91,_0x3f61d5,_0x137eb5):_0x354e71(_0x1f5e91,_0x3f61d5))||_0x137eb5;}return _0xecae0e>0x3&&_0x137eb5&&Object['defineProperty'](_0x1f5e91,_0x3f61d5,_0x137eb5),_0x137eb5;},__metadata=this&&this['__metadata']||function(_0x3a5dc3,_0xdfa90b){const _0x1a6fcd=_0x44ecc0;if(typeof Reflect===_0x1a6fcd(0xca)&&typeof Reflect[_0x1a6fcd(0xc4)]===_0x1a6fcd(0xc3))return Reflect[_0x1a6fcd(0xc4)](_0x3a5dc3,_0xdfa90b);},__param=this&&this['__param']||function(_0x54699d,_0x4c6f39){return function(_0x5283e7,_0x19196b){_0x4c6f39(_0x5283e7,_0x19196b,_0x54699d);};};Object[_0x44ecc0(0xbb)](exports,_0x44ecc0(0xc9),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require(_0x44ecc0(0xb4)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x44ecc0(0xda)),typeorm_2=require('typeorm'),app_entity_1=require(_0x44ecc0(0xb9)),models_service_1=require(_0x44ecc0(0xd6));function _0x3bc9(){const _0x24fae4=['非法操作、您在使用一个不存在的应用！','assign','__decorate','请先选择一个对话或者新加一个对话再操作！','save','@nestjs/common','HttpException','非法操作、您在删除一个非法资源！','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','ChatGroupService','../app/app.entity','BAD_REQUEST','defineProperty','30817072uXgUNj','includes','删除失败！','length','affected','appId','5288213hBrluZ','function','metadata','删除成功','map','query','737268UdlbhJ','__esModule','object','ChatGroupEntity','config','log','3bwlCeE','InjectRepository','update','undefined','HttpStatus','coverImg','DESC','1002522fwsaSz','../models/models.service','parse','create','Repository','@nestjs/typeorm','modelsService','del','getGroupInfoFromId','261690sGiQiV','应用对话名称不能修改哟！','stringify','user','findOne','appLogo','find','3227400LfXPXQ','appEntity','3139952pCXaIn','title','count','decorate','更新对话失败！','非法操作、您在使用一个未启用的应用！','chatGroupEntity','delAll','filter'];_0x3bc9=function(){return _0x24fae4;};return _0x3bc9();}let ChatGroupService=class ChatGroupService{constructor(_0x17f506,_0x1cb23f,_0x418b30){const _0x3dc16d=_0x44ecc0;this[_0x3dc16d(0xed)]=_0x17f506,this[_0x3dc16d(0xe6)]=_0x1cb23f,this[_0x3dc16d(0xdb)]=_0x418b30;}async[_0x44ecc0(0xd8)](_0x25a090,_0x344fcb){const _0x34faec=_0x44ecc0,{id:_0x42b3f7}=_0x344fcb[_0x34faec(0xe1)],{appId:_0x14750e}=_0x25a090,_0x41a7ee={'title':'新对话','userId':_0x42b3f7};if(_0x14750e){const _0x88bf62=await this[_0x34faec(0xe6)]['findOne']({'where':{'id':_0x14750e}});if(!_0x88bf62)throw new common_1[(_0x34faec(0xb5))](_0x34faec(0xf0),common_1[_0x34faec(0xd2)][_0x34faec(0xba)]);else{const {status:_0x26ee55,name:_0x553931}=_0x88bf62,_0x430378=await this[_0x34faec(0xed)][_0x34faec(0xe9)]({'where':{'userId':_0x42b3f7,'appId':_0x14750e,'isDelete':![]}});if(_0x430378>0x0)throw new common_1['HttpException']('当前应用已经开启了一个对话无需新建了！',common_1[_0x34faec(0xd2)][_0x34faec(0xba)]);if(![0x1,0x3,0x4,0x5][_0x34faec(0xbd)](_0x26ee55))throw new common_1[(_0x34faec(0xb5))](_0x34faec(0xec),common_1['HttpStatus'][_0x34faec(0xba)]);_0x553931&&(_0x41a7ee[_0x34faec(0xe8)]=_0x553931),_0x14750e&&(_0x41a7ee[_0x34faec(0xc1)]=_0x14750e);}}const _0x1144ee=await this[_0x34faec(0xdb)]['getBaseConfig'](_0x14750e);_0x14750e&&(_0x1144ee[_0x34faec(0xc1)]=_0x14750e);if(!_0x1144ee)throw new common_1[(_0x34faec(0xb5))](_0x34faec(0xb7),common_1[_0x34faec(0xd2)][_0x34faec(0xba)]);return await this[_0x34faec(0xed)][_0x34faec(0xb3)](Object[_0x34faec(0xf1)](Object[_0x34faec(0xf1)]({},_0x41a7ee),{'config':JSON[_0x34faec(0xe0)](_0x1144ee)}));}async[_0x44ecc0(0xc7)](_0x5c7358){const _0x589b57=_0x44ecc0;try{const {id:_0x1868ef}=_0x5c7358[_0x589b57(0xe1)],_0x4b3df9={'userId':_0x1868ef,'isDelete':![]},_0x328fe4=await this['chatGroupEntity']['find']({'where':_0x4b3df9,'order':{'isSticky':_0x589b57(0xd4),'id':_0x589b57(0xd4)}}),_0x343541=_0x328fe4[_0x589b57(0xef)](_0x441ad8=>_0x441ad8[_0x589b57(0xc1)])[_0x589b57(0xc6)](_0x2681ae=>_0x2681ae[_0x589b57(0xc1)]),_0x1682ac=await this[_0x589b57(0xe6)][_0x589b57(0xe4)]({'where':{'id':(0x0,typeorm_2['In'])(_0x343541)}});return _0x328fe4[_0x589b57(0xc6)](_0x48676a=>{const _0x3786dc=_0x589b57;var _0x3589da;return _0x48676a[_0x3786dc(0xe3)]=(_0x3589da=_0x1682ac[_0x3786dc(0xe4)](_0xc49db0=>_0xc49db0['id']===_0x48676a[_0x3786dc(0xc1)]))===null||_0x3589da===void 0x0?void 0x0:_0x3589da[_0x3786dc(0xd3)],_0x48676a;});}catch(_0x2b5c97){console[_0x589b57(0xcd)]('error:\x20',_0x2b5c97);}}async[_0x44ecc0(0xd0)](_0xa7e945,_0x38be1b){const _0x173e97=_0x44ecc0,{title:_0x500fcf,isSticky:_0x3e3e2a,groupId:_0x466bc1,config:_0xb6a214}=_0xa7e945,{id:_0x278081}=_0x38be1b[_0x173e97(0xe1)],_0x4cff34=await this[_0x173e97(0xed)][_0x173e97(0xe2)]({'where':{'id':_0x466bc1,'userId':_0x278081}});if(!_0x4cff34)throw new common_1[(_0x173e97(0xb5))](_0x173e97(0xb2),common_1[_0x173e97(0xd2)][_0x173e97(0xba)]);const {appId:_0x4518b1}=_0x4cff34;if(_0x4518b1&&!_0x500fcf)try{const _0xbbefbb=JSON[_0x173e97(0xd7)](_0xb6a214);if(Number(_0xbbefbb['keyType'])!==0x1)throw new common_1[(_0x173e97(0xb5))](_0x173e97(0xdf),common_1[_0x173e97(0xd2)]['BAD_REQUEST']);}catch(_0x5a9491){}const _0x3cacf6={};_0x500fcf&&(_0x3cacf6['title']=_0x500fcf),typeof _0x3e3e2a!==_0x173e97(0xd1)&&(_0x3cacf6['isSticky']=_0x3e3e2a),_0xb6a214&&(_0x3cacf6[_0x173e97(0xcc)]=_0xb6a214);const _0x5acd3d=await this['chatGroupEntity'][_0x173e97(0xd0)]({'id':_0x466bc1},_0x3cacf6);if(_0x5acd3d[_0x173e97(0xc0)])return!![];else throw new common_1[(_0x173e97(0xb5))](_0x173e97(0xeb),common_1[_0x173e97(0xd2)][_0x173e97(0xba)]);}async[_0x44ecc0(0xdc)](_0x168894,_0x41c943){const _0x223d57=_0x44ecc0,{groupId:_0x23a6aa}=_0x168894,{id:_0x51c1d4}=_0x41c943['user'],_0x49aaf2=await this[_0x223d57(0xed)][_0x223d57(0xe2)]({'where':{'id':_0x23a6aa,'userId':_0x51c1d4}});if(!_0x49aaf2)throw new common_1[(_0x223d57(0xb5))](_0x223d57(0xb6),common_1['HttpStatus'][_0x223d57(0xba)]);const _0x53b7bf=await this[_0x223d57(0xed)]['update']({'id':_0x23a6aa},{'isDelete':!![]});if(_0x53b7bf[_0x223d57(0xc0)])return _0x223d57(0xc5);else throw new common_1[(_0x223d57(0xb5))](_0x223d57(0xbe),common_1[_0x223d57(0xd2)][_0x223d57(0xba)]);}async[_0x44ecc0(0xee)](_0x4beb88){const _0x1a72dd=_0x44ecc0,{id:_0x39faf5}=_0x4beb88[_0x1a72dd(0xe1)],_0x125557=await this[_0x1a72dd(0xed)][_0x1a72dd(0xd0)]({'userId':_0x39faf5,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x125557[_0x1a72dd(0xc0)])return _0x1a72dd(0xc5);else throw new common_1[(_0x1a72dd(0xb5))](_0x1a72dd(0xbe),common_1[_0x1a72dd(0xd2)][_0x1a72dd(0xba)]);}async[_0x44ecc0(0xdd)](_0x58d979){const _0x35114b=_0x44ecc0;if(!_0x58d979)return;return await this['chatGroupEntity'][_0x35114b(0xe2)]({'where':{'id':_0x58d979}});}};function _0x883e(_0x7b6c66,_0x5957eb){const _0x3bc92d=_0x3bc9();return _0x883e=function(_0x883ea,_0x565d45){_0x883ea=_0x883ea-0xb1;let _0x1ef84d=_0x3bc92d[_0x883ea];return _0x1ef84d;},_0x883e(_0x7b6c66,_0x5957eb);}ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x44ecc0(0xcf)])(chatGroup_entity_1[_0x44ecc0(0xcb)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1['AppEntity'])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x44ecc0(0xd9)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x44ecc0(0xb8)]=ChatGroupService;