'use strict';const _0x5ceb09=_0x1f12;(function(_0x36811f,_0x25a445){const _0x4b8048=_0x1f12,_0x434460=_0x36811f();while(!![]){try{const _0x26c7b6=-parseInt(_0x4b8048(0xb8))/0x1*(parseInt(_0x4b8048(0xee))/0x2)+-parseInt(_0x4b8048(0xe4))/0x3*(-parseInt(_0x4b8048(0xe9))/0x4)+-parseInt(_0x4b8048(0xcc))/0x5+-parseInt(_0x4b8048(0xca))/0x6+-parseInt(_0x4b8048(0xbf))/0x7+-parseInt(_0x4b8048(0xdb))/0x8+parseInt(_0x4b8048(0xb2))/0x9;if(_0x26c7b6===_0x25a445)break;else _0x434460['push'](_0x434460['shift']());}catch(_0x1a5009){_0x434460['push'](_0x434460['shift']());}}}(_0x33f3,0xbbf76));function _0x33f3(){const _0x4db983=['appLogo','AppEntity','findOne','keyType','typeorm','defineProperty','BAD_REQUEST','chatGroupEntity','381TkMaBM','user','function','count','__esModule','10884tsxmoG','appId','../models/models.service','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','stringify','4jOzBGA','HttpStatus','../app/app.entity','Repository','update','Injectable','非法操作、您在删除一个非法资源！','ChatGroupService','删除成功','35010855bSZhAX','getBaseConfig','DESC','parse','title','query','596730nFDxaR','filter','del','./chatGroup.entity','assign','find','affected','256319ZyoBuP','ChatGroupEntity','InjectRepository','ModelsService','object','请先选择一个对话或者新加一个对话再操作！','非法操作、您在使用一个未启用的应用！','coverImg','create','map','length','4272240xvTwMp','metadata','454015HbpLVb','更新对话失败！','modelsService','新对话','save','删除失败！','HttpException','appEntity','design:paramtypes','decorate','__decorate','getGroupInfoFromId','undefined','includes','error:\x20','11462656JnKbTn'];_0x33f3=function(){return _0x4db983;};return _0x33f3();}var __decorate=this&&this[_0x5ceb09(0xd6)]||function(_0x2206c7,_0x4a959e,_0x37e9ef,_0x11a719){const _0x4b7857=_0x5ceb09;var _0x4aebcc=arguments['length'],_0x546db1=_0x4aebcc<0x3?_0x4a959e:_0x11a719===null?_0x11a719=Object['getOwnPropertyDescriptor'](_0x4a959e,_0x37e9ef):_0x11a719,_0x138614;if(typeof Reflect===_0x4b7857(0xc3)&&typeof Reflect[_0x4b7857(0xd5)]===_0x4b7857(0xe6))_0x546db1=Reflect[_0x4b7857(0xd5)](_0x2206c7,_0x4a959e,_0x37e9ef,_0x11a719);else{for(var _0x589c23=_0x2206c7[_0x4b7857(0xc9)]-0x1;_0x589c23>=0x0;_0x589c23--)if(_0x138614=_0x2206c7[_0x589c23])_0x546db1=(_0x4aebcc<0x3?_0x138614(_0x546db1):_0x4aebcc>0x3?_0x138614(_0x4a959e,_0x37e9ef,_0x546db1):_0x138614(_0x4a959e,_0x37e9ef))||_0x546db1;}return _0x4aebcc>0x3&&_0x546db1&&Object[_0x4b7857(0xe1)](_0x4a959e,_0x37e9ef,_0x546db1),_0x546db1;},__metadata=this&&this['__metadata']||function(_0x222f3a,_0x2331b7){const _0x31a0bd=_0x5ceb09;if(typeof Reflect===_0x31a0bd(0xc3)&&typeof Reflect[_0x31a0bd(0xcb)]===_0x31a0bd(0xe6))return Reflect['metadata'](_0x222f3a,_0x2331b7);},__param=this&&this['__param']||function(_0x48a58b,_0x28067c){return function(_0x492dc7,_0x49f799){_0x28067c(_0x492dc7,_0x49f799,_0x48a58b);};};Object[_0x5ceb09(0xe1)](exports,_0x5ceb09(0xe8),{'value':!![]}),exports[_0x5ceb09(0xb0)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x5ceb09(0xbb)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x5ceb09(0xe0)),app_entity_1=require(_0x5ceb09(0xab)),models_service_1=require(_0x5ceb09(0xeb));let ChatGroupService=class ChatGroupService{constructor(_0x51a844,_0x4cd16d,_0xdbe07f){const _0x2cd1c6=_0x5ceb09;this[_0x2cd1c6(0xe3)]=_0x51a844,this[_0x2cd1c6(0xd3)]=_0x4cd16d,this[_0x2cd1c6(0xce)]=_0xdbe07f;}async[_0x5ceb09(0xc7)](_0x102aaf,_0x53536b){const _0x257e83=_0x5ceb09,{id:_0x5edc83}=_0x53536b[_0x257e83(0xe5)],{appId:_0x51faf2}=_0x102aaf,_0x4f9822={'title':_0x257e83(0xcf),'userId':_0x5edc83};if(_0x51faf2){const _0x5b4597=await this[_0x257e83(0xd3)][_0x257e83(0xde)]({'where':{'id':_0x51faf2}});if(!_0x5b4597)throw new common_1['HttpException']('非法操作、您在使用一个不存在的应用！',common_1[_0x257e83(0xaa)]['BAD_REQUEST']);else{const {status:_0x56740e,name:_0x367107}=_0x5b4597,_0x3fed85=await this[_0x257e83(0xe3)][_0x257e83(0xe7)]({'where':{'userId':_0x5edc83,'appId':_0x51faf2,'isDelete':![]}});if(_0x3fed85>0x0)throw new common_1[(_0x257e83(0xd2))]('当前应用已经开启了一个对话无需新建了！',common_1['HttpStatus']['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x257e83(0xd9)](_0x56740e))throw new common_1['HttpException'](_0x257e83(0xc5),common_1['HttpStatus'][_0x257e83(0xe2)]);_0x367107&&(_0x4f9822[_0x257e83(0xb6)]=_0x367107),_0x51faf2&&(_0x4f9822[_0x257e83(0xea)]=_0x51faf2);}}const _0x336d63=await this[_0x257e83(0xce)][_0x257e83(0xb3)](_0x51faf2);_0x51faf2&&(_0x336d63[_0x257e83(0xea)]=_0x51faf2);if(!_0x336d63)throw new common_1[(_0x257e83(0xd2))](_0x257e83(0xec),common_1[_0x257e83(0xaa)][_0x257e83(0xe2)]);return await this['chatGroupEntity'][_0x257e83(0xd0)](Object[_0x257e83(0xbc)](Object['assign']({},_0x4f9822),{'config':JSON[_0x257e83(0xed)](_0x336d63)}));}async[_0x5ceb09(0xb7)](_0x2bda76){const _0x5f0087=_0x5ceb09;try{const {id:_0x20d8b9}=_0x2bda76[_0x5f0087(0xe5)],_0x19cf8f={'userId':_0x20d8b9,'isDelete':![]},_0x94d6a6=await this[_0x5f0087(0xe3)][_0x5f0087(0xbd)]({'where':_0x19cf8f,'order':{'isSticky':_0x5f0087(0xb4),'id':_0x5f0087(0xb4)}}),_0x5d08e0=_0x94d6a6[_0x5f0087(0xb9)](_0x2b585e=>_0x2b585e['appId'])[_0x5f0087(0xc8)](_0x43701f=>_0x43701f[_0x5f0087(0xea)]),_0x42d4e7=await this[_0x5f0087(0xd3)][_0x5f0087(0xbd)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5d08e0)}});return _0x94d6a6[_0x5f0087(0xc8)](_0x3d7e6e=>{const _0x511e91=_0x5f0087;var _0x485c8b;return _0x3d7e6e[_0x511e91(0xdc)]=(_0x485c8b=_0x42d4e7['find'](_0x306cb5=>_0x306cb5['id']===_0x3d7e6e[_0x511e91(0xea)]))===null||_0x485c8b===void 0x0?void 0x0:_0x485c8b[_0x511e91(0xc6)],_0x3d7e6e;});}catch(_0x50ba71){console['log'](_0x5f0087(0xda),_0x50ba71);}}async[_0x5ceb09(0xad)](_0x54bfdc,_0x4effcf){const _0x5a500d=_0x5ceb09,{title:_0x5b0996,isSticky:_0x408968,groupId:_0x4431de,config:_0x2b4757}=_0x54bfdc,{id:_0x193622}=_0x4effcf[_0x5a500d(0xe5)],_0x1c4faa=await this[_0x5a500d(0xe3)]['findOne']({'where':{'id':_0x4431de,'userId':_0x193622}});if(!_0x1c4faa)throw new common_1[(_0x5a500d(0xd2))](_0x5a500d(0xc4),common_1[_0x5a500d(0xaa)][_0x5a500d(0xe2)]);const {appId:_0x276c10}=_0x1c4faa;if(_0x276c10&&!_0x5b0996)try{const _0x1fb66b=JSON[_0x5a500d(0xb5)](_0x2b4757);if(Number(_0x1fb66b[_0x5a500d(0xdf)])!==0x1)throw new common_1['HttpException']('应用对话名称不能修改哟！',common_1['HttpStatus'][_0x5a500d(0xe2)]);}catch(_0x10e086){}const _0x733e72={};_0x5b0996&&(_0x733e72[_0x5a500d(0xb6)]=_0x5b0996),typeof _0x408968!==_0x5a500d(0xd8)&&(_0x733e72['isSticky']=_0x408968),_0x2b4757&&(_0x733e72['config']=_0x2b4757);const _0xb6864a=await this[_0x5a500d(0xe3)][_0x5a500d(0xad)]({'id':_0x4431de},_0x733e72);if(_0xb6864a[_0x5a500d(0xbe)])return!![];else throw new common_1[(_0x5a500d(0xd2))](_0x5a500d(0xcd),common_1[_0x5a500d(0xaa)][_0x5a500d(0xe2)]);}async[_0x5ceb09(0xba)](_0x518430,_0x3794da){const _0x38c411=_0x5ceb09,{groupId:_0x5f583a}=_0x518430,{id:_0x46241b}=_0x3794da[_0x38c411(0xe5)],_0x158d7e=await this['chatGroupEntity'][_0x38c411(0xde)]({'where':{'id':_0x5f583a,'userId':_0x46241b}});if(!_0x158d7e)throw new common_1[(_0x38c411(0xd2))](_0x38c411(0xaf),common_1[_0x38c411(0xaa)][_0x38c411(0xe2)]);const _0xd99df0=await this[_0x38c411(0xe3)][_0x38c411(0xad)]({'id':_0x5f583a},{'isDelete':!![]});if(_0xd99df0['affected'])return _0x38c411(0xb1);else throw new common_1[(_0x38c411(0xd2))](_0x38c411(0xd1),common_1['HttpStatus'][_0x38c411(0xe2)]);}async['delAll'](_0x455c98){const _0x4ff8c6=_0x5ceb09,{id:_0xcb238a}=_0x455c98[_0x4ff8c6(0xe5)],_0x4100c8=await this['chatGroupEntity'][_0x4ff8c6(0xad)]({'userId':_0xcb238a,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x4100c8[_0x4ff8c6(0xbe)])return _0x4ff8c6(0xb1);else throw new common_1['HttpException']('删除失败！',common_1[_0x4ff8c6(0xaa)][_0x4ff8c6(0xe2)]);}async[_0x5ceb09(0xd7)](_0x202b3b){const _0x4d118f=_0x5ceb09;if(!_0x202b3b)return;return await this[_0x4d118f(0xe3)][_0x4d118f(0xde)]({'where':{'id':_0x202b3b}});}};function _0x1f12(_0x1e8256,_0x180e3c){const _0x33f3d3=_0x33f3();return _0x1f12=function(_0x1f12f9,_0x4356fe){_0x1f12f9=_0x1f12f9-0xaa;let _0x1c5196=_0x33f3d3[_0x1f12f9];return _0x1c5196;},_0x1f12(_0x1e8256,_0x180e3c);}ChatGroupService=__decorate([(0x0,common_1[_0x5ceb09(0xae)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x5ceb09(0xc0)])),__param(0x1,(0x0,typeorm_1[_0x5ceb09(0xc1)])(app_entity_1[_0x5ceb09(0xdd)])),__metadata(_0x5ceb09(0xd4),[typeorm_2[_0x5ceb09(0xac)],typeorm_2[_0x5ceb09(0xac)],models_service_1[_0x5ceb09(0xc2)]])],ChatGroupService),exports[_0x5ceb09(0xb0)]=ChatGroupService;