'use strict';const _0x1d6b1a=_0x4b81;(function(_0x599cb3,_0x256a89){const _0x423007=_0x4b81,_0x242fff=_0x599cb3();while(!![]){try{const _0xe255e0=-parseInt(_0x423007(0x1fb))/0x1+parseInt(_0x423007(0x1f6))/0x2+-parseInt(_0x423007(0x202))/0x3+parseInt(_0x423007(0x1e9))/0x4+parseInt(_0x423007(0x1df))/0x5+-parseInt(_0x423007(0x1e0))/0x6*(parseInt(_0x423007(0x1ea))/0x7)+-parseInt(_0x423007(0x20f))/0x8*(-parseInt(_0x423007(0x217))/0x9);if(_0xe255e0===_0x256a89)break;else _0x242fff['push'](_0x242fff['shift']());}catch(_0x546ab8){_0x242fff['push'](_0x242fff['shift']());}}}(_0x179f,0xbc83d));function _0x179f(){const _0x5039bb=['10500833HZdEHb','../models/models.service','create','BAD_REQUEST','DESC','__param','assign','find','更新对话失败！','config','非法操作、您在使用一个未启用的应用！','typeorm','1196416KaKFOL','Injectable','log','parse','getBaseConfig','1034592KHHYju','query','__esModule','非法操作、您在删除一个非法资源！','appId','function','defineProperty','3001050NLlObB','object','affected','删除成功','length','save','modelsService','undefined','isSticky','@nestjs/typeorm','chatGroupEntity','appEntity','Repository','13675560OozUtv','../app/app.entity','非法操作、您在使用一个不存在的应用！','getOwnPropertyDescriptor','ChatGroupService','design:paramtypes','title','error:\x20','9vNzHAa','findOne','InjectRepository','metadata','getGroupInfoFromId','count','HttpException','HttpStatus','删除失败！','update','map','user','keyType','4382730eoJhdy','6cNTHyb','delAll','./chatGroup.entity','请先选择一个对话或者新加一个对话再操作！','includes','decorate','应用对话名称不能修改哟！','__metadata','当前应用已经开启了一个对话无需新建了！','4492076UAelfw'];_0x179f=function(){return _0x5039bb;};return _0x179f();}var __decorate=this&&this['__decorate']||function(_0x3af1cd,_0x324055,_0x10df36,_0x1bfd71){const _0x1b9642=_0x4b81;var _0x3f9b52=arguments['length'],_0x5f34fe=_0x3f9b52<0x3?_0x324055:_0x1bfd71===null?_0x1bfd71=Object[_0x1b9642(0x212)](_0x324055,_0x10df36):_0x1bfd71,_0x56c72d;if(typeof Reflect===_0x1b9642(0x203)&&typeof Reflect[_0x1b9642(0x1e5)]==='function')_0x5f34fe=Reflect[_0x1b9642(0x1e5)](_0x3af1cd,_0x324055,_0x10df36,_0x1bfd71);else{for(var _0x4c475a=_0x3af1cd[_0x1b9642(0x206)]-0x1;_0x4c475a>=0x0;_0x4c475a--)if(_0x56c72d=_0x3af1cd[_0x4c475a])_0x5f34fe=(_0x3f9b52<0x3?_0x56c72d(_0x5f34fe):_0x3f9b52>0x3?_0x56c72d(_0x324055,_0x10df36,_0x5f34fe):_0x56c72d(_0x324055,_0x10df36))||_0x5f34fe;}return _0x3f9b52>0x3&&_0x5f34fe&&Object[_0x1b9642(0x201)](_0x324055,_0x10df36,_0x5f34fe),_0x5f34fe;},__metadata=this&&this[_0x1d6b1a(0x1e7)]||function(_0x2dd0fb,_0x34dccd){const _0x2786c8=_0x1d6b1a;if(typeof Reflect===_0x2786c8(0x203)&&typeof Reflect[_0x2786c8(0x1d5)]===_0x2786c8(0x200))return Reflect['metadata'](_0x2dd0fb,_0x34dccd);},__param=this&&this[_0x1d6b1a(0x1ef)]||function(_0x3b2f6c,_0x31f52f){return function(_0x1e0dd7,_0x54188c){_0x31f52f(_0x1e0dd7,_0x54188c,_0x3b2f6c);};};function _0x4b81(_0xc88855,_0x4fe568){const _0x179fd1=_0x179f();return _0x4b81=function(_0x4b81ed,_0x5c60ed){_0x4b81ed=_0x4b81ed-0x1d3;let _0x44099a=_0x179fd1[_0x4b81ed];return _0x44099a;},_0x4b81(_0xc88855,_0x4fe568);}Object[_0x1d6b1a(0x201)](exports,_0x1d6b1a(0x1fd),{'value':!![]}),exports[_0x1d6b1a(0x213)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x1d6b1a(0x1e2)),typeorm_1=require(_0x1d6b1a(0x20b)),typeorm_2=require(_0x1d6b1a(0x1f5)),app_entity_1=require(_0x1d6b1a(0x210)),models_service_1=require(_0x1d6b1a(0x1eb));let ChatGroupService=class ChatGroupService{constructor(_0x3266e3,_0x232e1a,_0xd66bca){const _0x49dffb=_0x1d6b1a;this[_0x49dffb(0x20c)]=_0x3266e3,this['appEntity']=_0x232e1a,this[_0x49dffb(0x208)]=_0xd66bca;}async[_0x1d6b1a(0x1ec)](_0x2d1e5b,_0x1c9046){const _0x36adb3=_0x1d6b1a,{id:_0x38f90b}=_0x1c9046['user'],{appId:_0x5ede7a}=_0x2d1e5b,_0x28264b={'title':'新对话','userId':_0x38f90b};if(_0x5ede7a){const _0x7dfacb=await this[_0x36adb3(0x20d)]['findOne']({'where':{'id':_0x5ede7a}});if(!_0x7dfacb)throw new common_1[(_0x36adb3(0x1d8))](_0x36adb3(0x211),common_1[_0x36adb3(0x1d9)][_0x36adb3(0x1ed)]);else{const {status:_0x513c98,name:_0x5064c8}=_0x7dfacb,_0x346091=await this[_0x36adb3(0x20c)][_0x36adb3(0x1d7)]({'where':{'userId':_0x38f90b,'appId':_0x5ede7a,'isDelete':![]}});if(_0x346091>0x0)throw new common_1[(_0x36adb3(0x1d8))](_0x36adb3(0x1e8),common_1[_0x36adb3(0x1d9)][_0x36adb3(0x1ed)]);if(![0x1,0x3,0x4,0x5][_0x36adb3(0x1e4)](_0x513c98))throw new common_1[(_0x36adb3(0x1d8))](_0x36adb3(0x1f4),common_1[_0x36adb3(0x1d9)][_0x36adb3(0x1ed)]);_0x5064c8&&(_0x28264b[_0x36adb3(0x215)]=_0x5064c8),_0x5ede7a&&(_0x28264b['appId']=_0x5ede7a);}}const _0x188597=await this['modelsService'][_0x36adb3(0x1fa)](_0x5ede7a);_0x5ede7a&&(_0x188597[_0x36adb3(0x1ff)]=_0x5ede7a);if(!_0x188597)throw new common_1[(_0x36adb3(0x1d8))]('管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！',common_1['HttpStatus'][_0x36adb3(0x1ed)]);return await this[_0x36adb3(0x20c)][_0x36adb3(0x207)](Object[_0x36adb3(0x1f0)](Object['assign']({},_0x28264b),{'config':JSON['stringify'](_0x188597)}));}async[_0x1d6b1a(0x1fc)](_0x4556b8){const _0x2ab996=_0x1d6b1a;try{const {id:_0x4a6d2b}=_0x4556b8[_0x2ab996(0x1dd)],_0x5bd676={'userId':_0x4a6d2b,'isDelete':![]},_0x4a1c54=await this[_0x2ab996(0x20c)]['find']({'where':_0x5bd676,'order':{'isSticky':_0x2ab996(0x1ee),'id':_0x2ab996(0x1ee)}}),_0x524c69=_0x4a1c54['filter'](_0x1d02cf=>_0x1d02cf['appId'])[_0x2ab996(0x1dc)](_0x248317=>_0x248317[_0x2ab996(0x1ff)]),_0x254ddc=await this[_0x2ab996(0x20d)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x524c69)}});return _0x4a1c54['map'](_0x15b902=>{const _0x1d0ffb=_0x2ab996;var _0x79db7b;return _0x15b902['appLogo']=(_0x79db7b=_0x254ddc[_0x1d0ffb(0x1f1)](_0x30fcf5=>_0x30fcf5['id']===_0x15b902[_0x1d0ffb(0x1ff)]))===null||_0x79db7b===void 0x0?void 0x0:_0x79db7b['coverImg'],_0x15b902;});}catch(_0x2f08fc){console[_0x2ab996(0x1f8)](_0x2ab996(0x216),_0x2f08fc);}}async[_0x1d6b1a(0x1db)](_0x3e8ec6,_0x296e0a){const _0x51372b=_0x1d6b1a,{title:_0x3cfc9a,isSticky:_0x34600c,groupId:_0x3f5f3c,config:_0x12ee40}=_0x3e8ec6,{id:_0x2ae051}=_0x296e0a[_0x51372b(0x1dd)],_0x5a8480=await this[_0x51372b(0x20c)]['findOne']({'where':{'id':_0x3f5f3c,'userId':_0x2ae051}});if(!_0x5a8480)throw new common_1['HttpException'](_0x51372b(0x1e3),common_1[_0x51372b(0x1d9)][_0x51372b(0x1ed)]);const {appId:_0x507360}=_0x5a8480;if(_0x507360&&!_0x3cfc9a)try{const _0x36583c=JSON[_0x51372b(0x1f9)](_0x12ee40);if(Number(_0x36583c[_0x51372b(0x1de)])!==0x1)throw new common_1[(_0x51372b(0x1d8))](_0x51372b(0x1e6),common_1[_0x51372b(0x1d9)][_0x51372b(0x1ed)]);}catch(_0x4a3c09){}const _0x2bfb97={};_0x3cfc9a&&(_0x2bfb97[_0x51372b(0x215)]=_0x3cfc9a),typeof _0x34600c!==_0x51372b(0x209)&&(_0x2bfb97[_0x51372b(0x20a)]=_0x34600c),_0x12ee40&&(_0x2bfb97[_0x51372b(0x1f3)]=_0x12ee40);const _0x19e0aa=await this[_0x51372b(0x20c)][_0x51372b(0x1db)]({'id':_0x3f5f3c},_0x2bfb97);if(_0x19e0aa['affected'])return!![];else throw new common_1[(_0x51372b(0x1d8))](_0x51372b(0x1f2),common_1[_0x51372b(0x1d9)][_0x51372b(0x1ed)]);}async['del'](_0x4e0727,_0x58e2ff){const _0x18a6d8=_0x1d6b1a,{groupId:_0x3377d0}=_0x4e0727,{id:_0x1bfc78}=_0x58e2ff[_0x18a6d8(0x1dd)],_0x24c3df=await this[_0x18a6d8(0x20c)][_0x18a6d8(0x1d3)]({'where':{'id':_0x3377d0,'userId':_0x1bfc78}});if(!_0x24c3df)throw new common_1[(_0x18a6d8(0x1d8))](_0x18a6d8(0x1fe),common_1['HttpStatus'][_0x18a6d8(0x1ed)]);const _0x4fc640=await this[_0x18a6d8(0x20c)][_0x18a6d8(0x1db)]({'id':_0x3377d0},{'isDelete':!![]});if(_0x4fc640[_0x18a6d8(0x204)])return'删除成功';else throw new common_1[(_0x18a6d8(0x1d8))](_0x18a6d8(0x1da),common_1[_0x18a6d8(0x1d9)]['BAD_REQUEST']);}async[_0x1d6b1a(0x1e1)](_0x425c16){const _0x5a761f=_0x1d6b1a,{id:_0x5eb73a}=_0x425c16[_0x5a761f(0x1dd)],_0x5e8c04=await this[_0x5a761f(0x20c)][_0x5a761f(0x1db)]({'userId':_0x5eb73a,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x5e8c04[_0x5a761f(0x204)])return _0x5a761f(0x205);else throw new common_1['HttpException'](_0x5a761f(0x1da),common_1['HttpStatus'][_0x5a761f(0x1ed)]);}async[_0x1d6b1a(0x1d6)](_0x5cb84e){const _0x1dc667=_0x1d6b1a;if(!_0x5cb84e)return;return await this[_0x1dc667(0x20c)][_0x1dc667(0x1d3)]({'where':{'id':_0x5cb84e}});}};ChatGroupService=__decorate([(0x0,common_1[_0x1d6b1a(0x1f7)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1[_0x1d6b1a(0x1d4)])(app_entity_1['AppEntity'])),__metadata(_0x1d6b1a(0x214),[typeorm_2[_0x1d6b1a(0x20e)],typeorm_2['Repository'],models_service_1['ModelsService']])],ChatGroupService),exports[_0x1d6b1a(0x213)]=ChatGroupService;