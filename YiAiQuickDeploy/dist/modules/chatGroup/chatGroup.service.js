'use strict';function _0x4725(){const _0x1e4d82=['InjectRepository','213316MFEpDB','includes','keyType','modelsService','decorate','user','delAll','Repository','assign','删除成功','应用对话名称不能修改哟！','error:\x20','删除失败！','新对话','非法操作、您在使用一个不存在的应用！','DESC','metadata','stringify','__param','chatGroupEntity','378352NGkCrg','ChatGroupService','400185dFgGdv','@nestjs/typeorm','query','filter','../models/models.service','getGroupInfoFromId','isSticky','Injectable','非法操作、您在使用一个未启用的应用！','config','__decorate','update','4041405tgOmRo','del','当前应用已经开启了一个对话无需新建了！','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','1908632UqdRzS','create','log','1773408OFLStH','findOne','title','design:paramtypes','function','length','12JwKtOH','appEntity','object','getOwnPropertyDescriptor','appId','affected','3637109FLlRoD','HttpStatus','../app/app.entity','ChatGroupEntity','200IRNEcU','HttpException','defineProperty','map','BAD_REQUEST','find','24uPvqvG'];_0x4725=function(){return _0x1e4d82;};return _0x4725();}const _0x172dc4=_0x1252;function _0x1252(_0xfad34c,_0x5dac32){const _0x4725f1=_0x4725();return _0x1252=function(_0x1252fa,_0x180af2){_0x1252fa=_0x1252fa-0x163;let _0x38f4ee=_0x4725f1[_0x1252fa];return _0x38f4ee;},_0x1252(_0xfad34c,_0x5dac32);}(function(_0x3e03ac,_0x1915b7){const _0x2c9ca0=_0x1252,_0x4646f9=_0x3e03ac();while(!![]){try{const _0x5ac672=parseInt(_0x2c9ca0(0x1a3))/0x1+parseInt(_0x2c9ca0(0x18b))/0x2+-parseInt(_0x2c9ca0(0x1a1))/0x3*(-parseInt(_0x2c9ca0(0x176))/0x4)+-parseInt(_0x2c9ca0(0x184))/0x5+-parseInt(_0x2c9ca0(0x191))/0x6*(parseInt(_0x2c9ca0(0x197))/0x7)+-parseInt(_0x2c9ca0(0x188))/0x8+parseInt(_0x2c9ca0(0x178))/0x9*(parseInt(_0x2c9ca0(0x19b))/0xa);if(_0x5ac672===_0x1915b7)break;else _0x4646f9['push'](_0x4646f9['shift']());}catch(_0x5dab3b){_0x4646f9['push'](_0x4646f9['shift']());}}}(_0x4725,0xa1216));var __decorate=this&&this[_0x172dc4(0x182)]||function(_0x33e513,_0xd9cc00,_0x16985c,_0x5b7805){const _0x2c888c=_0x172dc4;var _0x8b7e58=arguments['length'],_0x35724d=_0x8b7e58<0x3?_0xd9cc00:_0x5b7805===null?_0x5b7805=Object[_0x2c888c(0x194)](_0xd9cc00,_0x16985c):_0x5b7805,_0x48725a;if(typeof Reflect===_0x2c888c(0x193)&&typeof Reflect['decorate']===_0x2c888c(0x18f))_0x35724d=Reflect[_0x2c888c(0x166)](_0x33e513,_0xd9cc00,_0x16985c,_0x5b7805);else{for(var _0x16df70=_0x33e513[_0x2c888c(0x190)]-0x1;_0x16df70>=0x0;_0x16df70--)if(_0x48725a=_0x33e513[_0x16df70])_0x35724d=(_0x8b7e58<0x3?_0x48725a(_0x35724d):_0x8b7e58>0x3?_0x48725a(_0xd9cc00,_0x16985c,_0x35724d):_0x48725a(_0xd9cc00,_0x16985c))||_0x35724d;}return _0x8b7e58>0x3&&_0x35724d&&Object[_0x2c888c(0x19d)](_0xd9cc00,_0x16985c,_0x35724d),_0x35724d;},__metadata=this&&this['__metadata']||function(_0x25f352,_0xeb72f){const _0x2959ab=_0x172dc4;if(typeof Reflect===_0x2959ab(0x193)&&typeof Reflect['metadata']===_0x2959ab(0x18f))return Reflect[_0x2959ab(0x172)](_0x25f352,_0xeb72f);},__param=this&&this[_0x172dc4(0x174)]||function(_0x191a97,_0x15929c){return function(_0x5a3a29,_0xd3648){_0x15929c(_0x5a3a29,_0xd3648,_0x191a97);};};Object[_0x172dc4(0x19d)](exports,'__esModule',{'value':!![]}),exports[_0x172dc4(0x177)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x172dc4(0x179)),typeorm_2=require('typeorm'),app_entity_1=require(_0x172dc4(0x199)),models_service_1=require(_0x172dc4(0x17c));let ChatGroupService=class ChatGroupService{constructor(_0x2348ec,_0xada8fc,_0x44171d){const _0xd49474=_0x172dc4;this[_0xd49474(0x175)]=_0x2348ec,this[_0xd49474(0x192)]=_0xada8fc,this['modelsService']=_0x44171d;}async[_0x172dc4(0x189)](_0xcde4a4,_0x2a9704){const _0x2f3be2=_0x172dc4,{id:_0x346bd7}=_0x2a9704[_0x2f3be2(0x167)],{appId:_0x5d22cb}=_0xcde4a4,_0x4a63bd={'title':_0x2f3be2(0x16f),'userId':_0x346bd7};if(_0x5d22cb){const _0x342135=await this[_0x2f3be2(0x192)][_0x2f3be2(0x18c)]({'where':{'id':_0x5d22cb}});if(!_0x342135)throw new common_1[(_0x2f3be2(0x19c))](_0x2f3be2(0x170),common_1[_0x2f3be2(0x198)]['BAD_REQUEST']);else{const {status:_0x2bbdc2,name:_0x2a7592}=_0x342135,_0x351325=await this[_0x2f3be2(0x175)]['count']({'where':{'userId':_0x346bd7,'appId':_0x5d22cb,'isDelete':![]}});if(_0x351325>0x0)throw new common_1[(_0x2f3be2(0x19c))](_0x2f3be2(0x186),common_1['HttpStatus'][_0x2f3be2(0x19f)]);if(![0x1,0x3,0x4,0x5][_0x2f3be2(0x163)](_0x2bbdc2))throw new common_1[(_0x2f3be2(0x19c))](_0x2f3be2(0x180),common_1[_0x2f3be2(0x198)][_0x2f3be2(0x19f)]);_0x2a7592&&(_0x4a63bd[_0x2f3be2(0x18d)]=_0x2a7592),_0x5d22cb&&(_0x4a63bd[_0x2f3be2(0x195)]=_0x5d22cb);}}const _0x4a1808=await this[_0x2f3be2(0x165)]['getBaseConfig'](_0x5d22cb);_0x5d22cb&&(_0x4a1808['appId']=_0x5d22cb);if(!_0x4a1808)throw new common_1[(_0x2f3be2(0x19c))](_0x2f3be2(0x187),common_1['HttpStatus'][_0x2f3be2(0x19f)]);return await this['chatGroupEntity']['save'](Object['assign'](Object[_0x2f3be2(0x16a)]({},_0x4a63bd),{'config':JSON[_0x2f3be2(0x173)](_0x4a1808)}));}async[_0x172dc4(0x17a)](_0x3f904a){const _0x492a34=_0x172dc4;try{const {id:_0x29fc89}=_0x3f904a['user'],_0x3937bc={'userId':_0x29fc89,'isDelete':![]},_0x35898d=await this[_0x492a34(0x175)][_0x492a34(0x1a0)]({'where':_0x3937bc,'order':{'isSticky':'DESC','id':_0x492a34(0x171)}}),_0x564f92=_0x35898d[_0x492a34(0x17b)](_0x210d2b=>_0x210d2b[_0x492a34(0x195)])['map'](_0x2c3817=>_0x2c3817[_0x492a34(0x195)]),_0x5ede36=await this['appEntity'][_0x492a34(0x1a0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x564f92)}});return _0x35898d[_0x492a34(0x19e)](_0x1f3a6f=>{const _0x7c1e6f=_0x492a34;var _0x56ff6d;return _0x1f3a6f['appLogo']=(_0x56ff6d=_0x5ede36[_0x7c1e6f(0x1a0)](_0x3ce18b=>_0x3ce18b['id']===_0x1f3a6f[_0x7c1e6f(0x195)]))===null||_0x56ff6d===void 0x0?void 0x0:_0x56ff6d['coverImg'],_0x1f3a6f;});}catch(_0x1845e7){console[_0x492a34(0x18a)](_0x492a34(0x16d),_0x1845e7);}}async['update'](_0x4a9f37,_0x34a34b){const _0x10a293=_0x172dc4,{title:_0x3dac4b,isSticky:_0x51654b,groupId:_0x4f4745,config:_0x1365d0}=_0x4a9f37,{id:_0x27900b}=_0x34a34b[_0x10a293(0x167)],_0x511160=await this[_0x10a293(0x175)]['findOne']({'where':{'id':_0x4f4745,'userId':_0x27900b}});if(!_0x511160)throw new common_1['HttpException']('请先选择一个对话或者新加一个对话再操作！',common_1['HttpStatus'][_0x10a293(0x19f)]);const {appId:_0xa09aad}=_0x511160;if(_0xa09aad&&!_0x3dac4b)try{const _0x53f673=JSON['parse'](_0x1365d0);if(Number(_0x53f673[_0x10a293(0x164)])!==0x1)throw new common_1[(_0x10a293(0x19c))](_0x10a293(0x16c),common_1[_0x10a293(0x198)][_0x10a293(0x19f)]);}catch(_0x164150){}const _0x2a2e34={};_0x3dac4b&&(_0x2a2e34['title']=_0x3dac4b),typeof _0x51654b!=='undefined'&&(_0x2a2e34[_0x10a293(0x17e)]=_0x51654b),_0x1365d0&&(_0x2a2e34[_0x10a293(0x181)]=_0x1365d0);const _0x33ff92=await this[_0x10a293(0x175)][_0x10a293(0x183)]({'id':_0x4f4745},_0x2a2e34);if(_0x33ff92['affected'])return!![];else throw new common_1[(_0x10a293(0x19c))]('更新对话失败！',common_1[_0x10a293(0x198)][_0x10a293(0x19f)]);}async[_0x172dc4(0x185)](_0x28743e,_0x487a9b){const _0x341077=_0x172dc4,{groupId:_0x378760}=_0x28743e,{id:_0x57321e}=_0x487a9b['user'],_0x496f62=await this[_0x341077(0x175)]['findOne']({'where':{'id':_0x378760,'userId':_0x57321e}});if(!_0x496f62)throw new common_1[(_0x341077(0x19c))]('非法操作、您在删除一个非法资源！',common_1[_0x341077(0x198)][_0x341077(0x19f)]);const _0x28e493=await this[_0x341077(0x175)][_0x341077(0x183)]({'id':_0x378760},{'isDelete':!![]});if(_0x28e493[_0x341077(0x196)])return _0x341077(0x16b);else throw new common_1[(_0x341077(0x19c))](_0x341077(0x16e),common_1[_0x341077(0x198)][_0x341077(0x19f)]);}async[_0x172dc4(0x168)](_0x163895){const _0x41f195=_0x172dc4,{id:_0x3fc026}=_0x163895[_0x41f195(0x167)],_0x209a14=await this[_0x41f195(0x175)][_0x41f195(0x183)]({'userId':_0x3fc026,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x209a14[_0x41f195(0x196)])return _0x41f195(0x16b);else throw new common_1[(_0x41f195(0x19c))](_0x41f195(0x16e),common_1[_0x41f195(0x198)][_0x41f195(0x19f)]);}async[_0x172dc4(0x17d)](_0x53f7fa){const _0xdfd796=_0x172dc4;if(!_0x53f7fa)return;return await this['chatGroupEntity'][_0xdfd796(0x18c)]({'where':{'id':_0x53f7fa}});}};ChatGroupService=__decorate([(0x0,common_1[_0x172dc4(0x17f)])(),__param(0x0,(0x0,typeorm_1[_0x172dc4(0x1a2)])(chatGroup_entity_1[_0x172dc4(0x19a)])),__param(0x1,(0x0,typeorm_1[_0x172dc4(0x1a2)])(app_entity_1['AppEntity'])),__metadata(_0x172dc4(0x18e),[typeorm_2[_0x172dc4(0x169)],typeorm_2[_0x172dc4(0x169)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x172dc4(0x177)]=ChatGroupService;