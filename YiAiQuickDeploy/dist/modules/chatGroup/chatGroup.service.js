'use strict';const _0x16f2c9=_0x2a01;(function(_0x4f8b54,_0x276ce5){const _0x4c1c80=_0x2a01,_0x2cbd79=_0x4f8b54();while(!![]){try{const _0x258e74=-parseInt(_0x4c1c80(0x85))/0x1*(-parseInt(_0x4c1c80(0x86))/0x2)+-parseInt(_0x4c1c80(0x87))/0x3*(-parseInt(_0x4c1c80(0xb6))/0x4)+parseInt(_0x4c1c80(0xbb))/0x5+-parseInt(_0x4c1c80(0x9e))/0x6*(parseInt(_0x4c1c80(0x9f))/0x7)+parseInt(_0x4c1c80(0xc5))/0x8*(parseInt(_0x4c1c80(0xb1))/0x9)+-parseInt(_0x4c1c80(0xc4))/0xa+parseInt(_0x4c1c80(0xb0))/0xb;if(_0x258e74===_0x276ce5)break;else _0x2cbd79['push'](_0x2cbd79['shift']());}catch(_0x549207){_0x2cbd79['push'](_0x2cbd79['shift']());}}}(_0x41bf,0xb0fd8));function _0x41bf(){const _0x16c459=['8CLOCkq','非法操作、您在删除一个非法资源！','find','../app/app.entity','__metadata','105142iOYshp','8tqIeaD','3LpveVY','typeorm','isSticky','update','del','modelsService','defineProperty','keyType','AppEntity','parse','includes','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','decorate','title','findOne','Injectable','appEntity','./chatGroup.entity','@nestjs/common','delAll','ChatGroupService','删除成功','../models/models.service','6275034HRVkjQ','7DcOYEU','length','应用对话名称不能修改哟！','log','BAD_REQUEST','更新对话失败！','HttpStatus','当前应用已经开启了一个对话无需新建了！','affected','coverImg','save','function','__esModule','user','请先选择一个对话或者新加一个对话再操作！','非法操作、您在使用一个不存在的应用！','DESC','675642pdhEUy','4231197lRayhX','object','HttpException','Repository','map','654388GPSeBM','filter','config','assign','appId','7035090EXLaBE','metadata','chatGroupEntity','非法操作、您在使用一个未启用的应用！','error:\x20','create','ChatGroupEntity','InjectRepository','design:paramtypes','7519470ggveUp'];_0x41bf=function(){return _0x16c459;};return _0x41bf();}function _0x2a01(_0xf7f039,_0x216dbe){const _0x41bf8a=_0x41bf();return _0x2a01=function(_0x2a01f2,_0x5ae5e2){_0x2a01f2=_0x2a01f2-0x85;let _0x6aa03d=_0x41bf8a[_0x2a01f2];return _0x6aa03d;},_0x2a01(_0xf7f039,_0x216dbe);}var __decorate=this&&this['__decorate']||function(_0x5207e1,_0x27f8c3,_0xdab3bf,_0x25ca65){const _0x131a21=_0x2a01;var _0x40ef76=arguments[_0x131a21(0xa0)],_0x11cecd=_0x40ef76<0x3?_0x27f8c3:_0x25ca65===null?_0x25ca65=Object['getOwnPropertyDescriptor'](_0x27f8c3,_0xdab3bf):_0x25ca65,_0x1f98f3;if(typeof Reflect===_0x131a21(0xb2)&&typeof Reflect['decorate']===_0x131a21(0xaa))_0x11cecd=Reflect[_0x131a21(0x93)](_0x5207e1,_0x27f8c3,_0xdab3bf,_0x25ca65);else{for(var _0x41aac4=_0x5207e1['length']-0x1;_0x41aac4>=0x0;_0x41aac4--)if(_0x1f98f3=_0x5207e1[_0x41aac4])_0x11cecd=(_0x40ef76<0x3?_0x1f98f3(_0x11cecd):_0x40ef76>0x3?_0x1f98f3(_0x27f8c3,_0xdab3bf,_0x11cecd):_0x1f98f3(_0x27f8c3,_0xdab3bf))||_0x11cecd;}return _0x40ef76>0x3&&_0x11cecd&&Object['defineProperty'](_0x27f8c3,_0xdab3bf,_0x11cecd),_0x11cecd;},__metadata=this&&this[_0x16f2c9(0xc9)]||function(_0x38b985,_0x1989da){const _0x504b70=_0x16f2c9;if(typeof Reflect===_0x504b70(0xb2)&&typeof Reflect[_0x504b70(0xbc)]===_0x504b70(0xaa))return Reflect['metadata'](_0x38b985,_0x1989da);},__param=this&&this['__param']||function(_0x4bc5c5,_0x35e48e){return function(_0x5c45ab,_0x533904){_0x35e48e(_0x5c45ab,_0x533904,_0x4bc5c5);};};Object[_0x16f2c9(0x8d)](exports,_0x16f2c9(0xab),{'value':!![]}),exports[_0x16f2c9(0x9b)]=void 0x0;const common_1=require(_0x16f2c9(0x99)),chatGroup_entity_1=require(_0x16f2c9(0x98)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x16f2c9(0x88)),app_entity_1=require(_0x16f2c9(0xc8)),models_service_1=require(_0x16f2c9(0x9d));let ChatGroupService=class ChatGroupService{constructor(_0x341e65,_0xf7eabc,_0x499128){const _0x2c0879=_0x16f2c9;this[_0x2c0879(0xbd)]=_0x341e65,this[_0x2c0879(0x97)]=_0xf7eabc,this[_0x2c0879(0x8c)]=_0x499128;}async[_0x16f2c9(0xc0)](_0x234cfe,_0x4e068a){const _0x688012=_0x16f2c9,{id:_0x26673e}=_0x4e068a['user'],{appId:_0xba56c1}=_0x234cfe,_0x16cccf={'title':'新对话','userId':_0x26673e};if(_0xba56c1){const _0x57ffb7=await this[_0x688012(0x97)][_0x688012(0x95)]({'where':{'id':_0xba56c1}});if(!_0x57ffb7)throw new common_1[(_0x688012(0xb3))](_0x688012(0xae),common_1['HttpStatus'][_0x688012(0xa3)]);else{const {status:_0x108091,name:_0x177c2e}=_0x57ffb7,_0x354dfc=await this[_0x688012(0xbd)]['count']({'where':{'userId':_0x26673e,'appId':_0xba56c1,'isDelete':![]}});if(_0x354dfc>0x0)throw new common_1[(_0x688012(0xb3))](_0x688012(0xa6),common_1['HttpStatus']['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x688012(0x91)](_0x108091))throw new common_1['HttpException'](_0x688012(0xbe),common_1[_0x688012(0xa5)][_0x688012(0xa3)]);_0x177c2e&&(_0x16cccf['title']=_0x177c2e),_0xba56c1&&(_0x16cccf[_0x688012(0xba)]=_0xba56c1);}}const _0x66f2ca=await this['modelsService']['getBaseConfig'](_0xba56c1);_0xba56c1&&(_0x66f2ca[_0x688012(0xba)]=_0xba56c1);if(!_0x66f2ca)throw new common_1['HttpException'](_0x688012(0x92),common_1[_0x688012(0xa5)][_0x688012(0xa3)]);return await this['chatGroupEntity'][_0x688012(0xa9)](Object[_0x688012(0xb9)](Object['assign']({},_0x16cccf),{'config':JSON['stringify'](_0x66f2ca)}));}async['query'](_0x246be1){const _0x3a9385=_0x16f2c9;try{const {id:_0x58db87}=_0x246be1[_0x3a9385(0xac)],_0x346646={'userId':_0x58db87,'isDelete':![]},_0x11f5cc=await this[_0x3a9385(0xbd)][_0x3a9385(0xc7)]({'where':_0x346646,'order':{'isSticky':'DESC','id':_0x3a9385(0xaf)}}),_0x1bcd95=_0x11f5cc[_0x3a9385(0xb7)](_0x5a43c8=>_0x5a43c8[_0x3a9385(0xba)])['map'](_0x3a134c=>_0x3a134c['appId']),_0x3b0de5=await this[_0x3a9385(0x97)][_0x3a9385(0xc7)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1bcd95)}});return _0x11f5cc[_0x3a9385(0xb5)](_0xaea67e=>{const _0x2f46b9=_0x3a9385;var _0xe4bd69;return _0xaea67e['appLogo']=(_0xe4bd69=_0x3b0de5[_0x2f46b9(0xc7)](_0x1a370c=>_0x1a370c['id']===_0xaea67e['appId']))===null||_0xe4bd69===void 0x0?void 0x0:_0xe4bd69[_0x2f46b9(0xa8)],_0xaea67e;});}catch(_0x14d910){console[_0x3a9385(0xa2)](_0x3a9385(0xbf),_0x14d910);}}async[_0x16f2c9(0x8a)](_0x5bd6db,_0x3209b9){const _0x35c952=_0x16f2c9,{title:_0x41888d,isSticky:_0xf654aa,groupId:_0x5e292b,config:_0xcceba8}=_0x5bd6db,{id:_0x3c8923}=_0x3209b9[_0x35c952(0xac)],_0x1946aa=await this[_0x35c952(0xbd)]['findOne']({'where':{'id':_0x5e292b,'userId':_0x3c8923}});if(!_0x1946aa)throw new common_1['HttpException'](_0x35c952(0xad),common_1['HttpStatus'][_0x35c952(0xa3)]);const {appId:_0x26c891}=_0x1946aa;if(_0x26c891&&!_0x41888d)try{const _0x5df336=JSON[_0x35c952(0x90)](_0xcceba8);if(Number(_0x5df336[_0x35c952(0x8e)])!==0x1)throw new common_1[(_0x35c952(0xb3))](_0x35c952(0xa1),common_1['HttpStatus']['BAD_REQUEST']);}catch(_0x4bb0f8){}const _0x4e04f4={};_0x41888d&&(_0x4e04f4[_0x35c952(0x94)]=_0x41888d),typeof _0xf654aa!=='undefined'&&(_0x4e04f4[_0x35c952(0x89)]=_0xf654aa),_0xcceba8&&(_0x4e04f4[_0x35c952(0xb8)]=_0xcceba8);const _0x1cc723=await this[_0x35c952(0xbd)][_0x35c952(0x8a)]({'id':_0x5e292b},_0x4e04f4);if(_0x1cc723[_0x35c952(0xa7)])return!![];else throw new common_1[(_0x35c952(0xb3))](_0x35c952(0xa4),common_1['HttpStatus'][_0x35c952(0xa3)]);}async[_0x16f2c9(0x8b)](_0x2bac64,_0xa51477){const _0x3043ec=_0x16f2c9,{groupId:_0x2390bf}=_0x2bac64,{id:_0x510b84}=_0xa51477['user'],_0x47f1ad=await this[_0x3043ec(0xbd)][_0x3043ec(0x95)]({'where':{'id':_0x2390bf,'userId':_0x510b84}});if(!_0x47f1ad)throw new common_1[(_0x3043ec(0xb3))](_0x3043ec(0xc6),common_1[_0x3043ec(0xa5)]['BAD_REQUEST']);const _0x4831ff=await this['chatGroupEntity'][_0x3043ec(0x8a)]({'id':_0x2390bf},{'isDelete':!![]});if(_0x4831ff[_0x3043ec(0xa7)])return _0x3043ec(0x9c);else throw new common_1['HttpException']('删除失败！',common_1[_0x3043ec(0xa5)]['BAD_REQUEST']);}async[_0x16f2c9(0x9a)](_0x44fb1e){const _0x50d67d=_0x16f2c9,{id:_0x54d80c}=_0x44fb1e[_0x50d67d(0xac)],_0x336627=await this[_0x50d67d(0xbd)][_0x50d67d(0x8a)]({'userId':_0x54d80c,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x336627[_0x50d67d(0xa7)])return _0x50d67d(0x9c);else throw new common_1[(_0x50d67d(0xb3))]('删除失败！',common_1[_0x50d67d(0xa5)][_0x50d67d(0xa3)]);}async['getGroupInfoFromId'](_0x2580b1){const _0x1ccad6=_0x16f2c9;if(!_0x2580b1)return;return await this[_0x1ccad6(0xbd)][_0x1ccad6(0x95)]({'where':{'id':_0x2580b1}});}};ChatGroupService=__decorate([(0x0,common_1[_0x16f2c9(0x96)])(),__param(0x0,(0x0,typeorm_1[_0x16f2c9(0xc2)])(chatGroup_entity_1[_0x16f2c9(0xc1)])),__param(0x1,(0x0,typeorm_1[_0x16f2c9(0xc2)])(app_entity_1[_0x16f2c9(0x8f)])),__metadata(_0x16f2c9(0xc3),[typeorm_2[_0x16f2c9(0xb4)],typeorm_2[_0x16f2c9(0xb4)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x16f2c9(0x9b)]=ChatGroupService;