'use strict';const _0x2c02f2=_0x13f1;(function(_0x40dc60,_0xfdb527){const _0x387aa0=_0x13f1,_0x3c63b4=_0x40dc60();while(!![]){try{const _0x278205=-parseInt(_0x387aa0(0x192))/0x1+parseInt(_0x387aa0(0x185))/0x2+-parseInt(_0x387aa0(0x187))/0x3+parseInt(_0x387aa0(0x170))/0x4+-parseInt(_0x387aa0(0x196))/0x5*(parseInt(_0x387aa0(0x19b))/0x6)+-parseInt(_0x387aa0(0x16a))/0x7*(-parseInt(_0x387aa0(0x167))/0x8)+-parseInt(_0x387aa0(0x171))/0x9*(-parseInt(_0x387aa0(0x18a))/0xa);if(_0x278205===_0xfdb527)break;else _0x3c63b4['push'](_0x3c63b4['shift']());}catch(_0x468517){_0x3c63b4['push'](_0x3c63b4['shift']());}}}(_0x21df,0xdf62d));function _0x13f1(_0x4d99ec,_0x4b6412){const _0x21df7d=_0x21df();return _0x13f1=function(_0x13f110,_0x1c33a3){_0x13f110=_0x13f110-0x158;let _0x5b58b7=_0x21df7d[_0x13f110];return _0x5b58b7;},_0x13f1(_0x4d99ec,_0x4b6412);}function _0x21df(){const _0x5d32fb=['3175224sfmCOF','../models/models.service','find','1555060colNOm','chatGroupEntity','parse','design:paramtypes','stringify','ChatGroupEntity','非法操作、您在删除一个非法资源！','getGroupInfoFromId','1434414eubVVQ','InjectRepository','AppEntity','affected','1165mZrvHC','metadata','undefined','BAD_REQUEST','appId','10572zzCYGo','update','../app/app.entity','create','assign','@nestjs/typeorm','__param','DESC','./chatGroup.entity','HttpException','coverImg','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','ModelsService','filter','Repository','Injectable','265272iRwThI','findOne','decorate','63HMgjlo','user','delAll','del','save','typeorm','2985224IHpZcA','144gJeTVv','keyType','更新对话失败！','ChatGroupService','length','HttpStatus','function','appEntity','删除失败！','includes','新对话','defineProperty','非法操作、您在使用一个未启用的应用！','应用对话名称不能修改哟！','map','当前应用已经开启了一个对话无需新建了！','__esModule','object','count','config','571048AIfhgB','query'];_0x21df=function(){return _0x5d32fb;};return _0x21df();}var __decorate=this&&this['__decorate']||function(_0x310dc0,_0x2e4b3e,_0x526f50,_0x48b5d9){const _0x42fe01=_0x13f1;var _0x14a7e3=arguments['length'],_0x4034d6=_0x14a7e3<0x3?_0x2e4b3e:_0x48b5d9===null?_0x48b5d9=Object['getOwnPropertyDescriptor'](_0x2e4b3e,_0x526f50):_0x48b5d9,_0x18f7b8;if(typeof Reflect==='object'&&typeof Reflect[_0x42fe01(0x169)]==='function')_0x4034d6=Reflect[_0x42fe01(0x169)](_0x310dc0,_0x2e4b3e,_0x526f50,_0x48b5d9);else{for(var _0x51732c=_0x310dc0[_0x42fe01(0x175)]-0x1;_0x51732c>=0x0;_0x51732c--)if(_0x18f7b8=_0x310dc0[_0x51732c])_0x4034d6=(_0x14a7e3<0x3?_0x18f7b8(_0x4034d6):_0x14a7e3>0x3?_0x18f7b8(_0x2e4b3e,_0x526f50,_0x4034d6):_0x18f7b8(_0x2e4b3e,_0x526f50))||_0x4034d6;}return _0x14a7e3>0x3&&_0x4034d6&&Object[_0x42fe01(0x17c)](_0x2e4b3e,_0x526f50,_0x4034d6),_0x4034d6;},__metadata=this&&this['__metadata']||function(_0x135cf3,_0xa8cb86){const _0x12479c=_0x13f1;if(typeof Reflect===_0x12479c(0x182)&&typeof Reflect[_0x12479c(0x197)]===_0x12479c(0x177))return Reflect[_0x12479c(0x197)](_0x135cf3,_0xa8cb86);},__param=this&&this[_0x2c02f2(0x15d)]||function(_0x1bc08c,_0x152b57){return function(_0x3374ed,_0x490aaf){_0x152b57(_0x3374ed,_0x490aaf,_0x1bc08c);};};Object['defineProperty'](exports,_0x2c02f2(0x181),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x2c02f2(0x15f)),typeorm_1=require(_0x2c02f2(0x15c)),typeorm_2=require(_0x2c02f2(0x16f)),app_entity_1=require(_0x2c02f2(0x159)),models_service_1=require(_0x2c02f2(0x188));let ChatGroupService=class ChatGroupService{constructor(_0x400cd2,_0x2c7182,_0x8a11b0){const _0x383750=_0x2c02f2;this['chatGroupEntity']=_0x400cd2,this[_0x383750(0x178)]=_0x2c7182,this['modelsService']=_0x8a11b0;}async[_0x2c02f2(0x15a)](_0x464b14,_0x33766c){const _0x1a8afc=_0x2c02f2,{id:_0x5331a9}=_0x33766c[_0x1a8afc(0x16b)],{appId:_0x579c3a}=_0x464b14,_0x4e5e9b={'title':_0x1a8afc(0x17b),'userId':_0x5331a9};if(_0x579c3a){const _0x4cce67=await this[_0x1a8afc(0x178)][_0x1a8afc(0x168)]({'where':{'id':_0x579c3a}});if(!_0x4cce67)throw new common_1[(_0x1a8afc(0x160))]('非法操作、您在使用一个不存在的应用！',common_1[_0x1a8afc(0x176)][_0x1a8afc(0x199)]);else{const {status:_0x115a07,name:_0xd7a301}=_0x4cce67,_0x2e39c2=await this['chatGroupEntity'][_0x1a8afc(0x183)]({'where':{'userId':_0x5331a9,'appId':_0x579c3a,'isDelete':![]}});if(_0x2e39c2>0x0)throw new common_1[(_0x1a8afc(0x160))](_0x1a8afc(0x180),common_1['HttpStatus'][_0x1a8afc(0x199)]);if(![0x1,0x3,0x4,0x5][_0x1a8afc(0x17a)](_0x115a07))throw new common_1[(_0x1a8afc(0x160))](_0x1a8afc(0x17d),common_1['HttpStatus'][_0x1a8afc(0x199)]);_0xd7a301&&(_0x4e5e9b['title']=_0xd7a301),_0x579c3a&&(_0x4e5e9b['appId']=_0x579c3a);}}const _0x3ec41c=await this['modelsService']['getBaseConfig'](_0x579c3a);_0x579c3a&&(_0x3ec41c[_0x1a8afc(0x19a)]=_0x579c3a);if(!_0x3ec41c)throw new common_1[(_0x1a8afc(0x160))](_0x1a8afc(0x162),common_1[_0x1a8afc(0x176)][_0x1a8afc(0x199)]);return await this[_0x1a8afc(0x18b)][_0x1a8afc(0x16e)](Object['assign'](Object[_0x1a8afc(0x15b)]({},_0x4e5e9b),{'config':JSON[_0x1a8afc(0x18e)](_0x3ec41c)}));}async[_0x2c02f2(0x186)](_0xf31abf){const _0x45955d=_0x2c02f2;try{const {id:_0x55382c}=_0xf31abf[_0x45955d(0x16b)],_0x2124c5={'userId':_0x55382c,'isDelete':![]},_0x2de784=await this['chatGroupEntity'][_0x45955d(0x189)]({'where':_0x2124c5,'order':{'isSticky':'DESC','id':_0x45955d(0x15e)}}),_0xf69829=_0x2de784[_0x45955d(0x164)](_0x338c2b=>_0x338c2b['appId'])[_0x45955d(0x17f)](_0x5205df=>_0x5205df[_0x45955d(0x19a)]),_0x227da1=await this[_0x45955d(0x178)][_0x45955d(0x189)]({'where':{'id':(0x0,typeorm_2['In'])(_0xf69829)}});return _0x2de784[_0x45955d(0x17f)](_0x367703=>{const _0x5d8e82=_0x45955d;var _0x4322b7;return _0x367703['appLogo']=(_0x4322b7=_0x227da1['find'](_0x4a8f65=>_0x4a8f65['id']===_0x367703[_0x5d8e82(0x19a)]))===null||_0x4322b7===void 0x0?void 0x0:_0x4322b7[_0x5d8e82(0x161)],_0x367703;});}catch(_0x4de84e){console['log']('error:\x20',_0x4de84e);}}async[_0x2c02f2(0x158)](_0x26c00b,_0xc86b3e){const _0x529c19=_0x2c02f2,{title:_0x211e25,isSticky:_0x356763,groupId:_0x5f4150,config:_0x49329c}=_0x26c00b,{id:_0x35dba7}=_0xc86b3e[_0x529c19(0x16b)],_0x221c67=await this['chatGroupEntity'][_0x529c19(0x168)]({'where':{'id':_0x5f4150,'userId':_0x35dba7}});if(!_0x221c67)throw new common_1[(_0x529c19(0x160))]('请先选择一个对话或者新加一个对话再操作！',common_1['HttpStatus'][_0x529c19(0x199)]);const {appId:_0x25bf27}=_0x221c67;if(_0x25bf27&&!_0x211e25)try{const _0x318def=JSON[_0x529c19(0x18c)](_0x49329c);if(Number(_0x318def[_0x529c19(0x172)])!==0x1)throw new common_1['HttpException'](_0x529c19(0x17e),common_1[_0x529c19(0x176)][_0x529c19(0x199)]);}catch(_0xe8db08){}const _0x2490ff={};_0x211e25&&(_0x2490ff['title']=_0x211e25),typeof _0x356763!==_0x529c19(0x198)&&(_0x2490ff['isSticky']=_0x356763),_0x49329c&&(_0x2490ff[_0x529c19(0x184)]=_0x49329c);const _0x435486=await this['chatGroupEntity'][_0x529c19(0x158)]({'id':_0x5f4150},_0x2490ff);if(_0x435486[_0x529c19(0x195)])return!![];else throw new common_1['HttpException'](_0x529c19(0x173),common_1[_0x529c19(0x176)][_0x529c19(0x199)]);}async[_0x2c02f2(0x16d)](_0x3466a9,_0x141f37){const _0x2deffd=_0x2c02f2,{groupId:_0x24e5ca}=_0x3466a9,{id:_0x2204a4}=_0x141f37[_0x2deffd(0x16b)],_0x1fb088=await this[_0x2deffd(0x18b)][_0x2deffd(0x168)]({'where':{'id':_0x24e5ca,'userId':_0x2204a4}});if(!_0x1fb088)throw new common_1['HttpException'](_0x2deffd(0x190),common_1[_0x2deffd(0x176)]['BAD_REQUEST']);const _0x2aaa49=await this[_0x2deffd(0x18b)][_0x2deffd(0x158)]({'id':_0x24e5ca},{'isDelete':!![]});if(_0x2aaa49[_0x2deffd(0x195)])return'删除成功';else throw new common_1[(_0x2deffd(0x160))]('删除失败！',common_1[_0x2deffd(0x176)][_0x2deffd(0x199)]);}async[_0x2c02f2(0x16c)](_0x4d6981){const _0x549130=_0x2c02f2,{id:_0x5e2d3a}=_0x4d6981['user'],_0x48a05e=await this[_0x549130(0x18b)][_0x549130(0x158)]({'userId':_0x5e2d3a,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x48a05e['affected'])return'删除成功';else throw new common_1['HttpException'](_0x549130(0x179),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x2c02f2(0x191)](_0x278744){const _0x1539d7=_0x2c02f2;if(!_0x278744)return;return await this[_0x1539d7(0x18b)][_0x1539d7(0x168)]({'where':{'id':_0x278744}});}};ChatGroupService=__decorate([(0x0,common_1[_0x2c02f2(0x166)])(),__param(0x0,(0x0,typeorm_1[_0x2c02f2(0x193)])(chatGroup_entity_1[_0x2c02f2(0x18f)])),__param(0x1,(0x0,typeorm_1[_0x2c02f2(0x193)])(app_entity_1[_0x2c02f2(0x194)])),__metadata(_0x2c02f2(0x18d),[typeorm_2[_0x2c02f2(0x165)],typeorm_2[_0x2c02f2(0x165)],models_service_1[_0x2c02f2(0x163)]])],ChatGroupService),exports[_0x2c02f2(0x174)]=ChatGroupService;