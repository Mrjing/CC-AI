'use strict';const _0x21c622=_0x5ca2;(function(_0x5eca53,_0x33065b){const _0x33ef0a=_0x5ca2,_0x2aea9d=_0x5eca53();while(!![]){try{const _0x2d185d=-parseInt(_0x33ef0a(0x104))/0x1+-parseInt(_0x33ef0a(0x12b))/0x2+-parseInt(_0x33ef0a(0x12a))/0x3*(parseInt(_0x33ef0a(0xef))/0x4)+-parseInt(_0x33ef0a(0xf8))/0x5+parseInt(_0x33ef0a(0x110))/0x6+parseInt(_0x33ef0a(0x11a))/0x7+parseInt(_0x33ef0a(0xfc))/0x8;if(_0x2d185d===_0x33065b)break;else _0x2aea9d['push'](_0x2aea9d['shift']());}catch(_0x2ec7c7){_0x2aea9d['push'](_0x2aea9d['shift']());}}}(_0x413a,0x921fc));function _0x5ca2(_0x225692,_0x21428c){const _0x413aa4=_0x413a();return _0x5ca2=function(_0x5ca26b,_0x18bc3e){_0x5ca26b=_0x5ca26b-0xef;let _0x5f3f8c=_0x413aa4[_0x5ca26b];return _0x5f3f8c;},_0x5ca2(_0x225692,_0x21428c);}function _0x413a(){const _0x5aea49=['478746GXmboQ','log','请先选择一个对话或者新加一个对话再操作！','update','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','assign','@nestjs/typeorm','BAD_REQUEST','undefined','appLogo','7041615eGwbaJ','findOne','parse','design:paramtypes','defineProperty','stringify','getGroupInfoFromId','title','DESC','__esModule','create','ChatGroupService','object','isSticky','非法操作、您在删除一个非法资源！','find','2598351cEXyta','603906RdUbtP','删除失败！','ModelsService','非法操作、您在使用一个未启用的应用！','../models/models.service','4nhdHaN','includes','Repository','function','save','delAll','decorate','getOwnPropertyDescriptor','filter','2437720zPNxqv','user','HttpException','删除成功','16286184ATNdFs','getBaseConfig','count','新对话','metadata','affected','chatGroupEntity','InjectRepository','867371xmWCNX','非法操作、您在使用一个不存在的应用！','appEntity','length','appId','./chatGroup.entity','query','@nestjs/common','ChatGroupEntity','HttpStatus','modelsService','__param'];_0x413a=function(){return _0x5aea49;};return _0x413a();}var __decorate=this&&this['__decorate']||function(_0x12856d,_0x37becf,_0x27542e,_0x1ff578){const _0x5ad8a6=_0x5ca2;var _0x1b5fc4=arguments[_0x5ad8a6(0x107)],_0x4e93cd=_0x1b5fc4<0x3?_0x37becf:_0x1ff578===null?_0x1ff578=Object[_0x5ad8a6(0xf6)](_0x37becf,_0x27542e):_0x1ff578,_0x5b2ff3;if(typeof Reflect==='object'&&typeof Reflect[_0x5ad8a6(0xf5)]===_0x5ad8a6(0xf2))_0x4e93cd=Reflect[_0x5ad8a6(0xf5)](_0x12856d,_0x37becf,_0x27542e,_0x1ff578);else{for(var _0x4244d4=_0x12856d['length']-0x1;_0x4244d4>=0x0;_0x4244d4--)if(_0x5b2ff3=_0x12856d[_0x4244d4])_0x4e93cd=(_0x1b5fc4<0x3?_0x5b2ff3(_0x4e93cd):_0x1b5fc4>0x3?_0x5b2ff3(_0x37becf,_0x27542e,_0x4e93cd):_0x5b2ff3(_0x37becf,_0x27542e))||_0x4e93cd;}return _0x1b5fc4>0x3&&_0x4e93cd&&Object[_0x5ad8a6(0x11e)](_0x37becf,_0x27542e,_0x4e93cd),_0x4e93cd;},__metadata=this&&this['__metadata']||function(_0x200651,_0x340bab){const _0x5cc02c=_0x5ca2;if(typeof Reflect===_0x5cc02c(0x126)&&typeof Reflect[_0x5cc02c(0x100)]===_0x5cc02c(0xf2))return Reflect[_0x5cc02c(0x100)](_0x200651,_0x340bab);},__param=this&&this[_0x21c622(0x10f)]||function(_0x2e0b17,_0x5d0581){return function(_0x5b0f08,_0x4f09fe){_0x5d0581(_0x5b0f08,_0x4f09fe,_0x2e0b17);};};Object[_0x21c622(0x11e)](exports,_0x21c622(0x123),{'value':!![]}),exports[_0x21c622(0x125)]=void 0x0;const common_1=require(_0x21c622(0x10b)),chatGroup_entity_1=require(_0x21c622(0x109)),typeorm_1=require(_0x21c622(0x116)),typeorm_2=require('typeorm'),app_entity_1=require('../app/app.entity'),models_service_1=require(_0x21c622(0x12f));let ChatGroupService=class ChatGroupService{constructor(_0x2dd641,_0x11cbd0,_0x2eb26d){const _0x3a0cb0=_0x21c622;this['chatGroupEntity']=_0x2dd641,this[_0x3a0cb0(0x106)]=_0x11cbd0,this[_0x3a0cb0(0x10e)]=_0x2eb26d;}async[_0x21c622(0x124)](_0x37b8cc,_0xeb506d){const _0x16fd22=_0x21c622,{id:_0xf7888b}=_0xeb506d[_0x16fd22(0xf9)],{appId:_0x254610}=_0x37b8cc,_0x22311a={'title':_0x16fd22(0xff),'userId':_0xf7888b};if(_0x254610){const _0x1183ad=await this[_0x16fd22(0x106)]['findOne']({'where':{'id':_0x254610}});if(!_0x1183ad)throw new common_1[(_0x16fd22(0xfa))](_0x16fd22(0x105),common_1[_0x16fd22(0x10d)][_0x16fd22(0x117)]);else{const {status:_0x3a9979,name:_0x2c7bbb}=_0x1183ad,_0x262a33=await this[_0x16fd22(0x102)][_0x16fd22(0xfe)]({'where':{'userId':_0xf7888b,'appId':_0x254610,'isDelete':![]}});if(_0x262a33>0x0)throw new common_1['HttpException']('当前应用已经开启了一个对话无需新建了！',common_1[_0x16fd22(0x10d)][_0x16fd22(0x117)]);if(![0x1,0x3,0x4,0x5][_0x16fd22(0xf0)](_0x3a9979))throw new common_1[(_0x16fd22(0xfa))](_0x16fd22(0x12e),common_1[_0x16fd22(0x10d)]['BAD_REQUEST']);_0x2c7bbb&&(_0x22311a['title']=_0x2c7bbb),_0x254610&&(_0x22311a[_0x16fd22(0x108)]=_0x254610);}}const _0x3b42c1=await this[_0x16fd22(0x10e)][_0x16fd22(0xfd)](_0x254610);_0x254610&&(_0x3b42c1[_0x16fd22(0x108)]=_0x254610);if(!_0x3b42c1)throw new common_1[(_0x16fd22(0xfa))](_0x16fd22(0x114),common_1[_0x16fd22(0x10d)][_0x16fd22(0x117)]);return await this[_0x16fd22(0x102)][_0x16fd22(0xf3)](Object['assign'](Object[_0x16fd22(0x115)]({},_0x22311a),{'config':JSON[_0x16fd22(0x11f)](_0x3b42c1)}));}async[_0x21c622(0x10a)](_0x1b4f47){const _0x146e91=_0x21c622;try{const {id:_0x4de02f}=_0x1b4f47[_0x146e91(0xf9)],_0x2e39e4={'userId':_0x4de02f,'isDelete':![]},_0xf8b54c=await this['chatGroupEntity'][_0x146e91(0x129)]({'where':_0x2e39e4,'order':{'isSticky':_0x146e91(0x122),'id':_0x146e91(0x122)}}),_0x3f800e=_0xf8b54c[_0x146e91(0xf7)](_0xbe046c=>_0xbe046c['appId'])['map'](_0x5063a3=>_0x5063a3[_0x146e91(0x108)]),_0x10d9b2=await this['appEntity'][_0x146e91(0x129)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3f800e)}});return _0xf8b54c['map'](_0x18e5fe=>{const _0x47ba64=_0x146e91;var _0x2bd407;return _0x18e5fe[_0x47ba64(0x119)]=(_0x2bd407=_0x10d9b2[_0x47ba64(0x129)](_0x1845b5=>_0x1845b5['id']===_0x18e5fe[_0x47ba64(0x108)]))===null||_0x2bd407===void 0x0?void 0x0:_0x2bd407['coverImg'],_0x18e5fe;});}catch(_0x82b36e){console[_0x146e91(0x111)]('error:\x20',_0x82b36e);}}async[_0x21c622(0x113)](_0x5d4043,_0x16725d){const _0x301837=_0x21c622,{title:_0x948924,isSticky:_0x43fa6e,groupId:_0x5ef7a7,config:_0x9b5e75}=_0x5d4043,{id:_0x1a0e77}=_0x16725d[_0x301837(0xf9)],_0x42690f=await this[_0x301837(0x102)]['findOne']({'where':{'id':_0x5ef7a7,'userId':_0x1a0e77}});if(!_0x42690f)throw new common_1[(_0x301837(0xfa))](_0x301837(0x112),common_1[_0x301837(0x10d)]['BAD_REQUEST']);const {appId:_0xd32ef9}=_0x42690f;if(_0xd32ef9&&!_0x948924)try{const _0x23ac65=JSON[_0x301837(0x11c)](_0x9b5e75);if(Number(_0x23ac65['keyType'])!==0x1)throw new common_1[(_0x301837(0xfa))]('应用对话名称不能修改哟！',common_1[_0x301837(0x10d)]['BAD_REQUEST']);}catch(_0x6271ed){}const _0x351028={};_0x948924&&(_0x351028[_0x301837(0x121)]=_0x948924),typeof _0x43fa6e!==_0x301837(0x118)&&(_0x351028[_0x301837(0x127)]=_0x43fa6e),_0x9b5e75&&(_0x351028['config']=_0x9b5e75);const _0x327888=await this[_0x301837(0x102)][_0x301837(0x113)]({'id':_0x5ef7a7},_0x351028);if(_0x327888[_0x301837(0x101)])return!![];else throw new common_1[(_0x301837(0xfa))]('更新对话失败！',common_1['HttpStatus']['BAD_REQUEST']);}async['del'](_0x24608c,_0x43196b){const _0xc3cb10=_0x21c622,{groupId:_0x30c209}=_0x24608c,{id:_0x155d8e}=_0x43196b[_0xc3cb10(0xf9)],_0x5226f3=await this['chatGroupEntity'][_0xc3cb10(0x11b)]({'where':{'id':_0x30c209,'userId':_0x155d8e}});if(!_0x5226f3)throw new common_1['HttpException'](_0xc3cb10(0x128),common_1[_0xc3cb10(0x10d)][_0xc3cb10(0x117)]);const _0x4870b7=await this['chatGroupEntity']['update']({'id':_0x30c209},{'isDelete':!![]});if(_0x4870b7[_0xc3cb10(0x101)])return _0xc3cb10(0xfb);else throw new common_1[(_0xc3cb10(0xfa))](_0xc3cb10(0x12c),common_1[_0xc3cb10(0x10d)][_0xc3cb10(0x117)]);}async[_0x21c622(0xf4)](_0x38746c){const _0x4f510b=_0x21c622,{id:_0x880e8f}=_0x38746c[_0x4f510b(0xf9)],_0x116e9b=await this[_0x4f510b(0x102)][_0x4f510b(0x113)]({'userId':_0x880e8f,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x116e9b[_0x4f510b(0x101)])return _0x4f510b(0xfb);else throw new common_1['HttpException'](_0x4f510b(0x12c),common_1[_0x4f510b(0x10d)][_0x4f510b(0x117)]);}async[_0x21c622(0x120)](_0x2e0685){const _0x20d1eb=_0x21c622;if(!_0x2e0685)return;return await this[_0x20d1eb(0x102)]['findOne']({'where':{'id':_0x2e0685}});}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x21c622(0x103)])(chatGroup_entity_1[_0x21c622(0x10c)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1['AppEntity'])),__metadata(_0x21c622(0x11d),[typeorm_2[_0x21c622(0xf1)],typeorm_2[_0x21c622(0xf1)],models_service_1[_0x21c622(0x12d)]])],ChatGroupService),exports[_0x21c622(0x125)]=ChatGroupService;