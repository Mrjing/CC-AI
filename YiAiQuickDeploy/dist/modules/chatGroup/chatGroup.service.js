'use strict';const _0x5004af=_0x3ee3;function _0x2d23(){const _0x210001=['length','appEntity','function','非法操作、您在使用一个不存在的应用！','9225909oZvngy','117282YzlWnA','del','@nestjs/typeorm','decorate','请先选择一个对话或者新加一个对话再操作！','删除失败！','assign','log','save','HttpException','affected','../app/app.entity','新对话','ChatGroupService','__esModule','9ISARnC','getBaseConfig','AppEntity','stringify','error:\x20','删除成功','ChatGroupEntity','HttpStatus','appLogo','includes','metadata','Repository','4552026QxCEog','keyType','__param','3127144qgHcuG','DESC','find','6113312jJntjo','map','__decorate','BAD_REQUEST','1280457yjObqg','create','coverImg','2827925OORoHn','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','./chatGroup.entity','chatGroupEntity','title','modelsService','update','getGroupInfoFromId','typeorm','当前应用已经开启了一个对话无需新建了！','defineProperty','非法操作、您在使用一个未启用的应用！','appId','94PjKAiI','findOne','Injectable','user','object','更新对话失败！','count','InjectRepository'];_0x2d23=function(){return _0x210001;};return _0x2d23();}(function(_0x2dddd4,_0x2f4a80){const _0x118a7d=_0x3ee3,_0x3fa56a=_0x2dddd4();while(!![]){try{const _0x3f9bf7=parseInt(_0x118a7d(0x14b))/0x1+parseInt(_0x118a7d(0x119))/0x2*(-parseInt(_0x118a7d(0x126))/0x3)+parseInt(_0x118a7d(0x144))/0x4+-parseInt(_0x118a7d(0x14e))/0x5+parseInt(_0x118a7d(0x141))/0x6+parseInt(_0x118a7d(0x125))/0x7+parseInt(_0x118a7d(0x147))/0x8*(-parseInt(_0x118a7d(0x135))/0x9);if(_0x3f9bf7===_0x2f4a80)break;else _0x3fa56a['push'](_0x3fa56a['shift']());}catch(_0x3725a9){_0x3fa56a['push'](_0x3fa56a['shift']());}}}(_0x2d23,0xed3d6));function _0x3ee3(_0x9bca0e,_0xb0bb5f){const _0x2d23a9=_0x2d23();return _0x3ee3=function(_0x3ee380,_0x5a7996){_0x3ee380=_0x3ee380-0x115;let _0x28dc3c=_0x2d23a9[_0x3ee380];return _0x28dc3c;},_0x3ee3(_0x9bca0e,_0xb0bb5f);}var __decorate=this&&this[_0x5004af(0x149)]||function(_0x4db8f9,_0x3d1d2d,_0x74a488,_0x1af541){const _0x512a61=_0x5004af;var _0x245d34=arguments[_0x512a61(0x121)],_0x1c6804=_0x245d34<0x3?_0x3d1d2d:_0x1af541===null?_0x1af541=Object['getOwnPropertyDescriptor'](_0x3d1d2d,_0x74a488):_0x1af541,_0x52985e;if(typeof Reflect===_0x512a61(0x11d)&&typeof Reflect[_0x512a61(0x129)]===_0x512a61(0x123))_0x1c6804=Reflect[_0x512a61(0x129)](_0x4db8f9,_0x3d1d2d,_0x74a488,_0x1af541);else{for(var _0x520199=_0x4db8f9[_0x512a61(0x121)]-0x1;_0x520199>=0x0;_0x520199--)if(_0x52985e=_0x4db8f9[_0x520199])_0x1c6804=(_0x245d34<0x3?_0x52985e(_0x1c6804):_0x245d34>0x3?_0x52985e(_0x3d1d2d,_0x74a488,_0x1c6804):_0x52985e(_0x3d1d2d,_0x74a488))||_0x1c6804;}return _0x245d34>0x3&&_0x1c6804&&Object[_0x512a61(0x116)](_0x3d1d2d,_0x74a488,_0x1c6804),_0x1c6804;},__metadata=this&&this['__metadata']||function(_0x5946d9,_0x4462ed){const _0x3ad2a9=_0x5004af;if(typeof Reflect===_0x3ad2a9(0x11d)&&typeof Reflect['metadata']===_0x3ad2a9(0x123))return Reflect[_0x3ad2a9(0x13f)](_0x5946d9,_0x4462ed);},__param=this&&this[_0x5004af(0x143)]||function(_0x1ff39d,_0x56200f){return function(_0x209e36,_0x1cb92c){_0x56200f(_0x209e36,_0x1cb92c,_0x1ff39d);};};Object['defineProperty'](exports,_0x5004af(0x134),{'value':!![]}),exports[_0x5004af(0x133)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x5004af(0x150)),typeorm_1=require(_0x5004af(0x128)),typeorm_2=require(_0x5004af(0x156)),app_entity_1=require(_0x5004af(0x131)),models_service_1=require('../models/models.service');let ChatGroupService=class ChatGroupService{constructor(_0x42c7b0,_0x403b78,_0x3cfb05){const _0x2d83e3=_0x5004af;this[_0x2d83e3(0x151)]=_0x42c7b0,this['appEntity']=_0x403b78,this[_0x2d83e3(0x153)]=_0x3cfb05;}async[_0x5004af(0x14c)](_0x30d029,_0x339a13){const _0x24e0c6=_0x5004af,{id:_0x190564}=_0x339a13[_0x24e0c6(0x11c)],{appId:_0x53a4ab}=_0x30d029,_0x282194={'title':_0x24e0c6(0x132),'userId':_0x190564};if(_0x53a4ab){const _0x447cc4=await this[_0x24e0c6(0x122)][_0x24e0c6(0x11a)]({'where':{'id':_0x53a4ab}});if(!_0x447cc4)throw new common_1[(_0x24e0c6(0x12f))](_0x24e0c6(0x124),common_1[_0x24e0c6(0x13c)][_0x24e0c6(0x14a)]);else{const {status:_0x2fc377,name:_0x138d64}=_0x447cc4,_0x2d2b66=await this[_0x24e0c6(0x151)][_0x24e0c6(0x11f)]({'where':{'userId':_0x190564,'appId':_0x53a4ab,'isDelete':![]}});if(_0x2d2b66>0x0)throw new common_1['HttpException'](_0x24e0c6(0x115),common_1[_0x24e0c6(0x13c)][_0x24e0c6(0x14a)]);if(![0x1,0x3,0x4,0x5][_0x24e0c6(0x13e)](_0x2fc377))throw new common_1[(_0x24e0c6(0x12f))](_0x24e0c6(0x117),common_1[_0x24e0c6(0x13c)][_0x24e0c6(0x14a)]);_0x138d64&&(_0x282194[_0x24e0c6(0x152)]=_0x138d64),_0x53a4ab&&(_0x282194['appId']=_0x53a4ab);}}const _0x4bb052=await this['modelsService'][_0x24e0c6(0x136)](_0x53a4ab);_0x53a4ab&&(_0x4bb052[_0x24e0c6(0x118)]=_0x53a4ab);if(!_0x4bb052)throw new common_1[(_0x24e0c6(0x12f))](_0x24e0c6(0x14f),common_1[_0x24e0c6(0x13c)][_0x24e0c6(0x14a)]);return await this[_0x24e0c6(0x151)][_0x24e0c6(0x12e)](Object[_0x24e0c6(0x12c)](Object['assign']({},_0x282194),{'config':JSON[_0x24e0c6(0x138)](_0x4bb052)}));}async['query'](_0x3113ff){const _0x1ac9e4=_0x5004af;try{const {id:_0x5c0659}=_0x3113ff[_0x1ac9e4(0x11c)],_0x50e2cf={'userId':_0x5c0659,'isDelete':![]},_0x4757f0=await this[_0x1ac9e4(0x151)][_0x1ac9e4(0x146)]({'where':_0x50e2cf,'order':{'isSticky':'DESC','id':_0x1ac9e4(0x145)}}),_0x44e52a=_0x4757f0['filter'](_0x205700=>_0x205700[_0x1ac9e4(0x118)])[_0x1ac9e4(0x148)](_0x214c4c=>_0x214c4c[_0x1ac9e4(0x118)]),_0x1d9284=await this[_0x1ac9e4(0x122)][_0x1ac9e4(0x146)]({'where':{'id':(0x0,typeorm_2['In'])(_0x44e52a)}});return _0x4757f0[_0x1ac9e4(0x148)](_0x285ff8=>{const _0x4b4db0=_0x1ac9e4;var _0x427aef;return _0x285ff8[_0x4b4db0(0x13d)]=(_0x427aef=_0x1d9284[_0x4b4db0(0x146)](_0x5f4cfb=>_0x5f4cfb['id']===_0x285ff8['appId']))===null||_0x427aef===void 0x0?void 0x0:_0x427aef[_0x4b4db0(0x14d)],_0x285ff8;});}catch(_0x18f624){console[_0x1ac9e4(0x12d)](_0x1ac9e4(0x139),_0x18f624);}}async[_0x5004af(0x154)](_0x32407a,_0x38fbc0){const _0x39021d=_0x5004af,{title:_0x14e009,isSticky:_0x41cefd,groupId:_0x369bcb,config:_0x186d1a}=_0x32407a,{id:_0x5cf330}=_0x38fbc0[_0x39021d(0x11c)],_0x122bbe=await this[_0x39021d(0x151)][_0x39021d(0x11a)]({'where':{'id':_0x369bcb,'userId':_0x5cf330}});if(!_0x122bbe)throw new common_1[(_0x39021d(0x12f))](_0x39021d(0x12a),common_1[_0x39021d(0x13c)][_0x39021d(0x14a)]);const {appId:_0x55f9e9}=_0x122bbe;if(_0x55f9e9&&!_0x14e009)try{const _0x34922b=JSON['parse'](_0x186d1a);if(Number(_0x34922b[_0x39021d(0x142)])!==0x1)throw new common_1[(_0x39021d(0x12f))]('应用对话名称不能修改哟！',common_1[_0x39021d(0x13c)][_0x39021d(0x14a)]);}catch(_0x3152ca){}const _0x57989f={};_0x14e009&&(_0x57989f[_0x39021d(0x152)]=_0x14e009),typeof _0x41cefd!=='undefined'&&(_0x57989f['isSticky']=_0x41cefd),_0x186d1a&&(_0x57989f['config']=_0x186d1a);const _0x152fd8=await this[_0x39021d(0x151)][_0x39021d(0x154)]({'id':_0x369bcb},_0x57989f);if(_0x152fd8[_0x39021d(0x130)])return!![];else throw new common_1['HttpException'](_0x39021d(0x11e),common_1[_0x39021d(0x13c)][_0x39021d(0x14a)]);}async[_0x5004af(0x127)](_0x5edf82,_0x582abd){const _0x583471=_0x5004af,{groupId:_0x225c2c}=_0x5edf82,{id:_0x5b3002}=_0x582abd[_0x583471(0x11c)],_0x3a3382=await this[_0x583471(0x151)][_0x583471(0x11a)]({'where':{'id':_0x225c2c,'userId':_0x5b3002}});if(!_0x3a3382)throw new common_1['HttpException']('非法操作、您在删除一个非法资源！',common_1[_0x583471(0x13c)][_0x583471(0x14a)]);const _0x21b5b6=await this[_0x583471(0x151)][_0x583471(0x154)]({'id':_0x225c2c},{'isDelete':!![]});if(_0x21b5b6['affected'])return _0x583471(0x13a);else throw new common_1[(_0x583471(0x12f))](_0x583471(0x12b),common_1['HttpStatus']['BAD_REQUEST']);}async['delAll'](_0x28efe0){const _0x8ecdb5=_0x5004af,{id:_0x9116c}=_0x28efe0[_0x8ecdb5(0x11c)],_0x2b83ab=await this[_0x8ecdb5(0x151)]['update']({'userId':_0x9116c,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x2b83ab[_0x8ecdb5(0x130)])return _0x8ecdb5(0x13a);else throw new common_1[(_0x8ecdb5(0x12f))](_0x8ecdb5(0x12b),common_1[_0x8ecdb5(0x13c)][_0x8ecdb5(0x14a)]);}async[_0x5004af(0x155)](_0x444437){const _0x3415af=_0x5004af;if(!_0x444437)return;return await this[_0x3415af(0x151)][_0x3415af(0x11a)]({'where':{'id':_0x444437}});}};ChatGroupService=__decorate([(0x0,common_1[_0x5004af(0x11b)])(),__param(0x0,(0x0,typeorm_1[_0x5004af(0x120)])(chatGroup_entity_1[_0x5004af(0x13b)])),__param(0x1,(0x0,typeorm_1[_0x5004af(0x120)])(app_entity_1[_0x5004af(0x137)])),__metadata('design:paramtypes',[typeorm_2[_0x5004af(0x140)],typeorm_2[_0x5004af(0x140)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x5004af(0x133)]=ChatGroupService;