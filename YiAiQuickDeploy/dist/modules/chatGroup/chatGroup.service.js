'use strict';const _0x51a738=_0x3c8c;(function(_0x53b6d5,_0x31debc){const _0x298027=_0x3c8c,_0x11c6a3=_0x53b6d5();while(!![]){try{const _0x36c435=-parseInt(_0x298027(0x1c3))/0x1+parseInt(_0x298027(0x1dd))/0x2*(parseInt(_0x298027(0x1b5))/0x3)+-parseInt(_0x298027(0x1c7))/0x4+parseInt(_0x298027(0x1d8))/0x5+-parseInt(_0x298027(0x1e0))/0x6*(parseInt(_0x298027(0x1a5))/0x7)+-parseInt(_0x298027(0x1bc))/0x8*(parseInt(_0x298027(0x1ea))/0x9)+-parseInt(_0x298027(0x1e9))/0xa*(-parseInt(_0x298027(0x1cc))/0xb);if(_0x36c435===_0x31debc)break;else _0x11c6a3['push'](_0x11c6a3['shift']());}catch(_0x2d4185){_0x11c6a3['push'](_0x11c6a3['shift']());}}}(_0x22ac,0xddaa5));function _0x22ac(){const _0x4dfa6d=['HttpException','3zazZQa','DESC','update','filter','defineProperty','BAD_REQUEST','__param','152rHeJhh','includes','InjectRepository','getOwnPropertyDescriptor','./chatGroup.entity','appEntity','删除失败！','70314uELova','coverImg','ModelsService','metadata','5875016rqBGxx','user','删除成功','save','query','138281EJxafB','title','findOne','map','length','error:\x20','ChatGroupEntity','当前应用已经开启了一个对话无需新建了！','undefined','decorate','ChatGroupService','应用对话名称不能修改哟！','2603510VEGKzI','config','appId','chatGroupEntity','非法操作、您在使用一个未启用的应用！','409044fliGlc','delAll','modelsService','1231104EJVpkN','typeorm','非法操作、您在删除一个非法资源！','function','stringify','assign','__esModule','keyType','affected','1970xXpBLH','260298AzDbbB','7dSYMVN','__metadata','del','getBaseConfig','HttpStatus','../app/app.entity','object','log','design:paramtypes','find','@nestjs/common','Repository','更新对话失败！','非法操作、您在使用一个不存在的应用！','getGroupInfoFromId'];_0x22ac=function(){return _0x4dfa6d;};return _0x22ac();}var __decorate=this&&this['__decorate']||function(_0x469a74,_0x9e8b58,_0x127ff0,_0x31ba58){const _0x50ca7d=_0x3c8c;var _0x2c71c1=arguments[_0x50ca7d(0x1d0)],_0x12a8c1=_0x2c71c1<0x3?_0x9e8b58:_0x31ba58===null?_0x31ba58=Object[_0x50ca7d(0x1bf)](_0x9e8b58,_0x127ff0):_0x31ba58,_0x4a2588;if(typeof Reflect===_0x50ca7d(0x1ab)&&typeof Reflect[_0x50ca7d(0x1d5)]===_0x50ca7d(0x1e3))_0x12a8c1=Reflect[_0x50ca7d(0x1d5)](_0x469a74,_0x9e8b58,_0x127ff0,_0x31ba58);else{for(var _0x296adb=_0x469a74['length']-0x1;_0x296adb>=0x0;_0x296adb--)if(_0x4a2588=_0x469a74[_0x296adb])_0x12a8c1=(_0x2c71c1<0x3?_0x4a2588(_0x12a8c1):_0x2c71c1>0x3?_0x4a2588(_0x9e8b58,_0x127ff0,_0x12a8c1):_0x4a2588(_0x9e8b58,_0x127ff0))||_0x12a8c1;}return _0x2c71c1>0x3&&_0x12a8c1&&Object['defineProperty'](_0x9e8b58,_0x127ff0,_0x12a8c1),_0x12a8c1;},__metadata=this&&this[_0x51a738(0x1a6)]||function(_0x3b432c,_0x379c5d){const _0x336d61=_0x51a738;if(typeof Reflect==='object'&&typeof Reflect[_0x336d61(0x1c6)]===_0x336d61(0x1e3))return Reflect[_0x336d61(0x1c6)](_0x3b432c,_0x379c5d);},__param=this&&this[_0x51a738(0x1bb)]||function(_0x456365,_0x2ec7ba){return function(_0x259b4e,_0x1f5f2c){_0x2ec7ba(_0x259b4e,_0x1f5f2c,_0x456365);};};function _0x3c8c(_0x3201e2,_0x52bfb2){const _0x22ac3f=_0x22ac();return _0x3c8c=function(_0x3c8cad,_0x5bf8a1){_0x3c8cad=_0x3c8cad-0x1a5;let _0x23f192=_0x22ac3f[_0x3c8cad];return _0x23f192;},_0x3c8c(_0x3201e2,_0x52bfb2);}Object[_0x51a738(0x1b9)](exports,_0x51a738(0x1e6),{'value':!![]}),exports[_0x51a738(0x1d6)]=void 0x0;const common_1=require(_0x51a738(0x1af)),chatGroup_entity_1=require(_0x51a738(0x1c0)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x51a738(0x1e1)),app_entity_1=require(_0x51a738(0x1aa)),models_service_1=require('../models/models.service');let ChatGroupService=class ChatGroupService{constructor(_0xd67459,_0x5783cb,_0x26afd3){const _0x38f046=_0x51a738;this[_0x38f046(0x1db)]=_0xd67459,this[_0x38f046(0x1c1)]=_0x5783cb,this[_0x38f046(0x1df)]=_0x26afd3;}async['create'](_0xc01fd,_0x855b69){const _0x2aaf07=_0x51a738,{id:_0x2e9d1b}=_0x855b69[_0x2aaf07(0x1c8)],{appId:_0x292f4d}=_0xc01fd,_0x28ade6={'title':'新对话','userId':_0x2e9d1b};if(_0x292f4d){const _0x25228a=await this[_0x2aaf07(0x1c1)][_0x2aaf07(0x1ce)]({'where':{'id':_0x292f4d}});if(!_0x25228a)throw new common_1[(_0x2aaf07(0x1b4))](_0x2aaf07(0x1b2),common_1[_0x2aaf07(0x1a9)][_0x2aaf07(0x1ba)]);else{const {status:_0x330a8c,name:_0x548995}=_0x25228a,_0x5884f9=await this[_0x2aaf07(0x1db)]['count']({'where':{'userId':_0x2e9d1b,'appId':_0x292f4d,'isDelete':![]}});if(_0x5884f9>0x0)throw new common_1[(_0x2aaf07(0x1b4))](_0x2aaf07(0x1d3),common_1[_0x2aaf07(0x1a9)][_0x2aaf07(0x1ba)]);if(![0x1,0x3,0x4,0x5][_0x2aaf07(0x1bd)](_0x330a8c))throw new common_1['HttpException'](_0x2aaf07(0x1dc),common_1[_0x2aaf07(0x1a9)][_0x2aaf07(0x1ba)]);_0x548995&&(_0x28ade6[_0x2aaf07(0x1cd)]=_0x548995),_0x292f4d&&(_0x28ade6['appId']=_0x292f4d);}}const _0x127805=await this[_0x2aaf07(0x1df)][_0x2aaf07(0x1a8)](_0x292f4d);_0x292f4d&&(_0x127805[_0x2aaf07(0x1da)]=_0x292f4d);if(!_0x127805)throw new common_1['HttpException']('管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！',common_1[_0x2aaf07(0x1a9)][_0x2aaf07(0x1ba)]);return await this[_0x2aaf07(0x1db)][_0x2aaf07(0x1ca)](Object[_0x2aaf07(0x1e5)](Object[_0x2aaf07(0x1e5)]({},_0x28ade6),{'config':JSON[_0x2aaf07(0x1e4)](_0x127805)}));}async[_0x51a738(0x1cb)](_0x141f0a){const _0x554d20=_0x51a738;try{const {id:_0x47021c}=_0x141f0a[_0x554d20(0x1c8)],_0x49f04e={'userId':_0x47021c,'isDelete':![]},_0x1d824d=await this[_0x554d20(0x1db)][_0x554d20(0x1ae)]({'where':_0x49f04e,'order':{'isSticky':_0x554d20(0x1b6),'id':_0x554d20(0x1b6)}}),_0x2b68aa=_0x1d824d[_0x554d20(0x1b8)](_0x3858a3=>_0x3858a3[_0x554d20(0x1da)])[_0x554d20(0x1cf)](_0x6f56cb=>_0x6f56cb[_0x554d20(0x1da)]),_0x174e5b=await this[_0x554d20(0x1c1)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2b68aa)}});return _0x1d824d[_0x554d20(0x1cf)](_0x24df15=>{const _0x498584=_0x554d20;var _0x3303e8;return _0x24df15['appLogo']=(_0x3303e8=_0x174e5b['find'](_0x44a7ff=>_0x44a7ff['id']===_0x24df15[_0x498584(0x1da)]))===null||_0x3303e8===void 0x0?void 0x0:_0x3303e8[_0x498584(0x1c4)],_0x24df15;});}catch(_0x224fa3){console[_0x554d20(0x1ac)](_0x554d20(0x1d1),_0x224fa3);}}async[_0x51a738(0x1b7)](_0x6c8949,_0x35fbf3){const _0x3184cc=_0x51a738,{title:_0xb57b58,isSticky:_0x1ae9d1,groupId:_0x2702b6,config:_0x50d9bb}=_0x6c8949,{id:_0x24ff39}=_0x35fbf3['user'],_0x36b122=await this[_0x3184cc(0x1db)][_0x3184cc(0x1ce)]({'where':{'id':_0x2702b6,'userId':_0x24ff39}});if(!_0x36b122)throw new common_1[(_0x3184cc(0x1b4))]('请先选择一个对话或者新加一个对话再操作！',common_1['HttpStatus']['BAD_REQUEST']);const {appId:_0x591dca}=_0x36b122;if(_0x591dca&&!_0xb57b58)try{const _0x224c83=JSON['parse'](_0x50d9bb);if(Number(_0x224c83[_0x3184cc(0x1e7)])!==0x1)throw new common_1[(_0x3184cc(0x1b4))](_0x3184cc(0x1d7),common_1[_0x3184cc(0x1a9)][_0x3184cc(0x1ba)]);}catch(_0x2d6bf4){}const _0x581e07={};_0xb57b58&&(_0x581e07[_0x3184cc(0x1cd)]=_0xb57b58),typeof _0x1ae9d1!==_0x3184cc(0x1d4)&&(_0x581e07['isSticky']=_0x1ae9d1),_0x50d9bb&&(_0x581e07[_0x3184cc(0x1d9)]=_0x50d9bb);const _0x4d05cb=await this[_0x3184cc(0x1db)][_0x3184cc(0x1b7)]({'id':_0x2702b6},_0x581e07);if(_0x4d05cb[_0x3184cc(0x1e8)])return!![];else throw new common_1['HttpException'](_0x3184cc(0x1b1),common_1['HttpStatus'][_0x3184cc(0x1ba)]);}async[_0x51a738(0x1a7)](_0x11fb8b,_0x398626){const _0x12cc49=_0x51a738,{groupId:_0x32e39c}=_0x11fb8b,{id:_0x3157b3}=_0x398626['user'],_0x575832=await this[_0x12cc49(0x1db)][_0x12cc49(0x1ce)]({'where':{'id':_0x32e39c,'userId':_0x3157b3}});if(!_0x575832)throw new common_1[(_0x12cc49(0x1b4))](_0x12cc49(0x1e2),common_1[_0x12cc49(0x1a9)]['BAD_REQUEST']);const _0x3b311a=await this['chatGroupEntity'][_0x12cc49(0x1b7)]({'id':_0x32e39c},{'isDelete':!![]});if(_0x3b311a['affected'])return _0x12cc49(0x1c9);else throw new common_1[(_0x12cc49(0x1b4))](_0x12cc49(0x1c2),common_1[_0x12cc49(0x1a9)][_0x12cc49(0x1ba)]);}async[_0x51a738(0x1de)](_0x575c4c){const _0x2654db=_0x51a738,{id:_0x56ee1d}=_0x575c4c[_0x2654db(0x1c8)],_0x36e877=await this[_0x2654db(0x1db)]['update']({'userId':_0x56ee1d,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x36e877['affected'])return _0x2654db(0x1c9);else throw new common_1['HttpException'](_0x2654db(0x1c2),common_1['HttpStatus'][_0x2654db(0x1ba)]);}async[_0x51a738(0x1b3)](_0x557292){const _0x5219e0=_0x51a738;if(!_0x557292)return;return await this['chatGroupEntity'][_0x5219e0(0x1ce)]({'where':{'id':_0x557292}});}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x51a738(0x1be)])(chatGroup_entity_1[_0x51a738(0x1d2)])),__param(0x1,(0x0,typeorm_1[_0x51a738(0x1be)])(app_entity_1['AppEntity'])),__metadata(_0x51a738(0x1ad),[typeorm_2['Repository'],typeorm_2[_0x51a738(0x1b0)],models_service_1[_0x51a738(0x1c5)]])],ChatGroupService),exports[_0x51a738(0x1d6)]=ChatGroupService;