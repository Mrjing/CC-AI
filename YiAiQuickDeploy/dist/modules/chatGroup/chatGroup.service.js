'use strict';function _0x40c9(){const _0x412926=['管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','当前应用已经开启了一个对话无需新建了！','update','非法操作、您在删除一个非法资源！','affected','defineProperty','1753076tuoxoL','assign','新对话','config','ModelsService','modelsService','非法操作、您在使用一个不存在的应用！','map','775490TTfxOW','应用对话名称不能修改哟！','47265xCcNRW','parse','__param','12139596qzfoWL','BAD_REQUEST','error:\x20','create','InjectRepository','1176894qYFbfJ','find','删除失败！','isSticky','appLogo','删除成功','3994683yprDfr','query','appEntity','../models/models.service','../app/app.entity','Injectable','decorate','ChatGroupService','object','__esModule','更新对话失败！','findOne','includes','6qvXZsg','length','design:paramtypes','HttpException','title','getBaseConfig','DESC','AppEntity','@nestjs/common','__decorate','metadata','appId','6cfPKXk','save','./chatGroup.entity','user','HttpStatus','filter','chatGroupEntity','getOwnPropertyDescriptor','请先选择一个对话或者新加一个对话再操作！','Repository','2831488sgRyIt'];_0x40c9=function(){return _0x412926;};return _0x40c9();}const _0x64e660=_0x4f14;function _0x4f14(_0x54db8a,_0x3ca671){const _0x40c911=_0x40c9();return _0x4f14=function(_0x4f14bc,_0x14aa4a){_0x4f14bc=_0x4f14bc-0x7f;let _0x46ecf8=_0x40c911[_0x4f14bc];return _0x46ecf8;},_0x4f14(_0x54db8a,_0x3ca671);}(function(_0x4c057a,_0x10b2e1){const _0x280b85=_0x4f14,_0x9c4d12=_0x4c057a();while(!![]){try{const _0x3702b8=parseInt(_0x280b85(0xa7))/0x1*(parseInt(_0x280b85(0x80))/0x2)+-parseInt(_0x280b85(0xaf))/0x3+-parseInt(_0x280b85(0x9d))/0x4+-parseInt(_0x280b85(0xa5))/0x5+-parseInt(_0x280b85(0x8c))/0x6*(parseInt(_0x280b85(0xb5))/0x7)+parseInt(_0x280b85(0x96))/0x8+parseInt(_0x280b85(0xaa))/0x9;if(_0x3702b8===_0x10b2e1)break;else _0x9c4d12['push'](_0x9c4d12['shift']());}catch(_0x6253de){_0x9c4d12['push'](_0x9c4d12['shift']());}}}(_0x40c9,0x465f1));var __decorate=this&&this[_0x64e660(0x89)]||function(_0x3090cf,_0x521138,_0x16e545,_0x30e9d3){const _0x3e2973=_0x64e660;var _0x42b7d5=arguments['length'],_0xd83aee=_0x42b7d5<0x3?_0x521138:_0x30e9d3===null?_0x30e9d3=Object[_0x3e2973(0x93)](_0x521138,_0x16e545):_0x30e9d3,_0x35fdfb;if(typeof Reflect===_0x3e2973(0xbd)&&typeof Reflect[_0x3e2973(0xbb)]==='function')_0xd83aee=Reflect[_0x3e2973(0xbb)](_0x3090cf,_0x521138,_0x16e545,_0x30e9d3);else{for(var _0x258e99=_0x3090cf[_0x3e2973(0x81)]-0x1;_0x258e99>=0x0;_0x258e99--)if(_0x35fdfb=_0x3090cf[_0x258e99])_0xd83aee=(_0x42b7d5<0x3?_0x35fdfb(_0xd83aee):_0x42b7d5>0x3?_0x35fdfb(_0x521138,_0x16e545,_0xd83aee):_0x35fdfb(_0x521138,_0x16e545))||_0xd83aee;}return _0x42b7d5>0x3&&_0xd83aee&&Object[_0x3e2973(0x9c)](_0x521138,_0x16e545,_0xd83aee),_0xd83aee;},__metadata=this&&this['__metadata']||function(_0x1acf7e,_0x4b71ca){const _0x1bf0eb=_0x64e660;if(typeof Reflect===_0x1bf0eb(0xbd)&&typeof Reflect[_0x1bf0eb(0x8a)]==='function')return Reflect[_0x1bf0eb(0x8a)](_0x1acf7e,_0x4b71ca);},__param=this&&this[_0x64e660(0xa9)]||function(_0x328bfa,_0x5145ae){return function(_0x1aaa53,_0x26bb45){_0x5145ae(_0x1aaa53,_0x26bb45,_0x328bfa);};};Object[_0x64e660(0x9c)](exports,_0x64e660(0xbe),{'value':!![]}),exports[_0x64e660(0xbc)]=void 0x0;const common_1=require(_0x64e660(0x88)),chatGroup_entity_1=require(_0x64e660(0x8e)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),app_entity_1=require(_0x64e660(0xb9)),models_service_1=require(_0x64e660(0xb8));let ChatGroupService=class ChatGroupService{constructor(_0x4d3a6a,_0x5b7c24,_0x2e6b6b){const _0x2f6cc9=_0x64e660;this[_0x2f6cc9(0x92)]=_0x4d3a6a,this[_0x2f6cc9(0xb7)]=_0x5b7c24,this[_0x2f6cc9(0xa2)]=_0x2e6b6b;}async[_0x64e660(0xad)](_0x22dd38,_0xb41c69){const _0x5b151a=_0x64e660,{id:_0x1f6c73}=_0xb41c69[_0x5b151a(0x8f)],{appId:_0x46a80}=_0x22dd38,_0x2d8732={'title':_0x5b151a(0x9f),'userId':_0x1f6c73};if(_0x46a80){const _0x260825=await this[_0x5b151a(0xb7)][_0x5b151a(0xc0)]({'where':{'id':_0x46a80}});if(!_0x260825)throw new common_1[(_0x5b151a(0x83))](_0x5b151a(0xa3),common_1[_0x5b151a(0x90)][_0x5b151a(0xab)]);else{const {status:_0x1f397f,name:_0x2fd500}=_0x260825,_0x5a0d96=await this[_0x5b151a(0x92)]['count']({'where':{'userId':_0x1f6c73,'appId':_0x46a80,'isDelete':![]}});if(_0x5a0d96>0x0)throw new common_1[(_0x5b151a(0x83))](_0x5b151a(0x98),common_1['HttpStatus'][_0x5b151a(0xab)]);if(![0x1,0x3,0x4,0x5][_0x5b151a(0x7f)](_0x1f397f))throw new common_1[(_0x5b151a(0x83))]('非法操作、您在使用一个未启用的应用！',common_1[_0x5b151a(0x90)]['BAD_REQUEST']);_0x2fd500&&(_0x2d8732[_0x5b151a(0x84)]=_0x2fd500),_0x46a80&&(_0x2d8732[_0x5b151a(0x8b)]=_0x46a80);}}const _0x42dfa3=await this['modelsService'][_0x5b151a(0x85)](_0x46a80);_0x46a80&&(_0x42dfa3['appId']=_0x46a80);if(!_0x42dfa3)throw new common_1['HttpException'](_0x5b151a(0x97),common_1[_0x5b151a(0x90)][_0x5b151a(0xab)]);return await this[_0x5b151a(0x92)][_0x5b151a(0x8d)](Object[_0x5b151a(0x9e)](Object['assign']({},_0x2d8732),{'config':JSON['stringify'](_0x42dfa3)}));}async[_0x64e660(0xb6)](_0x59f64c){const _0x55e5ee=_0x64e660;try{const {id:_0xa35b60}=_0x59f64c[_0x55e5ee(0x8f)],_0xde76f7={'userId':_0xa35b60,'isDelete':![]},_0xe0b047=await this['chatGroupEntity'][_0x55e5ee(0xb0)]({'where':_0xde76f7,'order':{'isSticky':'DESC','id':_0x55e5ee(0x86)}}),_0x4852ea=_0xe0b047[_0x55e5ee(0x91)](_0x2ed360=>_0x2ed360[_0x55e5ee(0x8b)])['map'](_0x460b30=>_0x460b30[_0x55e5ee(0x8b)]),_0x52248c=await this[_0x55e5ee(0xb7)][_0x55e5ee(0xb0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4852ea)}});return _0xe0b047[_0x55e5ee(0xa4)](_0x4e642b=>{const _0x4b9142=_0x55e5ee;var _0x3242f4;return _0x4e642b[_0x4b9142(0xb3)]=(_0x3242f4=_0x52248c[_0x4b9142(0xb0)](_0x4b1025=>_0x4b1025['id']===_0x4e642b[_0x4b9142(0x8b)]))===null||_0x3242f4===void 0x0?void 0x0:_0x3242f4['coverImg'],_0x4e642b;});}catch(_0x42bd88){console['log'](_0x55e5ee(0xac),_0x42bd88);}}async['update'](_0x5ef853,_0x5f4332){const _0x350a76=_0x64e660,{title:_0x14df3e,isSticky:_0x4c5509,groupId:_0x5245db,config:_0x4d837b}=_0x5ef853,{id:_0xec73a0}=_0x5f4332['user'],_0x28e5fa=await this[_0x350a76(0x92)][_0x350a76(0xc0)]({'where':{'id':_0x5245db,'userId':_0xec73a0}});if(!_0x28e5fa)throw new common_1[(_0x350a76(0x83))](_0x350a76(0x94),common_1[_0x350a76(0x90)][_0x350a76(0xab)]);const {appId:_0x51cc34}=_0x28e5fa;if(_0x51cc34&&!_0x14df3e)try{const _0x2e927a=JSON[_0x350a76(0xa8)](_0x4d837b);if(Number(_0x2e927a['keyType'])!==0x1)throw new common_1['HttpException'](_0x350a76(0xa6),common_1['HttpStatus'][_0x350a76(0xab)]);}catch(_0x547c49){}const _0x19170a={};_0x14df3e&&(_0x19170a[_0x350a76(0x84)]=_0x14df3e),typeof _0x4c5509!=='undefined'&&(_0x19170a[_0x350a76(0xb2)]=_0x4c5509),_0x4d837b&&(_0x19170a[_0x350a76(0xa0)]=_0x4d837b);const _0x433e07=await this[_0x350a76(0x92)]['update']({'id':_0x5245db},_0x19170a);if(_0x433e07[_0x350a76(0x9b)])return!![];else throw new common_1['HttpException'](_0x350a76(0xbf),common_1[_0x350a76(0x90)][_0x350a76(0xab)]);}async['del'](_0x3cac2d,_0x5a62cc){const _0x1b89c4=_0x64e660,{groupId:_0x3456e3}=_0x3cac2d,{id:_0x1c935d}=_0x5a62cc[_0x1b89c4(0x8f)],_0xa0bab8=await this[_0x1b89c4(0x92)][_0x1b89c4(0xc0)]({'where':{'id':_0x3456e3,'userId':_0x1c935d}});if(!_0xa0bab8)throw new common_1[(_0x1b89c4(0x83))](_0x1b89c4(0x9a),common_1['HttpStatus'][_0x1b89c4(0xab)]);const _0x343f8f=await this[_0x1b89c4(0x92)][_0x1b89c4(0x99)]({'id':_0x3456e3},{'isDelete':!![]});if(_0x343f8f[_0x1b89c4(0x9b)])return _0x1b89c4(0xb4);else throw new common_1[(_0x1b89c4(0x83))](_0x1b89c4(0xb1),common_1[_0x1b89c4(0x90)][_0x1b89c4(0xab)]);}async['delAll'](_0x595595){const _0x1604cb=_0x64e660,{id:_0x4550d4}=_0x595595[_0x1604cb(0x8f)],_0x168477=await this[_0x1604cb(0x92)]['update']({'userId':_0x4550d4,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x168477[_0x1604cb(0x9b)])return _0x1604cb(0xb4);else throw new common_1[(_0x1604cb(0x83))](_0x1604cb(0xb1),common_1[_0x1604cb(0x90)][_0x1604cb(0xab)]);}async['getGroupInfoFromId'](_0x77f91b){const _0x414273=_0x64e660;if(!_0x77f91b)return;return await this[_0x414273(0x92)][_0x414273(0xc0)]({'where':{'id':_0x77f91b}});}};ChatGroupService=__decorate([(0x0,common_1[_0x64e660(0xba)])(),__param(0x0,(0x0,typeorm_1[_0x64e660(0xae)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1[_0x64e660(0xae)])(app_entity_1[_0x64e660(0x87)])),__metadata(_0x64e660(0x82),[typeorm_2[_0x64e660(0x95)],typeorm_2[_0x64e660(0x95)],models_service_1[_0x64e660(0xa1)]])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;