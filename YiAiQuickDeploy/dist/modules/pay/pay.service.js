'use strict';function _0x5451(_0x4910ac,_0x829240){const _0x7c0488=_0x7c04();return _0x5451=function(_0x5451d4,_0x4f71af){_0x5451d4=_0x5451d4-0x9d;let _0x880a1c=_0x7c0488[_0x5451d4];return _0x880a1c;},_0x5451(_0x4910ac,_0x829240);}const _0x18c43b=_0x5451;(function(_0x2084b8,_0x102406){const _0x497670=_0x5451,_0x38347e=_0x2084b8();while(!![]){try{const _0xbbbcdc=-parseInt(_0x497670(0xe4))/0x1+-parseInt(_0x497670(0x107))/0x2+parseInt(_0x497670(0xd2))/0x3+parseInt(_0x497670(0x147))/0x4*(-parseInt(_0x497670(0xbb))/0x5)+parseInt(_0x497670(0x140))/0x6+parseInt(_0x497670(0x122))/0x7*(-parseInt(_0x497670(0xec))/0x8)+parseInt(_0x497670(0x104))/0x9;if(_0xbbbcdc===_0x102406)break;else _0x38347e['push'](_0x38347e['shift']());}catch(_0x3e4150){_0x38347e['push'](_0x38347e['shift']());}}}(_0x7c04,0x7af52));function _0x7c04(){const _0x20dfa5=['param','native','attach','UserService','192.168.1.100','globalConfigService','payMpayPid','套餐不存在!','../order/order.entity','unsupported\x20pay\x20type','11095866lLqTLS','payMpaySecret','wechat','1202042MSJFFh','event_type','WxPay','trade_state','trade_status','get','Wap','hupi','success','now','wx-native\x20获取二维码地址为空','pay','payHupi','alipay','sign_type','return_url','payWeChatAppId','../user/user.service','payEpayPid','payEpaySecret','PayService','payHupiNotifyUrl','payHupiReturnUrl','order','BAD_REQUEST','InjectRepository','__param','23723dOOoMs','pid','订单不存在!','keys','default','defineProperty','object','epay\x20--->\x20res:\x20','failed','payPlatform','version','clientip','notifyWeChat','userBalanceService','importDynamic','HttpException','queryMpay','metadata','用户openId:\x20','query','https://api.xunhupay.com/payment/query.html','payer','type','createHash','update','notify','nonce_str','__metadata','toString','h5_info','5280336tgfcGa','status:\x20','__decorate','payEpayNotifyUrl','notifyMpay','payWeChatPublicKey','notifyEpay','356onpEfB','post','CramiPackageEntity','hex','transactions_native','trade_order_id','money','createRandomNonceStr','findOne','MD5','env','name','addBalanceToOrder','wechat-pay:\x20','affected','response','design:paramtypes','payMpayReturnUrl','getConfigs','校验签名通过','digest','total','sort','payWeChatMchId','payWeChatH5Name','log','Injectable','payMpay','https://api.xunhupay.com/payment/do.html','payHupiSecret','out_trade_order','@nestjs/common','cramiPackageEntity','支付请求失败:\x20','transactions_jsapi','payType:\x20','function','支付通知验证失败:\x20','8035Equvmp','time','goodsId','orderEntity','payMpayApiQueryUrl','total_fee','error:\x20','title','UserBalanceService','status','message','typeorm','TRADE_SUCCESS','axios','payEpayApiPayUrl','length','decorate','crypto','join','onModuleInit','transactions_h5','sign','HttpStatus','2420628wZeIsE','hash','1.1','userService','Repository','SERIAL_NO','payHupiAppId','queryHupi','resource','out_trade_no','scene_info','payWeChatNotifyUrl','md5','微信支付通知params:\x20','epay','payWeChat','__esModule','SUCCESS','811322eBTZlm','wxpay','queryWeChat','key','payWeChatPrivateKey','notify_url','payEpayApiQueryUrl','notifyHupi','2032wynxyb','appid','queryEpay','jsapi支付结果返回值:\x20','payMpayApiPayUrl','jsapi','payEpay','act','wechatpay-node-v3','payMpayNotifyUrl','device','order_no','校验签名','payWeChatH5Url'];_0x7c04=function(){return _0x20dfa5;};return _0x7c04();}var __decorate=this&&this[_0x18c43b(0x142)]||function(_0x259123,_0x480140,_0x257871,_0x233e1e){const _0x50b5e1=_0x18c43b;var _0x37d777=arguments[_0x50b5e1(0xca)],_0x14d852=_0x37d777<0x3?_0x480140:_0x233e1e===null?_0x233e1e=Object['getOwnPropertyDescriptor'](_0x480140,_0x257871):_0x233e1e,_0x3fc248;if(typeof Reflect===_0x50b5e1(0x128)&&typeof Reflect[_0x50b5e1(0xcb)]===_0x50b5e1(0xb9))_0x14d852=Reflect['decorate'](_0x259123,_0x480140,_0x257871,_0x233e1e);else{for(var _0x3cf3c9=_0x259123[_0x50b5e1(0xca)]-0x1;_0x3cf3c9>=0x0;_0x3cf3c9--)if(_0x3fc248=_0x259123[_0x3cf3c9])_0x14d852=(_0x37d777<0x3?_0x3fc248(_0x14d852):_0x37d777>0x3?_0x3fc248(_0x480140,_0x257871,_0x14d852):_0x3fc248(_0x480140,_0x257871))||_0x14d852;}return _0x37d777>0x3&&_0x14d852&&Object[_0x50b5e1(0x127)](_0x480140,_0x257871,_0x14d852),_0x14d852;},__metadata=this&&this[_0x18c43b(0x13d)]||function(_0x370e38,_0x43ecfa){const _0x216497=_0x18c43b;if(typeof Reflect===_0x216497(0x128)&&typeof Reflect['metadata']===_0x216497(0xb9))return Reflect[_0x216497(0x133)](_0x370e38,_0x43ecfa);},__param=this&&this[_0x18c43b(0x121)]||function(_0x1c7e12,_0x1f9b89){return function(_0x55bf14,_0x20ded8){_0x1f9b89(_0x55bf14,_0x20ded8,_0x1c7e12);};};Object['defineProperty'](exports,_0x18c43b(0xe2),{'value':!![]}),exports[_0x18c43b(0x11b)]=void 0x0;const typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x18c43b(0xc6)),common_1=require(_0x18c43b(0xb4)),crypto=require(_0x18c43b(0xcc)),axios_1=require(_0x18c43b(0xc8)),order_entity_1=require(_0x18c43b(0x102)),cramiPackage_entity_1=require('../crami/cramiPackage.entity'),userBalance_service_1=require('../userBalance/userBalance.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),utils_1=require('../../common/utils'),user_service_1=require(_0x18c43b(0x118));let PayService=class PayService{constructor(_0x35fb7a,_0x4f410e,_0x2d1d3d,_0x1d26fc,_0x393315){const _0x40d455=_0x18c43b;this[_0x40d455(0xb5)]=_0x35fb7a,this[_0x40d455(0xbe)]=_0x4f410e,this[_0x40d455(0x12f)]=_0x2d1d3d,this[_0x40d455(0xff)]=_0x1d26fc,this[_0x40d455(0xd5)]=_0x393315;}async[_0x18c43b(0xce)](){const _0x5c5183=_0x18c43b,_0x3fefaa=await(0x0,utils_1[_0x5c5183(0x130)])(_0x5c5183(0xf4));this['WxPay']=(_0x3fefaa===null||_0x3fefaa===void 0x0?void 0x0:_0x3fefaa[_0x5c5183(0x126)])?_0x3fefaa[_0x5c5183(0x126)]:_0x3fefaa;}async[_0x18c43b(0x13b)](_0x1cede1){const _0x40f358=_0x18c43b;if(_0x1cede1[_0x40f358(0xfa)]==_0x40f358(0xe0))return this[_0x40f358(0x146)](_0x1cede1);if(_0x1cede1['attach']==_0x40f358(0x10e))return this[_0x40f358(0xeb)](_0x1cede1);if(typeof _0x1cede1[_0x40f358(0xda)]=='object')return this[_0x40f358(0x12e)](_0x1cede1);return this[_0x40f358(0x144)](_0x1cede1);}async[_0x18c43b(0x112)](_0x57c97b,_0x5adda2,_0x387262=_0x18c43b(0xe5)){const _0x4c3bde=_0x18c43b,_0x2516d8=await this['orderEntity'][_0x4c3bde(0x9d)]({'where':{'userId':_0x57c97b,'orderId':_0x5adda2}});if(!_0x2516d8)throw new common_1[(_0x4c3bde(0x131))](_0x4c3bde(0x124),common_1[_0x4c3bde(0xd1)][_0x4c3bde(0x11f)]);const _0x5d1105=await this['cramiPackageEntity']['findOne']({'where':{'id':_0x2516d8['goodsId']}});if(!_0x5d1105)throw new common_1[(_0x4c3bde(0x131))](_0x4c3bde(0x101),common_1[_0x4c3bde(0xd1)][_0x4c3bde(0x11f)]);console['log']('本次支付类型:\x20',_0x2516d8[_0x4c3bde(0x12b)]);try{if(_0x2516d8[_0x4c3bde(0x12b)]==_0x4c3bde(0x106))return this['payWeChat'](_0x57c97b,_0x5adda2,_0x387262);if(_0x2516d8[_0x4c3bde(0x12b)]==_0x4c3bde(0xe0))return this[_0x4c3bde(0xf2)](_0x57c97b,_0x5adda2,_0x387262);if(_0x2516d8[_0x4c3bde(0x12b)]=='mpay')return this[_0x4c3bde(0xb0)](_0x57c97b,_0x5adda2,_0x387262);if(_0x2516d8['payPlatform']==_0x4c3bde(0x10e))return this[_0x4c3bde(0x113)](_0x57c97b,_0x5adda2,_0x387262);}catch(_0x6fa963){console['log'](_0x4c3bde(0xb6),_0x6fa963);throw new common_1[(_0x4c3bde(0x131))]('支付请求失败!',common_1['HttpStatus'][_0x4c3bde(0x11f)]);}}async[_0x18c43b(0x135)](_0x54a6ba){const _0x22cb15=_0x18c43b,_0x444db8=await this[_0x22cb15(0xbe)]['findOne']({'where':{'orderId':_0x54a6ba}});if(!_0x444db8)throw new common_1[(_0x22cb15(0x131))](_0x22cb15(0x124),common_1['HttpStatus']['BAD_REQUEST']);return _0x444db8;}async[_0x18c43b(0xeb)](_0x461fe7){const _0x14ead0=_0x18c43b,_0x1c040b=await this[_0x14ead0(0xff)]['getConfigs']([_0x14ead0(0xb2)]),_0x5447d3=_0x461fe7['hash'];delete _0x461fe7[_0x14ead0(0xd3)];if(this[_0x14ead0(0xd0)](_0x461fe7,_0x1c040b)!=_0x5447d3)return _0x14ead0(0x12a);const _0x29568d=await this[_0x14ead0(0xbe)][_0x14ead0(0x9d)]({'where':{'orderId':_0x461fe7[_0x14ead0(0x14c)],'status':0x0}});if(!_0x29568d)return _0x14ead0(0x12a);await this[_0x14ead0(0x12f)]['addBalanceToOrder'](_0x29568d);const _0x356414=await this[_0x14ead0(0xbe)][_0x14ead0(0x13a)]({'orderId':_0x461fe7['trade_order_id']},{'status':0x1,'paydAt':new Date()});if(_0x356414[_0x14ead0(0xa3)]!=0x1)return _0x14ead0(0x12a);return'success';}async[_0x18c43b(0x113)](_0x165431,_0x38c36d,_0x3c9266='wxpay'){const _0x33911a=_0x18c43b,_0x130d80=await this[_0x33911a(0xbe)][_0x33911a(0x9d)]({'where':{'userId':_0x165431,'orderId':_0x38c36d}});if(!_0x130d80)throw new common_1[(_0x33911a(0x131))]('订单不存在!',common_1[_0x33911a(0xd1)]['BAD_REQUEST']);const _0x584284=await this['cramiPackageEntity'][_0x33911a(0x9d)]({'where':{'id':_0x130d80['goodsId']}});if(!_0x584284)throw new common_1['HttpException'](_0x33911a(0x101),common_1[_0x33911a(0xd1)]['BAD_REQUEST']);const {payHupiAppId:_0x4a71a8,payHupiSecret:_0x4461d2,payHupiNotifyUrl:_0x274e5c,payHupiReturnUrl:_0x5c870b,payHupiGatewayUrl:_0xdb3031}=await this['globalConfigService'][_0x33911a(0xa7)]([_0x33911a(0xd8),_0x33911a(0xb2),_0x33911a(0x11c),_0x33911a(0x11d),'payHupiGatewayUrl']),_0x5350a7={};_0x5350a7[_0x33911a(0x12c)]='1.1',_0x5350a7[_0x33911a(0xed)]=_0x4a71a8,_0x5350a7[_0x33911a(0xbc)]=(Date[_0x33911a(0x110)]()/0x3e8)['toFixed'](0x0),_0x5350a7[_0x33911a(0x13c)]=(0x0,utils_1[_0x33911a(0x14e)])(0x20),_0x5350a7['trade_order_id']=_0x38c36d,_0x5350a7[_0x33911a(0xc2)]=_0x584284[_0x33911a(0xa0)],_0x5350a7[_0x33911a(0xc0)]=_0x130d80['total'],_0x5350a7['notify_url']=_0x274e5c,_0x5350a7[_0x33911a(0x116)]=_0x5c870b,_0x5350a7[_0x33911a(0xfc)]='hupi',_0x5350a7['hash']=this[_0x33911a(0xd0)](_0x5350a7,_0x4461d2);const {data:{errcode:_0x35b200,errmsg:_0x3157b5,url_qrcode:_0x4226b6,url:_0x212f4e}}=await axios_1[_0x33911a(0x126)][_0x33911a(0x148)](_0xdb3031||_0x33911a(0xb1),_0x5350a7);if(_0x35b200!=0x0)throw new common_1[(_0x33911a(0x131))](_0x3157b5,common_1[_0x33911a(0xd1)][_0x33911a(0x11f)]);return{'url_qrcode':_0x4226b6,'url':_0x212f4e};}async[_0x18c43b(0xd9)](_0x31a6ed){const _0x1875b4=_0x18c43b,{payHupiAppId:_0x52b80d,payHupiSecret:_0x87f58f}=await this[_0x1875b4(0xff)]['getConfigs']([_0x1875b4(0xd8),_0x1875b4(0xb2)]),_0x21deff={};_0x21deff[_0x1875b4(0x12c)]=_0x1875b4(0xd4),_0x21deff[_0x1875b4(0xed)]=_0x52b80d,_0x21deff[_0x1875b4(0xbc)]=(Date[_0x1875b4(0x110)]()/0x3e8)['toFixed'](0x0),_0x21deff['nonce_str']=(0x0,utils_1['createRandomNonceStr'])(0x20),_0x21deff[_0x1875b4(0xb3)]=_0x31a6ed,_0x21deff[_0x1875b4(0xd3)]=this[_0x1875b4(0xd0)](_0x21deff,_0x87f58f);const {data:{errcode:_0x8f9860,errmsg:_0x534087,data:_0x3c28e0}}=await axios_1[_0x1875b4(0x126)]['post'](_0x1875b4(0x136),_0x21deff);if(_0x8f9860!=0x0)throw new common_1[(_0x1875b4(0x131))](_0x534087,common_1[_0x1875b4(0xd1)][_0x1875b4(0x11f)]);return _0x3c28e0;}async[_0x18c43b(0x146)](_0x24b272){const _0x816e4=_0x18c43b,_0x296b81=_0x24b272['sign'];delete _0x24b272[_0x816e4(0xd0)],delete _0x24b272[_0x816e4(0x115)];const _0x271082=await this[_0x816e4(0xff)][_0x816e4(0xa7)]([_0x816e4(0x11a)]);if(this['sign'](_0x24b272,_0x271082)!=_0x296b81)return _0x816e4(0x12a);console[_0x816e4(0xae)](_0x816e4(0xa8));const _0x5bb9b1=await this['orderEntity'][_0x816e4(0x9d)]({'where':{'orderId':_0x24b272[_0x816e4(0xdb)],'status':0x0}});if(!_0x5bb9b1)return _0x816e4(0x12a);const _0x39e769=_0x24b272['trade_status']=='TRADE_SUCCESS'?0x1:0x2,_0x439886=await this[_0x816e4(0xbe)][_0x816e4(0x13a)]({'orderId':_0x24b272['out_trade_no']},{'status':_0x39e769,'paydAt':new Date()});_0x39e769===0x1&&await this[_0x816e4(0x12f)]['addBalanceToOrder'](_0x5bb9b1);if(_0x439886['affected']!=0x1)return'failed';return _0x816e4(0x10f);}async[_0x18c43b(0xf2)](_0x3d5060,_0x1a55f6,_0x2a3c4d=_0x18c43b(0x114)){const _0xce2c3a=_0x18c43b,_0x45ad6e=await this['orderEntity']['findOne']({'where':{'userId':_0x3d5060,'orderId':_0x1a55f6}});if(!_0x45ad6e)throw new common_1[(_0xce2c3a(0x131))]('订单不存在!',common_1[_0xce2c3a(0xd1)][_0xce2c3a(0x11f)]);const _0x27851d=await this[_0xce2c3a(0xb5)]['findOne']({'where':{'id':_0x45ad6e[_0xce2c3a(0xbd)]}});if(!_0x27851d)throw new common_1['HttpException'](_0xce2c3a(0x101),common_1[_0xce2c3a(0xd1)][_0xce2c3a(0x11f)]);const {payEpayPid:_0x84a857,payEpaySecret:_0x57af77,payEpayNotifyUrl:_0x554750,payEpayReturnUrl:_0x15971b,payEpayApiPayUrl:_0xa11311}=await this[_0xce2c3a(0xff)]['getConfigs']([_0xce2c3a(0x119),_0xce2c3a(0x11a),_0xce2c3a(0x143),'payEpayReturnUrl',_0xce2c3a(0xc9)]);let _0x1e548c;_0x84a857[_0xce2c3a(0xca)]<=0x10?_0x1e548c=Number(_0x84a857):_0x1e548c=BigInt(_0x84a857);const _0x4bc6b2={};_0x4bc6b2['pid']=_0x1e548c,_0x4bc6b2[_0xce2c3a(0x138)]=_0x2a3c4d,_0x4bc6b2[_0xce2c3a(0xdb)]=_0x1a55f6,_0x4bc6b2[_0xce2c3a(0xa0)]=_0x27851d['name'],_0x4bc6b2[_0xce2c3a(0x14d)]=_0x45ad6e['total'],_0x4bc6b2[_0xce2c3a(0x12d)]=_0xce2c3a(0xfe),_0x4bc6b2[_0xce2c3a(0xf6)]='pc',_0x4bc6b2['notify_url']=_0x554750,_0x4bc6b2['return_url']=_0x15971b,_0x4bc6b2[_0xce2c3a(0xfa)]=_0xce2c3a(0xe0),_0x4bc6b2['sign']=this[_0xce2c3a(0xd0)](_0x4bc6b2,_0x57af77),_0x4bc6b2[_0xce2c3a(0x115)]=_0xce2c3a(0x9e);const _0x3c473b=new URLSearchParams(_0x4bc6b2)[_0xce2c3a(0x13e)](),_0x1a9e10=_0xa11311+'?'+_0x3c473b;if(_0xa11311['includes']('submit.php'))return{'url_qrcode':null,'redirectUrl':_0x1a9e10,'channel':_0x2a3c4d,'isRedirect':!![]};else{const _0x26f863=await axios_1[_0xce2c3a(0x126)]['get'](_0xa11311,{'params':_0x4bc6b2});console[_0xce2c3a(0xae)](_0xce2c3a(0x129),_0x26f863['data']);const {data:{code:_0x44ca63,msg:_0x6e262e,qrcode:_0x2f71b2}}=_0x26f863;if(_0x44ca63!=0x1)throw new common_1[(_0xce2c3a(0x131))](_0x6e262e,common_1[_0xce2c3a(0xd1)][_0xce2c3a(0x11f)]);return{'url_qrcode':_0x2f71b2,'redirectUrl':null,'channel':_0x2a3c4d,'isRedirect':![]};}}async[_0x18c43b(0xee)](_0x220f64){const _0x27837a=_0x18c43b,{payEpayPid:_0x25b000,payEpaySecret:_0x55542b,payEpayApiQueryUrl:_0x11eeff}=await this[_0x27837a(0xff)][_0x27837a(0xa7)](['payEpayPid',_0x27837a(0x11a),_0x27837a(0xea)]),_0x4d2085={};_0x4d2085[_0x27837a(0xf3)]=_0x27837a(0x11e),_0x4d2085['out_trade_no']=_0x220f64,_0x4d2085[_0x27837a(0x123)]=_0x25b000,_0x4d2085[_0x27837a(0xe7)]=_0x55542b;const {data:{code:_0x1cf936,msg:_0xbf4de0,data:_0x337787}}=await axios_1[_0x27837a(0x126)]['get'](_0x11eeff,{'params':_0x4d2085});if(_0x1cf936!=0x1)throw new common_1[(_0x27837a(0x131))](_0xbf4de0,common_1[_0x27837a(0xd1)][_0x27837a(0x11f)]);return _0x337787;}async[_0x18c43b(0x144)](_0x4bbd35){const _0x1f3f1a=_0x18c43b,_0x5a131d=_0x4bbd35[_0x1f3f1a(0xd0)];delete _0x4bbd35[_0x1f3f1a(0xd0)],delete _0x4bbd35['sign_type'];const _0x57844b=await this[_0x1f3f1a(0xff)][_0x1f3f1a(0xa7)]([_0x1f3f1a(0x105)]);console[_0x1f3f1a(0xae)](_0x1f3f1a(0xf8));if(this[_0x1f3f1a(0xd0)](_0x4bbd35,_0x57844b)!=_0x5a131d)return _0x1f3f1a(0x12a);console[_0x1f3f1a(0xae)](_0x1f3f1a(0xa8));const _0x2582be=await this['orderEntity'][_0x1f3f1a(0x9d)]({'where':{'orderId':_0x4bbd35[_0x1f3f1a(0xdb)],'status':0x0}});if(!_0x2582be)return _0x1f3f1a(0x12a);const _0x277bbf=_0x4bbd35[_0x1f3f1a(0x10b)]==_0x1f3f1a(0xc7)?0x1:0x2;console[_0x1f3f1a(0xae)](_0x1f3f1a(0x141),_0x277bbf);const _0x26af88=await this['orderEntity']['update']({'orderId':_0x4bbd35[_0x1f3f1a(0xdb)]},{'status':_0x277bbf,'paydAt':new Date()});_0x277bbf===0x1&&await this[_0x1f3f1a(0x12f)][_0x1f3f1a(0xa1)](_0x2582be);if(_0x26af88[_0x1f3f1a(0xa3)]!=0x1)return'failed';return _0x1f3f1a(0x10f);}async['payMpay'](_0x3ec810,_0x43f5cd,_0x149c8d=_0x18c43b(0xe5)){const _0x1cd02d=_0x18c43b,_0x424bdf=await this['orderEntity'][_0x1cd02d(0x9d)]({'where':{'userId':_0x3ec810,'orderId':_0x43f5cd}});if(!_0x424bdf)throw new common_1[(_0x1cd02d(0x131))](_0x1cd02d(0x124),common_1[_0x1cd02d(0xd1)][_0x1cd02d(0x11f)]);const _0x17e76a=await this[_0x1cd02d(0xb5)][_0x1cd02d(0x9d)]({'where':{'id':_0x424bdf['goodsId']}});if(!_0x17e76a)throw new common_1[(_0x1cd02d(0x131))](_0x1cd02d(0x101),common_1['HttpStatus'][_0x1cd02d(0x11f)]);const {payMpayPid:_0x325a3c,payMpaySecret:_0x1738c7,payMpayNotifyUrl:_0x46aec9,payMpayReturnUrl:_0xd93b39,payMpayApiPayUrl:_0x129921}=await this['globalConfigService'][_0x1cd02d(0xa7)]([_0x1cd02d(0x100),_0x1cd02d(0x105),_0x1cd02d(0xf5),_0x1cd02d(0xa6),_0x1cd02d(0xf0)]),_0x2c618f={};_0x2c618f[_0x1cd02d(0x123)]=Number(_0x325a3c),_0x2c618f[_0x1cd02d(0x138)]=_0x149c8d,_0x2c618f[_0x1cd02d(0xdb)]=_0x43f5cd,_0x2c618f['name']=_0x17e76a['name'],_0x2c618f[_0x1cd02d(0x14d)]=_0x424bdf[_0x1cd02d(0xaa)],_0x2c618f[_0x1cd02d(0xe9)]=_0x46aec9,_0x2c618f[_0x1cd02d(0x116)]=_0xd93b39,_0x2c618f['sign']=this[_0x1cd02d(0xd0)](_0x2c618f,_0x1738c7),_0x2c618f['sign_type']=_0x1cd02d(0x9e);const _0x5e138a=new URLSearchParams(_0x2c618f)[_0x1cd02d(0x13e)](),_0x140590=_0x129921+'?'+_0x5e138a;return{'url_qrcode':null,'redirectUrl':_0x140590,'channel':_0x149c8d,'isRedirect':!![]};const _0x483b68=await axios_1[_0x1cd02d(0x126)]['get'](_0x129921,{'params':_0x2c618f});}async[_0x18c43b(0x132)](_0x4d74bb){const _0x4abb14=_0x18c43b,{payMpayApiQueryUrl:_0x488a19}=await this[_0x4abb14(0xff)]['getConfigs']([_0x4abb14(0x100),_0x4abb14(0x105),_0x4abb14(0xbf)]),_0x1526c6={};_0x1526c6[_0x4abb14(0x138)]=0x2,_0x1526c6[_0x4abb14(0xf7)]=_0x4d74bb;const {data:{code:_0x4f7027,msg:_0x393548,data:_0x41c1d3}}=await axios_1[_0x4abb14(0x126)][_0x4abb14(0x10c)](_0x488a19,{'params':_0x1526c6});if(_0x4f7027!=0x1)throw new common_1[(_0x4abb14(0x131))](_0x393548,common_1[_0x4abb14(0xd1)][_0x4abb14(0x11f)]);return _0x41c1d3;}async[_0x18c43b(0x12e)](_0x38551f){const _0x43f551=_0x18c43b;console['log'](_0x43f551(0xdf),_0x38551f);const {payWeChatAppId:_0x2254f3,payWeChatMchId:_0x553c78,payWeChatSecret:_0x321fde,payWeChatPublicKey:_0x10732e,payWeChatPrivateKey:_0x44c7b2}=await this[_0x43f551(0xff)][_0x43f551(0xa7)]([_0x43f551(0x117),_0x43f551(0xac),'payWeChatSecret','payWeChatPublicKey',_0x43f551(0xe8)]),_0x3df71a=new this[(_0x43f551(0x109))]({'appid':_0x2254f3,'mchid':_0x553c78,'publicKey':_0x10732e,'privateKey':_0x44c7b2});try{if(_0x38551f[_0x43f551(0x108)]=='TRANSACTION.SUCCESS'){const {ciphertext:_0x231e78,associated_data:_0x8786ee,nonce:_0x43080f}=_0x38551f[_0x43f551(0xda)],_0x1295a0=_0x3df71a['decipher_gcm'](_0x231e78,_0x8786ee,_0x43080f,_0x321fde),_0x31a016=await this[_0x43f551(0xbe)][_0x43f551(0x9d)]({'where':{'orderId':_0x1295a0['out_trade_no'],'status':0x0}});if(!_0x31a016)return _0x43f551(0x12a);const _0x23a6a0=_0x1295a0[_0x43f551(0x10a)]==_0x43f551(0xe3)?0x1:0x2,_0x2360ee=await this[_0x43f551(0xbe)][_0x43f551(0x13a)]({'orderId':_0x1295a0[_0x43f551(0xdb)]},{'status':_0x23a6a0,'paydAt':new Date()});_0x23a6a0===0x1&&await this['userBalanceService'][_0x43f551(0xa1)](_0x31a016);if(_0x2360ee[_0x43f551(0xa3)]!=0x1)return'failed';}return _0x43f551(0x10f);}catch(_0x406e95){return console[_0x43f551(0xae)](_0x43f551(0xc1),_0x406e95),console[_0x43f551(0xae)](_0x43f551(0xba),_0x406e95),_0x43f551(0x12a);}}async[_0x18c43b(0xe1)](_0x994e24,_0x3f7c41,_0x3ffa0e='native'){const _0x368eb7=_0x18c43b;var _0x3dd370,_0x5d2ccb,_0x304858;console['log'](_0x368eb7(0xb8),_0x3ffa0e);const _0xf43cfd=await this[_0x368eb7(0xbe)][_0x368eb7(0x9d)]({'where':{'userId':_0x994e24,'orderId':_0x3f7c41}});if(!_0xf43cfd)throw new common_1[(_0x368eb7(0x131))](_0x368eb7(0x124),common_1[_0x368eb7(0xd1)][_0x368eb7(0x11f)]);const _0xef785c=await this[_0x368eb7(0xb5)]['findOne']({'where':{'id':_0xf43cfd[_0x368eb7(0xbd)]}});if(!_0xef785c)throw new common_1[(_0x368eb7(0x131))](_0x368eb7(0x101),common_1[_0x368eb7(0xd1)][_0x368eb7(0x11f)]);const {payWeChatAppId:_0x1476e6,payWeChatMchId:_0x177729,payWeChatPublicKey:_0x33f40e,payWeChatPrivateKey:_0xec9b79,payWeChatNotifyUrl:_0x1e2918,payWeChatH5Name:_0x31408d,payWeChatH5Url:_0x3ca0fc}=await this[_0x368eb7(0xff)][_0x368eb7(0xa7)]([_0x368eb7(0x117),_0x368eb7(0xac),_0x368eb7(0x145),_0x368eb7(0xe8),_0x368eb7(0xdd),_0x368eb7(0xad),_0x368eb7(0xf9)]);console[_0x368eb7(0xae)](_0x368eb7(0x117),_0x1476e6),console[_0x368eb7(0xae)](_0x368eb7(0xac),_0x177729),console[_0x368eb7(0xae)](_0x368eb7(0x145),_0x33f40e),console[_0x368eb7(0xae)](_0x368eb7(0xe8),_0xec9b79);const _0x15c1ae=new this[(_0x368eb7(0x109))]({'appid':_0x1476e6,'mchid':_0x177729,'publicKey':_0x33f40e,'privateKey':_0xec9b79,'serial_no':process[_0x368eb7(0x9f)][_0x368eb7(0xd7)]}),_0x7594d0={'appid':_0x1476e6,'mchid':_0x177729,'description':_0xef785c[_0x368eb7(0xa0)],'out_trade_no':_0x3f7c41,'notify_url':_0x1e2918,'amount':{'total':Number(_0xf43cfd[_0x368eb7(0xaa)]*0x64)},'scene_info':{'payer_client_ip':_0x368eb7(0xfe)}};console[_0x368eb7(0xae)](_0x368eb7(0xa2),_0x7594d0);if(_0x3ffa0e=='h5'){_0x7594d0[_0x368eb7(0xdc)][_0x368eb7(0x13f)]={'type':_0x368eb7(0x10d),'app_name':_0x31408d,'app_url':_0x3ca0fc};const _0x469ead=await _0x15c1ae[_0x368eb7(0xcf)](_0x7594d0);if(_0x469ead[_0x368eb7(0xc4)]===0x193){const _0x4dfb10=(_0x304858=(_0x5d2ccb=(_0x3dd370=_0x469ead===null||_0x469ead===void 0x0?void 0x0:_0x469ead['errRaw'])===null||_0x3dd370===void 0x0?void 0x0:_0x3dd370[_0x368eb7(0xa4)])===null||_0x5d2ccb===void 0x0?void 0x0:_0x5d2ccb['text'])===null||_0x304858===void 0x0?void 0x0:_0x304858[_0x368eb7(0xc5)];throw new common_1['HttpException']((_0x469ead===null||_0x469ead===void 0x0?void 0x0:_0x469ead[_0x368eb7(0xc5)])||'微信H5支付失败！',common_1[_0x368eb7(0xd1)][_0x368eb7(0x11f)]);}const {h5_url:_0x423e80}=_0x469ead;return{'url':_0x423e80};}if(_0x3ffa0e==_0x368eb7(0xf1)){const _0x573ac0=await this[_0x368eb7(0xd5)]['getOpenIdByUserId'](_0x994e24);console[_0x368eb7(0xae)](_0x368eb7(0x134),_0x573ac0),_0x7594d0[_0x368eb7(0x137)]={'openid':_0x573ac0};const _0x14bb96=await _0x15c1ae[_0x368eb7(0xb7)](_0x7594d0);return console[_0x368eb7(0xae)](_0x368eb7(0xef),_0x14bb96),_0x14bb96;}if(_0x3ffa0e==_0x368eb7(0xfb)){const _0x179b2c=await _0x15c1ae[_0x368eb7(0x14b)](_0x7594d0),{data:_0x5f59e8,status:_0x441549}=_0x179b2c;if(_0x441549!==0xc8)throw new common_1[(_0x368eb7(0x131))]('获取支付二维码失败',_0x179b2c);const {code_url:_0x40336c}=_0x5f59e8;return!_0x40336c&&console[_0x368eb7(0xae)](_0x368eb7(0x111),_0x179b2c),{'url_qrcode':_0x40336c,'isRedirect':![]};}throw new common_1[(_0x368eb7(0x131))](_0x368eb7(0x103),common_1[_0x368eb7(0xd1)]['BAD_REQUEST']);}async[_0x18c43b(0xe6)](_0x2400b1){const _0x2df848=_0x18c43b,{payWeChatAppId:_0x2268a2,payWeChatMchId:_0x5bea8f,payWeChatPublicKey:_0x3c46ef,payWeChatPrivateKey:_0x45b0ed,payWeChatNotifyUrl:_0x143238,payWeChatH5Name:_0x1030bd,payWeChatH5Url:_0x525ca2}=await this[_0x2df848(0xff)][_0x2df848(0xa7)](['payWeChatAppId',_0x2df848(0xac),_0x2df848(0x145),_0x2df848(0xe8)]),_0x46f981=new this['WxPay']({'appid':_0x2268a2,'mchid':_0x5bea8f,'publicKey':_0x3c46ef,'privateKey':_0x45b0ed}),_0x3f62a0=await _0x46f981[_0x2df848(0x135)]({'out_trade_no':_0x2400b1});return _0x3f62a0;}[_0x18c43b(0xd0)](_0xa67bce,_0x4c509f){const _0x354890=_0x18c43b,_0x7995c8=Object[_0x354890(0x125)](_0xa67bce)[_0x354890(0xab)]()['map'](_0x176fe8=>_0x176fe8+'='+_0xa67bce[_0x176fe8])[_0x354890(0xcd)]('&')+_0x4c509f;return crypto[_0x354890(0x139)](_0x354890(0xde))['update'](_0x7995c8)[_0x354890(0xa9)](_0x354890(0x14a));}};PayService=__decorate([(0x0,common_1[_0x18c43b(0xaf)])(),__param(0x0,(0x0,typeorm_1[_0x18c43b(0x120)])(cramiPackage_entity_1[_0x18c43b(0x149)])),__param(0x1,(0x0,typeorm_1[_0x18c43b(0x120)])(order_entity_1['OrderEntity'])),__metadata(_0x18c43b(0xa5),[typeorm_2[_0x18c43b(0xd6)],typeorm_2['Repository'],userBalance_service_1[_0x18c43b(0xc3)],globalConfig_service_1['GlobalConfigService'],user_service_1[_0x18c43b(0xfd)]])],PayService),exports[_0x18c43b(0x11b)]=PayService;