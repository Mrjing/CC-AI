'use strict';const _0x75e4df=_0x348e;(function(_0x31b29f,_0x576195){const _0x235068=_0x348e,_0x558f89=_0x31b29f();while(!![]){try{const _0xfc4100=-parseInt(_0x235068(0x121))/0x1*(parseInt(_0x235068(0x138))/0x2)+-parseInt(_0x235068(0x140))/0x3*(parseInt(_0x235068(0x114))/0x4)+parseInt(_0x235068(0xab))/0x5+-parseInt(_0x235068(0x100))/0x6*(parseInt(_0x235068(0xc2))/0x7)+parseInt(_0x235068(0xf4))/0x8*(-parseInt(_0x235068(0xef))/0x9)+parseInt(_0x235068(0x115))/0xa+parseInt(_0x235068(0xf6))/0xb;if(_0xfc4100===_0x576195)break;else _0x558f89['push'](_0x558f89['shift']());}catch(_0x12f4bc){_0x558f89['push'](_0x558f89['shift']());}}}(_0x4f61,0x5d7ba));var __decorate=this&&this['__decorate']||function(_0xaaa73e,_0x313be5,_0x26aeeb,_0x222a55){const _0x36a677=_0x348e;var _0x14ed95=arguments[_0x36a677(0x10c)],_0x4047b0=_0x14ed95<0x3?_0x313be5:_0x222a55===null?_0x222a55=Object[_0x36a677(0xec)](_0x313be5,_0x26aeeb):_0x222a55,_0x2a9398;if(typeof Reflect==='object'&&typeof Reflect[_0x36a677(0x11e)]===_0x36a677(0x122))_0x4047b0=Reflect[_0x36a677(0x11e)](_0xaaa73e,_0x313be5,_0x26aeeb,_0x222a55);else{for(var _0x363544=_0xaaa73e[_0x36a677(0x10c)]-0x1;_0x363544>=0x0;_0x363544--)if(_0x2a9398=_0xaaa73e[_0x363544])_0x4047b0=(_0x14ed95<0x3?_0x2a9398(_0x4047b0):_0x14ed95>0x3?_0x2a9398(_0x313be5,_0x26aeeb,_0x4047b0):_0x2a9398(_0x313be5,_0x26aeeb))||_0x4047b0;}return _0x14ed95>0x3&&_0x4047b0&&Object[_0x36a677(0xe5)](_0x313be5,_0x26aeeb,_0x4047b0),_0x4047b0;},__metadata=this&&this[_0x75e4df(0xd7)]||function(_0x56b48e,_0x5c2c27){const _0x3e3090=_0x75e4df;if(typeof Reflect===_0x3e3090(0x148)&&typeof Reflect[_0x3e3090(0xca)]===_0x3e3090(0x122))return Reflect[_0x3e3090(0xca)](_0x56b48e,_0x5c2c27);},__param=this&&this[_0x75e4df(0xcf)]||function(_0x1fe0d4,_0x184664){return function(_0x1dd215,_0x1f1b4d){_0x184664(_0x1dd215,_0x1f1b4d,_0x1fe0d4);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x75e4df(0xbb)]=void 0x0;function _0x348e(_0x265acd,_0x16d0e6){const _0x4f6158=_0x4f61();return _0x348e=function(_0x348e4c,_0x298fc9){_0x348e4c=_0x348e4c-0x93;let _0x4decc9=_0x4f6158[_0x348e4c];return _0x4decc9;},_0x348e(_0x265acd,_0x16d0e6);}function _0x4f61(){const _0x533cc6=['11829uVdTKl','inviteCode','createUserAndVerifycation','UserStatusErrMsg','WhiteListEntity','getUserById','InjectRepository','client','object','createHash','queryOneUserInfo','重置密码失败！','UserEntity','saveRecordRechargeLog','userBalanceService','@nestjs/typeorm','../globalConfig/globalConfig.service','registerBaseUrl','当前用户信息失效、请重新登录！','当前密码错误！','Not','createUserFromOpenId','getUserFromOpenId','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','maskEmail','不可将用户置为未激活状态！','affected','sign','registerVerifyExpir','registerIp','log','register','UserBalanceService','当前账户不存在！','2400755Cxvrsb','queryUserBalance','visitor','../globalConfig/config.entity','registerVerifyEmailTitle','lastLoginIp','balanceInfo','md5','HttpStatus','password','Injectable','用户名或者邮箱已被注册！','GlobalConfigService','userId','该微信已绑定其他账号！','Repository','UserService','getConfigs','resetUserPass','UNAUTHORIZED','findAndCount','bcryptjs','../../common/constants/verification.constant','98eLMgSf','configMap:\x20','生成邀请码失败，请重新试一次吧！','startsWith','registerVerifyEmailFrom','whiteListEntity','split','已生成过邀请码、请勿重复生成','metadata','userEntity','verificationService','forEach','email','__param','getUserOpenId','@nestjs/common','savaLoginIp','updateUserStatus','Like','phone','用户不存在！','__metadata','username','用户名已存在！','userDefautlAvatar','openId','design:paramtypes','bindWx','sendMail','update','LOCKED','configVal','$2a$','PENDING','getInviteRecord','defineProperty','addBalanceToUser','cloneDeep','inviteLink','updateUserPassword','queryOne','queryUserBalanceByIds','getOwnPropertyDescriptor','无效的邀请码！','Registration','54qzfYZe','status','BLACKLISTED','createdAt','queryUserInfoById','598264bIelVu','map','8304307kuyOpx','hex','getSuper','createVerification','qureyUserInfoByInviteCode','----,','VerificationService','的账号激活','email\x20response\x20\x20->\x20:\x20','isBindWx','285978JLYDcL','获取邀请记录失败！','123456','compareSync','当前绑定用户不存在！','Connection','verifyUserPassword','恭喜您绑定成功、后续可直接扫码登录了！','error:\x20','修改用户信息失败！','../../common/utils','ConfigEntity','length','$2b$','verifyUserRegisterByPhone','../verification/verification.service','getUserStatus','UserStatusEnum','绑定微信失败、请联系管理员！','find','332HCrUVW','7119140QOCQXt','BAD_REQUEST','超级管理员不可被操作！','assign','VerificationEnum','crypto','ACTIVE','createUser','@default.com','decorate','user','findOne','1XjYFva','function','avatar','createRandomUid','hashSync','修改密码失败、请重新试试吧。','../../common/constants/balance.constant','userRecharge','role','@nestjs-modules/mailer','RechargeType','没有变更，无需更改！','digest','genInviteCode',']成功!','globalConfigService','isVerifyEmail','../../common/constants/user.constant','../chatgpt/whiteList.entity','reduce','DESC','修改用户状态失败！','save','241694iMwBIF','未激活用户不可手动变更状态！','super','HttpException','configEntity','当前手机号已注册、请勿重复注册！','用户名已存在、请更换用户名！','$2y$'];_0x4f61=function(){return _0x533cc6;};return _0x4f61();}const globalConfig_service_1=require(_0x75e4df(0x99)),user_constant_1=require(_0x75e4df(0x132)),mailer_1=require(_0x75e4df(0x12a)),verification_service_1=require(_0x75e4df(0x10f)),common_1=require(_0x75e4df(0xd1)),typeorm_1=require(_0x75e4df(0x98)),typeorm_2=require('typeorm'),user_entity_1=require('./user.entity'),bcrypt=require(_0x75e4df(0xc0)),crypto=require(_0x75e4df(0x11a)),_=require('lodash'),verification_constant_1=require(_0x75e4df(0xc1)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x75e4df(0x10a)),balance_constant_1=require(_0x75e4df(0x127)),config_entity_1=require(_0x75e4df(0xae)),whiteList_entity_1=require(_0x75e4df(0x133));let UserService=class UserService{constructor(_0x12b0fb,_0x19537a,_0x472936,_0x4e19ab,_0x30863b,_0x36e9ad,_0x5a7b77,_0x368321){const _0x36a2fe=_0x75e4df;this[_0x36a2fe(0xcb)]=_0x12b0fb,this[_0x36a2fe(0xc7)]=_0x19537a,this['connection']=_0x472936,this[_0x36a2fe(0xcc)]=_0x4e19ab,this['mailerService']=_0x30863b,this[_0x36a2fe(0x97)]=_0x36e9ad,this[_0x36a2fe(0x130)]=_0x5a7b77,this[_0x36a2fe(0x13c)]=_0x368321;}async[_0x75e4df(0x142)](_0x30333d,_0x1d67b4){const _0x398dee=_0x75e4df,{username:_0x4a8607,email:_0x4dae49,password:_0x5d09f6,invitedBy:_0x418e2d,client:client=0x0}=_0x30333d;if(_0x418e2d){const _0x40eebd=await this[_0x398dee(0xcb)][_0x398dee(0x120)]({'where':{'inviteCode':_0x418e2d}});if(!_0x40eebd)throw new common_1['HttpException'](_0x398dee(0xed),common_1[_0x398dee(0xb3)][_0x398dee(0x116)]);}const _0x3d5e61=[{'username':_0x4a8607},{'email':_0x4dae49}],_0x9e3cec=await this[_0x398dee(0xcb)]['findOne']({'where':_0x3d5e61});if(_0x9e3cec&&_0x9e3cec[_0x398dee(0xf0)]!==user_constant_1[_0x398dee(0x111)][_0x398dee(0xe3)])throw new common_1[(_0x398dee(0x13b))](_0x398dee(0xb6),common_1[_0x398dee(0xb3)]['BAD_REQUEST']);try{const _0x4e9e21=_[_0x398dee(0xe7)](_0x30333d),_0x20f09a=bcrypt['hashSync'](_0x5d09f6,0xa),_0x572112=(0x0,utils_1['getClientIp'])(_0x1d67b4);_0x4e9e21[_0x398dee(0xb4)]=_0x20f09a,_0x4e9e21[_0x398dee(0xa6)]=_0x572112,_0x4e9e21[_0x398dee(0x147)]=client;let _0x323f5d;if(!_0x9e3cec){const _0x3ad64a=await this[_0x398dee(0x130)][_0x398dee(0xbc)](['userDefautlAvatar']);_0x4e9e21[_0x398dee(0x123)]=_0x3ad64a,_0x323f5d=await this[_0x398dee(0xcb)][_0x398dee(0x137)](_0x4e9e21);}else _0x323f5d=_0x9e3cec;const _0x1b10ad=await this[_0x398dee(0x13c)][_0x398dee(0x113)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x398dee(0x131),_0x398dee(0x9a),_0x398dee(0xaf),'registerVerifyEmailDesc',_0x398dee(0xc6),_0x398dee(0xa5)])}}),_0x54ea5b=_0x1b10ad[_0x398dee(0x134)]((_0x4f99bc,_0x46dda6)=>{const _0x4fc94a=_0x398dee;return _0x4f99bc[_0x46dda6['configKey']]=_0x46dda6[_0x4fc94a(0xe1)],_0x4f99bc;},{}),_0x1d5a11=_0x54ea5b['isVerifyEmail']?Number(_0x54ea5b[_0x398dee(0x131)]):0x1;if(_0x1d5a11){const _0x5ebc79=_0x54ea5b[_0x398dee(0xa5)]?Number(_0x54ea5b[_0x398dee(0xa5)]):0x1e*0x3c,_0x5ca678=await this['verificationService'][_0x398dee(0xf9)](_0x323f5d,verification_constant_1[_0x398dee(0x119)][_0x398dee(0xee)],_0x5ebc79),{code:_0x3222bc,email:_0xdd0633,id:_0x31cd63}=_0x5ca678,{registerVerifyEmailFrom:_0x1380b7}=_0x54ea5b;console[_0x398dee(0xa7)](_0x398dee(0xc3),_0x54ea5b);const _0xfd829e=await this['mailerService'][_0x398dee(0xde)]({'to':_0xdd0633,'subject':'来自'+_0x1380b7+_0x398dee(0xfd),'template':_0x398dee(0xa8),'context':Object[_0x398dee(0x118)]({'baseUrl':_0x54ea5b[_0x398dee(0x9a)],'code':_0x3222bc,'id':_0x31cd63},_0x54ea5b)});console['log'](_0x398dee(0xfe),_0xfd829e);}else{const {username:_0x12d476,email:_0x406778,id:_0x4bf584,invitedBy:_0x1ba4ef}=_0x323f5d;await this['updateUserStatus'](_0x4bf584,user_constant_1['UserStatusEnum'][_0x398dee(0x11b)]);let _0x472956;_0x1ba4ef&&(_0x472956=await this[_0x398dee(0xfa)](_0x1ba4ef)),await this['userBalanceService']['addBalanceToNewUser'](_0x4bf584,_0x472956===null||_0x472956===void 0x0?void 0x0:_0x472956['id']);}return _0x323f5d;}catch(_0x2474b0){console['log'](_0x398dee(0x108),_0x2474b0);throw _0x2474b0;}}async[_0x75e4df(0xf8)](){const _0xe97ab8=_0x75e4df,_0x444214=await this[_0xe97ab8(0xcb)][_0xe97ab8(0x120)]({'where':{'role':'super'}});return _0x444214;}async['verifyUserCredentials'](_0x151aee){const _0x53ae98=_0x75e4df,{username:_0x15dbf8,password:_0x132143,uid:uid=0x0,phone:_0x19b0a5}=_0x151aee;let _0x4a3653=null;if(uid>0x0){_0x4a3653=await this['userEntity']['findOne']({'where':{'id':uid}});if(!_0x4a3653)throw new common_1[(_0x53ae98(0x13b))](_0x53ae98(0xaa),common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);if(_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)](_0x53ae98(0xe2))||_0x4a3653['password'][_0x53ae98(0xc5)](_0x53ae98(0x10d))||_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)]('$2y$')){if(!bcrypt[_0x53ae98(0x103)](_0x132143,_0x4a3653['password']))throw new common_1['HttpException'](_0x53ae98(0x9c),common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);}else{console[_0x53ae98(0xa7)]('----,');const _0x118b08=crypto[_0x53ae98(0x149)]('md5')[_0x53ae98(0xdf)](_0x132143)['digest'](_0x53ae98(0xf7));console[_0x53ae98(0xa7)](_0x53ae98(0xfb),_0x118b08);if(_0x118b08!==_0x4a3653['password'])throw new common_1['HttpException'](_0x53ae98(0x9c),common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);}}if(_0x15dbf8&&_0x132143){const _0x5aa243=[{'username':_0x15dbf8},{'email':_0x15dbf8}];_0x4a3653=await this[_0x53ae98(0xcb)][_0x53ae98(0x120)]({'where':_0x5aa243});if(!_0x4a3653)throw new common_1[(_0x53ae98(0x13b))](_0x53ae98(0xaa),common_1['HttpStatus'][_0x53ae98(0x116)]);if(_0x4a3653['password']['startsWith'](_0x53ae98(0xe2))||_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)](_0x53ae98(0x10d))||_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)](_0x53ae98(0x13f))){if(!bcrypt[_0x53ae98(0x103)](_0x132143,_0x4a3653[_0x53ae98(0xb4)]))throw new common_1[(_0x53ae98(0x13b))](_0x53ae98(0x9c),common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);}else{console[_0x53ae98(0xa7)](_0x53ae98(0xfb));const _0x977a9c=crypto[_0x53ae98(0x149)](_0x53ae98(0xb2))[_0x53ae98(0xdf)](_0x132143)[_0x53ae98(0x12d)](_0x53ae98(0xf7));console[_0x53ae98(0xa7)](_0x53ae98(0xfb),_0x977a9c);if(_0x977a9c!==_0x4a3653[_0x53ae98(0xb4)])throw new common_1[(_0x53ae98(0x13b))](_0x53ae98(0x9c),common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);}}if(_0x19b0a5&&_0x132143){const _0x34248b=[{'phone':_0x19b0a5}];_0x4a3653=await this[_0x53ae98(0xcb)]['findOne']({'where':_0x34248b});if(!_0x4a3653)throw new common_1[(_0x53ae98(0x13b))]('当前账户不存在！',common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);if(_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)](_0x53ae98(0xe2))||_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)]('$2b$')||_0x4a3653[_0x53ae98(0xb4)][_0x53ae98(0xc5)]('$2y$')){if(!bcrypt[_0x53ae98(0x103)](_0x132143,_0x4a3653[_0x53ae98(0xb4)]))throw new common_1[(_0x53ae98(0x13b))]('当前密码错误！',common_1['HttpStatus'][_0x53ae98(0x116)]);}else{console[_0x53ae98(0xa7)](_0x53ae98(0xfb));const _0x267c00=crypto[_0x53ae98(0x149)](_0x53ae98(0xb2))[_0x53ae98(0xdf)](_0x132143)[_0x53ae98(0x12d)](_0x53ae98(0xf7));console[_0x53ae98(0xa7)](_0x53ae98(0xfb),_0x267c00);if(_0x267c00!==_0x4a3653[_0x53ae98(0xb4)])throw new common_1[(_0x53ae98(0x13b))]('当前密码错误！',common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);}}if(!_0x4a3653)throw new common_1[(_0x53ae98(0x13b))]('当前账户不存在！',common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);if(_0x4a3653[_0x53ae98(0xf0)]!==user_constant_1[_0x53ae98(0x111)]['ACTIVE'])throw new common_1['HttpException'](user_constant_1[_0x53ae98(0x143)][_0x4a3653['status']],common_1[_0x53ae98(0xb3)][_0x53ae98(0x116)]);return _0x4a3653;}async[_0x75e4df(0x106)](_0x4b65e5,_0x743b6f){const _0x5ca595=_0x75e4df,_0x5f3720=await this[_0x5ca595(0xcb)][_0x5ca595(0x120)]({'where':{'id':_0x4b65e5}});if(_0x5f3720[_0x5ca595(0xb4)][_0x5ca595(0xc5)](_0x5ca595(0xe2))||_0x5f3720[_0x5ca595(0xb4)][_0x5ca595(0xc5)]('$2b$')||_0x5f3720[_0x5ca595(0xb4)][_0x5ca595(0xc5)](_0x5ca595(0x13f)))return bcrypt[_0x5ca595(0x103)](_0x743b6f,_0x5f3720[_0x5ca595(0xb4)]);else{const _0x22919b=crypto[_0x5ca595(0x149)](_0x5ca595(0xb2))['update'](_0x743b6f)[_0x5ca595(0x12d)](_0x5ca595(0xf7));return console[_0x5ca595(0xa7)](_0x5ca595(0xfb),_0x22919b),_0x22919b===_0x5f3720['password'];}}async[_0x75e4df(0xd3)](_0x1ae68e,_0x3dcb15){const _0x555baa=_0x75e4df,_0x58fbba=await this[_0x555baa(0xcb)]['update']({'id':_0x1ae68e},{'status':_0x3dcb15});return _0x58fbba['affected']>0x0;}async[_0x75e4df(0x110)](_0x380c19){const _0x196130=await this['userEntity']['findOne']({'where':{'id':_0x380c19}});return _0x196130['status'];}async[_0x75e4df(0xf3)](_0x2a6c8a){const _0xab6f1b=_0x75e4df;return await this[_0xab6f1b(0xcb)][_0xab6f1b(0x120)]({'where':{'id':_0x2a6c8a}});}async[_0x75e4df(0x93)](_0x148846){const _0x144d0f=_0x75e4df;return await this[_0x144d0f(0xcb)]['findOne']({'where':{'id':_0x148846}});}async['checkUserStatus'](_0x6aae6){const _0x16066c=_0x75e4df,{id:_0x1255be,role:_0x284a8d}=_0x6aae6;if(_0x284a8d===_0x16066c(0xad))return!![];const _0x1331c7=await this[_0x16066c(0xcb)][_0x16066c(0x120)]({'where':{'id':_0x1255be}});if(!_0x1331c7)throw new common_1['HttpException']('当前用户信息失效、请重新登录！',common_1[_0x16066c(0xb3)][_0x16066c(0xbe)]);if(_0x1331c7[_0x16066c(0xf0)]===user_constant_1[_0x16066c(0x111)][_0x16066c(0xf1)])throw new common_1[(_0x16066c(0x13b))](_0x16066c(0xa0),common_1['HttpStatus'][_0x16066c(0x116)]);if(_0x1331c7['status']===user_constant_1[_0x16066c(0x111)][_0x16066c(0xe0)])throw new common_1[(_0x16066c(0x13b))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x16066c(0xb3)][_0x16066c(0x116)]);}async['getUserInfo'](_0x7a6e72){const _0x6ed833=_0x75e4df,_0x3c8458=await this[_0x6ed833(0xcb)][_0x6ed833(0x120)]({'where':{'id':_0x7a6e72},'select':[_0x6ed833(0xd8),_0x6ed833(0x123),_0x6ed833(0x129),_0x6ed833(0xce),_0x6ed833(0xa4),_0x6ed833(0x141),_0x6ed833(0xdb),'consecutiveDays']});if(!_0x3c8458)throw new common_1[(_0x6ed833(0x13b))](_0x6ed833(0x9b),common_1[_0x6ed833(0xb3)][_0x6ed833(0xbe)]);_0x3c8458[_0x6ed833(0xff)]=!!(_0x3c8458===null||_0x3c8458===void 0x0?void 0x0:_0x3c8458[_0x6ed833(0xdb)]),delete _0x3c8458[_0x6ed833(0xdb)];const _0xb37139=await this[_0x6ed833(0x97)][_0x6ed833(0xac)](_0x7a6e72);return{'userInfo':_0x3c8458,'userBalance':Object[_0x6ed833(0x118)]({},_0xb37139)};}async[_0x75e4df(0x145)](_0x148d6c){return await this['userEntity']['findOne']({'where':{'id':_0x148d6c}});}async[_0x75e4df(0xd0)](_0x4a52cc){const _0x389faf=_0x75e4df;return await this[_0x389faf(0xcb)][_0x389faf(0x120)]({'where':{'openId':_0x4a52cc}});}async['updateInfo'](_0x4f8944,_0x1f78fa){const _0x9c768=_0x75e4df,{id:_0x38b94a}=_0x1f78fa[_0x9c768(0x11f)],_0x48150b=await this[_0x9c768(0xcb)][_0x9c768(0x120)]({'where':{'id':_0x38b94a}});if(!_0x48150b)throw new common_1[(_0x9c768(0x13b))]('当前用户不存在！',common_1['HttpStatus'][_0x9c768(0x116)]);if(_0x4f8944[_0x9c768(0xd8)]&&_0x48150b[_0x9c768(0xd8)]===_0x4f8944[_0x9c768(0xd8)])throw new common_1['HttpException'](_0x9c768(0x12c),common_1['HttpStatus'][_0x9c768(0x116)]);if(_0x4f8944[_0x9c768(0xd8)]){const _0x2a7040=await this[_0x9c768(0xcb)]['findOne']({'where':{'username':_0x4f8944[_0x9c768(0xd8)],'id':(0x0,typeorm_2[_0x9c768(0x9d)])(_0x38b94a)}});if(_0x2a7040)throw new common_1[(_0x9c768(0x13b))](_0x9c768(0xd9),common_1[_0x9c768(0xb3)][_0x9c768(0x116)]);}const _0x37509c=await this[_0x9c768(0xcb)][_0x9c768(0xdf)]({'id':_0x38b94a},_0x4f8944);if(_0x37509c[_0x9c768(0xa3)]<=0x0)throw new common_1[(_0x9c768(0x13b))](_0x9c768(0x109),common_1['HttpStatus'][_0x9c768(0x116)]);return'修改用户信息成功！';}async[_0x75e4df(0xe9)](_0x23095a,_0x4389f2){const _0x1a25c9=_0x75e4df,_0x2d5ffa=bcrypt['hashSync'](_0x4389f2,0xa),_0x2d4d58=await this['userEntity'][_0x1a25c9(0xdf)]({'id':_0x23095a},{'password':_0x2d5ffa});if(_0x2d4d58[_0x1a25c9(0xa3)]<=0x0)throw new common_1[(_0x1a25c9(0x13b))](_0x1a25c9(0x126),common_1[_0x1a25c9(0xb3)][_0x1a25c9(0x116)]);}async[_0x75e4df(0x12e)](_0x470bb5){const _0xf6ccce=_0x75e4df,{id:_0x3d7c01}=_0x470bb5[_0xf6ccce(0x11f)],_0x349f5a=await this[_0xf6ccce(0xcb)][_0xf6ccce(0x120)]({'where':{'id':_0x3d7c01}});if(!_0x349f5a||_0x349f5a[_0xf6ccce(0x141)])throw new common_1['HttpException'](_0xf6ccce(0xc9),common_1[_0xf6ccce(0xb3)][_0xf6ccce(0x116)]);const _0x1bbc3a=(0x0,utils_1['generateRandomString'])(),_0x3f6dcf=await this[_0xf6ccce(0xcb)][_0xf6ccce(0x120)]({'where':{'inviteCode':_0x1bbc3a}});if(_0x3f6dcf)throw new common_1[(_0xf6ccce(0x13b))](_0xf6ccce(0xc4),common_1[_0xf6ccce(0xb3)][_0xf6ccce(0x116)]);const _0x23b2ea=await this[_0xf6ccce(0xcb)][_0xf6ccce(0xdf)]({'id':_0x3d7c01},{'inviteCode':_0x1bbc3a});if(_0x23b2ea[_0xf6ccce(0xa3)]<=0x0)throw new common_1[(_0xf6ccce(0x13b))](_0xf6ccce(0xc4),common_1[_0xf6ccce(0xb3)][_0xf6ccce(0x116)]);return _0x1bbc3a;}async[_0x75e4df(0xe4)](_0x180fa4,_0x3b568b){const _0x3f40e2=_0x75e4df;try{const {id:_0x964b87}=_0x180fa4[_0x3f40e2(0x11f)],{page:page=0x1,size:size=0xa}=_0x3b568b,_0x458904=await this[_0x3f40e2(0xcb)][_0x3f40e2(0x120)]({'where':{'id':_0x964b87}}),{inviteCode:_0x6ee317}=_0x458904;if(!_0x6ee317)return[];const [_0x4fef03,_0x51b1c]=await this[_0x3f40e2(0xcb)][_0x3f40e2(0xbf)]({'where':{'inviteCode':_0x6ee317},'order':{'id':_0x3f40e2(0x135)},'select':[_0x3f40e2(0xd8),_0x3f40e2(0xce),'createdAt','status',_0x3f40e2(0x123)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1['formatCreateOrUpdateDate'])(_0x4fef03)[_0x3f40e2(0xf5)](_0x143693=>{const _0x45a11d=_0x3f40e2;return _0x143693[_0x45a11d(0xce)]=(0x0,utils_1['maskEmail'])(_0x143693[_0x45a11d(0xce)]),_0x143693;}),{'rows':_0x4fef03,'count':_0x51b1c};}catch(_0x1cd7b7){console[_0x3f40e2(0xa7)]('error:\x20',_0x1cd7b7);throw new common_1[(_0x3f40e2(0x13b))](_0x3f40e2(0x101),common_1[_0x3f40e2(0xb3)][_0x3f40e2(0x116)]);}}async[_0x75e4df(0xe8)](_0x1b3e04){const _0x48604a=_0x75e4df,_0x5d188e=await this['userEntity'][_0x48604a(0x120)]({'where':{'inviteCode':_0x1b3e04}});if(!_0x5d188e)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x5d188e,_0x113993=await this['userEntity'][_0x48604a(0xdf)]({'inviteCode':_0x1b3e04},{'inviteLinkCount':inviteLinkCount+0x1});return _0x113993[_0x48604a(0xa3)]?0x1:0x0;}async[_0x75e4df(0xfa)](_0x456388){const _0x12d4fc=_0x75e4df;return await this[_0x12d4fc(0xcb)][_0x12d4fc(0x120)]({'where':{'inviteCode':_0x456388}});}async[_0x75e4df(0x128)](_0xe8457d){const _0x2bd555=_0x75e4df,{userId:_0x152d25,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0xe8457d;await this['userBalanceService'][_0x2bd555(0xe6)](_0x152d25,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x200036=await this[_0x2bd555(0x97)][_0x2bd555(0x96)]({'userId':_0x152d25,'rechargeType':balance_constant_1[_0x2bd555(0x12b)]['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x200036;}async['queryAll'](_0x1561f8,_0x432fce){const _0x5a9804=_0x75e4df,{page:page=0x1,size:size=0xa,username:_0x3442d0,email:_0xef59,status:_0x132c8f,keyword:_0x41a8d4,phone:_0x284fcc}=_0x1561f8;let _0x253427={};_0x3442d0&&Object[_0x5a9804(0x118)](_0x253427,{'username':(0x0,typeorm_2[_0x5a9804(0xd4)])('%'+_0x3442d0+'%')}),_0xef59&&Object['assign'](_0x253427,{'email':(0x0,typeorm_2[_0x5a9804(0xd4)])('%'+_0xef59+'%')}),_0x284fcc&&Object[_0x5a9804(0x118)](_0x253427,{'phone':(0x0,typeorm_2[_0x5a9804(0xd4)])('%'+_0x284fcc+'%')}),_0x132c8f&&Object[_0x5a9804(0x118)](_0x253427,{'status':_0x132c8f});_0x41a8d4&&(_0x253427=[{'username':(0x0,typeorm_2['Like'])('%'+_0x41a8d4+'%')},{'email':(0x0,typeorm_2[_0x5a9804(0xd4)])('%'+_0x41a8d4+'%')},{'phone':(0x0,typeorm_2[_0x5a9804(0xd4)])('%'+_0x41a8d4+'%')}]);const [_0x148c93,_0x414fe1]=await this[_0x5a9804(0xcb)][_0x5a9804(0xbf)]({'skip':(page-0x1)*size,'where':_0x253427,'take':size,'order':{'createdAt':_0x5a9804(0x135)},'cache':!![],'select':['username',_0x5a9804(0x123),_0x5a9804(0x141),_0x5a9804(0x129),_0x5a9804(0xa4),_0x5a9804(0xf0),'id',_0x5a9804(0xce),_0x5a9804(0xf2),_0x5a9804(0xb0),_0x5a9804(0xd5)]}),_0x3de19a=_0x148c93[_0x5a9804(0xf5)](_0x4be18d=>_0x4be18d['id']),_0x2a6ee7=await this[_0x5a9804(0x97)][_0x5a9804(0xeb)](_0x3de19a);return _0x148c93[_0x5a9804(0xcd)](_0x53856c=>_0x53856c[_0x5a9804(0xb1)]=_0x2a6ee7[_0x5a9804(0x113)](_0x4a7cbc=>_0x4a7cbc[_0x5a9804(0xb8)]===_0x53856c['id'])),_0x432fce[_0x5a9804(0x11f)][_0x5a9804(0x129)]!==_0x5a9804(0x13a)&&_0x148c93['forEach'](_0x27c3b4=>_0x27c3b4[_0x5a9804(0xce)]=(0x0,utils_1[_0x5a9804(0xa1)])(_0x27c3b4['email'])),_0x432fce['user'][_0x5a9804(0x129)]!==_0x5a9804(0x13a)&&_0x148c93[_0x5a9804(0xcd)](_0x4fe2f6=>_0x4fe2f6['lastLoginIp']=(0x0,utils_1['maskIpAddress'])(_0x4fe2f6[_0x5a9804(0xb0)])),_0x432fce[_0x5a9804(0x11f)]['role']!==_0x5a9804(0x13a)&&_0x148c93[_0x5a9804(0xcd)](_0x2a81af=>_0x2a81af[_0x5a9804(0xd5)]=(0x0,utils_1['maskIpAddress'])(_0x2a81af['phone'])),{'rows':_0x148c93,'count':_0x414fe1};}async[_0x75e4df(0xea)]({id:_0x313baf}){const _0x27c278=_0x75e4df;return await this[_0x27c278(0xcb)][_0x27c278(0x120)]({'where':{'id':_0x313baf},'select':['username',_0x27c278(0x123),_0x27c278(0x141),_0x27c278(0x129),_0x27c278(0xa4),'status']});}async['updateStatus'](_0x4e3535){const _0xbc161c=_0x75e4df,{id:_0xa4776d,status:_0x3f8d31}=_0x4e3535,_0x447b5c=await this[_0xbc161c(0xcb)][_0xbc161c(0x120)]({'where':{'id':_0xa4776d}});if(!_0x447b5c)throw new common_1[(_0xbc161c(0x13b))]('用户不存在！',common_1[_0xbc161c(0xb3)][_0xbc161c(0x116)]);if(_0x447b5c[_0xbc161c(0x129)]===_0xbc161c(0x13a))throw new common_1[(_0xbc161c(0x13b))](_0xbc161c(0x117),common_1['HttpStatus'][_0xbc161c(0x116)]);if(_0x447b5c['status']===user_constant_1[_0xbc161c(0x111)]['PENDING'])throw new common_1[(_0xbc161c(0x13b))](_0xbc161c(0x139),common_1[_0xbc161c(0xb3)][_0xbc161c(0x116)]);if(_0x447b5c[_0xbc161c(0x129)]===_0xbc161c(0x13a))throw new common_1['HttpException'](_0xbc161c(0x117),common_1['HttpStatus'][_0xbc161c(0x116)]);if(_0x3f8d31===user_constant_1[_0xbc161c(0x111)][_0xbc161c(0xe3)])throw new common_1[(_0xbc161c(0x13b))](_0xbc161c(0xa2),common_1['HttpStatus'][_0xbc161c(0x116)]);const _0x322582=await this[_0xbc161c(0xcb)][_0xbc161c(0xdf)]({'id':_0xa4776d},{'status':_0x3f8d31});if(_0x322582[_0xbc161c(0xa3)]<=0x0)throw new common_1[(_0xbc161c(0x13b))](_0xbc161c(0x136),common_1[_0xbc161c(0xb3)][_0xbc161c(0x116)]);return'修改用户状态成功！';}async[_0x75e4df(0xbd)](_0x428248){const _0x2b3099=_0x75e4df,{id:_0x4d95a5}=_0x428248,_0x1e125a=await this[_0x2b3099(0xcb)][_0x2b3099(0x120)]({'where':{'id':_0x4d95a5}});if(!_0x1e125a)throw new common_1['HttpException'](_0x2b3099(0xd6),common_1[_0x2b3099(0xb3)]['BAD_REQUEST']);const _0x19f7d0=_0x2b3099(0x102),_0xd4817d=bcrypt[_0x2b3099(0x125)](_0x19f7d0,0xa),_0x3ecd8b=await this[_0x2b3099(0xcb)][_0x2b3099(0xdf)]({'id':_0x4d95a5},{'password':_0xd4817d});if(_0x3ecd8b[_0x2b3099(0xa3)]<=0x0)throw new common_1[(_0x2b3099(0x13b))](_0x2b3099(0x94),common_1['HttpStatus']['BAD_REQUEST']);return'密码重置为['+_0x19f7d0+_0x2b3099(0x12f);}async[_0x75e4df(0xd2)](_0x5a5b3f,_0x903552){const _0x2f6b4a=_0x75e4df;return await this[_0x2f6b4a(0xcb)][_0x2f6b4a(0xdf)]({'id':_0x5a5b3f},{'lastLoginIp':_0x903552});}async[_0x75e4df(0x9f)](_0x125ded,_0xb0695a){const _0x17a873=_0x75e4df,_0x24ff42=await this[_0x17a873(0xcb)][_0x17a873(0x120)]({'where':{'openId':_0x125ded}});if(!_0x24ff42){const _0x269b9e=_0xb0695a?_0xb0695a[_0x17a873(0xc8)](':')[0x1]:'',_0x2fea83=await this[_0x17a873(0xfa)](_0x269b9e),_0x253b1f=await this[_0x17a873(0x9e)](_0x125ded,_0x269b9e);return await this[_0x17a873(0x97)]['addBalanceToNewUser'](_0x253b1f['id'],_0x269b9e?_0x2fea83===null||_0x2fea83===void 0x0?void 0x0:_0x2fea83['id']:null),_0x253b1f;}return _0x24ff42;}async[_0x75e4df(0x9e)](_0x3c7589,_0x1f534a){const _0x5cb41a=_0x75e4df,_0x24a1da=await this[_0x5cb41a(0x130)]['getConfigs']([_0x5cb41a(0xda)]),_0x4c97d0={'avatar':_0x24a1da,'username':'用户'+(0x0,utils_1[_0x5cb41a(0x124)])(),'status':user_constant_1['UserStatusEnum'][_0x5cb41a(0x11b)],'sex':0x0,'email':(0x0,utils_1[_0x5cb41a(0x124)])()+_0x5cb41a(0x11d),'invitedBy':_0x1f534a,'openId':_0x3c7589},_0xfdab26=await this['userEntity'][_0x5cb41a(0x137)](_0x4c97d0);return _0xfdab26;}async[_0x75e4df(0xdd)](_0x467669,_0x5cc2b4){const _0x301e63=_0x75e4df;try{const _0x3c3baf=await this[_0x301e63(0xcb)][_0x301e63(0x120)]({'where':{'id':_0x5cc2b4}});if(!_0x3c3baf)return{'status':![],'msg':_0x301e63(0x104)};const _0x34d19c=await this['userEntity'][_0x301e63(0x120)]({'where':{'openId':_0x467669}});if(_0x34d19c)return{'status':![],'msg':_0x301e63(0xb9)};const _0x20bca6=await this['userEntity']['update']({'id':_0x5cc2b4},{'openId':_0x467669});if(_0x20bca6[_0x301e63(0xa3)]<=0x0)return{'status':![],'msg':_0x301e63(0x112)};return{'status':!![],'msg':_0x301e63(0x107)};}catch(_0x181feb){return{'status':![],'msg':_0x301e63(0x112)};}}async['getOpenIdByUserId'](_0x27ff6c){const _0x2aa617=_0x75e4df,_0x16f5c4=await this['userEntity'][_0x2aa617(0x120)]({'where':{'id':_0x27ff6c}});return _0x16f5c4===null||_0x16f5c4===void 0x0?void 0x0:_0x16f5c4['openId'];}async[_0x75e4df(0x10e)](_0x196cf4){const _0x23fb5d=_0x75e4df,{username:_0x1e718e,password:_0x4705c9,phone:_0x1de9e5,phoneCode:_0x46cebc}=_0x196cf4,_0x147763=await this['userEntity'][_0x23fb5d(0x120)]({'where':[{'username':_0x1e718e},{'phone':_0x1de9e5}]});if(_0x147763&&_0x147763[_0x23fb5d(0xd8)]===_0x1e718e)throw new common_1['HttpException'](_0x23fb5d(0x13e),common_1[_0x23fb5d(0xb3)][_0x23fb5d(0x116)]);if(_0x147763&&_0x147763[_0x23fb5d(0xd5)]===_0x1de9e5)throw new common_1['HttpException'](_0x23fb5d(0x13d),common_1[_0x23fb5d(0xb3)][_0x23fb5d(0x116)]);}async[_0x75e4df(0x11c)](_0x460398){const _0x29b38a=_0x75e4df;return await this[_0x29b38a(0xcb)]['save'](_0x460398);}};UserService=__decorate([(0x0,common_1[_0x75e4df(0xb5)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x75e4df(0x95)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(whiteList_entity_1[_0x75e4df(0x144)])),__param(0x7,(0x0,typeorm_1[_0x75e4df(0x146)])(config_entity_1[_0x75e4df(0x10b)])),__metadata(_0x75e4df(0xdc),[typeorm_2[_0x75e4df(0xba)],typeorm_2[_0x75e4df(0xba)],typeorm_2[_0x75e4df(0x105)],verification_service_1[_0x75e4df(0xfc)],mailer_1['MailerService'],userBalance_service_1[_0x75e4df(0xa9)],globalConfig_service_1[_0x75e4df(0xb7)],typeorm_2['Repository']])],UserService),exports['UserService']=UserService;