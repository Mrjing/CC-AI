'use strict';const _0x5c2f26=_0x9c06;function _0x68d8(){const _0x338979=['checkAutoReply','user',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','8485hMuZvR','accessToken***','getUserOpenId','HttpException','race','aotoPlay','loginBySceneStr','defineProperty','../user/user.service','crypto','chatSyncFree','verify','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','__metadata','&url=','bindWx','14935930sygNHp','&grant_type=authorization_code','getTime','wechatAccessToken','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','wechatOfficialAppSecret','chatgptService','__esModule','wechatOfficialToken','../auth/auth.service','jiangly','getOwnPropertyDescriptor','非法参数','getWechatAccessToken','bindWxBySceneStr','wechatOfficialAppId','36TxBnDa','11pJKvsJ','sha1','HttpStatus','appId:\x20','function','&redirect_uri=','sceneStrMap','scanedSceneStrMap','officialAutoReplyText','metadata','__decorate','hex','loginByOpenId','fetchQRCodeTicket','tousername','str:\x20','design:paramtypes','genXmlMsg','UserService','getUserFromOpenId','来自公众号的询问问题\x20=======>\x20','getUserById','getRedirectUrl','14391891HvLQQX','join','post','object','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','decorate','&secret=','请求超时','axios','getConfigs','userService','digest','ChatgptService','getQRCodeTicket','BAD_REQUEST','461408Gvjhpo','../chatgpt/chatgpt.service','../autoreply/autoreply.service','autoreplyService','AuthService','scan','authService','get','GlobalConfigService','wechatJsapiTicket','88ngQWWc','fromusername','getQRSceneStrByBind','getQRSceneStr','createRandomNonceStr','1469474RQKmDv','length','../globalConfig/globalConfig.service','sort','&noncestr=','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','261114DxOswX','onModuleInit',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','scanBindWx','回跳跳转地址:\x20','232113snrokn','now','jsapi_ticket=','toFixed','createHash','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','8zXZrkY','OfficialService','log','globalConfigService','loginByCode','getJsapiTicket'];_0x68d8=function(){return _0x338979;};return _0x68d8();}(function(_0x3f4838,_0x409568){const _0x4bd463=_0x9c06,_0x5818fd=_0x3f4838();while(!![]){try{const _0x5e9fb8=parseInt(_0x4bd463(0x22b))/0x1+-parseInt(_0x4bd463(0x21c))/0x2+parseInt(_0x4bd463(0x236))/0x3*(parseInt(_0x4bd463(0x23c))/0x4)+parseInt(_0x4bd463(0x245))/0x5*(-parseInt(_0x4bd463(0x1f5))/0x6)+parseInt(_0x4bd463(0x231))/0x7*(-parseInt(_0x4bd463(0x226))/0x8)+-parseInt(_0x4bd463(0x20d))/0x9+parseInt(_0x4bd463(0x255))/0xa*(parseInt(_0x4bd463(0x1f6))/0xb);if(_0x5e9fb8===_0x409568)break;else _0x5818fd['push'](_0x5818fd['shift']());}catch(_0x331b38){_0x5818fd['push'](_0x5818fd['shift']());}}}(_0x68d8,0xd3cae));var __decorate=this&&this[_0x5c2f26(0x200)]||function(_0x19e74e,_0x926dac,_0x5c56e7,_0x5961a6){const _0x15d712=_0x5c2f26;var _0x3f5141=arguments[_0x15d712(0x22c)],_0x5c02eb=_0x3f5141<0x3?_0x926dac:_0x5961a6===null?_0x5961a6=Object[_0x15d712(0x1f0)](_0x926dac,_0x5c56e7):_0x5961a6,_0x5a1c7a;if(typeof Reflect==='object'&&typeof Reflect[_0x15d712(0x212)]===_0x15d712(0x1fa))_0x5c02eb=Reflect[_0x15d712(0x212)](_0x19e74e,_0x926dac,_0x5c56e7,_0x5961a6);else{for(var _0x3ac238=_0x19e74e[_0x15d712(0x22c)]-0x1;_0x3ac238>=0x0;_0x3ac238--)if(_0x5a1c7a=_0x19e74e[_0x3ac238])_0x5c02eb=(_0x3f5141<0x3?_0x5a1c7a(_0x5c02eb):_0x3f5141>0x3?_0x5a1c7a(_0x926dac,_0x5c56e7,_0x5c02eb):_0x5a1c7a(_0x926dac,_0x5c56e7))||_0x5c02eb;}return _0x3f5141>0x3&&_0x5c02eb&&Object[_0x15d712(0x24c)](_0x926dac,_0x5c56e7,_0x5c02eb),_0x5c02eb;},__metadata=this&&this[_0x5c2f26(0x252)]||function(_0x80b6d2,_0x1424c2){const _0x5df2e7=_0x5c2f26;if(typeof Reflect===_0x5df2e7(0x210)&&typeof Reflect[_0x5df2e7(0x1ff)]==='function')return Reflect['metadata'](_0x80b6d2,_0x1424c2);};Object[_0x5c2f26(0x24c)](exports,_0x5c2f26(0x1ec),{'value':!![]}),exports[_0x5c2f26(0x23d)]=void 0x0;function _0x9c06(_0x18b8f2,_0x17956a){const _0x68d8d8=_0x68d8();return _0x9c06=function(_0x9c0607,_0x2e6f4b){_0x9c0607=_0x9c0607-0x1ea;let _0x1a6cc5=_0x68d8d8[_0x9c0607];return _0x1a6cc5;},_0x9c06(_0x18b8f2,_0x17956a);}const chatgpt_service_1=require(_0x5c2f26(0x21d)),globalConfig_service_1=require(_0x5c2f26(0x22d)),auth_service_1=require(_0x5c2f26(0x1ee)),user_service_1=require(_0x5c2f26(0x24d)),autoreply_service_1=require(_0x5c2f26(0x21e)),common_1=require('@nestjs/common'),crypto=require(_0x5c2f26(0x24e)),axios_1=require(_0x5c2f26(0x215)),utils_1=require('../../common/utils');let OfficialService=class OfficialService{constructor(_0x5e6399,_0x2d06b9,_0x3b0a64,_0x170809,_0x32408b){const _0x4ea2e7=_0x5c2f26;this[_0x4ea2e7(0x21f)]=_0x5e6399,this['userService']=_0x2d06b9,this[_0x4ea2e7(0x222)]=_0x3b0a64,this[_0x4ea2e7(0x23f)]=_0x170809,this[_0x4ea2e7(0x1eb)]=_0x32408b,this[_0x4ea2e7(0x1fc)]={},this['scanedSceneStrMap']={};}async[_0x5c2f26(0x232)](){const _0x45d1fc=_0x5c2f26;await this[_0x45d1fc(0x23f)][_0x45d1fc(0x1f2)](!![]);}async[_0x5c2f26(0x229)](_0x5ce8f7){const {invitedBy:_0x57a8d9}=_0x5ce8f7;let _0x2998e3=(0x0,utils_1['createRandomNonceStr'])(0x20);return _0x57a8d9&&(_0x2998e3+=':'+_0x57a8d9),this['sceneStrMap'][_0x2998e3]=!![],_0x2998e3;}async[_0x5c2f26(0x228)](_0x2c2550){const _0x418828=_0x5c2f26,{id:_0x386cb3}=_0x2c2550[_0x418828(0x243)],_0x3efc04=(0x0,utils_1[_0x418828(0x22a)])(0x20)+'/'+_0x386cb3;return this['sceneStrMap'][_0x3efc04]=!![],_0x3efc04;}async[_0x5c2f26(0x21a)](_0xff469a){const _0x42ed2c=_0x5c2f26;return this[_0x42ed2c(0x203)](_0xff469a);}async[_0x5c2f26(0x20c)](_0x59a0cd){const _0x5ecc89=_0x5c2f26,_0x4e839c=await this['globalConfigService'][_0x5ecc89(0x216)](['wechatOfficialAppId']),_0x3d6cbb='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x4e839c+_0x5ecc89(0x1fb)+encodeURIComponent(_0x59a0cd)+_0x5ecc89(0x211);return console['log'](_0x5ecc89(0x235),_0x3d6cbb),_0x3d6cbb;}async[_0x5c2f26(0x241)](_0x5c7ae5){const _0x2334ce=_0x5c2f26,_0x48e5d9=(0x0,utils_1[_0x2334ce(0x22a)])(0x20),_0x5a37b5=(Date[_0x2334ce(0x237)]()/0x3e8)[_0x2334ce(0x239)](0x0),_0x418586=await this[_0x2334ce(0x23f)][_0x2334ce(0x216)]([_0x2334ce(0x225)]);console['log']('jsapiTicket:\x20',_0x418586);const _0x10ded0=await this[_0x2334ce(0x23f)][_0x2334ce(0x216)]([_0x2334ce(0x1f4)]);console['log'](_0x2334ce(0x1f9),_0x10ded0);const _0x392f36=_0x2334ce(0x238)+_0x418586+_0x2334ce(0x22f)+_0x48e5d9+'&timestamp='+_0x5a37b5+_0x2334ce(0x253)+_0x5c7ae5;console['log'](_0x2334ce(0x205),_0x392f36);const _0x51cc27=this['sha1'](_0x392f36);return{'appId':_0x10ded0,'nonceStr':_0x48e5d9,'timestamp':_0x5a37b5,'signature':_0x51cc27};}async['fetchQRCodeTicket'](_0x62787e){const _0x3125d3=_0x5c2f26,_0x392d50=await this[_0x3125d3(0x23f)][_0x3125d3(0x216)]([_0x3125d3(0x258)]),_0x2f39e2={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x62787e}}};console[_0x3125d3(0x23e)](_0x3125d3(0x246),_0x392d50);const _0x542432=await axios_1['default'][_0x3125d3(0x20f)]('https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token='+_0x392d50,_0x2f39e2),{data:{errmsg:_0x248e14,ticket:_0x38e1c4}}=_0x542432;console[_0x3125d3(0x23e)]('qrcodecreate',_0x542432);if(_0x248e14)throw new common_1['HttpException'](_0x248e14,common_1[_0x3125d3(0x1f8)][_0x3125d3(0x21b)]);return _0x38e1c4;}async[_0x5c2f26(0x240)](_0x24c54d,_0x43a462){const _0x137f09=_0x5c2f26,_0x477e2c=await this[_0x137f09(0x23f)][_0x137f09(0x216)](['wechatOfficialAppId']),_0x10f406=await this['globalConfigService'][_0x137f09(0x216)]([_0x137f09(0x1ea)]),_0x410f95=await axios_1['default'][_0x137f09(0x223)](_0x137f09(0x230)+_0x477e2c+_0x137f09(0x213)+_0x10f406+'&code='+_0x43a462+_0x137f09(0x256)),{data:{errmsg:_0x349e45,openid:_0x36c0f0}}=_0x410f95;if(_0x349e45)throw new common_1['HttpException'](_0x349e45,common_1[_0x137f09(0x1f8)][_0x137f09(0x21b)]);let _0x11b3e5;return _0x11b3e5=await this[_0x137f09(0x217)][_0x137f09(0x247)](_0x36c0f0),!_0x11b3e5&&(_0x11b3e5=await this['userService'][_0x137f09(0x209)](_0x36c0f0)),this[_0x137f09(0x222)]['loginByOpenId'](_0x11b3e5,_0x24c54d);}async[_0x5c2f26(0x221)](_0x589ff1,_0x593a94){const _0x378ee0=_0x5c2f26;if(!this['sceneStrMap'][_0x593a94])throw new common_1[(_0x378ee0(0x248))](_0x378ee0(0x1f1),common_1[_0x378ee0(0x1f8)][_0x378ee0(0x21b)]);const _0x2b85f3=await this[_0x378ee0(0x217)][_0x378ee0(0x209)](_0x589ff1,_0x593a94);this[_0x378ee0(0x1fd)][_0x593a94]=_0x2b85f3['id'];}async[_0x5c2f26(0x24b)](_0x11fe0c,_0xea73a7){const _0x382a39=_0x5c2f26;if(!this[_0x382a39(0x1fc)][_0xea73a7])return;const _0x27e3d3=this[_0x382a39(0x1fd)][_0xea73a7];if(!_0x27e3d3)return'';const _0x9ab9e4=await this[_0x382a39(0x217)][_0x382a39(0x20b)](_0x27e3d3);return delete this[_0x382a39(0x1fd)][_0xea73a7],this['authService'][_0x382a39(0x202)](_0x9ab9e4,_0x11fe0c);}async[_0x5c2f26(0x234)](_0x238598,_0x3ad480){const _0x271484=_0x5c2f26;if(!this[_0x271484(0x1fc)][_0x3ad480])throw new common_1[(_0x271484(0x248))](_0x271484(0x1f1),common_1['HttpStatus']['BAD_REQUEST']);const _0x4b8d13=_0x3ad480['split']('/')[0x1],_0x227952=await this[_0x271484(0x217)][_0x271484(0x254)](_0x238598,_0x4b8d13);this[_0x271484(0x1fd)][_0x3ad480]=_0x227952;}async[_0x5c2f26(0x1f3)](_0x23ecab,_0x58a34d){const _0x47c5be=_0x5c2f26;if(!this[_0x47c5be(0x1fc)][_0x58a34d])throw new common_1[(_0x47c5be(0x248))](_0x47c5be(0x1f1),common_1['HttpStatus']['BAD_REQUEST']);const {id:_0x703c13}=_0x23ecab[_0x47c5be(0x243)],_0x4605de=this[_0x47c5be(0x1fd)][_0x58a34d];if(!_0x4605de)return'';return delete this[_0x47c5be(0x1fd)][_0x58a34d],_0x4605de;}async[_0x5c2f26(0x250)](_0x2b2c87,_0x117018,_0x864abb){const _0x3ffb6b=_0x5c2f26,_0x41c9b1=await this['globalConfigService'][_0x3ffb6b(0x216)]([_0x3ffb6b(0x1ed)])||_0x3ffb6b(0x1ef);return await this['sha1']([_0x41c9b1,_0x117018,_0x864abb][_0x3ffb6b(0x22e)]()[_0x3ffb6b(0x20e)](''))==_0x2b2c87;}[_0x5c2f26(0x1f7)](_0x3c9ad8){const _0x251f91=_0x5c2f26;return crypto[_0x251f91(0x23a)](_0x251f91(0x1f7))['update'](_0x3c9ad8)[_0x251f91(0x218)](_0x251f91(0x201));}async['genXmlMsgByConfig'](_0x4c2599,_0x1f9225){const _0x322f86=_0x5c2f26,_0x4f273b=await this[_0x322f86(0x23f)][_0x322f86(0x216)]([_0x1f9225]);return this[_0x322f86(0x207)](_0x4c2599,_0x4f273b);}async[_0x5c2f26(0x207)](_0x403e9b,_0x809328){const _0x329aed=_0x5c2f26;return _0x329aed(0x259)+_0x403e9b[_0x329aed(0x227)][0x0]+_0x329aed(0x244)+_0x403e9b[_0x329aed(0x204)][0x0]+_0x329aed(0x233)+new Date()[_0x329aed(0x257)]()+_0x329aed(0x251)+_0x809328+']]></Content>\x0a\x20\x20\x20\x20</xml>';}async[_0x5c2f26(0x24a)](_0x47b667){const _0x196ab7=_0x5c2f26,_0x4b882f=new Promise((_0x212c0a,_0x5a1b26)=>{setTimeout(()=>{const _0x1eb2f9=_0x9c06;_0x5a1b26(new Error(_0x1eb2f9(0x214)));},0x12c0);});let _0x1a90bd='';try{console[_0x196ab7(0x23e)](_0x196ab7(0x20a),_0x47b667);const _0x471d1f=await Promise[_0x196ab7(0x249)]([this['chatgptService'][_0x196ab7(0x24f)](_0x47b667),_0x4b882f]);_0x1a90bd=_0x471d1f||await this[_0x196ab7(0x21f)][_0x196ab7(0x242)](_0x47b667);}catch(_0x30862b){console[_0x196ab7(0x23e)](_0x196ab7(0x23b)),_0x1a90bd=await this[_0x196ab7(0x23f)][_0x196ab7(0x216)]([_0x196ab7(0x1fe)])||'由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！';}return _0x1a90bd;}};OfficialService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x5c2f26(0x206),[autoreply_service_1['AutoreplyService'],user_service_1[_0x5c2f26(0x208)],auth_service_1[_0x5c2f26(0x220)],globalConfig_service_1[_0x5c2f26(0x224)],chatgpt_service_1[_0x5c2f26(0x219)]])],OfficialService),exports[_0x5c2f26(0x23d)]=OfficialService;