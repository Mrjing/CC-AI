'use strict';const _0x1ecf56=_0x3896;function _0x3896(_0x46ba75,_0x4878ef){const _0x39d6da=_0x39d6();return _0x3896=function(_0x389678,_0x447e99){_0x389678=_0x389678-0xd7;let _0x8a9600=_0x39d6da[_0x389678];return _0x8a9600;},_0x3896(_0x46ba75,_0x4878ef);}(function(_0x3f2e22,_0x12665b){const _0x440a9a=_0x3896,_0x234cc5=_0x3f2e22();while(!![]){try{const _0x1bf1e6=parseInt(_0x440a9a(0x13a))/0x1*(parseInt(_0x440a9a(0x126))/0x2)+-parseInt(_0x440a9a(0xdf))/0x3*(parseInt(_0x440a9a(0xe7))/0x4)+-parseInt(_0x440a9a(0xf1))/0x5*(-parseInt(_0x440a9a(0x11b))/0x6)+parseInt(_0x440a9a(0xdb))/0x7*(parseInt(_0x440a9a(0x130))/0x8)+-parseInt(_0x440a9a(0x12d))/0x9*(-parseInt(_0x440a9a(0x122))/0xa)+parseInt(_0x440a9a(0x115))/0xb+-parseInt(_0x440a9a(0xe4))/0xc*(parseInt(_0x440a9a(0xf0))/0xd);if(_0x1bf1e6===_0x12665b)break;else _0x234cc5['push'](_0x234cc5['shift']());}catch(_0x1c3108){_0x234cc5['push'](_0x234cc5['shift']());}}}(_0x39d6,0xa3225));var __decorate=this&&this[_0x1ecf56(0x121)]||function(_0x4a7632,_0x320ed3,_0x5e8249,_0x26679f){const _0x45521a=_0x1ecf56;var _0x2a18d6=arguments[_0x45521a(0x111)],_0x3d646b=_0x2a18d6<0x3?_0x320ed3:_0x26679f===null?_0x26679f=Object[_0x45521a(0x102)](_0x320ed3,_0x5e8249):_0x26679f,_0x2667a1;if(typeof Reflect===_0x45521a(0x11a)&&typeof Reflect['decorate']===_0x45521a(0x104))_0x3d646b=Reflect[_0x45521a(0xf5)](_0x4a7632,_0x320ed3,_0x5e8249,_0x26679f);else{for(var _0x31adb2=_0x4a7632[_0x45521a(0x111)]-0x1;_0x31adb2>=0x0;_0x31adb2--)if(_0x2667a1=_0x4a7632[_0x31adb2])_0x3d646b=(_0x2a18d6<0x3?_0x2667a1(_0x3d646b):_0x2a18d6>0x3?_0x2667a1(_0x320ed3,_0x5e8249,_0x3d646b):_0x2667a1(_0x320ed3,_0x5e8249))||_0x3d646b;}return _0x2a18d6>0x3&&_0x3d646b&&Object[_0x45521a(0xee)](_0x320ed3,_0x5e8249,_0x3d646b),_0x3d646b;},__metadata=this&&this['__metadata']||function(_0x47b36b,_0x2ae75d){const _0x5dc1cb=_0x1ecf56;if(typeof Reflect===_0x5dc1cb(0x11a)&&typeof Reflect[_0x5dc1cb(0x108)]===_0x5dc1cb(0x104))return Reflect[_0x5dc1cb(0x108)](_0x47b36b,_0x2ae75d);};Object[_0x1ecf56(0xee)](exports,_0x1ecf56(0x135),{'value':!![]}),exports[_0x1ecf56(0xf9)]=void 0x0;function _0x39d6(){const _0x516e60=['BAD_REQUEST','user','onModuleInit','36636AhjbuL','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','wechatJsapiTicket','188kgURMB','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','scanedSceneStrMap','bindWx','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','getJsapiTicket','defineProperty','getConfigs','6331zxSaGN','610VWuVCl','@nestjs/common','userService','default','decorate','getQRSceneStr','fetchQRCodeTicket','QR_STR_SCENE','OfficialService',']]></Content>\x0a\x20\x20\x20\x20</xml>','sceneStrMap','HttpStatus','now','globalConfigService','genXmlMsg','loginByOpenId','get','getOwnPropertyDescriptor','UserService','function','&url=',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','createHash','metadata','design:paramtypes','&secret=','&redirect_uri=','jiangly','autoreplyService','../user/user.service','wechatOfficialAppId','jsapi_ticket=','length','sha1','wechatOfficialAppSecret','authService','7855661DDjmTO','genXmlMsgByConfig','AutoreplyService','wechatAccessToken','../chatgpt/chatgpt.service','object','46614pzjXAf','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','chatSyncFree','非法参数','hex','../auth/auth.service','__decorate','370ublgNq','bindWxBySceneStr','AuthService','getUserById','22394sHqNSf','officialAutoReplyText','loginByCode','getUserOpenId','scan','ChatgptService','appId:\x20','161091besTCZ','createRandomNonceStr','log','10104jsxArQ','回跳跳转地址:\x20',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','str:\x20','loginBySceneStr','__esModule','getQRSceneStrByBind','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','getWechatAccessToken','toFixed','79pparbR','tousername','&grant_type=authorization_code','getUserFromOpenId','../../common/utils','Injectable','sort','chatgptService','HttpException','987zTyxoZ','&timestamp=','&noncestr=','crypto','78630dnPrtz','请求超时'];_0x39d6=function(){return _0x516e60;};return _0x39d6();}const chatgpt_service_1=require(_0x1ecf56(0x119)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),auth_service_1=require(_0x1ecf56(0x120)),user_service_1=require(_0x1ecf56(0x10e)),autoreply_service_1=require('../autoreply/autoreply.service'),common_1=require(_0x1ecf56(0xf2)),crypto=require(_0x1ecf56(0xde)),axios_1=require('axios'),utils_1=require(_0x1ecf56(0x13e));let OfficialService=class OfficialService{constructor(_0x3cd91f,_0x2aba44,_0x43cec8,_0x37612c,_0x38332c){const _0x18c723=_0x1ecf56;this[_0x18c723(0x10d)]=_0x3cd91f,this[_0x18c723(0xf3)]=_0x2aba44,this[_0x18c723(0x114)]=_0x43cec8,this['globalConfigService']=_0x37612c,this[_0x18c723(0xd9)]=_0x38332c,this['sceneStrMap']={},this[_0x18c723(0xea)]={};}async[_0x1ecf56(0xe3)](){const _0x4f75cb=_0x1ecf56;await this[_0x4f75cb(0xfe)][_0x4f75cb(0x138)](!![]);}async[_0x1ecf56(0xf6)](_0x5025ee){const _0x1dc71f=_0x1ecf56,{invitedBy:_0x2c7620}=_0x5025ee;let _0x4f83bb=(0x0,utils_1[_0x1dc71f(0x12e)])(0x20);return _0x2c7620&&(_0x4f83bb+=':'+_0x2c7620),this['sceneStrMap'][_0x4f83bb]=!![],_0x4f83bb;}async[_0x1ecf56(0x136)](_0x4ce729){const _0x5878a0=_0x1ecf56,{id:_0x98adc4}=_0x4ce729[_0x5878a0(0xe2)],_0x212cb0=(0x0,utils_1[_0x5878a0(0x12e)])(0x20)+'/'+_0x98adc4;return this[_0x5878a0(0xfb)][_0x212cb0]=!![],_0x212cb0;}async['getQRCodeTicket'](_0x3d4e09){return this['fetchQRCodeTicket'](_0x3d4e09);}async['getRedirectUrl'](_0x95f06b){const _0x578ea0=_0x1ecf56,_0x2eb045=await this[_0x578ea0(0xfe)][_0x578ea0(0xef)]([_0x578ea0(0x10f)]),_0x5c6fca=_0x578ea0(0x11c)+_0x2eb045+_0x578ea0(0x10b)+encodeURIComponent(_0x95f06b)+_0x578ea0(0xec);return console['log'](_0x578ea0(0x131),_0x5c6fca),_0x5c6fca;}async[_0x1ecf56(0xed)](_0x4d48df){const _0x44c831=_0x1ecf56,_0x5739e2=(0x0,utils_1['createRandomNonceStr'])(0x20),_0x1363cf=(Date[_0x44c831(0xfd)]()/0x3e8)[_0x44c831(0x139)](0x0),_0x5cde88=await this[_0x44c831(0xfe)][_0x44c831(0xef)]([_0x44c831(0xe6)]);console[_0x44c831(0x12f)]('jsapiTicket:\x20',_0x5cde88);const _0xf27e04=await this[_0x44c831(0xfe)][_0x44c831(0xef)]([_0x44c831(0x10f)]);console['log'](_0x44c831(0x12c),_0xf27e04);const _0x172839=_0x44c831(0x110)+_0x5cde88+_0x44c831(0xdd)+_0x5739e2+_0x44c831(0xdc)+_0x1363cf+_0x44c831(0x105)+_0x4d48df;console[_0x44c831(0x12f)](_0x44c831(0x133),_0x172839);const _0x4c6074=this[_0x44c831(0x112)](_0x172839);return{'appId':_0xf27e04,'nonceStr':_0x5739e2,'timestamp':_0x1363cf,'signature':_0x4c6074};}async[_0x1ecf56(0xf7)](_0x510b5b){const _0x2469ca=_0x1ecf56,_0x5cc621=await this['globalConfigService'][_0x2469ca(0xef)]([_0x2469ca(0x118)]),_0x13ec81={'action_name':_0x2469ca(0xf8),'action_info':{'scene':{'scene_str':_0x510b5b}}},_0x5ddc7e=await axios_1[_0x2469ca(0xf4)]['post'](_0x2469ca(0x137)+_0x5cc621,_0x13ec81),{data:{errmsg:_0x5dfdc5,ticket:_0x2f0576}}=_0x5ddc7e;if(_0x5dfdc5)throw new common_1[(_0x2469ca(0xda))](_0x5dfdc5,common_1[_0x2469ca(0xfc)][_0x2469ca(0xe1)]);return _0x2f0576;}async[_0x1ecf56(0x128)](_0x29f972,_0x14140f){const _0x57f9e1=_0x1ecf56,_0x4f223b=await this[_0x57f9e1(0xfe)][_0x57f9e1(0xef)]([_0x57f9e1(0x10f)]),_0x4e12c8=await this[_0x57f9e1(0xfe)][_0x57f9e1(0xef)]([_0x57f9e1(0x113)]),_0x49426f=await axios_1[_0x57f9e1(0xf4)][_0x57f9e1(0x101)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x4f223b+_0x57f9e1(0x10a)+_0x4e12c8+'&code='+_0x14140f+_0x57f9e1(0x13c)),{data:{errmsg:_0x39fac1,openid:_0x154e00}}=_0x49426f;if(_0x39fac1)throw new common_1[(_0x57f9e1(0xda))](_0x39fac1,common_1[_0x57f9e1(0xfc)]['BAD_REQUEST']);let _0x3b7859;return _0x3b7859=await this[_0x57f9e1(0xf3)][_0x57f9e1(0x129)](_0x154e00),!_0x3b7859&&(_0x3b7859=await this[_0x57f9e1(0xf3)][_0x57f9e1(0x13d)](_0x154e00)),this['authService'][_0x57f9e1(0x100)](_0x3b7859,_0x29f972);}async[_0x1ecf56(0x12a)](_0x1256ea,_0x25dd8e){const _0x28541c=_0x1ecf56;if(!this[_0x28541c(0xfb)][_0x25dd8e])throw new common_1[(_0x28541c(0xda))](_0x28541c(0x11e),common_1[_0x28541c(0xfc)][_0x28541c(0xe1)]);const _0x512e12=await this['userService']['getUserFromOpenId'](_0x1256ea,_0x25dd8e);this[_0x28541c(0xea)][_0x25dd8e]=_0x512e12['id'];}async[_0x1ecf56(0x134)](_0x305320,_0xd5c15){const _0x429e2c=_0x1ecf56;if(!this[_0x429e2c(0xfb)][_0xd5c15])return;const _0xe29db0=this[_0x429e2c(0xea)][_0xd5c15];if(!_0xe29db0)return'';const _0x40342d=await this[_0x429e2c(0xf3)][_0x429e2c(0x125)](_0xe29db0);return delete this[_0x429e2c(0xea)][_0xd5c15],this[_0x429e2c(0x114)]['loginByOpenId'](_0x40342d,_0x305320);}async['scanBindWx'](_0x4fbafb,_0x2a8320){const _0x3792fa=_0x1ecf56;if(!this[_0x3792fa(0xfb)][_0x2a8320])throw new common_1[(_0x3792fa(0xda))](_0x3792fa(0x11e),common_1[_0x3792fa(0xfc)][_0x3792fa(0xe1)]);const _0x27707f=_0x2a8320['split']('/')[0x1],_0x11f646=await this[_0x3792fa(0xf3)][_0x3792fa(0xeb)](_0x4fbafb,_0x27707f);this['scanedSceneStrMap'][_0x2a8320]=_0x11f646;}async[_0x1ecf56(0x123)](_0x22e890,_0x460d48){const _0x11dba7=_0x1ecf56;if(!this[_0x11dba7(0xfb)][_0x460d48])throw new common_1[(_0x11dba7(0xda))](_0x11dba7(0x11e),common_1[_0x11dba7(0xfc)][_0x11dba7(0xe1)]);const {id:_0x313453}=_0x22e890[_0x11dba7(0xe2)],_0xe529f0=this[_0x11dba7(0xea)][_0x460d48];if(!_0xe529f0)return'';return delete this[_0x11dba7(0xea)][_0x460d48],_0xe529f0;}async['verify'](_0xf6d081,_0xd4e1e,_0x4ea8a8){const _0x364e0a=_0x1ecf56,_0x144b1=await this[_0x364e0a(0xfe)][_0x364e0a(0xef)](['wechatOfficialToken'])||_0x364e0a(0x10c);return await this[_0x364e0a(0x112)]([_0x144b1,_0xd4e1e,_0x4ea8a8][_0x364e0a(0xd8)]()['join'](''))==_0xf6d081;}[_0x1ecf56(0x112)](_0x2af8f0){const _0x313572=_0x1ecf56;return crypto[_0x313572(0x107)]('sha1')['update'](_0x2af8f0)['digest'](_0x313572(0x11f));}async[_0x1ecf56(0x116)](_0x10f181,_0x2071f8){const _0x5b6098=_0x1ecf56,_0x4c5e99=await this[_0x5b6098(0xfe)]['getConfigs']([_0x2071f8]);return this[_0x5b6098(0xff)](_0x10f181,_0x4c5e99);}async['genXmlMsg'](_0x2c525e,_0x4bdfe3){const _0x2f61e5=_0x1ecf56;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x2c525e['fromusername'][0x0]+_0x2f61e5(0x106)+_0x2c525e[_0x2f61e5(0x13b)][0x0]+_0x2f61e5(0x132)+new Date()['getTime']()+_0x2f61e5(0xe5)+_0x4bdfe3+_0x2f61e5(0xfa);}async['aotoPlay'](_0x538a19){const _0x5b87fd=_0x1ecf56,_0x3f11b2=new Promise((_0x91f0b1,_0x5c1aeb)=>{setTimeout(()=>{const _0x545693=_0x3896;_0x5c1aeb(new Error(_0x545693(0xe0)));},0x12c0);});let _0x56a2f9='';try{console['log']('来自公众号的询问问题\x20=======>\x20',_0x538a19);const _0x3b0890=await Promise['race']([this['chatgptService'][_0x5b87fd(0x11d)](_0x538a19),_0x3f11b2]);_0x56a2f9=_0x3b0890||await this[_0x5b87fd(0x10d)]['checkAutoReply'](_0x538a19);}catch(_0x519560){console[_0x5b87fd(0x12f)](_0x5b87fd(0xe9)),_0x56a2f9=await this[_0x5b87fd(0xfe)][_0x5b87fd(0xef)]([_0x5b87fd(0x127)])||_0x5b87fd(0xe8);}return _0x56a2f9;}};OfficialService=__decorate([(0x0,common_1[_0x1ecf56(0xd7)])(),__metadata(_0x1ecf56(0x109),[autoreply_service_1[_0x1ecf56(0x117)],user_service_1[_0x1ecf56(0x103)],auth_service_1[_0x1ecf56(0x124)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1[_0x1ecf56(0x12b)]])],OfficialService),exports[_0x1ecf56(0xf9)]=OfficialService;