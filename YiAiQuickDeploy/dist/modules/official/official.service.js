'use strict';const _0x19ad72=_0x1fd5;(function(_0x509138,_0x23ff84){const _0x5166e4=_0x1fd5,_0x54c9ee=_0x509138();while(!![]){try{const _0x552c71=parseInt(_0x5166e4(0x15c))/0x1*(-parseInt(_0x5166e4(0x17f))/0x2)+parseInt(_0x5166e4(0x161))/0x3+-parseInt(_0x5166e4(0x185))/0x4+-parseInt(_0x5166e4(0x17d))/0x5+-parseInt(_0x5166e4(0x142))/0x6+-parseInt(_0x5166e4(0x152))/0x7+parseInt(_0x5166e4(0x140))/0x8*(parseInt(_0x5166e4(0x15e))/0x9);if(_0x552c71===_0x23ff84)break;else _0x54c9ee['push'](_0x54c9ee['shift']());}catch(_0x203c97){_0x54c9ee['push'](_0x54c9ee['shift']());}}}(_0x4377,0xb38a2));var __decorate=this&&this['__decorate']||function(_0x47af3f,_0x2628fa,_0x2393ed,_0x28668d){const _0x403359=_0x1fd5;var _0x485df4=arguments[_0x403359(0x18e)],_0x360ea6=_0x485df4<0x3?_0x2628fa:_0x28668d===null?_0x28668d=Object[_0x403359(0x145)](_0x2628fa,_0x2393ed):_0x28668d,_0x3878ce;if(typeof Reflect===_0x403359(0x192)&&typeof Reflect['decorate']===_0x403359(0x158))_0x360ea6=Reflect[_0x403359(0x143)](_0x47af3f,_0x2628fa,_0x2393ed,_0x28668d);else{for(var _0x52a5af=_0x47af3f[_0x403359(0x18e)]-0x1;_0x52a5af>=0x0;_0x52a5af--)if(_0x3878ce=_0x47af3f[_0x52a5af])_0x360ea6=(_0x485df4<0x3?_0x3878ce(_0x360ea6):_0x485df4>0x3?_0x3878ce(_0x2628fa,_0x2393ed,_0x360ea6):_0x3878ce(_0x2628fa,_0x2393ed))||_0x360ea6;}return _0x485df4>0x3&&_0x360ea6&&Object['defineProperty'](_0x2628fa,_0x2393ed,_0x360ea6),_0x360ea6;},__metadata=this&&this['__metadata']||function(_0xf9d82a,_0xd86f27){const _0x18c37f=_0x1fd5;if(typeof Reflect===_0x18c37f(0x192)&&typeof Reflect[_0x18c37f(0x189)]==='function')return Reflect[_0x18c37f(0x189)](_0xf9d82a,_0xd86f27);};function _0x4377(){const _0x298667=['sha1','loginByOpenId','376712jMiqEO','../user/user.service','getWechatAccessToken','OfficialService','tousername','join','function','digest','getRedirectUrl','AuthService','213iagQXc','log','963KYnWJv','globalConfigService','getQRSceneStr','3640119eSmhrT','BAD_REQUEST','../globalConfig/globalConfig.service','onModuleInit','UserService','&secret=','getJsapiTicket','../chatgpt/chatgpt.service','来自公众号的询问问题\x20=======>\x20','split','HttpException','AutoreplyService','now',']]></Content>\x0a\x20\x20\x20\x20</xml>','default','fromusername','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','&noncestr=','wechatOfficialToken','&redirect_uri=','getUserById','loginByCode',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','getConfigs','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','非法参数','jsapiTicket:\x20','verify','5505790pdMSzk','getQRCodeTicket','9188Bujbxs','fetchQRCodeTicket','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','str:\x20','请求超时','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','4279688oTxiVE','createRandomNonceStr','__esModule','wechatOfficialAppId','metadata','toFixed','bindWx','crypto','genXmlMsgByConfig','length','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','axios','user','object','createHash','@nestjs/common','authService','Injectable','&url=','GlobalConfigService','&code=','../auth/auth.service','chatSyncFree','../../common/utils','getUserOpenId','userService','HttpStatus','wechatAccessToken','getUserFromOpenId','genXmlMsg','回跳跳转地址:\x20','227896mwDkmh','scanedSceneStrMap','1936020fLjLgS','decorate','checkAutoReply','getOwnPropertyDescriptor','get','update','sceneStrMap','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','wechatJsapiTicket','bindWxBySceneStr','&timestamp=','race','chatgptService','loginBySceneStr'];_0x4377=function(){return _0x298667;};return _0x4377();}Object['defineProperty'](exports,_0x19ad72(0x187),{'value':!![]}),exports[_0x19ad72(0x155)]=void 0x0;function _0x1fd5(_0x51dda4,_0x202d0e){const _0x4377d6=_0x4377();return _0x1fd5=function(_0x1fd58e,_0x58e83a){_0x1fd58e=_0x1fd58e-0x132;let _0x577b0f=_0x4377d6[_0x1fd58e];return _0x577b0f;},_0x1fd5(_0x51dda4,_0x202d0e);}const chatgpt_service_1=require(_0x19ad72(0x168)),globalConfig_service_1=require(_0x19ad72(0x163)),auth_service_1=require(_0x19ad72(0x136)),user_service_1=require(_0x19ad72(0x153)),autoreply_service_1=require('../autoreply/autoreply.service'),common_1=require(_0x19ad72(0x194)),crypto=require(_0x19ad72(0x18c)),axios_1=require(_0x19ad72(0x190)),utils_1=require(_0x19ad72(0x138));let OfficialService=class OfficialService{constructor(_0x5ab17d,_0x365d9a,_0xcec72,_0x41e18f,_0x24e74c){const _0x1918e6=_0x19ad72;this['autoreplyService']=_0x5ab17d,this[_0x1918e6(0x13a)]=_0x365d9a,this[_0x1918e6(0x195)]=_0xcec72,this[_0x1918e6(0x15f)]=_0x41e18f,this['chatgptService']=_0x24e74c,this[_0x1918e6(0x148)]={},this[_0x1918e6(0x141)]={};}async[_0x19ad72(0x164)](){const _0x149b38=_0x19ad72;await this['globalConfigService'][_0x149b38(0x154)](!![]);}async[_0x19ad72(0x160)](_0x4f0f3f){const _0xbb19f9=_0x19ad72,{invitedBy:_0x4253d0}=_0x4f0f3f;let _0xcbea=(0x0,utils_1[_0xbb19f9(0x186)])(0x20);return _0x4253d0&&(_0xcbea+=':'+_0x4253d0),this[_0xbb19f9(0x148)][_0xcbea]=!![],_0xcbea;}async['getQRSceneStrByBind'](_0x287764){const _0x52e20b=_0x19ad72,{id:_0x2d6214}=_0x287764['user'],_0x19c5a0=(0x0,utils_1['createRandomNonceStr'])(0x20)+'/'+_0x2d6214;return this[_0x52e20b(0x148)][_0x19c5a0]=!![],_0x19c5a0;}async[_0x19ad72(0x17e)](_0x55de88){const _0x551bc7=_0x19ad72;return this[_0x551bc7(0x180)](_0x55de88);}async[_0x19ad72(0x15a)](_0x720c9d){const _0x1cd9b7=_0x19ad72,_0x53976f=await this[_0x1cd9b7(0x15f)][_0x1cd9b7(0x178)]([_0x1cd9b7(0x188)]),_0x3a5190='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x53976f+_0x1cd9b7(0x174)+encodeURIComponent(_0x720c9d)+_0x1cd9b7(0x179);return console[_0x1cd9b7(0x15d)](_0x1cd9b7(0x13f),_0x3a5190),_0x3a5190;}async[_0x19ad72(0x167)](_0x4e818e){const _0x3b6b4d=_0x19ad72,_0x4c6d56=(0x0,utils_1[_0x3b6b4d(0x186)])(0x20),_0x39b5a3=(Date[_0x3b6b4d(0x16d)]()/0x3e8)[_0x3b6b4d(0x18a)](0x0),_0x644ac7=await this[_0x3b6b4d(0x15f)]['getConfigs']([_0x3b6b4d(0x14a)]);console[_0x3b6b4d(0x15d)](_0x3b6b4d(0x17b),_0x644ac7);const _0xdc4507=await this['globalConfigService'][_0x3b6b4d(0x178)]([_0x3b6b4d(0x188)]);console[_0x3b6b4d(0x15d)]('appId:\x20',_0xdc4507);const _0x1a68a2='jsapi_ticket='+_0x644ac7+_0x3b6b4d(0x172)+_0x4c6d56+_0x3b6b4d(0x14c)+_0x39b5a3+_0x3b6b4d(0x133)+_0x4e818e;console[_0x3b6b4d(0x15d)](_0x3b6b4d(0x182),_0x1a68a2);const _0x21513d=this[_0x3b6b4d(0x150)](_0x1a68a2);return{'appId':_0xdc4507,'nonceStr':_0x4c6d56,'timestamp':_0x39b5a3,'signature':_0x21513d};}async['fetchQRCodeTicket'](_0x385fb3){const _0x2d105d=_0x19ad72,_0x299c3c=await this['globalConfigService'][_0x2d105d(0x178)]([_0x2d105d(0x13c)]),_0x45fb1b={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x385fb3}}};console[_0x2d105d(0x15d)]('accessToken***',_0x299c3c);const _0x165b37=await axios_1[_0x2d105d(0x16f)]['post'](_0x2d105d(0x18f)+_0x299c3c,_0x45fb1b),{data:{errmsg:_0x56167c,ticket:_0x207b13}}=_0x165b37;console[_0x2d105d(0x15d)]('qrcodecreate',_0x165b37);if(_0x56167c)throw new common_1[(_0x2d105d(0x16b))](_0x56167c,common_1[_0x2d105d(0x13b)][_0x2d105d(0x162)]);return _0x207b13;}async[_0x19ad72(0x176)](_0x1757d0,_0x583e27){const _0x194aef=_0x19ad72,_0x1b894c=await this[_0x194aef(0x15f)]['getConfigs']([_0x194aef(0x188)]),_0x58f390=await this[_0x194aef(0x15f)][_0x194aef(0x178)](['wechatOfficialAppSecret']),_0xd566bc=await axios_1[_0x194aef(0x16f)][_0x194aef(0x146)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x1b894c+_0x194aef(0x166)+_0x58f390+_0x194aef(0x135)+_0x583e27+'&grant_type=authorization_code'),{data:{errmsg:_0x2be094,openid:_0x4b4457}}=_0xd566bc;if(_0x2be094)throw new common_1[(_0x194aef(0x16b))](_0x2be094,common_1[_0x194aef(0x13b)]['BAD_REQUEST']);let _0x240395;return _0x240395=await this[_0x194aef(0x13a)][_0x194aef(0x139)](_0x4b4457),!_0x240395&&(_0x240395=await this[_0x194aef(0x13a)][_0x194aef(0x13d)](_0x4b4457)),this[_0x194aef(0x195)][_0x194aef(0x151)](_0x240395,_0x1757d0);}async['scan'](_0x38772c,_0x14407b){const _0x4ffd64=_0x19ad72;if(!this[_0x4ffd64(0x148)][_0x14407b])throw new common_1[(_0x4ffd64(0x16b))](_0x4ffd64(0x17a),common_1['HttpStatus']['BAD_REQUEST']);const _0x532b84=await this[_0x4ffd64(0x13a)][_0x4ffd64(0x13d)](_0x38772c,_0x14407b);this[_0x4ffd64(0x141)][_0x14407b]=_0x532b84['id'];}async[_0x19ad72(0x14f)](_0x47f6b9,_0x51e953){const _0x4530e2=_0x19ad72;if(!this['sceneStrMap'][_0x51e953])return;const _0x3dc31b=this[_0x4530e2(0x141)][_0x51e953];if(!_0x3dc31b)return'';const _0x2c0b50=await this[_0x4530e2(0x13a)][_0x4530e2(0x175)](_0x3dc31b);return delete this[_0x4530e2(0x141)][_0x51e953],this[_0x4530e2(0x195)]['loginByOpenId'](_0x2c0b50,_0x47f6b9);}async['scanBindWx'](_0x2125cf,_0x5476ff){const _0x56a5e9=_0x19ad72;if(!this['sceneStrMap'][_0x5476ff])throw new common_1[(_0x56a5e9(0x16b))]('非法参数',common_1[_0x56a5e9(0x13b)][_0x56a5e9(0x162)]);const _0xc5b154=_0x5476ff[_0x56a5e9(0x16a)]('/')[0x1],_0x459af7=await this[_0x56a5e9(0x13a)][_0x56a5e9(0x18b)](_0x2125cf,_0xc5b154);this[_0x56a5e9(0x141)][_0x5476ff]=_0x459af7;}async[_0x19ad72(0x14b)](_0x84fb55,_0x6b6378){const _0x3138dc=_0x19ad72;if(!this[_0x3138dc(0x148)][_0x6b6378])throw new common_1[(_0x3138dc(0x16b))](_0x3138dc(0x17a),common_1[_0x3138dc(0x13b)][_0x3138dc(0x162)]);const {id:_0x19c3c9}=_0x84fb55[_0x3138dc(0x191)],_0x410824=this[_0x3138dc(0x141)][_0x6b6378];if(!_0x410824)return'';return delete this[_0x3138dc(0x141)][_0x6b6378],_0x410824;}async[_0x19ad72(0x17c)](_0x5e071d,_0x70b60e,_0x9c7ea9){const _0x549410=_0x19ad72,_0x208a58=await this['globalConfigService'][_0x549410(0x178)]([_0x549410(0x173)])||'jiangly';return await this[_0x549410(0x150)]([_0x208a58,_0x70b60e,_0x9c7ea9]['sort']()[_0x549410(0x157)](''))==_0x5e071d;}[_0x19ad72(0x150)](_0x116b6c){const _0x23092e=_0x19ad72;return crypto[_0x23092e(0x193)]('sha1')[_0x23092e(0x147)](_0x116b6c)[_0x23092e(0x159)]('hex');}async[_0x19ad72(0x18d)](_0x3fb353,_0x2f30a0){const _0x307d91=_0x19ad72,_0x37e2fa=await this[_0x307d91(0x15f)][_0x307d91(0x178)]([_0x2f30a0]);return this['genXmlMsg'](_0x3fb353,_0x37e2fa);}async[_0x19ad72(0x13e)](_0x558285,_0x1dcbd3){const _0x3b347a=_0x19ad72;return _0x3b347a(0x184)+_0x558285[_0x3b347a(0x170)][0x0]+_0x3b347a(0x177)+_0x558285[_0x3b347a(0x156)][0x0]+']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>'+new Date()['getTime']()+_0x3b347a(0x181)+_0x1dcbd3+_0x3b347a(0x16e);}async['aotoPlay'](_0x109621){const _0x344bf0=_0x19ad72,_0x4d7186=new Promise((_0x3b259c,_0x1a9be5)=>{setTimeout(()=>{const _0x2101b6=_0x1fd5;_0x1a9be5(new Error(_0x2101b6(0x183)));},0x12c0);});let _0x471e9b='';try{console[_0x344bf0(0x15d)](_0x344bf0(0x169),_0x109621);const _0x381621=await Promise[_0x344bf0(0x14d)]([this[_0x344bf0(0x14e)][_0x344bf0(0x137)](_0x109621),_0x4d7186]);_0x471e9b=_0x381621||await this['autoreplyService'][_0x344bf0(0x144)](_0x109621);}catch(_0x2408a4){console[_0x344bf0(0x15d)](_0x344bf0(0x171)),_0x471e9b=await this[_0x344bf0(0x15f)]['getConfigs'](['officialAutoReplyText'])||_0x344bf0(0x149);}return _0x471e9b;}};OfficialService=__decorate([(0x0,common_1[_0x19ad72(0x132)])(),__metadata('design:paramtypes',[autoreply_service_1[_0x19ad72(0x16c)],user_service_1[_0x19ad72(0x165)],auth_service_1[_0x19ad72(0x15b)],globalConfig_service_1[_0x19ad72(0x134)],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x19ad72(0x155)]=OfficialService;