'use strict';const _0x19820b=_0x2375;(function(_0x5bdb1f,_0x164ff9){const _0x2cab27=_0x2375,_0x1006ad=_0x5bdb1f();while(!![]){try{const _0x38ccca=parseInt(_0x2cab27(0x189))/0x1+-parseInt(_0x2cab27(0x168))/0x2+-parseInt(_0x2cab27(0x1ad))/0x3*(parseInt(_0x2cab27(0x188))/0x4)+-parseInt(_0x2cab27(0x178))/0x5*(parseInt(_0x2cab27(0x195))/0x6)+parseInt(_0x2cab27(0x1a9))/0x7+parseInt(_0x2cab27(0x1c0))/0x8*(-parseInt(_0x2cab27(0x1c2))/0x9)+parseInt(_0x2cab27(0x199))/0xa;if(_0x38ccca===_0x164ff9)break;else _0x1006ad['push'](_0x1006ad['shift']());}catch(_0x4b04cd){_0x1006ad['push'](_0x1006ad['shift']());}}}(_0x1d6c,0x18949));var __decorate=this&&this[_0x19820b(0x1aa)]||function(_0x50edb7,_0x2e5959,_0x2b1909,_0x592da6){const _0x5218cc=_0x19820b;var _0x1d644c=arguments[_0x5218cc(0x172)],_0x57f5ff=_0x1d644c<0x3?_0x2e5959:_0x592da6===null?_0x592da6=Object[_0x5218cc(0x18a)](_0x2e5959,_0x2b1909):_0x592da6,_0x9bb16a;if(typeof Reflect===_0x5218cc(0x174)&&typeof Reflect['decorate']==='function')_0x57f5ff=Reflect[_0x5218cc(0x176)](_0x50edb7,_0x2e5959,_0x2b1909,_0x592da6);else{for(var _0x4bafc9=_0x50edb7[_0x5218cc(0x172)]-0x1;_0x4bafc9>=0x0;_0x4bafc9--)if(_0x9bb16a=_0x50edb7[_0x4bafc9])_0x57f5ff=(_0x1d644c<0x3?_0x9bb16a(_0x57f5ff):_0x1d644c>0x3?_0x9bb16a(_0x2e5959,_0x2b1909,_0x57f5ff):_0x9bb16a(_0x2e5959,_0x2b1909))||_0x57f5ff;}return _0x1d644c>0x3&&_0x57f5ff&&Object['defineProperty'](_0x2e5959,_0x2b1909,_0x57f5ff),_0x57f5ff;},__metadata=this&&this['__metadata']||function(_0x58e7f0,_0x13b23d){const _0x525775=_0x19820b;if(typeof Reflect===_0x525775(0x174)&&typeof Reflect[_0x525775(0x1c8)]===_0x525775(0x1c6))return Reflect[_0x525775(0x1c8)](_0x58e7f0,_0x13b23d);};function _0x2375(_0x1831a3,_0x3ee0c0){const _0x1d6cf7=_0x1d6c();return _0x2375=function(_0x2375f5,_0x4c53cd){_0x2375f5=_0x2375f5-0x165;let _0x5747bb=_0x1d6cf7[_0x2375f5];return _0x5747bb;},_0x2375(_0x1831a3,_0x3ee0c0);}Object[_0x19820b(0x1b0)](exports,_0x19820b(0x19d),{'value':!![]}),exports[_0x19820b(0x1a8)]=void 0x0;const chatgpt_service_1=require(_0x19820b(0x16e)),globalConfig_service_1=require(_0x19820b(0x1ae)),auth_service_1=require('../auth/auth.service'),user_service_1=require(_0x19820b(0x1a4)),autoreply_service_1=require(_0x19820b(0x166)),common_1=require(_0x19820b(0x196)),crypto=require('crypto'),axios_1=require(_0x19820b(0x1be)),utils_1=require(_0x19820b(0x1ba));function _0x1d6c(){const _0x49b62c=['&url=','AuthService','toFixed','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','jsapi_ticket=','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','12lMlJyy','@nestjs/common','autoreplyService','非法参数','3001640SiQuuB','&redirect_uri=','officialAutoReplyText','fromusername','__esModule','scanedSceneStrMap','jsapiTicket:\x20','race','HttpStatus','ChatgptService','design:paramtypes','../user/user.service','chatgptService','getUserFromOpenId','authService','OfficialService','1349173eQzZBj','__decorate','getQRCodeTicket','HttpException','178047XIjHQl','../globalConfig/globalConfig.service','onModuleInit','defineProperty','sort','AutoreplyService','wechatAccessToken','default','createRandomNonceStr','getUserById','getUserOpenId','createHash','verify','../../common/utils','update','bindWx','aotoPlay','axios',']]></Content>\x0a\x20\x20\x20\x20</xml>','107904fPvqUM','getJsapiTicket','108djBZfM','来自公众号的询问问题\x20=======>\x20','wechatJsapiTicket','&secret=','function','log','metadata','globalConfigService','../autoreply/autoreply.service','wechatOfficialToken','321138pRYMYK',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','getRedirectUrl','getQRSceneStr','UserService','loginByOpenId','../chatgpt/chatgpt.service','&timestamp=','jiangly','user','length','genXmlMsg','object','getTime','decorate','appId:\x20','306125KNweAM','BAD_REQUEST','getConfigs','checkAutoReply','str:\x20','回跳跳转地址:\x20',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','wechatOfficialAppId','getWechatAccessToken','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','sha1','&noncestr=','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','scanBindWx','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','sceneStrMap','8aVIziT','171351IUqjbp','getOwnPropertyDescriptor','userService','split','wechatOfficialAppSecret','scan'];_0x1d6c=function(){return _0x49b62c;};return _0x1d6c();}let OfficialService=class OfficialService{constructor(_0x242e66,_0xb25911,_0x2db47d,_0x4b00cf,_0x458a85){const _0x2e02db=_0x19820b;this[_0x2e02db(0x197)]=_0x242e66,this['userService']=_0xb25911,this[_0x2e02db(0x1a7)]=_0x2db47d,this['globalConfigService']=_0x4b00cf,this[_0x2e02db(0x1a5)]=_0x458a85,this[_0x2e02db(0x187)]={},this[_0x2e02db(0x19e)]={};}async[_0x19820b(0x1af)](){const _0x25a8f9=_0x19820b;await this[_0x25a8f9(0x165)][_0x25a8f9(0x180)](!![]);}async[_0x19820b(0x16b)](_0xc24225){const _0xf505cc=_0x19820b,{invitedBy:_0x113985}=_0xc24225;let _0x44f450=(0x0,utils_1[_0xf505cc(0x1b5)])(0x20);return _0x113985&&(_0x44f450+=':'+_0x113985),this[_0xf505cc(0x187)][_0x44f450]=!![],_0x44f450;}async['getQRSceneStrByBind'](_0xa09a66){const _0x3c2738=_0x19820b,{id:_0x5ed0aa}=_0xa09a66[_0x3c2738(0x171)],_0x5b5e89=(0x0,utils_1[_0x3c2738(0x1b5)])(0x20)+'/'+_0x5ed0aa;return this['sceneStrMap'][_0x5b5e89]=!![],_0x5b5e89;}async[_0x19820b(0x1ab)](_0x3f041e){return this['fetchQRCodeTicket'](_0x3f041e);}async[_0x19820b(0x16a)](_0x3fbc3f){const _0x341b6f=_0x19820b,_0x5a6248=await this[_0x341b6f(0x165)]['getConfigs']([_0x341b6f(0x17f)]),_0x114ace=_0x341b6f(0x186)+_0x5a6248+_0x341b6f(0x19a)+encodeURIComponent(_0x3fbc3f)+'&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect';return console['log'](_0x341b6f(0x17d),_0x114ace),_0x114ace;}async[_0x19820b(0x1c1)](_0x5433a2){const _0x1ab27f=_0x19820b,_0x3777c5=(0x0,utils_1[_0x1ab27f(0x1b5)])(0x20),_0x59a7ec=(Date['now']()/0x3e8)[_0x1ab27f(0x191)](0x0),_0x3524ac=await this[_0x1ab27f(0x165)][_0x1ab27f(0x17a)]([_0x1ab27f(0x1c4)]);console['log'](_0x1ab27f(0x19f),_0x3524ac);const _0x23a86e=await this[_0x1ab27f(0x165)][_0x1ab27f(0x17a)]([_0x1ab27f(0x17f)]);console[_0x1ab27f(0x1c7)](_0x1ab27f(0x177),_0x23a86e);const _0x41f315=_0x1ab27f(0x193)+_0x3524ac+_0x1ab27f(0x183)+_0x3777c5+_0x1ab27f(0x16f)+_0x59a7ec+_0x1ab27f(0x18f)+_0x5433a2;console['log'](_0x1ab27f(0x17c),_0x41f315);const _0x44b527=this['sha1'](_0x41f315);return{'appId':_0x23a86e,'nonceStr':_0x3777c5,'timestamp':_0x59a7ec,'signature':_0x44b527};}async['fetchQRCodeTicket'](_0x528705){const _0x42bc64=_0x19820b,_0x307d46=await this['globalConfigService'][_0x42bc64(0x17a)]([_0x42bc64(0x1b3)]),_0x3e0c61={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x528705}}},_0x111cdd=await axios_1[_0x42bc64(0x1b4)]['post'](_0x42bc64(0x194)+_0x307d46,_0x3e0c61),{data:{errmsg:_0x5c8f4f,ticket:_0x471e65}}=_0x111cdd;if(_0x5c8f4f)throw new common_1[(_0x42bc64(0x1ac))](_0x5c8f4f,common_1[_0x42bc64(0x1a1)]['BAD_REQUEST']);return _0x471e65;}async['loginByCode'](_0x223541,_0x45bce9){const _0x2c6b91=_0x19820b,_0x3d8f00=await this[_0x2c6b91(0x165)][_0x2c6b91(0x17a)]([_0x2c6b91(0x17f)]),_0x124074=await this[_0x2c6b91(0x165)][_0x2c6b91(0x17a)]([_0x2c6b91(0x18d)]),_0x5e3042=await axios_1[_0x2c6b91(0x1b4)]['get']('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x3d8f00+_0x2c6b91(0x1c5)+_0x124074+'&code='+_0x45bce9+'&grant_type=authorization_code'),{data:{errmsg:_0x4fda84,openid:_0x93a1d4}}=_0x5e3042;if(_0x4fda84)throw new common_1['HttpException'](_0x4fda84,common_1[_0x2c6b91(0x1a1)][_0x2c6b91(0x179)]);let _0x8b123b;return _0x8b123b=await this['userService'][_0x2c6b91(0x1b7)](_0x93a1d4),!_0x8b123b&&(_0x8b123b=await this[_0x2c6b91(0x18b)][_0x2c6b91(0x1a6)](_0x93a1d4)),this[_0x2c6b91(0x1a7)][_0x2c6b91(0x16d)](_0x8b123b,_0x223541);}async[_0x19820b(0x18e)](_0x7247b1,_0x453f1f){const _0x5e03f4=_0x19820b;if(!this[_0x5e03f4(0x187)][_0x453f1f])throw new common_1[(_0x5e03f4(0x1ac))]('非法参数',common_1['HttpStatus']['BAD_REQUEST']);const _0x2b1bf7=await this['userService'][_0x5e03f4(0x1a6)](_0x7247b1,_0x453f1f);this[_0x5e03f4(0x19e)][_0x453f1f]=_0x2b1bf7['id'];}async['loginBySceneStr'](_0x25a357,_0x1d9321){const _0x508951=_0x19820b;if(!this[_0x508951(0x187)][_0x1d9321])return;const _0x2e4ba6=this[_0x508951(0x19e)][_0x1d9321];if(!_0x2e4ba6)return'';const _0x42c735=await this[_0x508951(0x18b)][_0x508951(0x1b6)](_0x2e4ba6);return delete this[_0x508951(0x19e)][_0x1d9321],this[_0x508951(0x1a7)][_0x508951(0x16d)](_0x42c735,_0x25a357);}async[_0x19820b(0x185)](_0x55f7be,_0x5bcf02){const _0x6edaaf=_0x19820b;if(!this[_0x6edaaf(0x187)][_0x5bcf02])throw new common_1[(_0x6edaaf(0x1ac))](_0x6edaaf(0x198),common_1[_0x6edaaf(0x1a1)][_0x6edaaf(0x179)]);const _0x32445e=_0x5bcf02[_0x6edaaf(0x18c)]('/')[0x1],_0x132423=await this[_0x6edaaf(0x18b)][_0x6edaaf(0x1bc)](_0x55f7be,_0x32445e);this[_0x6edaaf(0x19e)][_0x5bcf02]=_0x132423;}async['bindWxBySceneStr'](_0x439fe5,_0x2df723){const _0x1e704a=_0x19820b;if(!this['sceneStrMap'][_0x2df723])throw new common_1[(_0x1e704a(0x1ac))]('非法参数',common_1['HttpStatus'][_0x1e704a(0x179)]);const {id:_0xe5b853}=_0x439fe5[_0x1e704a(0x171)],_0x238345=this[_0x1e704a(0x19e)][_0x2df723];if(!_0x238345)return'';return delete this[_0x1e704a(0x19e)][_0x2df723],_0x238345;}async[_0x19820b(0x1b9)](_0x518955,_0x4a1da8,_0x5553b2){const _0x5f1236=_0x19820b,_0x25bcd9=await this[_0x5f1236(0x165)][_0x5f1236(0x17a)]([_0x5f1236(0x167)])||_0x5f1236(0x170);return await this[_0x5f1236(0x182)]([_0x25bcd9,_0x4a1da8,_0x5553b2][_0x5f1236(0x1b1)]()['join'](''))==_0x518955;}[_0x19820b(0x182)](_0x3c1e12){const _0x668ad1=_0x19820b;return crypto[_0x668ad1(0x1b8)](_0x668ad1(0x182))[_0x668ad1(0x1bb)](_0x3c1e12)['digest']('hex');}async['genXmlMsgByConfig'](_0x53c83a,_0x5b4447){const _0x505957=_0x19820b,_0x2d11c3=await this['globalConfigService'][_0x505957(0x17a)]([_0x5b4447]);return this[_0x505957(0x173)](_0x53c83a,_0x2d11c3);}async['genXmlMsg'](_0x2985c9,_0x574597){const _0x3d31b9=_0x19820b;return _0x3d31b9(0x192)+_0x2985c9[_0x3d31b9(0x19c)][0x0]+_0x3d31b9(0x169)+_0x2985c9['tousername'][0x0]+_0x3d31b9(0x17e)+new Date()[_0x3d31b9(0x175)]()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x574597+_0x3d31b9(0x1bf);}async[_0x19820b(0x1bd)](_0x58ac06){const _0x5f074b=_0x19820b,_0x1d35b6=new Promise((_0x50f16d,_0x1ddaac)=>{setTimeout(()=>{_0x1ddaac(new Error('请求超时'));},0x12c0);});let _0x58b58b='';try{console[_0x5f074b(0x1c7)](_0x5f074b(0x1c3),_0x58ac06);const _0x45fded=await Promise[_0x5f074b(0x1a0)]([this[_0x5f074b(0x1a5)]['chatSyncFree'](_0x58ac06),_0x1d35b6]);_0x58b58b=_0x45fded||await this[_0x5f074b(0x197)][_0x5f074b(0x17b)](_0x58ac06);}catch(_0x533b15){console[_0x5f074b(0x1c7)](_0x5f074b(0x181)),_0x58b58b=await this[_0x5f074b(0x165)][_0x5f074b(0x17a)]([_0x5f074b(0x19b)])||_0x5f074b(0x184);}return _0x58b58b;}};OfficialService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x19820b(0x1a3),[autoreply_service_1[_0x19820b(0x1b2)],user_service_1[_0x19820b(0x16c)],auth_service_1[_0x19820b(0x190)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1[_0x19820b(0x1a2)]])],OfficialService),exports[_0x19820b(0x1a8)]=OfficialService;