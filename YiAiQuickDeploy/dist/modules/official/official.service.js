'use strict';const _0x3a9c31=_0x58a7;(function(_0x4e5d2d,_0x41be03){const _0x4464d0=_0x58a7,_0x4025fe=_0x4e5d2d();while(!![]){try{const _0x40de35=-parseInt(_0x4464d0(0x94))/0x1+-parseInt(_0x4464d0(0xbe))/0x2+parseInt(_0x4464d0(0x81))/0x3+-parseInt(_0x4464d0(0xd4))/0x4+parseInt(_0x4464d0(0xc1))/0x5*(parseInt(_0x4464d0(0xae))/0x6)+-parseInt(_0x4464d0(0x92))/0x7*(parseInt(_0x4464d0(0xa2))/0x8)+-parseInt(_0x4464d0(0xd1))/0x9*(-parseInt(_0x4464d0(0xd2))/0xa);if(_0x40de35===_0x41be03)break;else _0x4025fe['push'](_0x4025fe['shift']());}catch(_0xb7b780){_0x4025fe['push'](_0x4025fe['shift']());}}}(_0x50a7,0xddee3));function _0x58a7(_0x41a226,_0x342994){const _0x50a7f7=_0x50a7();return _0x58a7=function(_0x58a7d6,_0xa9bed2){_0x58a7d6=_0x58a7d6-0x7c;let _0x4b525a=_0x50a7f7[_0x58a7d6];return _0x4b525a;},_0x58a7(_0x41a226,_0x342994);}var __decorate=this&&this[_0x3a9c31(0x7c)]||function(_0x2060c9,_0x442df6,_0x46d6ea,_0x2e2945){const _0x206678=_0x3a9c31;var _0x5be3f4=arguments[_0x206678(0xdf)],_0x19061b=_0x5be3f4<0x3?_0x442df6:_0x2e2945===null?_0x2e2945=Object[_0x206678(0x87)](_0x442df6,_0x46d6ea):_0x2e2945,_0x1c8d85;if(typeof Reflect==='object'&&typeof Reflect[_0x206678(0x8c)]==='function')_0x19061b=Reflect[_0x206678(0x8c)](_0x2060c9,_0x442df6,_0x46d6ea,_0x2e2945);else{for(var _0x13ac69=_0x2060c9['length']-0x1;_0x13ac69>=0x0;_0x13ac69--)if(_0x1c8d85=_0x2060c9[_0x13ac69])_0x19061b=(_0x5be3f4<0x3?_0x1c8d85(_0x19061b):_0x5be3f4>0x3?_0x1c8d85(_0x442df6,_0x46d6ea,_0x19061b):_0x1c8d85(_0x442df6,_0x46d6ea))||_0x19061b;}return _0x5be3f4>0x3&&_0x19061b&&Object[_0x206678(0xd8)](_0x442df6,_0x46d6ea,_0x19061b),_0x19061b;},__metadata=this&&this[_0x3a9c31(0x85)]||function(_0x180b60,_0x119064){const _0x14b5d5=_0x3a9c31;if(typeof Reflect===_0x14b5d5(0xb2)&&typeof Reflect[_0x14b5d5(0x90)]===_0x14b5d5(0x7d))return Reflect[_0x14b5d5(0x90)](_0x180b60,_0x119064);};Object[_0x3a9c31(0xd8)](exports,_0x3a9c31(0x9e),{'value':!![]}),exports[_0x3a9c31(0x9b)]=void 0x0;const chatgpt_service_1=require(_0x3a9c31(0x88)),globalConfig_service_1=require(_0x3a9c31(0xe0)),auth_service_1=require(_0x3a9c31(0xbf)),user_service_1=require(_0x3a9c31(0xc0)),autoreply_service_1=require('../autoreply/autoreply.service'),common_1=require(_0x3a9c31(0x98)),crypto=require(_0x3a9c31(0x84)),axios_1=require(_0x3a9c31(0x89)),utils_1=require(_0x3a9c31(0xcd));let OfficialService=class OfficialService{constructor(_0x196f8a,_0x154a69,_0x582259,_0x2041c4,_0x490ecb){const _0x370d37=_0x3a9c31;this[_0x370d37(0x9c)]=_0x196f8a,this[_0x370d37(0xb6)]=_0x154a69,this[_0x370d37(0x91)]=_0x582259,this[_0x370d37(0xa3)]=_0x2041c4,this[_0x370d37(0xbd)]=_0x490ecb,this[_0x370d37(0xcf)]={},this[_0x370d37(0xb0)]={};}async[_0x3a9c31(0xca)](){const _0x4a578c=_0x3a9c31;await this[_0x4a578c(0xa3)]['getWechatAccessToken'](!![]);}async[_0x3a9c31(0xac)](_0x2c946c){const {invitedBy:_0x25478e}=_0x2c946c;let _0x52b1e4=(0x0,utils_1['createRandomNonceStr'])(0x20);return _0x25478e&&(_0x52b1e4+=':'+_0x25478e),this['sceneStrMap'][_0x52b1e4]=!![],_0x52b1e4;}async[_0x3a9c31(0x8e)](_0x4b946c){const {id:_0x327322}=_0x4b946c['user'],_0x1fde60=(0x0,utils_1['createRandomNonceStr'])(0x20)+'/'+_0x327322;return this['sceneStrMap'][_0x1fde60]=!![],_0x1fde60;}async['getQRCodeTicket'](_0x47c49a){const _0x12a9b0=_0x3a9c31;return this[_0x12a9b0(0xab)](_0x47c49a);}async[_0x3a9c31(0xa9)](_0x44b7c8){const _0x59bb5e=_0x3a9c31,_0x1c4be6=await this[_0x59bb5e(0xa3)][_0x59bb5e(0xd9)]([_0x59bb5e(0xad)]),_0x4e4de9=_0x59bb5e(0xb1)+_0x1c4be6+_0x59bb5e(0xce)+encodeURIComponent(_0x44b7c8)+_0x59bb5e(0xc6);return console[_0x59bb5e(0xc3)]('回跳跳转地址:\x20',_0x4e4de9),_0x4e4de9;}async[_0x3a9c31(0xde)](_0x3cee60){const _0x557200=_0x3a9c31,_0x27ea20=(0x0,utils_1[_0x557200(0xa8)])(0x20),_0x735b0b=(Date['now']()/0x3e8)['toFixed'](0x0),_0x3c32a8=await this[_0x557200(0xa3)][_0x557200(0xd9)]([_0x557200(0xd0)]);console[_0x557200(0xc3)](_0x557200(0xdb),_0x3c32a8);const _0x51e610=await this[_0x557200(0xa3)]['getConfigs']([_0x557200(0xad)]);console[_0x557200(0xc3)]('appId:\x20',_0x51e610);const _0x326127='jsapi_ticket='+_0x3c32a8+_0x557200(0xa6)+_0x27ea20+_0x557200(0xc2)+_0x735b0b+_0x557200(0xdc)+_0x3cee60;console[_0x557200(0xc3)](_0x557200(0xd3),_0x326127);const _0x1ad8d2=this[_0x557200(0xb5)](_0x326127);return{'appId':_0x51e610,'nonceStr':_0x27ea20,'timestamp':_0x735b0b,'signature':_0x1ad8d2};}async[_0x3a9c31(0xab)](_0x27ca99){const _0xbaee61=_0x3a9c31,_0x16f652=await this[_0xbaee61(0xa3)]['getConfigs']([_0xbaee61(0xc5)]),_0x3d029c={'action_name':_0xbaee61(0x99),'action_info':{'scene':{'scene_str':_0x27ca99}}};console[_0xbaee61(0xc3)](_0xbaee61(0x9a),_0x16f652);const _0xbfe2d7=await axios_1['default'][_0xbaee61(0xbb)]('https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token='+_0x16f652,_0x3d029c),{data:{errmsg:_0x15de21,ticket:_0x4747c4}}=_0xbfe2d7;console[_0xbaee61(0xc3)](_0xbaee61(0x93),_0xbfe2d7);if(_0x15de21)throw new common_1[(_0xbaee61(0xc7))](_0x15de21,common_1[_0xbaee61(0xc9)][_0xbaee61(0x8f)]);return _0x4747c4;}async[_0x3a9c31(0xb8)](_0x533a42,_0x51afcd){const _0x97aee9=_0x3a9c31,_0x2953a6=await this[_0x97aee9(0xa3)]['getConfigs']([_0x97aee9(0xad)]),_0x4a9d8e=await this[_0x97aee9(0xa3)][_0x97aee9(0xd9)](['wechatOfficialAppSecret']),_0x48b39f=await axios_1['default'][_0x97aee9(0xb7)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x2953a6+_0x97aee9(0x9f)+_0x4a9d8e+_0x97aee9(0xa4)+_0x51afcd+_0x97aee9(0xc4)),{data:{errmsg:_0x400f45,openid:_0x7ff555}}=_0x48b39f;if(_0x400f45)throw new common_1[(_0x97aee9(0xc7))](_0x400f45,common_1[_0x97aee9(0xc9)]['BAD_REQUEST']);let _0xfb3dd2;return _0xfb3dd2=await this['userService']['getUserOpenId'](_0x7ff555),!_0xfb3dd2&&(_0xfb3dd2=await this[_0x97aee9(0xb6)][_0x97aee9(0xcc)](_0x7ff555)),this[_0x97aee9(0x91)]['loginByOpenId'](_0xfb3dd2,_0x533a42);}async[_0x3a9c31(0xd5)](_0x7ddc8c,_0x105293){const _0x3f0a89=_0x3a9c31;if(!this[_0x3f0a89(0xcf)][_0x105293])throw new common_1[(_0x3f0a89(0xc7))]('非法参数',common_1[_0x3f0a89(0xc9)][_0x3f0a89(0x8f)]);const _0x288aa9=await this[_0x3f0a89(0xb6)][_0x3f0a89(0xcc)](_0x7ddc8c,_0x105293);this[_0x3f0a89(0xb0)][_0x105293]=_0x288aa9['id'];}async[_0x3a9c31(0x9d)](_0x1680c0,_0x470349){const _0x17c002=_0x3a9c31;if(!this[_0x17c002(0xcf)][_0x470349])return;const _0x3cb2db=this[_0x17c002(0xb0)][_0x470349];if(!_0x3cb2db)return'';const _0x3691ef=await this[_0x17c002(0xb6)][_0x17c002(0xda)](_0x3cb2db);return delete this['scanedSceneStrMap'][_0x470349],this[_0x17c002(0x91)][_0x17c002(0xb3)](_0x3691ef,_0x1680c0);}async[_0x3a9c31(0xa5)](_0x9f55a6,_0x35bb08){const _0xd50bd0=_0x3a9c31;if(!this[_0xd50bd0(0xcf)][_0x35bb08])throw new common_1[(_0xd50bd0(0xc7))]('非法参数',common_1['HttpStatus']['BAD_REQUEST']);const _0x1d5896=_0x35bb08[_0xd50bd0(0x7e)]('/')[0x1],_0x25038a=await this[_0xd50bd0(0xb6)]['bindWx'](_0x9f55a6,_0x1d5896);this[_0xd50bd0(0xb0)][_0x35bb08]=_0x25038a;}async['bindWxBySceneStr'](_0x357109,_0x9db5f5){const _0x56d237=_0x3a9c31;if(!this['sceneStrMap'][_0x9db5f5])throw new common_1[(_0x56d237(0xc7))](_0x56d237(0xb4),common_1['HttpStatus'][_0x56d237(0x8f)]);const {id:_0x3be317}=_0x357109[_0x56d237(0xd7)],_0x23e473=this[_0x56d237(0xb0)][_0x9db5f5];if(!_0x23e473)return'';return delete this['scanedSceneStrMap'][_0x9db5f5],_0x23e473;}async[_0x3a9c31(0x86)](_0x3b7f65,_0x344b33,_0x29a04a){const _0x5a383d=_0x3a9c31,_0x28c8d9=await this[_0x5a383d(0xa3)][_0x5a383d(0xd9)]([_0x5a383d(0x82)])||_0x5a383d(0x8d);return await this['sha1']([_0x28c8d9,_0x344b33,_0x29a04a]['sort']()[_0x5a383d(0xe1)](''))==_0x3b7f65;}[_0x3a9c31(0xb5)](_0x94f87){const _0x19dfb3=_0x3a9c31;return crypto['createHash'](_0x19dfb3(0xb5))[_0x19dfb3(0x7f)](_0x94f87)['digest']('hex');}async[_0x3a9c31(0xa1)](_0xf65557,_0x1c8740){const _0x3068dc=_0x3a9c31,_0x93dea1=await this[_0x3068dc(0xa3)][_0x3068dc(0xd9)]([_0x1c8740]);return this['genXmlMsg'](_0xf65557,_0x93dea1);}async[_0x3a9c31(0x8a)](_0x52d733,_0x21b798){const _0x585b5a=_0x3a9c31;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x52d733[_0x585b5a(0xa0)][0x0]+_0x585b5a(0x80)+_0x52d733['tousername'][0x0]+_0x585b5a(0xbc)+new Date()['getTime']()+_0x585b5a(0xaa)+_0x21b798+_0x585b5a(0xba);}async[_0x3a9c31(0x97)](_0x2b27c2){const _0x1eae36=_0x3a9c31,_0x3872f5=new Promise((_0x549c96,_0x5265e7)=>{setTimeout(()=>{const _0x5a8274=_0x58a7;_0x5265e7(new Error(_0x5a8274(0xaf)));},0x12c0);});let _0x5ba1cb='';try{console[_0x1eae36(0xc3)](_0x1eae36(0xb9),_0x2b27c2);const _0x172e9b=await Promise[_0x1eae36(0x96)]([this[_0x1eae36(0xbd)][_0x1eae36(0x95)](_0x2b27c2),_0x3872f5]);_0x5ba1cb=_0x172e9b||await this[_0x1eae36(0x9c)][_0x1eae36(0xcb)](_0x2b27c2);}catch(_0x426d27){console['log']('来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整'),_0x5ba1cb=await this[_0x1eae36(0xa3)]['getConfigs']([_0x1eae36(0xd6)])||_0x1eae36(0xdd);}return _0x5ba1cb;}};OfficialService=__decorate([(0x0,common_1[_0x3a9c31(0xc8)])(),__metadata(_0x3a9c31(0xa7),[autoreply_service_1[_0x3a9c31(0x83)],user_service_1[_0x3a9c31(0x8b)],auth_service_1['AuthService'],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x3a9c31(0x9b)]=OfficialService;function _0x50a7(){const _0x102f4b=['BAD_REQUEST','metadata','authService','18186EVOThk','qrcodecreate','38228dwgzpi','chatSyncFree','race','aotoPlay','@nestjs/common','QR_STR_SCENE','accessToken***','OfficialService','autoreplyService','loginBySceneStr','__esModule','&secret=','fromusername','genXmlMsgByConfig','512bFujPZ','globalConfigService','&code=','scanBindWx','&noncestr=','design:paramtypes','createRandomNonceStr','getRedirectUrl','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','fetchQRCodeTicket','getQRSceneStr','wechatOfficialAppId','4764uAZiwk','请求超时','scanedSceneStrMap','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','object','loginByOpenId','非法参数','sha1','userService','get','loginByCode','来自公众号的询问问题\x20=======>\x20',']]></Content>\x0a\x20\x20\x20\x20</xml>','post',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','chatgptService','682202NzzqHu','../auth/auth.service','../user/user.service','3805mGOViU','&timestamp=','log','&grant_type=authorization_code','wechatAccessToken','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','HttpException','Injectable','HttpStatus','onModuleInit','checkAutoReply','getUserFromOpenId','../../common/utils','&redirect_uri=','sceneStrMap','wechatJsapiTicket','9513nITzmN','2190bbXMIH','str:\x20','848980uOSeLi','scan','officialAutoReplyText','user','defineProperty','getConfigs','getUserById','jsapiTicket:\x20','&url=','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','getJsapiTicket','length','../globalConfig/globalConfig.service','join','__decorate','function','split','update',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','2493468JNWfXK','wechatOfficialToken','AutoreplyService','crypto','__metadata','verify','getOwnPropertyDescriptor','../chatgpt/chatgpt.service','axios','genXmlMsg','UserService','decorate','jiangly','getQRSceneStrByBind'];_0x50a7=function(){return _0x102f4b;};return _0x50a7();}