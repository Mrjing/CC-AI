'use strict';const _0xa0c4ab=_0x37e1;(function(_0x16d5d6,_0xf18fc1){const _0x2425d3=_0x37e1,_0x49696a=_0x16d5d6();while(!![]){try{const _0x3203d9=parseInt(_0x2425d3(0x146))/0x1+-parseInt(_0x2425d3(0x105))/0x2*(-parseInt(_0x2425d3(0x137))/0x3)+parseInt(_0x2425d3(0x12d))/0x4*(-parseInt(_0x2425d3(0x126))/0x5)+parseInt(_0x2425d3(0x109))/0x6*(parseInt(_0x2425d3(0x159))/0x7)+-parseInt(_0x2425d3(0x12a))/0x8+parseInt(_0x2425d3(0x139))/0x9*(-parseInt(_0x2425d3(0x118))/0xa)+parseInt(_0x2425d3(0x13c))/0xb*(parseInt(_0x2425d3(0xfc))/0xc);if(_0x3203d9===_0xf18fc1)break;else _0x49696a['push'](_0x49696a['shift']());}catch(_0x534874){_0x49696a['push'](_0x49696a['shift']());}}}(_0x497e,0x9633e));function _0x497e(){const _0x58730c=['HttpStatus','loginByCode','wechatAccessToken','chatgptService','metadata','length','fromusername','GlobalConfigService','27321bOCbSE','autoreplyService','user','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','&grant_type=authorization_code','fetchQRCodeTicket','get','OfficialService','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','defineProperty','userService','../user/user.service','12PMQCBz','../globalConfig/globalConfig.service','getQRSceneStr','genXmlMsgByConfig','default','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','__decorate','decorate','bindWx','199254nxZOon','getUserById','../../common/utils','appId:\x20','1710CdYLVt','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','回跳跳转地址:\x20','loginByOpenId','hex','getRedirectUrl','非法参数','QR_STR_SCENE','scan','getTime','aotoPlay',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','请求超时','wechatOfficialToken','bindWxBySceneStr','37480pVYGdq','design:paramtypes','__metadata','str:\x20','BAD_REQUEST','tousername','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','join','jsapi_ticket=','loginBySceneStr','officialAutoReplyText','getQRSceneStrByBind','authService','Injectable','25EbMmRk','axios','log','createRandomNonceStr','9530656jSFmFd','crypto','sceneStrMap','359972mYCmfq','getUserOpenId','sha1','getWechatAccessToken','genXmlMsg','ChatgptService','jiangly','../auth/auth.service','getUserFromOpenId','&timestamp=','3MHYqYE','UserService','54mEvbVF','createHash','HttpException','9024433GTJhPS','digest','&secret=','globalConfigService','function','getQRCodeTicket','scanedSceneStrMap','来自公众号的询问问题\x20=======>\x20','object','toFixed','246630MIyYVt','update','wechatJsapiTicket','../chatgpt/chatgpt.service','post',']]></Content>\x0a\x20\x20\x20\x20</xml>','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','AutoreplyService','verify','getConfigs','wechatOfficialAppId'];_0x497e=function(){return _0x58730c;};return _0x497e();}function _0x37e1(_0x4002e6,_0x216dff){const _0x497ee4=_0x497e();return _0x37e1=function(_0x37e1bf,_0x406770){_0x37e1bf=_0x37e1bf-0xf8;let _0x14d614=_0x497ee4[_0x37e1bf];return _0x14d614;},_0x37e1(_0x4002e6,_0x216dff);}var __decorate=this&&this[_0xa0c4ab(0x102)]||function(_0x5bc142,_0x2080ca,_0x5eca78,_0x45644f){const _0x1070e6=_0xa0c4ab;var _0x4b8d3d=arguments[_0x1070e6(0x156)],_0x326740=_0x4b8d3d<0x3?_0x2080ca:_0x45644f===null?_0x45644f=Object['getOwnPropertyDescriptor'](_0x2080ca,_0x5eca78):_0x45644f,_0x60fb6c;if(typeof Reflect===_0x1070e6(0x144)&&typeof Reflect[_0x1070e6(0x103)]===_0x1070e6(0x140))_0x326740=Reflect['decorate'](_0x5bc142,_0x2080ca,_0x5eca78,_0x45644f);else{for(var _0x209f41=_0x5bc142[_0x1070e6(0x156)]-0x1;_0x209f41>=0x0;_0x209f41--)if(_0x60fb6c=_0x5bc142[_0x209f41])_0x326740=(_0x4b8d3d<0x3?_0x60fb6c(_0x326740):_0x4b8d3d>0x3?_0x60fb6c(_0x2080ca,_0x5eca78,_0x326740):_0x60fb6c(_0x2080ca,_0x5eca78))||_0x326740;}return _0x4b8d3d>0x3&&_0x326740&&Object[_0x1070e6(0xf9)](_0x2080ca,_0x5eca78,_0x326740),_0x326740;},__metadata=this&&this[_0xa0c4ab(0x11a)]||function(_0x2c5d12,_0x579b60){const _0x4c8215=_0xa0c4ab;if(typeof Reflect===_0x4c8215(0x144)&&typeof Reflect[_0x4c8215(0x155)]===_0x4c8215(0x140))return Reflect[_0x4c8215(0x155)](_0x2c5d12,_0x579b60);};Object[_0xa0c4ab(0xf9)](exports,'__esModule',{'value':!![]}),exports['OfficialService']=void 0x0;const chatgpt_service_1=require(_0xa0c4ab(0x149)),globalConfig_service_1=require(_0xa0c4ab(0xfd)),auth_service_1=require(_0xa0c4ab(0x134)),user_service_1=require(_0xa0c4ab(0xfb)),autoreply_service_1=require('../autoreply/autoreply.service'),common_1=require('@nestjs/common'),crypto=require(_0xa0c4ab(0x12b)),axios_1=require(_0xa0c4ab(0x127)),utils_1=require(_0xa0c4ab(0x107));let OfficialService=class OfficialService{constructor(_0x4aa167,_0x5c0a69,_0x55ab6c,_0x516ee5,_0x220488){const _0x10d9b3=_0xa0c4ab;this[_0x10d9b3(0x15a)]=_0x4aa167,this[_0x10d9b3(0xfa)]=_0x5c0a69,this['authService']=_0x55ab6c,this[_0x10d9b3(0x13f)]=_0x516ee5,this[_0x10d9b3(0x154)]=_0x220488,this['sceneStrMap']={},this[_0x10d9b3(0x142)]={};}async['onModuleInit'](){const _0x45fc67=_0xa0c4ab;await this[_0x45fc67(0x13f)][_0x45fc67(0x130)](!![]);}async[_0xa0c4ab(0xfe)](_0x147ed4){const _0x47470b=_0xa0c4ab,{invitedBy:_0x588fcc}=_0x147ed4;let _0xb62aaf=(0x0,utils_1[_0x47470b(0x129)])(0x20);return _0x588fcc&&(_0xb62aaf+=':'+_0x588fcc),this[_0x47470b(0x12c)][_0xb62aaf]=!![],_0xb62aaf;}async[_0xa0c4ab(0x123)](_0x4cc36d){const _0x1dabc5=_0xa0c4ab,{id:_0x3726c1}=_0x4cc36d[_0x1dabc5(0x15b)],_0x13502e=(0x0,utils_1[_0x1dabc5(0x129)])(0x20)+'/'+_0x3726c1;return this[_0x1dabc5(0x12c)][_0x13502e]=!![],_0x13502e;}async[_0xa0c4ab(0x141)](_0x1734df){const _0x239660=_0xa0c4ab;return this[_0x239660(0x15e)](_0x1734df);}async[_0xa0c4ab(0x10e)](_0x4a3e03){const _0x25f188=_0xa0c4ab,_0x2ec4ba=await this[_0x25f188(0x13f)][_0x25f188(0x14f)]([_0x25f188(0x150)]),_0x2fe8bf='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x2ec4ba+'&redirect_uri='+encodeURIComponent(_0x4a3e03)+_0x25f188(0x11e);return console['log'](_0x25f188(0x10b),_0x2fe8bf),_0x2fe8bf;}async['getJsapiTicket'](_0x43581c){const _0x842887=_0xa0c4ab,_0x106c76=(0x0,utils_1[_0x842887(0x129)])(0x20),_0x41ca87=(Date['now']()/0x3e8)[_0x842887(0x145)](0x0),_0x257a6e=await this[_0x842887(0x13f)][_0x842887(0x14f)]([_0x842887(0x148)]);console[_0x842887(0x128)]('jsapiTicket:\x20',_0x257a6e);const _0x397588=await this[_0x842887(0x13f)]['getConfigs']([_0x842887(0x150)]);console[_0x842887(0x128)](_0x842887(0x108),_0x397588);const _0x5602bc=_0x842887(0x120)+_0x257a6e+'&noncestr='+_0x106c76+_0x842887(0x136)+_0x41ca87+'&url='+_0x43581c;console['log'](_0x842887(0x11b),_0x5602bc);const _0x5bdd8a=this[_0x842887(0x12f)](_0x5602bc);return{'appId':_0x397588,'nonceStr':_0x106c76,'timestamp':_0x41ca87,'signature':_0x5bdd8a};}async[_0xa0c4ab(0x15e)](_0x46b00a){const _0x4d2e2d=_0xa0c4ab,_0x303c43=await this[_0x4d2e2d(0x13f)][_0x4d2e2d(0x14f)]([_0x4d2e2d(0x153)]),_0x584268={'action_name':_0x4d2e2d(0x110),'action_info':{'scene':{'scene_str':_0x46b00a}}},_0x700bee=await axios_1['default'][_0x4d2e2d(0x14a)]('https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token='+_0x303c43,_0x584268),{data:{errmsg:_0x44c047,ticket:_0x559cb2}}=_0x700bee;if(_0x44c047)throw new common_1[(_0x4d2e2d(0x13b))](_0x44c047,common_1[_0x4d2e2d(0x151)][_0x4d2e2d(0x11c)]);return _0x559cb2;}async[_0xa0c4ab(0x152)](_0x4ce6f3,_0x55a49c){const _0x3b3a66=_0xa0c4ab,_0x3884fe=await this[_0x3b3a66(0x13f)]['getConfigs']([_0x3b3a66(0x150)]),_0x57afbe=await this[_0x3b3a66(0x13f)][_0x3b3a66(0x14f)](['wechatOfficialAppSecret']),_0x4457be=await axios_1[_0x3b3a66(0x100)][_0x3b3a66(0x15f)](_0x3b3a66(0x14c)+_0x3884fe+_0x3b3a66(0x13e)+_0x57afbe+'&code='+_0x55a49c+_0x3b3a66(0x15d)),{data:{errmsg:_0x2ceb18,openid:_0x1bbd42}}=_0x4457be;if(_0x2ceb18)throw new common_1['HttpException'](_0x2ceb18,common_1[_0x3b3a66(0x151)][_0x3b3a66(0x11c)]);let _0x513f9d;return _0x513f9d=await this[_0x3b3a66(0xfa)][_0x3b3a66(0x12e)](_0x1bbd42),!_0x513f9d&&(_0x513f9d=await this[_0x3b3a66(0xfa)][_0x3b3a66(0x135)](_0x1bbd42)),this[_0x3b3a66(0x124)][_0x3b3a66(0x10c)](_0x513f9d,_0x4ce6f3);}async[_0xa0c4ab(0x111)](_0x4e7c11,_0xf768f9){const _0x13f0cd=_0xa0c4ab;if(!this[_0x13f0cd(0x12c)][_0xf768f9])throw new common_1[(_0x13f0cd(0x13b))]('非法参数',common_1[_0x13f0cd(0x151)][_0x13f0cd(0x11c)]);const _0x1a3cd9=await this[_0x13f0cd(0xfa)]['getUserFromOpenId'](_0x4e7c11,_0xf768f9);this[_0x13f0cd(0x142)][_0xf768f9]=_0x1a3cd9['id'];}async[_0xa0c4ab(0x121)](_0x1ef6f5,_0x5c97b4){const _0x3e024f=_0xa0c4ab;if(!this['sceneStrMap'][_0x5c97b4])return;const _0x2b098e=this[_0x3e024f(0x142)][_0x5c97b4];if(!_0x2b098e)return'';const _0xf0d365=await this[_0x3e024f(0xfa)][_0x3e024f(0x106)](_0x2b098e);return delete this[_0x3e024f(0x142)][_0x5c97b4],this['authService'][_0x3e024f(0x10c)](_0xf0d365,_0x1ef6f5);}async['scanBindWx'](_0x2d8fb7,_0x3ae11d){const _0xf48f2e=_0xa0c4ab;if(!this['sceneStrMap'][_0x3ae11d])throw new common_1[(_0xf48f2e(0x13b))](_0xf48f2e(0x10f),common_1[_0xf48f2e(0x151)]['BAD_REQUEST']);const _0x254b08=_0x3ae11d['split']('/')[0x1],_0x5b2e0c=await this['userService'][_0xf48f2e(0x104)](_0x2d8fb7,_0x254b08);this[_0xf48f2e(0x142)][_0x3ae11d]=_0x5b2e0c;}async[_0xa0c4ab(0x117)](_0x722eb7,_0x4ddf67){const _0x29f25c=_0xa0c4ab;if(!this[_0x29f25c(0x12c)][_0x4ddf67])throw new common_1[(_0x29f25c(0x13b))](_0x29f25c(0x10f),common_1[_0x29f25c(0x151)][_0x29f25c(0x11c)]);const {id:_0xce18cf}=_0x722eb7[_0x29f25c(0x15b)],_0x36bdce=this[_0x29f25c(0x142)][_0x4ddf67];if(!_0x36bdce)return'';return delete this[_0x29f25c(0x142)][_0x4ddf67],_0x36bdce;}async[_0xa0c4ab(0x14e)](_0xb682e5,_0x2e30f7,_0x40fccc){const _0x1aadba=_0xa0c4ab,_0x29ec16=await this[_0x1aadba(0x13f)][_0x1aadba(0x14f)]([_0x1aadba(0x116)])||_0x1aadba(0x133);return await this[_0x1aadba(0x12f)]([_0x29ec16,_0x2e30f7,_0x40fccc]['sort']()[_0x1aadba(0x11f)](''))==_0xb682e5;}[_0xa0c4ab(0x12f)](_0x28d050){const _0x569b3f=_0xa0c4ab;return crypto[_0x569b3f(0x13a)](_0x569b3f(0x12f))[_0x569b3f(0x147)](_0x28d050)[_0x569b3f(0x13d)](_0x569b3f(0x10d));}async[_0xa0c4ab(0xff)](_0x2e71bb,_0x57b739){const _0x4ed7ae=_0xa0c4ab,_0x554e41=await this['globalConfigService']['getConfigs']([_0x57b739]);return this[_0x4ed7ae(0x131)](_0x2e71bb,_0x554e41);}async[_0xa0c4ab(0x131)](_0x3441ef,_0x382e9f){const _0x18f70b=_0xa0c4ab;return _0x18f70b(0x15c)+_0x3441ef[_0x18f70b(0x157)][0x0]+_0x18f70b(0x114)+_0x3441ef[_0x18f70b(0x11d)][0x0]+']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>'+new Date()[_0x18f70b(0x112)]()+_0x18f70b(0xf8)+_0x382e9f+_0x18f70b(0x14b);}async[_0xa0c4ab(0x113)](_0x35388e){const _0xc1028a=_0xa0c4ab,_0x29e850=new Promise((_0x3f8d5a,_0x343adc)=>{setTimeout(()=>{const _0x359595=_0x37e1;_0x343adc(new Error(_0x359595(0x115)));},0x12c0);});let _0x39baf9='';try{console[_0xc1028a(0x128)](_0xc1028a(0x143),_0x35388e);const _0x12f713=await Promise['race']([this['chatgptService']['chatSyncFree'](_0x35388e),_0x29e850]);_0x39baf9=_0x12f713||await this[_0xc1028a(0x15a)]['checkAutoReply'](_0x35388e);}catch(_0x8c0ce){console[_0xc1028a(0x128)](_0xc1028a(0x10a)),_0x39baf9=await this[_0xc1028a(0x13f)]['getConfigs']([_0xc1028a(0x122)])||_0xc1028a(0x101);}return _0x39baf9;}};OfficialService=__decorate([(0x0,common_1[_0xa0c4ab(0x125)])(),__metadata(_0xa0c4ab(0x119),[autoreply_service_1[_0xa0c4ab(0x14d)],user_service_1[_0xa0c4ab(0x138)],auth_service_1['AuthService'],globalConfig_service_1[_0xa0c4ab(0x158)],chatgpt_service_1[_0xa0c4ab(0x132)]])],OfficialService),exports[_0xa0c4ab(0x160)]=OfficialService;