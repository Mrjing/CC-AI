'use strict';const _0x125bb7=_0x15a8;function _0x15a8(_0x2309df,_0x12f0ba){const _0x107615=_0x1076();return _0x15a8=function(_0x15a888,_0x31f204){_0x15a888=_0x15a888-0xaf;let _0x25b6e1=_0x107615[_0x15a888];return _0x25b6e1;},_0x15a8(_0x2309df,_0x12f0ba);}(function(_0x26b27e,_0x5481c8){const _0x3e6843=_0x15a8,_0x29bdf1=_0x26b27e();while(!![]){try{const _0x2267b1=-parseInt(_0x3e6843(0xce))/0x1+-parseInt(_0x3e6843(0xea))/0x2*(-parseInt(_0x3e6843(0x116))/0x3)+parseInt(_0x3e6843(0xdb))/0x4+parseInt(_0x3e6843(0x10b))/0x5*(-parseInt(_0x3e6843(0x10c))/0x6)+-parseInt(_0x3e6843(0x108))/0x7+-parseInt(_0x3e6843(0xf2))/0x8*(parseInt(_0x3e6843(0x109))/0x9)+parseInt(_0x3e6843(0xda))/0xa;if(_0x2267b1===_0x5481c8)break;else _0x29bdf1['push'](_0x29bdf1['shift']());}catch(_0xa39766){_0x29bdf1['push'](_0x29bdf1['shift']());}}}(_0x1076,0x311c9));function _0x1076(){const _0x59cd1f=['sceneStrMap','请求超时','getJsapiTicket','scan','OfficialService','scanBindWx','3BORkXW','GlobalConfigService','../chatgpt/chatgpt.service','wechatOfficialAppId','getUserById','wechatJsapiTicket','split','HttpException','hex','toFixed','chatgptService','sha1','fromusername','../auth/auth.service','user','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','getUserFromOpenId','officialAutoReplyText','&secret=',']]></Content>\x0a\x20\x20\x20\x20</xml>','__metadata','genXmlMsg','&redirect_uri=','来自公众号的询问问题\x20=======>\x20','../autoreply/autoreply.service','getUserOpenId','getQRSceneStrByBind','length','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','userService','axios','getRedirectUrl','62863ToQjEy','metadata','createRandomNonceStr','design:paramtypes','tousername','default','jsapi_ticket=','&noncestr=','autoreplyService','../../common/utils','wechatOfficialAppSecret','HttpStatus','1910870WIgbvM','776812lCSTWq','onModuleInit','createHash','wechatAccessToken','join','verify','../globalConfig/globalConfig.service','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','__esModule','decorate','function','bindWx','loginByCode','update','AuthService','742628oLQCwZ','race','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','log','checkAutoReply','loginByOpenId','非法参数','2808XTPwFG','genXmlMsgByConfig','getQRCodeTicket','AutoreplyService','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','scanedSceneStrMap',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','BAD_REQUEST','getQRSceneStr','回跳跳转地址:\x20','Injectable','UserService','&grant_type=authorization_code','getWechatAccessToken','getConfigs','aotoPlay','&code=','globalConfigService','object','defineProperty','getOwnPropertyDescriptor',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','120939yrTbjw','6255egaCdm','crypto','1156790DMhlhm','6iZbXiU','jsapiTicket:\x20','post','ChatgptService'];_0x1076=function(){return _0x59cd1f;};return _0x1076();}var __decorate=this&&this['__decorate']||function(_0x201c90,_0x5535f3,_0x447b5f,_0x1f10ce){const _0x24a69d=_0x15a8;var _0x48399b=arguments[_0x24a69d(0xc9)],_0x4ddff9=_0x48399b<0x3?_0x5535f3:_0x1f10ce===null?_0x1f10ce=Object[_0x24a69d(0x106)](_0x5535f3,_0x447b5f):_0x1f10ce,_0x2f9a1a;if(typeof Reflect===_0x24a69d(0x104)&&typeof Reflect['decorate']===_0x24a69d(0xe5))_0x4ddff9=Reflect[_0x24a69d(0xe4)](_0x201c90,_0x5535f3,_0x447b5f,_0x1f10ce);else{for(var _0x182004=_0x201c90[_0x24a69d(0xc9)]-0x1;_0x182004>=0x0;_0x182004--)if(_0x2f9a1a=_0x201c90[_0x182004])_0x4ddff9=(_0x48399b<0x3?_0x2f9a1a(_0x4ddff9):_0x48399b>0x3?_0x2f9a1a(_0x5535f3,_0x447b5f,_0x4ddff9):_0x2f9a1a(_0x5535f3,_0x447b5f))||_0x4ddff9;}return _0x48399b>0x3&&_0x4ddff9&&Object[_0x24a69d(0x105)](_0x5535f3,_0x447b5f,_0x4ddff9),_0x4ddff9;},__metadata=this&&this[_0x125bb7(0xc2)]||function(_0x21fcf5,_0x281a4d){const _0x40ba87=_0x125bb7;if(typeof Reflect==='object'&&typeof Reflect[_0x40ba87(0xcf)]===_0x40ba87(0xe5))return Reflect[_0x40ba87(0xcf)](_0x21fcf5,_0x281a4d);};Object[_0x125bb7(0x105)](exports,_0x125bb7(0xe3),{'value':!![]}),exports[_0x125bb7(0x114)]=void 0x0;const chatgpt_service_1=require(_0x125bb7(0xb0)),globalConfig_service_1=require(_0x125bb7(0xe1)),auth_service_1=require(_0x125bb7(0xbb)),user_service_1=require('../user/user.service'),autoreply_service_1=require(_0x125bb7(0xc6)),common_1=require('@nestjs/common'),crypto=require(_0x125bb7(0x10a)),axios_1=require(_0x125bb7(0xcc)),utils_1=require(_0x125bb7(0xd7));let OfficialService=class OfficialService{constructor(_0x378a8d,_0x52970b,_0x2897a3,_0x131661,_0x42ea36){const _0x555999=_0x125bb7;this[_0x555999(0xd6)]=_0x378a8d,this[_0x555999(0xcb)]=_0x52970b,this['authService']=_0x2897a3,this['globalConfigService']=_0x131661,this['chatgptService']=_0x42ea36,this[_0x555999(0x110)]={},this[_0x555999(0xf7)]={};}async[_0x125bb7(0xdc)](){const _0x458dd2=_0x125bb7;await this[_0x458dd2(0x103)][_0x458dd2(0xff)](!![]);}async[_0x125bb7(0xfa)](_0x4acbd6){const _0x3ac0c0=_0x125bb7,{invitedBy:_0x165a7e}=_0x4acbd6;let _0x8dd3ec=(0x0,utils_1[_0x3ac0c0(0xd0)])(0x20);return _0x165a7e&&(_0x8dd3ec+=':'+_0x165a7e),this[_0x3ac0c0(0x110)][_0x8dd3ec]=!![],_0x8dd3ec;}async[_0x125bb7(0xc8)](_0x368826){const _0x3ad7c4=_0x125bb7,{id:_0x48160e}=_0x368826[_0x3ad7c4(0xbc)],_0x54c3c3=(0x0,utils_1[_0x3ad7c4(0xd0)])(0x20)+'/'+_0x48160e;return this[_0x3ad7c4(0x110)][_0x54c3c3]=!![],_0x54c3c3;}async[_0x125bb7(0xf4)](_0x195c65){return this['fetchQRCodeTicket'](_0x195c65);}async[_0x125bb7(0xcd)](_0x50f715){const _0xc8f9ae=_0x125bb7,_0x382349=await this['globalConfigService']['getConfigs']([_0xc8f9ae(0xb1)]),_0x59b60b=_0xc8f9ae(0xf6)+_0x382349+_0xc8f9ae(0xc4)+encodeURIComponent(_0x50f715)+_0xc8f9ae(0xbd);return console[_0xc8f9ae(0xee)](_0xc8f9ae(0xfb),_0x59b60b),_0x59b60b;}async[_0x125bb7(0x112)](_0x1cf520){const _0xcfae54=_0x125bb7,_0x5474ed=(0x0,utils_1[_0xcfae54(0xd0)])(0x20),_0x3c4691=(Date['now']()/0x3e8)[_0xcfae54(0xb7)](0x0),_0x331148=await this['globalConfigService'][_0xcfae54(0x100)]([_0xcfae54(0xb3)]);console[_0xcfae54(0xee)](_0xcfae54(0x10d),_0x331148);const _0x2991e5=await this['globalConfigService'][_0xcfae54(0x100)]([_0xcfae54(0xb1)]);console[_0xcfae54(0xee)]('appId:\x20',_0x2991e5);const _0x575363=_0xcfae54(0xd4)+_0x331148+_0xcfae54(0xd5)+_0x5474ed+'&timestamp='+_0x3c4691+'&url='+_0x1cf520;console[_0xcfae54(0xee)]('str:\x20',_0x575363);const _0x21f429=this['sha1'](_0x575363);return{'appId':_0x2991e5,'nonceStr':_0x5474ed,'timestamp':_0x3c4691,'signature':_0x21f429};}async['fetchQRCodeTicket'](_0x13dfb6){const _0x469da0=_0x125bb7,_0x5d4c91=await this[_0x469da0(0x103)][_0x469da0(0x100)]([_0x469da0(0xde)]),_0x3b619b={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x13dfb6}}},_0x1899d7=await axios_1[_0x469da0(0xd3)][_0x469da0(0x10e)](_0x469da0(0xec)+_0x5d4c91,_0x3b619b),{data:{errmsg:_0x4e6914,ticket:_0x165456}}=_0x1899d7;if(_0x4e6914)throw new common_1[(_0x469da0(0xb5))](_0x4e6914,common_1[_0x469da0(0xd9)][_0x469da0(0xf9)]);return _0x165456;}async[_0x125bb7(0xe7)](_0x8e45ce,_0x3f7867){const _0x2752ff=_0x125bb7,_0x15b864=await this[_0x2752ff(0x103)][_0x2752ff(0x100)](['wechatOfficialAppId']),_0x8e56af=await this[_0x2752ff(0x103)]['getConfigs']([_0x2752ff(0xd8)]),_0x199bfe=await axios_1['default']['get']('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x15b864+_0x2752ff(0xc0)+_0x8e56af+_0x2752ff(0x102)+_0x3f7867+_0x2752ff(0xfe)),{data:{errmsg:_0xbf0b5b,openid:_0x39f57e}}=_0x199bfe;if(_0xbf0b5b)throw new common_1[(_0x2752ff(0xb5))](_0xbf0b5b,common_1[_0x2752ff(0xd9)][_0x2752ff(0xf9)]);let _0x194e07;return _0x194e07=await this['userService'][_0x2752ff(0xc7)](_0x39f57e),!_0x194e07&&(_0x194e07=await this[_0x2752ff(0xcb)]['getUserFromOpenId'](_0x39f57e)),this['authService'][_0x2752ff(0xf0)](_0x194e07,_0x8e45ce);}async[_0x125bb7(0x113)](_0x1f7264,_0x40ffe9){const _0x100d5c=_0x125bb7;if(!this[_0x100d5c(0x110)][_0x40ffe9])throw new common_1[(_0x100d5c(0xb5))](_0x100d5c(0xf1),common_1['HttpStatus'][_0x100d5c(0xf9)]);const _0x1a6529=await this[_0x100d5c(0xcb)][_0x100d5c(0xbe)](_0x1f7264,_0x40ffe9);this[_0x100d5c(0xf7)][_0x40ffe9]=_0x1a6529['id'];}async['loginBySceneStr'](_0x192280,_0x3ce0f1){const _0x2109ad=_0x125bb7;if(!this[_0x2109ad(0x110)][_0x3ce0f1])return;const _0x1dfb24=this[_0x2109ad(0xf7)][_0x3ce0f1];if(!_0x1dfb24)return'';const _0x587ad9=await this[_0x2109ad(0xcb)][_0x2109ad(0xb2)](_0x1dfb24);return delete this[_0x2109ad(0xf7)][_0x3ce0f1],this['authService'][_0x2109ad(0xf0)](_0x587ad9,_0x192280);}async[_0x125bb7(0x115)](_0x34168a,_0x2bb35f){const _0x28c9b4=_0x125bb7;if(!this[_0x28c9b4(0x110)][_0x2bb35f])throw new common_1[(_0x28c9b4(0xb5))](_0x28c9b4(0xf1),common_1[_0x28c9b4(0xd9)][_0x28c9b4(0xf9)]);const _0x42fa3a=_0x2bb35f[_0x28c9b4(0xb4)]('/')[0x1],_0xff6609=await this[_0x28c9b4(0xcb)][_0x28c9b4(0xe6)](_0x34168a,_0x42fa3a);this[_0x28c9b4(0xf7)][_0x2bb35f]=_0xff6609;}async['bindWxBySceneStr'](_0x13c92e,_0xfc1f41){const _0xfe1b84=_0x125bb7;if(!this[_0xfe1b84(0x110)][_0xfc1f41])throw new common_1[(_0xfe1b84(0xb5))](_0xfe1b84(0xf1),common_1['HttpStatus'][_0xfe1b84(0xf9)]);const {id:_0x15148e}=_0x13c92e[_0xfe1b84(0xbc)],_0x16725d=this[_0xfe1b84(0xf7)][_0xfc1f41];if(!_0x16725d)return'';return delete this[_0xfe1b84(0xf7)][_0xfc1f41],_0x16725d;}async[_0x125bb7(0xe0)](_0x2b8b54,_0x437378,_0xa6f66b){const _0x6939e0=_0x125bb7,_0x49f162=await this[_0x6939e0(0x103)][_0x6939e0(0x100)](['wechatOfficialToken'])||'jiangly';return await this[_0x6939e0(0xb9)]([_0x49f162,_0x437378,_0xa6f66b]['sort']()[_0x6939e0(0xdf)](''))==_0x2b8b54;}[_0x125bb7(0xb9)](_0x465cc9){const _0x1444e6=_0x125bb7;return crypto[_0x1444e6(0xdd)]('sha1')[_0x1444e6(0xe8)](_0x465cc9)['digest'](_0x1444e6(0xb6));}async[_0x125bb7(0xf3)](_0xa5d9fd,_0x2a9c65){const _0x4f3d09=_0x125bb7,_0x28fe15=await this['globalConfigService'][_0x4f3d09(0x100)]([_0x2a9c65]);return this[_0x4f3d09(0xc3)](_0xa5d9fd,_0x28fe15);}async['genXmlMsg'](_0x1d051c,_0x471fe2){const _0x5f5944=_0x125bb7;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x1d051c[_0x5f5944(0xba)][0x0]+_0x5f5944(0x107)+_0x1d051c[_0x5f5944(0xd2)][0x0]+_0x5f5944(0xf8)+new Date()['getTime']()+_0x5f5944(0xca)+_0x471fe2+_0x5f5944(0xc1);}async[_0x125bb7(0x101)](_0x10f8fe){const _0x3f7c9d=_0x125bb7,_0x114e6c=new Promise((_0x33b155,_0x5856b)=>{setTimeout(()=>{const _0x4feede=_0x15a8;_0x5856b(new Error(_0x4feede(0x111)));},0x12c0);});let _0x36bfcd='';try{console[_0x3f7c9d(0xee)](_0x3f7c9d(0xc5),_0x10f8fe);const _0x1627ee=await Promise[_0x3f7c9d(0xeb)]([this[_0x3f7c9d(0xb8)]['chatSyncFree'](_0x10f8fe),_0x114e6c]);_0x36bfcd=_0x1627ee||await this[_0x3f7c9d(0xd6)][_0x3f7c9d(0xef)](_0x10f8fe);}catch(_0x2a0416){console['log'](_0x3f7c9d(0xe2)),_0x36bfcd=await this[_0x3f7c9d(0x103)]['getConfigs']([_0x3f7c9d(0xbf)])||_0x3f7c9d(0xed);}return _0x36bfcd;}};OfficialService=__decorate([(0x0,common_1[_0x125bb7(0xfc)])(),__metadata(_0x125bb7(0xd1),[autoreply_service_1[_0x125bb7(0xf5)],user_service_1[_0x125bb7(0xfd)],auth_service_1[_0x125bb7(0xe9)],globalConfig_service_1[_0x125bb7(0xaf)],chatgpt_service_1[_0x125bb7(0x10f)]])],OfficialService),exports[_0x125bb7(0x114)]=OfficialService;