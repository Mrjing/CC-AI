'use strict';const _0x3f4ca4=_0x423b;function _0x423b(_0x5ca78d,_0x5b4bcb){const _0x294603=_0x2946();return _0x423b=function(_0x423ba8,_0x288b81){_0x423ba8=_0x423ba8-0xd2;let _0x2defdc=_0x294603[_0x423ba8];return _0x2defdc;},_0x423b(_0x5ca78d,_0x5b4bcb);}(function(_0x53cb64,_0xcf484d){const _0x347efa=_0x423b,_0x18ea1d=_0x53cb64();while(!![]){try{const _0x1cd335=parseInt(_0x347efa(0x129))/0x1+parseInt(_0x347efa(0x102))/0x2*(-parseInt(_0x347efa(0x120))/0x3)+parseInt(_0x347efa(0xed))/0x4+-parseInt(_0x347efa(0xeb))/0x5*(parseInt(_0x347efa(0x11a))/0x6)+-parseInt(_0x347efa(0x10c))/0x7+parseInt(_0x347efa(0x12d))/0x8*(parseInt(_0x347efa(0x12e))/0x9)+parseInt(_0x347efa(0x103))/0xa;if(_0x1cd335===_0xcf484d)break;else _0x18ea1d['push'](_0x18ea1d['shift']());}catch(_0x58ef66){_0x18ea1d['push'](_0x18ea1d['shift']());}}}(_0x2946,0xd605e));var __decorate=this&&this[_0x3f4ca4(0xf2)]||function(_0x25585c,_0x4ea14a,_0x29e944,_0x3a9d45){const _0xe0f887=_0x3f4ca4;var _0x128f0d=arguments[_0xe0f887(0xff)],_0x434e7e=_0x128f0d<0x3?_0x4ea14a:_0x3a9d45===null?_0x3a9d45=Object[_0xe0f887(0x110)](_0x4ea14a,_0x29e944):_0x3a9d45,_0x57694a;if(typeof Reflect===_0xe0f887(0x127)&&typeof Reflect[_0xe0f887(0x104)]===_0xe0f887(0x114))_0x434e7e=Reflect[_0xe0f887(0x104)](_0x25585c,_0x4ea14a,_0x29e944,_0x3a9d45);else{for(var _0x63e4e5=_0x25585c[_0xe0f887(0xff)]-0x1;_0x63e4e5>=0x0;_0x63e4e5--)if(_0x57694a=_0x25585c[_0x63e4e5])_0x434e7e=(_0x128f0d<0x3?_0x57694a(_0x434e7e):_0x128f0d>0x3?_0x57694a(_0x4ea14a,_0x29e944,_0x434e7e):_0x57694a(_0x4ea14a,_0x29e944))||_0x434e7e;}return _0x128f0d>0x3&&_0x434e7e&&Object[_0xe0f887(0x10a)](_0x4ea14a,_0x29e944,_0x434e7e),_0x434e7e;},__metadata=this&&this[_0x3f4ca4(0xee)]||function(_0x15516c,_0x53d652){const _0x26cc04=_0x3f4ca4;if(typeof Reflect===_0x26cc04(0x127)&&typeof Reflect[_0x26cc04(0xf6)]===_0x26cc04(0x114))return Reflect[_0x26cc04(0xf6)](_0x15516c,_0x53d652);};function _0x2946(){const _0x44f352=['293181ZyEBtG','scanedSceneStrMap','axios','race','getOwnPropertyDescriptor','getQRCodeTicket','authService','OfficialService','function','aotoPlay','crypto','userService','getUserFromOpenId',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','9737916NzWnYa','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','bindWxBySceneStr','sceneStrMap','bindWx','wechatJsapiTicket','27aNpCJi','getQRSceneStrByBind','&redirect_uri=','split','chatgptService','../globalConfig/globalConfig.service','&noncestr=','object','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','1605501OGStli','来自公众号的询问问题\x20=======>\x20',']]></Content>\x0a\x20\x20\x20\x20</xml>','&secret=','552DevyYP','67941qtLMEF','chatSyncFree','wechatAccessToken','__esModule','jsapiTicket:\x20','loginBySceneStr','fetchQRCodeTicket','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','autoreplyService','hex','appId:\x20','globalConfigService','getJsapiTicket','checkAutoReply','请求超时','../../common/utils','@nestjs/common','HttpStatus','toFixed','log','scan','createRandomNonceStr','officialAutoReplyText','user','onModuleInit','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','HttpException','str:\x20','BAD_REQUEST','../user/user.service','../auth/auth.service','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','AutoreplyService','GlobalConfigService','default','design:paramtypes','非法参数','UserService','5RSCMIn','getTime','513412VMiYsN','__metadata','Injectable','&url=','sort','__decorate','genXmlMsg','post','&timestamp=','metadata','ChatgptService','AuthService','join','../autoreply/autoreply.service','../chatgpt/chatgpt.service','jiangly','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','getWechatAccessToken','length','getConfigs','createHash','105218FzbNMY','7602530AUCWQY','decorate','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','loginByOpenId','getUserById',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','sha1','defineProperty','QR_STR_SCENE'];_0x2946=function(){return _0x44f352;};return _0x2946();}Object[_0x3f4ca4(0x10a)](exports,_0x3f4ca4(0x131),{'value':!![]}),exports[_0x3f4ca4(0x113)]=void 0x0;const chatgpt_service_1=require(_0x3f4ca4(0xfb)),globalConfig_service_1=require(_0x3f4ca4(0x125)),auth_service_1=require(_0x3f4ca4(0xe3)),user_service_1=require(_0x3f4ca4(0xe2)),autoreply_service_1=require(_0x3f4ca4(0xfa)),common_1=require(_0x3f4ca4(0xd5)),crypto=require(_0x3f4ca4(0x116)),axios_1=require(_0x3f4ca4(0x10e)),utils_1=require(_0x3f4ca4(0xd4));let OfficialService=class OfficialService{constructor(_0x356d3d,_0x5896c1,_0x566108,_0x468ef9,_0x17aeea){const _0x1cda0f=_0x3f4ca4;this['autoreplyService']=_0x356d3d,this[_0x1cda0f(0x117)]=_0x5896c1,this[_0x1cda0f(0x112)]=_0x566108,this['globalConfigService']=_0x468ef9,this[_0x1cda0f(0x124)]=_0x17aeea,this[_0x1cda0f(0x11d)]={},this[_0x1cda0f(0x10d)]={};}async[_0x3f4ca4(0xdd)](){const _0x571243=_0x3f4ca4;await this[_0x571243(0x139)][_0x571243(0xfe)](!![]);}async['getQRSceneStr'](_0x5405d4){const _0x4650a2=_0x3f4ca4,{invitedBy:_0x28607c}=_0x5405d4;let _0x196bac=(0x0,utils_1['createRandomNonceStr'])(0x20);return _0x28607c&&(_0x196bac+=':'+_0x28607c),this[_0x4650a2(0x11d)][_0x196bac]=!![],_0x196bac;}async[_0x3f4ca4(0x121)](_0x4e277b){const _0x14d6cf=_0x3f4ca4,{id:_0x5d1e59}=_0x4e277b['user'],_0x1f38f5=(0x0,utils_1[_0x14d6cf(0xda)])(0x20)+'/'+_0x5d1e59;return this[_0x14d6cf(0x11d)][_0x1f38f5]=!![],_0x1f38f5;}async[_0x3f4ca4(0x111)](_0x2a9810){const _0x48fcca=_0x3f4ca4;return this[_0x48fcca(0x134)](_0x2a9810);}async['getRedirectUrl'](_0x4c86fe){const _0x93552a=_0x3f4ca4,_0x1ffad5=await this['globalConfigService']['getConfigs'](['wechatOfficialAppId']),_0x2edf5a='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x1ffad5+_0x93552a(0x122)+encodeURIComponent(_0x4c86fe)+_0x93552a(0x135);return console['log']('回跳跳转地址:\x20',_0x2edf5a),_0x2edf5a;}async[_0x3f4ca4(0x13a)](_0x2d6eaa){const _0x219cb2=_0x3f4ca4,_0x146a7f=(0x0,utils_1['createRandomNonceStr'])(0x20),_0xe51ed2=(Date['now']()/0x3e8)[_0x219cb2(0xd7)](0x0),_0x2aa352=await this[_0x219cb2(0x139)][_0x219cb2(0x100)]([_0x219cb2(0x11f)]);console[_0x219cb2(0xd8)](_0x219cb2(0x132),_0x2aa352);const _0xda8c1e=await this[_0x219cb2(0x139)]['getConfigs'](['wechatOfficialAppId']);console[_0x219cb2(0xd8)](_0x219cb2(0x138),_0xda8c1e);const _0x768dad='jsapi_ticket='+_0x2aa352+_0x219cb2(0x126)+_0x146a7f+_0x219cb2(0xf5)+_0xe51ed2+_0x219cb2(0xf0)+_0x2d6eaa;console['log'](_0x219cb2(0xe0),_0x768dad);const _0x201766=this[_0x219cb2(0x109)](_0x768dad);return{'appId':_0xda8c1e,'nonceStr':_0x146a7f,'timestamp':_0xe51ed2,'signature':_0x201766};}async[_0x3f4ca4(0x134)](_0x10c57a){const _0x1c4541=_0x3f4ca4,_0x3015e6=await this[_0x1c4541(0x139)][_0x1c4541(0x100)]([_0x1c4541(0x130)]),_0x3217a8={'action_name':_0x1c4541(0x10b),'action_info':{'scene':{'scene_str':_0x10c57a}}},_0x2a8d3d=await axios_1[_0x1c4541(0xe7)][_0x1c4541(0xf4)](_0x1c4541(0x11b)+_0x3015e6,_0x3217a8),{data:{errmsg:_0x2e7947,ticket:_0x5a6e2b}}=_0x2a8d3d;if(_0x2e7947)throw new common_1['HttpException'](_0x2e7947,common_1[_0x1c4541(0xd6)][_0x1c4541(0xe1)]);return _0x5a6e2b;}async['loginByCode'](_0x537689,_0x1831b9){const _0x53a010=_0x3f4ca4,_0xa06e29=await this[_0x53a010(0x139)][_0x53a010(0x100)](['wechatOfficialAppId']),_0xc7b981=await this[_0x53a010(0x139)][_0x53a010(0x100)](['wechatOfficialAppSecret']),_0x37e781=await axios_1[_0x53a010(0xe7)]['get'](_0x53a010(0x105)+_0xa06e29+_0x53a010(0x12c)+_0xc7b981+'&code='+_0x1831b9+'&grant_type=authorization_code'),{data:{errmsg:_0x48ca56,openid:_0x2b2f47}}=_0x37e781;if(_0x48ca56)throw new common_1['HttpException'](_0x48ca56,common_1[_0x53a010(0xd6)][_0x53a010(0xe1)]);let _0xc0c434;return _0xc0c434=await this['userService']['getUserOpenId'](_0x2b2f47),!_0xc0c434&&(_0xc0c434=await this[_0x53a010(0x117)][_0x53a010(0x118)](_0x2b2f47)),this['authService']['loginByOpenId'](_0xc0c434,_0x537689);}async[_0x3f4ca4(0xd9)](_0x2b55f8,_0xdc74d9){const _0x5ac331=_0x3f4ca4;if(!this[_0x5ac331(0x11d)][_0xdc74d9])throw new common_1[(_0x5ac331(0xdf))]('非法参数',common_1[_0x5ac331(0xd6)][_0x5ac331(0xe1)]);const _0x2774b1=await this['userService'][_0x5ac331(0x118)](_0x2b55f8,_0xdc74d9);this[_0x5ac331(0x10d)][_0xdc74d9]=_0x2774b1['id'];}async[_0x3f4ca4(0x133)](_0x10946e,_0x359fbe){const _0x314e1a=_0x3f4ca4;if(!this['sceneStrMap'][_0x359fbe])return;const _0x19ca26=this[_0x314e1a(0x10d)][_0x359fbe];if(!_0x19ca26)return'';const _0x56f5e3=await this[_0x314e1a(0x117)][_0x314e1a(0x107)](_0x19ca26);return delete this[_0x314e1a(0x10d)][_0x359fbe],this['authService'][_0x314e1a(0x106)](_0x56f5e3,_0x10946e);}async['scanBindWx'](_0x1bcef3,_0x56f33b){const _0x17fc9b=_0x3f4ca4;if(!this[_0x17fc9b(0x11d)][_0x56f33b])throw new common_1[(_0x17fc9b(0xdf))](_0x17fc9b(0xe9),common_1[_0x17fc9b(0xd6)][_0x17fc9b(0xe1)]);const _0x20a119=_0x56f33b[_0x17fc9b(0x123)]('/')[0x1],_0x5b7384=await this[_0x17fc9b(0x117)][_0x17fc9b(0x11e)](_0x1bcef3,_0x20a119);this[_0x17fc9b(0x10d)][_0x56f33b]=_0x5b7384;}async[_0x3f4ca4(0x11c)](_0x2a8c52,_0x44772a){const _0x825aa=_0x3f4ca4;if(!this[_0x825aa(0x11d)][_0x44772a])throw new common_1[(_0x825aa(0xdf))](_0x825aa(0xe9),common_1[_0x825aa(0xd6)][_0x825aa(0xe1)]);const {id:_0x50dffd}=_0x2a8c52[_0x825aa(0xdc)],_0x58719b=this[_0x825aa(0x10d)][_0x44772a];if(!_0x58719b)return'';return delete this[_0x825aa(0x10d)][_0x44772a],_0x58719b;}async['verify'](_0x1f8e8a,_0xff453d,_0x43a7e8){const _0x5aa189=_0x3f4ca4,_0x496ac0=await this[_0x5aa189(0x139)][_0x5aa189(0x100)](['wechatOfficialToken'])||_0x5aa189(0xfc);return await this[_0x5aa189(0x109)]([_0x496ac0,_0xff453d,_0x43a7e8][_0x5aa189(0xf1)]()[_0x5aa189(0xf9)](''))==_0x1f8e8a;}[_0x3f4ca4(0x109)](_0xbee4b4){const _0x594551=_0x3f4ca4;return crypto[_0x594551(0x101)]('sha1')['update'](_0xbee4b4)['digest'](_0x594551(0x137));}async['genXmlMsgByConfig'](_0x1ee497,_0x320c38){const _0x8cca83=_0x3f4ca4,_0x241f4b=await this[_0x8cca83(0x139)][_0x8cca83(0x100)]([_0x320c38]);return this[_0x8cca83(0xf3)](_0x1ee497,_0x241f4b);}async[_0x3f4ca4(0xf3)](_0x24a2c9,_0x2712f7){const _0x1ee802=_0x3f4ca4;return _0x1ee802(0x128)+_0x24a2c9['fromusername'][0x0]+_0x1ee802(0x119)+_0x24a2c9['tousername'][0x0]+_0x1ee802(0x108)+new Date()[_0x1ee802(0xec)]()+_0x1ee802(0xe4)+_0x2712f7+_0x1ee802(0x12b);}async[_0x3f4ca4(0x115)](_0x409177){const _0x4d6c2d=_0x3f4ca4,_0x1dafb2=new Promise((_0x1f1817,_0x408b64)=>{setTimeout(()=>{const _0xdca757=_0x423b;_0x408b64(new Error(_0xdca757(0xd3)));},0x12c0);});let _0x3ff586='';try{console[_0x4d6c2d(0xd8)](_0x4d6c2d(0x12a),_0x409177);const _0x16a00c=await Promise[_0x4d6c2d(0x10f)]([this['chatgptService'][_0x4d6c2d(0x12f)](_0x409177),_0x1dafb2]);_0x3ff586=_0x16a00c||await this[_0x4d6c2d(0x136)][_0x4d6c2d(0xd2)](_0x409177);}catch(_0x5716ae){console[_0x4d6c2d(0xd8)](_0x4d6c2d(0xde)),_0x3ff586=await this[_0x4d6c2d(0x139)]['getConfigs']([_0x4d6c2d(0xdb)])||_0x4d6c2d(0xfd);}return _0x3ff586;}};OfficialService=__decorate([(0x0,common_1[_0x3f4ca4(0xef)])(),__metadata(_0x3f4ca4(0xe8),[autoreply_service_1[_0x3f4ca4(0xe5)],user_service_1[_0x3f4ca4(0xea)],auth_service_1[_0x3f4ca4(0xf8)],globalConfig_service_1[_0x3f4ca4(0xe6)],chatgpt_service_1[_0x3f4ca4(0xf7)]])],OfficialService),exports[_0x3f4ca4(0x113)]=OfficialService;