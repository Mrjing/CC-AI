'use strict';const _0x59526a=_0x1b77;(function(_0x2115d0,_0x18a8e7){const _0x56d2d4=_0x1b77,_0x8b31f1=_0x2115d0();while(!![]){try{const _0xa6b453=-parseInt(_0x56d2d4(0xf7))/0x1*(parseInt(_0x56d2d4(0xd9))/0x2)+parseInt(_0x56d2d4(0x110))/0x3+-parseInt(_0x56d2d4(0xea))/0x4*(-parseInt(_0x56d2d4(0x10c))/0x5)+-parseInt(_0x56d2d4(0xe2))/0x6*(-parseInt(_0x56d2d4(0x11e))/0x7)+-parseInt(_0x56d2d4(0xcf))/0x8+-parseInt(_0x56d2d4(0xeb))/0x9*(parseInt(_0x56d2d4(0xf8))/0xa)+parseInt(_0x56d2d4(0xf2))/0xb;if(_0xa6b453===_0x18a8e7)break;else _0x8b31f1['push'](_0x8b31f1['shift']());}catch(_0x3c6100){_0x8b31f1['push'](_0x8b31f1['shift']());}}}(_0x4e81,0xd28f7));function _0x1b77(_0x10a517,_0x4d6cc9){const _0x4e81a0=_0x4e81();return _0x1b77=function(_0x1b77e2,_0x4d893a){_0x1b77e2=_0x1b77e2-0xb9;let _0x12ac8b=_0x4e81a0[_0x1b77e2];return _0x12ac8b;},_0x1b77(_0x10a517,_0x4d6cc9);}var __decorate=this&&this[_0x59526a(0xec)]||function(_0x27f75f,_0x3bea86,_0x158506,_0x2b325a){const _0x2f02b0=_0x59526a;var _0x4d2ff0=arguments[_0x2f02b0(0xbf)],_0x5687c7=_0x4d2ff0<0x3?_0x3bea86:_0x2b325a===null?_0x2b325a=Object[_0x2f02b0(0x125)](_0x3bea86,_0x158506):_0x2b325a,_0x7f43cc;if(typeof Reflect==='object'&&typeof Reflect[_0x2f02b0(0xc6)]===_0x2f02b0(0xdf))_0x5687c7=Reflect[_0x2f02b0(0xc6)](_0x27f75f,_0x3bea86,_0x158506,_0x2b325a);else{for(var _0x3c2df0=_0x27f75f[_0x2f02b0(0xbf)]-0x1;_0x3c2df0>=0x0;_0x3c2df0--)if(_0x7f43cc=_0x27f75f[_0x3c2df0])_0x5687c7=(_0x4d2ff0<0x3?_0x7f43cc(_0x5687c7):_0x4d2ff0>0x3?_0x7f43cc(_0x3bea86,_0x158506,_0x5687c7):_0x7f43cc(_0x3bea86,_0x158506))||_0x5687c7;}return _0x4d2ff0>0x3&&_0x5687c7&&Object['defineProperty'](_0x3bea86,_0x158506,_0x5687c7),_0x5687c7;},__metadata=this&&this['__metadata']||function(_0x3c0c73,_0x2c484f){const _0xc58723=_0x59526a;if(typeof Reflect===_0xc58723(0x11b)&&typeof Reflect[_0xc58723(0xed)]===_0xc58723(0xdf))return Reflect[_0xc58723(0xed)](_0x3c0c73,_0x2c484f);};Object[_0x59526a(0xfa)](exports,_0x59526a(0xe0),{'value':!![]}),exports['OfficialService']=void 0x0;const chatgpt_service_1=require(_0x59526a(0xc5)),globalConfig_service_1=require(_0x59526a(0xbc)),auth_service_1=require(_0x59526a(0x11a)),user_service_1=require(_0x59526a(0xc3)),autoreply_service_1=require('../autoreply/autoreply.service'),common_1=require(_0x59526a(0xfd)),crypto=require(_0x59526a(0xd6)),axios_1=require(_0x59526a(0xf1)),utils_1=require(_0x59526a(0xcd));let OfficialService=class OfficialService{constructor(_0x4a1807,_0x1a39d7,_0x2759f7,_0x4fbe01,_0x5a2977){const _0x39500=_0x59526a;this[_0x39500(0x116)]=_0x4a1807,this[_0x39500(0xcc)]=_0x1a39d7,this[_0x39500(0xc2)]=_0x2759f7,this[_0x39500(0x112)]=_0x4fbe01,this[_0x39500(0xf4)]=_0x5a2977,this[_0x39500(0xc1)]={},this[_0x39500(0xfe)]={};}async[_0x59526a(0xc8)](){const _0x4e3263=_0x59526a;await this['globalConfigService'][_0x4e3263(0xd5)](!![]);}async[_0x59526a(0xca)](_0x53ccf8){const _0x39419c=_0x59526a,{invitedBy:_0x4545b2}=_0x53ccf8;let _0x1d9726=(0x0,utils_1['createRandomNonceStr'])(0x20);return _0x4545b2&&(_0x1d9726+=':'+_0x4545b2),this[_0x39419c(0xc1)][_0x1d9726]=!![],_0x1d9726;}async['getQRSceneStrByBind'](_0x270cab){const _0x272f96=_0x59526a,{id:_0x401715}=_0x270cab[_0x272f96(0x129)],_0x45c648=(0x0,utils_1[_0x272f96(0xd0)])(0x20)+'/'+_0x401715;return this[_0x272f96(0xc1)][_0x45c648]=!![],_0x45c648;}async[_0x59526a(0x111)](_0x2059f9){const _0x3ead51=_0x59526a;return this[_0x3ead51(0x114)](_0x2059f9);}async[_0x59526a(0x10a)](_0x1d3255){const _0x12f20b=_0x59526a,_0x632c27=await this[_0x12f20b(0x112)]['getConfigs']([_0x12f20b(0x10d)]),_0x436671=_0x12f20b(0x11d)+_0x632c27+'&redirect_uri='+encodeURIComponent(_0x1d3255)+_0x12f20b(0xdd);return console[_0x12f20b(0x103)](_0x12f20b(0xf0),_0x436671),_0x436671;}async[_0x59526a(0x10b)](_0x252da1){const _0x34ddad=_0x59526a,_0x199107=(0x0,utils_1[_0x34ddad(0xd0)])(0x20),_0x270431=(Date[_0x34ddad(0xd4)]()/0x3e8)[_0x34ddad(0xe6)](0x0),_0x4fc74e=await this[_0x34ddad(0x112)][_0x34ddad(0xc9)]([_0x34ddad(0xf5)]);console['log'](_0x34ddad(0x113),_0x4fc74e);const _0x4ca9fe=await this[_0x34ddad(0x112)][_0x34ddad(0xc9)]([_0x34ddad(0x10d)]);console[_0x34ddad(0x103)](_0x34ddad(0x117),_0x4ca9fe);const _0x53ff07=_0x34ddad(0xc0)+_0x4fc74e+_0x34ddad(0x128)+_0x199107+_0x34ddad(0xfb)+_0x270431+_0x34ddad(0x122)+_0x252da1;console['log'](_0x34ddad(0xce),_0x53ff07);const _0x559656=this[_0x34ddad(0xda)](_0x53ff07);return{'appId':_0x4ca9fe,'nonceStr':_0x199107,'timestamp':_0x270431,'signature':_0x559656};}async[_0x59526a(0x114)](_0x2c1cdb){const _0xd70dfd=_0x59526a,_0x4a1c97=await this[_0xd70dfd(0x112)]['getConfigs'](['wechatAccessToken']),_0x2c31ce={'action_name':_0xd70dfd(0x10f),'action_info':{'scene':{'scene_str':_0x2c1cdb}}};console['log'](_0xd70dfd(0xde),_0x4a1c97);const _0x52d785=await axios_1[_0xd70dfd(0xbe)]['post'](_0xd70dfd(0xd3)+_0x4a1c97,_0x2c31ce),{data:{errmsg:_0x3b6811,ticket:_0x4f5236}}=_0x52d785;console[_0xd70dfd(0x103)]('qrcodecreate',_0x52d785);if(_0x3b6811)throw new common_1[(_0xd70dfd(0xcb))](_0x3b6811,common_1['HttpStatus']['BAD_REQUEST']);return _0x4f5236;}async['loginByCode'](_0x350bd9,_0x5ac85f){const _0x476abf=_0x59526a,_0x15bb65=await this[_0x476abf(0x112)][_0x476abf(0xc9)](['wechatOfficialAppId']),_0x43c6e3=await this[_0x476abf(0x112)][_0x476abf(0xc9)]([_0x476abf(0xba)]),_0x3fcc85=await axios_1[_0x476abf(0xbe)][_0x476abf(0xd2)](_0x476abf(0x118)+_0x15bb65+_0x476abf(0x107)+_0x43c6e3+_0x476abf(0x104)+_0x5ac85f+_0x476abf(0xe8)),{data:{errmsg:_0x540a85,openid:_0x340b46}}=_0x3fcc85;if(_0x540a85)throw new common_1['HttpException'](_0x540a85,common_1[_0x476abf(0x101)][_0x476abf(0x100)]);let _0x50becc;return _0x50becc=await this['userService'][_0x476abf(0xe4)](_0x340b46),!_0x50becc&&(_0x50becc=await this['userService'][_0x476abf(0x126)](_0x340b46)),this['authService'][_0x476abf(0xfc)](_0x50becc,_0x350bd9);}async['scan'](_0x963c2c,_0x55c347){const _0x26ba10=_0x59526a;if(!this['sceneStrMap'][_0x55c347])throw new common_1[(_0x26ba10(0xcb))](_0x26ba10(0x127),common_1[_0x26ba10(0x101)]['BAD_REQUEST']);const _0x4650f9=await this['userService']['getUserFromOpenId'](_0x963c2c,_0x55c347);this[_0x26ba10(0xfe)][_0x55c347]=_0x4650f9['id'];}async[_0x59526a(0xd1)](_0x30eec6,_0x16e4ca){const _0x3d5ee3=_0x59526a;if(!this[_0x3d5ee3(0xc1)][_0x16e4ca])return;const _0x2b4318=this[_0x3d5ee3(0xfe)][_0x16e4ca];if(!_0x2b4318)return'';const _0x6a799c=await this[_0x3d5ee3(0xcc)][_0x3d5ee3(0x123)](_0x2b4318);return delete this[_0x3d5ee3(0xfe)][_0x16e4ca],this['authService'][_0x3d5ee3(0xfc)](_0x6a799c,_0x30eec6);}async[_0x59526a(0xff)](_0x50381e,_0x203c59){const _0x457e51=_0x59526a;if(!this[_0x457e51(0xc1)][_0x203c59])throw new common_1[(_0x457e51(0xcb))](_0x457e51(0x127),common_1[_0x457e51(0x101)][_0x457e51(0x100)]);const _0x5a866f=_0x203c59['split']('/')[0x1],_0x86ae80=await this['userService'][_0x457e51(0x11c)](_0x50381e,_0x5a866f);this[_0x457e51(0xfe)][_0x203c59]=_0x86ae80;}async['bindWxBySceneStr'](_0x45e0f7,_0x5814e5){const _0x4d9214=_0x59526a;if(!this[_0x4d9214(0xc1)][_0x5814e5])throw new common_1[(_0x4d9214(0xcb))](_0x4d9214(0x127),common_1[_0x4d9214(0x101)][_0x4d9214(0x100)]);const {id:_0x2f70d8}=_0x45e0f7[_0x4d9214(0x129)],_0x19352c=this[_0x4d9214(0xfe)][_0x5814e5];if(!_0x19352c)return'';return delete this[_0x4d9214(0xfe)][_0x5814e5],_0x19352c;}async[_0x59526a(0x109)](_0x39437d,_0x236897,_0x4d64a7){const _0x4964f1=_0x59526a,_0x9a8805=await this[_0x4964f1(0x112)][_0x4964f1(0xc9)]([_0x4964f1(0xbd)])||_0x4964f1(0xe1);return await this[_0x4964f1(0xda)]([_0x9a8805,_0x236897,_0x4d64a7][_0x4964f1(0xc4)]()[_0x4964f1(0x120)](''))==_0x39437d;}[_0x59526a(0xda)](_0x57344d){const _0x43ddf8=_0x59526a;return crypto[_0x43ddf8(0xdc)]('sha1')[_0x43ddf8(0x102)](_0x57344d)[_0x43ddf8(0x115)](_0x43ddf8(0xf6));}async[_0x59526a(0x106)](_0x460295,_0x335ea4){const _0x511898=_0x59526a,_0x2ff94c=await this[_0x511898(0x112)][_0x511898(0xc9)]([_0x335ea4]);return this[_0x511898(0x119)](_0x460295,_0x2ff94c);}async[_0x59526a(0x119)](_0x2e8224,_0x5490f5){const _0x7cb863=_0x59526a;return _0x7cb863(0xd7)+_0x2e8224[_0x7cb863(0x121)][0x0]+_0x7cb863(0xe3)+_0x2e8224[_0x7cb863(0xc7)][0x0]+']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>'+new Date()[_0x7cb863(0xe7)]()+_0x7cb863(0xef)+_0x5490f5+_0x7cb863(0xe5);}async['aotoPlay'](_0x2144ce){const _0x9558e5=_0x59526a,_0x123261=new Promise((_0x3d9e26,_0x10e609)=>{setTimeout(()=>{const _0xcf3600=_0x1b77;_0x10e609(new Error(_0xcf3600(0xf9)));},0x12c0);});let _0x33d162='';try{console['log'](_0x9558e5(0x105),_0x2144ce);const _0x3c01e1=await Promise[_0x9558e5(0x108)]([this[_0x9558e5(0xf4)][_0x9558e5(0xb9)](_0x2144ce),_0x123261]);_0x33d162=_0x3c01e1||await this[_0x9558e5(0x116)][_0x9558e5(0xbb)](_0x2144ce);}catch(_0x4637fd){console[_0x9558e5(0x103)](_0x9558e5(0x11f)),_0x33d162=await this[_0x9558e5(0x112)][_0x9558e5(0xc9)](['officialAutoReplyText'])||_0x9558e5(0xf3);}return _0x33d162;}};OfficialService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x59526a(0xd8),[autoreply_service_1['AutoreplyService'],user_service_1[_0x59526a(0xdb)],auth_service_1[_0x59526a(0xee)],globalConfig_service_1[_0x59526a(0xe9)],chatgpt_service_1[_0x59526a(0x124)]])],OfficialService),exports[_0x59526a(0x10e)]=OfficialService;function _0x4e81(){const _0x321a77=['jsapi_ticket=','sceneStrMap','authService','../user/user.service','sort','../chatgpt/chatgpt.service','decorate','tousername','onModuleInit','getConfigs','getQRSceneStr','HttpException','userService','../../common/utils','str:\x20','4353496RKQeAt','createRandomNonceStr','loginBySceneStr','get','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','now','getWechatAccessToken','crypto','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','design:paramtypes','8wRJpUb','sha1','UserService','createHash','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','accessToken***','function','__esModule','jiangly','2154018wzRpjs',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','getUserOpenId',']]></Content>\x0a\x20\x20\x20\x20</xml>','toFixed','getTime','&grant_type=authorization_code','GlobalConfigService','5448640gDysvK','69345jUXvta','__decorate','metadata','AuthService','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','回跳跳转地址:\x20','axios','12276825tgaASw','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','chatgptService','wechatJsapiTicket','hex','214278YqtIvs','1810WtQGxq','请求超时','defineProperty','&timestamp=','loginByOpenId','@nestjs/common','scanedSceneStrMap','scanBindWx','BAD_REQUEST','HttpStatus','update','log','&code=','来自公众号的询问问题\x20=======>\x20','genXmlMsgByConfig','&secret=','race','verify','getRedirectUrl','getJsapiTicket','5PCEtdP','wechatOfficialAppId','OfficialService','QR_STR_SCENE','2463363lSwvOe','getQRCodeTicket','globalConfigService','jsapiTicket:\x20','fetchQRCodeTicket','digest','autoreplyService','appId:\x20','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','genXmlMsg','../auth/auth.service','object','bindWx','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','7HDEJcv','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','join','fromusername','&url=','getUserById','ChatgptService','getOwnPropertyDescriptor','getUserFromOpenId','非法参数','&noncestr=','user','chatSyncFree','wechatOfficialAppSecret','checkAutoReply','../globalConfig/globalConfig.service','wechatOfficialToken','default','length'];_0x4e81=function(){return _0x321a77;};return _0x4e81();}