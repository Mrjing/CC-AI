'use strict';function _0x58f0(_0x4e81e7,_0x55bf57){const _0x1255a=_0x1255();return _0x58f0=function(_0x58f0f5,_0x4baee1){_0x58f0f5=_0x58f0f5-0x195;let _0x4f3204=_0x1255a[_0x58f0f5];return _0x4f3204;},_0x58f0(_0x4e81e7,_0x55bf57);}const _0x166221=_0x58f0;function _0x1255(){const _0xd70509=['loginByCode','936054hFXQRv','globalConfigService','tousername','BAD_REQUEST','jsapiTicket:\x20','AuthService','loginByOpenId','&grant_type=authorization_code','Injectable','onModuleInit','axios','loginBySceneStr','function','getOwnPropertyDescriptor','__decorate','8AamnvZ','getConfigs','log','../globalConfig/globalConfig.service','wechatOfficialAppId','270739DUWPSc','&redirect_uri=','jsapi_ticket=','object','sort','getQRSceneStr','回跳跳转地址:\x20','getQRCodeTicket','chatgptService','genXmlMsg','getJsapiTicket','../user/user.service','metadata','sha1','getWechatAccessToken','sceneStrMap','&url=','../autoreply/autoreply.service','108033Wslnzz','726150hdDCEz','bindWxBySceneStr','default','1406421Dmlspw','getQRSceneStrByBind','../chatgpt/chatgpt.service','ChatgptService','1508900SExncU','crypto','../auth/auth.service','OfficialService','chatSyncFree','2096kavtIv','scanBindWx','decorate','createRandomNonceStr',']]></Content>\x0a\x20\x20\x20\x20</xml>','wechatOfficialToken','wechatJsapiTicket','userService','digest','user','getUserOpenId','post','fetchQRCodeTicket','16hOiDcI','appId:\x20','AutoreplyService','&timestamp=','请求超时','get','verify','update','6zHLfUc','length','getRedirectUrl','hex','race','https://open.weixin.qq.com/connect/oauth2/authorize?appid=',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','HttpException','bindWx','defineProperty','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','aotoPlay','authService','非法参数','HttpStatus','getUserFromOpenId','wechatOfficialAppSecret','../../common/utils','scanedSceneStrMap','autoreplyService','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','__esModule','design:paramtypes','&secret=','QR_STR_SCENE','&noncestr=','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','scan'];_0x1255=function(){return _0xd70509;};return _0x1255();}(function(_0x4aa5f2,_0x193984){const _0x1046c5=_0x58f0,_0x250eec=_0x4aa5f2();while(!![]){try{const _0x52a602=parseInt(_0x1046c5(0x1ac))/0x1*(-parseInt(_0x1046c5(0x197))/0x2)+-parseInt(_0x1046c5(0x1f0))/0x3*(-parseInt(_0x1046c5(0x1d9))/0x4)+parseInt(_0x1046c5(0x1f1))/0x5+-parseInt(_0x1046c5(0x1ca))/0x6+parseInt(_0x1046c5(0x1de))/0x7*(parseInt(_0x1046c5(0x1a4))/0x8)+parseInt(_0x1046c5(0x1f4))/0x9+-parseInt(_0x1046c5(0x1f8))/0xa;if(_0x52a602===_0x193984)break;else _0x250eec['push'](_0x250eec['shift']());}catch(_0x3e0567){_0x250eec['push'](_0x250eec['shift']());}}}(_0x1255,0x219d8));var __decorate=this&&this[_0x166221(0x1d8)]||function(_0x41610e,_0x2975ad,_0x37f711,_0x566f1c){const _0x86ff3=_0x166221;var _0x5dd0f6=arguments[_0x86ff3(0x1ad)],_0x1d0f08=_0x5dd0f6<0x3?_0x2975ad:_0x566f1c===null?_0x566f1c=Object[_0x86ff3(0x1d7)](_0x2975ad,_0x37f711):_0x566f1c,_0x3e1b01;if(typeof Reflect==='object'&&typeof Reflect[_0x86ff3(0x199)]===_0x86ff3(0x1d6))_0x1d0f08=Reflect[_0x86ff3(0x199)](_0x41610e,_0x2975ad,_0x37f711,_0x566f1c);else{for(var _0x27a0ea=_0x41610e[_0x86ff3(0x1ad)]-0x1;_0x27a0ea>=0x0;_0x27a0ea--)if(_0x3e1b01=_0x41610e[_0x27a0ea])_0x1d0f08=(_0x5dd0f6<0x3?_0x3e1b01(_0x1d0f08):_0x5dd0f6>0x3?_0x3e1b01(_0x2975ad,_0x37f711,_0x1d0f08):_0x3e1b01(_0x2975ad,_0x37f711))||_0x1d0f08;}return _0x5dd0f6>0x3&&_0x1d0f08&&Object[_0x86ff3(0x1b5)](_0x2975ad,_0x37f711,_0x1d0f08),_0x1d0f08;},__metadata=this&&this['__metadata']||function(_0x6a40c5,_0x143af1){const _0x556ed3=_0x166221;if(typeof Reflect===_0x556ed3(0x1e1)&&typeof Reflect[_0x556ed3(0x1ea)]===_0x556ed3(0x1d6))return Reflect['metadata'](_0x6a40c5,_0x143af1);};Object['defineProperty'](exports,_0x166221(0x1c1),{'value':!![]}),exports[_0x166221(0x195)]=void 0x0;const chatgpt_service_1=require(_0x166221(0x1f6)),globalConfig_service_1=require(_0x166221(0x1dc)),auth_service_1=require(_0x166221(0x1fa)),user_service_1=require(_0x166221(0x1e9)),autoreply_service_1=require(_0x166221(0x1ef)),common_1=require('@nestjs/common'),crypto=require(_0x166221(0x1f9)),axios_1=require(_0x166221(0x1d4)),utils_1=require(_0x166221(0x1bd));let OfficialService=class OfficialService{constructor(_0x10e7f7,_0x5d9434,_0x13a54f,_0x11387c,_0xa9dbde){const _0x30e8fc=_0x166221;this[_0x30e8fc(0x1bf)]=_0x10e7f7,this['userService']=_0x5d9434,this[_0x30e8fc(0x1b8)]=_0x13a54f,this['globalConfigService']=_0x11387c,this['chatgptService']=_0xa9dbde,this['sceneStrMap']={},this[_0x30e8fc(0x1be)]={};}async[_0x166221(0x1d3)](){const _0x4a822d=_0x166221;await this[_0x4a822d(0x1cb)][_0x4a822d(0x1ec)](!![]);}async[_0x166221(0x1e3)](_0x2e16bc){const {invitedBy:_0xa3edea}=_0x2e16bc;let _0x26bd67=(0x0,utils_1['createRandomNonceStr'])(0x20);return _0xa3edea&&(_0x26bd67+=':'+_0xa3edea),this['sceneStrMap'][_0x26bd67]=!![],_0x26bd67;}async[_0x166221(0x1f5)](_0x30d358){const _0x1ba0d1=_0x166221,{id:_0x42f7ab}=_0x30d358[_0x1ba0d1(0x1a0)],_0x1e73e3=(0x0,utils_1[_0x1ba0d1(0x19a)])(0x20)+'/'+_0x42f7ab;return this[_0x1ba0d1(0x1ed)][_0x1e73e3]=!![],_0x1e73e3;}async[_0x166221(0x1e5)](_0x302261){const _0x519f26=_0x166221;return this[_0x519f26(0x1a3)](_0x302261);}async[_0x166221(0x1ae)](_0x2ccd8c){const _0x5e1eda=_0x166221,_0x4c4c9d=await this[_0x5e1eda(0x1cb)][_0x5e1eda(0x1da)]([_0x5e1eda(0x1dd)]),_0x3e51dd=_0x5e1eda(0x1b1)+_0x4c4c9d+_0x5e1eda(0x1df)+encodeURIComponent(_0x2ccd8c)+_0x5e1eda(0x1b6);return console[_0x5e1eda(0x1db)](_0x5e1eda(0x1e4),_0x3e51dd),_0x3e51dd;}async[_0x166221(0x1e8)](_0x473b48){const _0x1b1fbe=_0x166221,_0x5d947e=(0x0,utils_1[_0x1b1fbe(0x19a)])(0x20),_0x493ba3=(Date['now']()/0x3e8)['toFixed'](0x0),_0x3eb308=await this['globalConfigService'][_0x1b1fbe(0x1da)]([_0x1b1fbe(0x19d)]);console[_0x1b1fbe(0x1db)](_0x1b1fbe(0x1ce),_0x3eb308);const _0x3f1280=await this[_0x1b1fbe(0x1cb)][_0x1b1fbe(0x1da)]([_0x1b1fbe(0x1dd)]);console[_0x1b1fbe(0x1db)](_0x1b1fbe(0x1a5),_0x3f1280);const _0x65221a=_0x1b1fbe(0x1e0)+_0x3eb308+_0x1b1fbe(0x1c5)+_0x5d947e+_0x1b1fbe(0x1a7)+_0x493ba3+_0x1b1fbe(0x1ee)+_0x473b48;console[_0x1b1fbe(0x1db)]('str:\x20',_0x65221a);const _0x14cefd=this[_0x1b1fbe(0x1eb)](_0x65221a);return{'appId':_0x3f1280,'nonceStr':_0x5d947e,'timestamp':_0x493ba3,'signature':_0x14cefd};}async[_0x166221(0x1a3)](_0x4b4abb){const _0xd386c9=_0x166221,_0x540c35=await this[_0xd386c9(0x1cb)][_0xd386c9(0x1da)](['wechatAccessToken']),_0x469f60={'action_name':_0xd386c9(0x1c4),'action_info':{'scene':{'scene_str':_0x4b4abb}}},_0x3709ca=await axios_1[_0xd386c9(0x1f3)][_0xd386c9(0x1a2)](_0xd386c9(0x1c6)+_0x540c35,_0x469f60),{data:{errmsg:_0x19b6fc,ticket:_0x45d01e}}=_0x3709ca;if(_0x19b6fc)throw new common_1[(_0xd386c9(0x1b3))](_0x19b6fc,common_1['HttpStatus'][_0xd386c9(0x1cd)]);return _0x45d01e;}async[_0x166221(0x1c9)](_0x51b797,_0x20ca1b){const _0x5901ba=_0x166221,_0x3d86f7=await this['globalConfigService'][_0x5901ba(0x1da)](['wechatOfficialAppId']),_0xdaf031=await this['globalConfigService'][_0x5901ba(0x1da)]([_0x5901ba(0x1bc)]),_0x2add68=await axios_1['default'][_0x5901ba(0x1a9)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x3d86f7+_0x5901ba(0x1c3)+_0xdaf031+'&code='+_0x20ca1b+_0x5901ba(0x1d1)),{data:{errmsg:_0x3b445f,openid:_0x2c9e77}}=_0x2add68;if(_0x3b445f)throw new common_1[(_0x5901ba(0x1b3))](_0x3b445f,common_1[_0x5901ba(0x1ba)][_0x5901ba(0x1cd)]);let _0xf4bde;return _0xf4bde=await this[_0x5901ba(0x19e)][_0x5901ba(0x1a1)](_0x2c9e77),!_0xf4bde&&(_0xf4bde=await this[_0x5901ba(0x19e)][_0x5901ba(0x1bb)](_0x2c9e77)),this['authService'][_0x5901ba(0x1d0)](_0xf4bde,_0x51b797);}async[_0x166221(0x1c8)](_0x4f4b41,_0x1745f7){const _0xd69f5d=_0x166221;if(!this['sceneStrMap'][_0x1745f7])throw new common_1[(_0xd69f5d(0x1b3))](_0xd69f5d(0x1b9),common_1[_0xd69f5d(0x1ba)]['BAD_REQUEST']);const _0x47de17=await this[_0xd69f5d(0x19e)][_0xd69f5d(0x1bb)](_0x4f4b41,_0x1745f7);this['scanedSceneStrMap'][_0x1745f7]=_0x47de17['id'];}async[_0x166221(0x1d5)](_0x5e8d3f,_0x29e8de){const _0x1a9c16=_0x166221;if(!this[_0x1a9c16(0x1ed)][_0x29e8de])return;const _0x126a18=this['scanedSceneStrMap'][_0x29e8de];if(!_0x126a18)return'';const _0x525937=await this[_0x1a9c16(0x19e)]['getUserById'](_0x126a18);return delete this[_0x1a9c16(0x1be)][_0x29e8de],this[_0x1a9c16(0x1b8)]['loginByOpenId'](_0x525937,_0x5e8d3f);}async[_0x166221(0x198)](_0xaeef49,_0x59b1d5){const _0x17e3e4=_0x166221;if(!this['sceneStrMap'][_0x59b1d5])throw new common_1[(_0x17e3e4(0x1b3))](_0x17e3e4(0x1b9),common_1['HttpStatus'][_0x17e3e4(0x1cd)]);const _0x1bdef7=_0x59b1d5['split']('/')[0x1],_0x290e7b=await this['userService'][_0x17e3e4(0x1b4)](_0xaeef49,_0x1bdef7);this[_0x17e3e4(0x1be)][_0x59b1d5]=_0x290e7b;}async[_0x166221(0x1f2)](_0xa94c95,_0x48294a){const _0x2da4ca=_0x166221;if(!this[_0x2da4ca(0x1ed)][_0x48294a])throw new common_1['HttpException'](_0x2da4ca(0x1b9),common_1[_0x2da4ca(0x1ba)]['BAD_REQUEST']);const {id:_0x5bd1fa}=_0xa94c95[_0x2da4ca(0x1a0)],_0x5905d6=this[_0x2da4ca(0x1be)][_0x48294a];if(!_0x5905d6)return'';return delete this['scanedSceneStrMap'][_0x48294a],_0x5905d6;}async[_0x166221(0x1aa)](_0x3a301e,_0x4c6eb8,_0x115ef5){const _0x333852=_0x166221,_0x3b89ee=await this[_0x333852(0x1cb)][_0x333852(0x1da)]([_0x333852(0x19c)])||'jiangly';return await this['sha1']([_0x3b89ee,_0x4c6eb8,_0x115ef5][_0x333852(0x1e2)]()['join'](''))==_0x3a301e;}[_0x166221(0x1eb)](_0x90a092){const _0x203c57=_0x166221;return crypto['createHash']('sha1')[_0x203c57(0x1ab)](_0x90a092)[_0x203c57(0x19f)](_0x203c57(0x1af));}async['genXmlMsgByConfig'](_0x29e93a,_0x13dd1b){const _0x3fd0ce=_0x166221,_0x2dc9c6=await this[_0x3fd0ce(0x1cb)][_0x3fd0ce(0x1da)]([_0x13dd1b]);return this[_0x3fd0ce(0x1e7)](_0x29e93a,_0x2dc9c6);}async[_0x166221(0x1e7)](_0x5e1d52,_0x4c57ae){const _0x11aac3=_0x166221;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x5e1d52['fromusername'][0x0]+_0x11aac3(0x1c7)+_0x5e1d52[_0x11aac3(0x1cc)][0x0]+_0x11aac3(0x1b2)+new Date()['getTime']()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x4c57ae+_0x11aac3(0x19b);}async[_0x166221(0x1b7)](_0x4bfdf8){const _0x51f5e8=_0x166221,_0x429760=new Promise((_0x4c1780,_0x446d46)=>{setTimeout(()=>{const _0x52b204=_0x58f0;_0x446d46(new Error(_0x52b204(0x1a8)));},0x12c0);});let _0x341b5d='';try{console[_0x51f5e8(0x1db)]('来自公众号的询问问题\x20=======>\x20',_0x4bfdf8);const _0x40c935=await Promise[_0x51f5e8(0x1b0)]([this[_0x51f5e8(0x1e6)][_0x51f5e8(0x196)](_0x4bfdf8),_0x429760]);_0x341b5d=_0x40c935||await this[_0x51f5e8(0x1bf)]['checkAutoReply'](_0x4bfdf8);}catch(_0x292ce6){console[_0x51f5e8(0x1db)](_0x51f5e8(0x1c0)),_0x341b5d=await this['globalConfigService'][_0x51f5e8(0x1da)](['officialAutoReplyText'])||'由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！';}return _0x341b5d;}};OfficialService=__decorate([(0x0,common_1[_0x166221(0x1d2)])(),__metadata(_0x166221(0x1c2),[autoreply_service_1[_0x166221(0x1a6)],user_service_1['UserService'],auth_service_1[_0x166221(0x1cf)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1[_0x166221(0x1f7)]])],OfficialService),exports[_0x166221(0x195)]=OfficialService;