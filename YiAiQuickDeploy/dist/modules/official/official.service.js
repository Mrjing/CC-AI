'use strict';const _0xbbc3ee=_0x1eb8;function _0x1eb8(_0x2f00bb,_0x26d904){const _0x2aaf60=_0x2aaf();return _0x1eb8=function(_0x1eb896,_0x57a2d3){_0x1eb896=_0x1eb896-0x191;let _0x192b28=_0x2aaf60[_0x1eb896];return _0x192b28;},_0x1eb8(_0x2f00bb,_0x26d904);}(function(_0x561e56,_0x49cd46){const _0x4a6bfe=_0x1eb8,_0x43aa22=_0x561e56();while(!![]){try{const _0x717066=-parseInt(_0x4a6bfe(0x1a6))/0x1+-parseInt(_0x4a6bfe(0x1ec))/0x2+parseInt(_0x4a6bfe(0x19f))/0x3+-parseInt(_0x4a6bfe(0x1a8))/0x4*(-parseInt(_0x4a6bfe(0x1e7))/0x5)+parseInt(_0x4a6bfe(0x1b1))/0x6+-parseInt(_0x4a6bfe(0x1ef))/0x7+-parseInt(_0x4a6bfe(0x1d6))/0x8*(-parseInt(_0x4a6bfe(0x1ab))/0x9);if(_0x717066===_0x49cd46)break;else _0x43aa22['push'](_0x43aa22['shift']());}catch(_0x39b0a1){_0x43aa22['push'](_0x43aa22['shift']());}}}(_0x2aaf,0x1f852));function _0x2aaf(){const _0x173258=['log','5LxDBFE','object','loginByOpenId','&secret=','str:\x20','509906GlaRwG','wechatOfficialToken','scanedSceneStrMap','1368794LQXcTX','ChatgptService','bindWxBySceneStr','getJsapiTicket','../chatgpt/chatgpt.service','sceneStrMap','__decorate','../auth/auth.service','../user/user.service','decorate','default','wechatOfficialAppSecret','getUserById','非法参数','getTime','authService','metadata','jiangly','tousername','autoreplyService','__metadata','__esModule','function','createRandomNonceStr','83478JXJSCv','post','来自公众号的询问问题\x20=======>\x20','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','getQRSceneStrByBind','userService','chatgptService','171890PEpaUY','OfficialService','303568awqOuY','jsapi_ticket=','fetchQRCodeTicket','9aQZeKo','Injectable','getWechatAccessToken','onModuleInit','UserService','fromusername','189636DziSwM','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','digest','appId:\x20','scanBindWx','HttpException','wechatAccessToken','chatSyncFree','AuthService','sort','getUserOpenId','回跳跳转地址:\x20','BAD_REQUEST','getQRSceneStr','globalConfigService','race','design:paramtypes',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','crypto','genXmlMsgByConfig','&url=','aotoPlay','&code=','getConfigs','../autoreply/autoreply.service','genXmlMsg','now','getUserFromOpenId','wechatOfficialAppId','&redirect_uri=','createHash','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','&grant_type=authorization_code','&noncestr=','AutoreplyService','jsapiTicket:\x20','join','4929336LAokHZ','&timestamp=','update','checkAutoReply',']]></Content>\x0a\x20\x20\x20\x20</xml>','../../common/utils','getQRCodeTicket','sha1','length','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','defineProperty','user','split','../globalConfig/globalConfig.service','HttpStatus','https://open.weixin.qq.com/connect/oauth2/authorize?appid='];_0x2aaf=function(){return _0x173258;};return _0x2aaf();}var __decorate=this&&this[_0xbbc3ee(0x1f5)]||function(_0x402b50,_0x564db3,_0x32f462,_0x5ae8d9){const _0x4ee3f9=_0xbbc3ee;var _0x205837=arguments[_0x4ee3f9(0x1de)],_0x988805=_0x205837<0x3?_0x564db3:_0x5ae8d9===null?_0x5ae8d9=Object['getOwnPropertyDescriptor'](_0x564db3,_0x32f462):_0x5ae8d9,_0x7f2e9a;if(typeof Reflect===_0x4ee3f9(0x1e8)&&typeof Reflect[_0x4ee3f9(0x1f8)]===_0x4ee3f9(0x19d))_0x988805=Reflect['decorate'](_0x402b50,_0x564db3,_0x32f462,_0x5ae8d9);else{for(var _0x1408eb=_0x402b50[_0x4ee3f9(0x1de)]-0x1;_0x1408eb>=0x0;_0x1408eb--)if(_0x7f2e9a=_0x402b50[_0x1408eb])_0x988805=(_0x205837<0x3?_0x7f2e9a(_0x988805):_0x205837>0x3?_0x7f2e9a(_0x564db3,_0x32f462,_0x988805):_0x7f2e9a(_0x564db3,_0x32f462))||_0x988805;}return _0x205837>0x3&&_0x988805&&Object[_0x4ee3f9(0x1e0)](_0x564db3,_0x32f462,_0x988805),_0x988805;},__metadata=this&&this[_0xbbc3ee(0x19b)]||function(_0x1f5cfd,_0x2b26ea){const _0xe1beb5=_0xbbc3ee;if(typeof Reflect==='object'&&typeof Reflect[_0xe1beb5(0x197)]==='function')return Reflect[_0xe1beb5(0x197)](_0x1f5cfd,_0x2b26ea);};Object['defineProperty'](exports,_0xbbc3ee(0x19c),{'value':!![]}),exports[_0xbbc3ee(0x1a7)]=void 0x0;const chatgpt_service_1=require(_0xbbc3ee(0x1f3)),globalConfig_service_1=require(_0xbbc3ee(0x1e3)),auth_service_1=require(_0xbbc3ee(0x1f6)),user_service_1=require(_0xbbc3ee(0x1f7)),autoreply_service_1=require(_0xbbc3ee(0x1c9)),common_1=require('@nestjs/common'),crypto=require(_0xbbc3ee(0x1c3)),axios_1=require('axios'),utils_1=require(_0xbbc3ee(0x1db));let OfficialService=class OfficialService{constructor(_0x4cf56c,_0x57a92f,_0x3347e0,_0x542b2e,_0xd4fb07){const _0x3894af=_0xbbc3ee;this[_0x3894af(0x19a)]=_0x4cf56c,this[_0x3894af(0x1a4)]=_0x57a92f,this[_0x3894af(0x196)]=_0x3347e0,this[_0x3894af(0x1bf)]=_0x542b2e,this[_0x3894af(0x1a5)]=_0xd4fb07,this[_0x3894af(0x1f4)]={},this[_0x3894af(0x1ee)]={};}async[_0xbbc3ee(0x1ae)](){const _0x565ef1=_0xbbc3ee;await this['globalConfigService'][_0x565ef1(0x1ad)](!![]);}async[_0xbbc3ee(0x1be)](_0x5f3d5c){const _0x2fdf44=_0xbbc3ee,{invitedBy:_0x3cd286}=_0x5f3d5c;let _0x2e848d=(0x0,utils_1[_0x2fdf44(0x19e)])(0x20);return _0x3cd286&&(_0x2e848d+=':'+_0x3cd286),this[_0x2fdf44(0x1f4)][_0x2e848d]=!![],_0x2e848d;}async[_0xbbc3ee(0x1a3)](_0xe6e948){const _0x119427=_0xbbc3ee,{id:_0x4cf1e6}=_0xe6e948['user'],_0x36fddc=(0x0,utils_1['createRandomNonceStr'])(0x20)+'/'+_0x4cf1e6;return this[_0x119427(0x1f4)][_0x36fddc]=!![],_0x36fddc;}async[_0xbbc3ee(0x1dc)](_0x29975e){const _0x37f6aa=_0xbbc3ee;return this[_0x37f6aa(0x1aa)](_0x29975e);}async['getRedirectUrl'](_0x1ef308){const _0x44ab4f=_0xbbc3ee,_0x2ac254=await this[_0x44ab4f(0x1bf)]['getConfigs'](['wechatOfficialAppId']),_0x2cb970=_0x44ab4f(0x1e5)+_0x2ac254+_0x44ab4f(0x1ce)+encodeURIComponent(_0x1ef308)+_0x44ab4f(0x1d0);return console['log'](_0x44ab4f(0x1bc),_0x2cb970),_0x2cb970;}async[_0xbbc3ee(0x1f2)](_0x2b11e1){const _0x58c581=_0xbbc3ee,_0x2c5998=(0x0,utils_1[_0x58c581(0x19e)])(0x20),_0x536f98=(Date[_0x58c581(0x1cb)]()/0x3e8)['toFixed'](0x0),_0x25138c=await this[_0x58c581(0x1bf)][_0x58c581(0x1c8)](['wechatJsapiTicket']);console[_0x58c581(0x1e6)](_0x58c581(0x1d4),_0x25138c);const _0x2f57bf=await this[_0x58c581(0x1bf)][_0x58c581(0x1c8)]([_0x58c581(0x1cd)]);console[_0x58c581(0x1e6)](_0x58c581(0x1b4),_0x2f57bf);const _0x263d1f=_0x58c581(0x1a9)+_0x25138c+_0x58c581(0x1d2)+_0x2c5998+_0x58c581(0x1d7)+_0x536f98+_0x58c581(0x1c5)+_0x2b11e1;console['log'](_0x58c581(0x1eb),_0x263d1f);const _0x25f29c=this[_0x58c581(0x1dd)](_0x263d1f);return{'appId':_0x2f57bf,'nonceStr':_0x2c5998,'timestamp':_0x536f98,'signature':_0x25f29c};}async['fetchQRCodeTicket'](_0x5484ee){const _0x14e065=_0xbbc3ee,_0x2b1418=await this[_0x14e065(0x1bf)][_0x14e065(0x1c8)]([_0x14e065(0x1b7)]),_0x1cc426={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x5484ee}}},_0x5f1127=await axios_1[_0x14e065(0x191)][_0x14e065(0x1a0)](_0x14e065(0x1b2)+_0x2b1418,_0x1cc426),{data:{errmsg:_0x5459a5,ticket:_0x20e771}}=_0x5f1127;if(_0x5459a5)throw new common_1[(_0x14e065(0x1b6))](_0x5459a5,common_1['HttpStatus'][_0x14e065(0x1bd)]);return _0x20e771;}async['loginByCode'](_0x35e3a5,_0x3571af){const _0x3a4e9a=_0xbbc3ee,_0x5cbc95=await this[_0x3a4e9a(0x1bf)][_0x3a4e9a(0x1c8)]([_0x3a4e9a(0x1cd)]),_0x3bdc53=await this[_0x3a4e9a(0x1bf)]['getConfigs']([_0x3a4e9a(0x192)]),_0x1010c8=await axios_1[_0x3a4e9a(0x191)]['get'](_0x3a4e9a(0x1df)+_0x5cbc95+_0x3a4e9a(0x1ea)+_0x3bdc53+_0x3a4e9a(0x1c7)+_0x3571af+_0x3a4e9a(0x1d1)),{data:{errmsg:_0x50b58b,openid:_0x254d15}}=_0x1010c8;if(_0x50b58b)throw new common_1[(_0x3a4e9a(0x1b6))](_0x50b58b,common_1[_0x3a4e9a(0x1e4)][_0x3a4e9a(0x1bd)]);let _0x4e1070;return _0x4e1070=await this[_0x3a4e9a(0x1a4)][_0x3a4e9a(0x1bb)](_0x254d15),!_0x4e1070&&(_0x4e1070=await this[_0x3a4e9a(0x1a4)][_0x3a4e9a(0x1cc)](_0x254d15)),this['authService']['loginByOpenId'](_0x4e1070,_0x35e3a5);}async['scan'](_0x3ef0ce,_0x386c3a){const _0x2f8633=_0xbbc3ee;if(!this[_0x2f8633(0x1f4)][_0x386c3a])throw new common_1[(_0x2f8633(0x1b6))](_0x2f8633(0x194),common_1[_0x2f8633(0x1e4)][_0x2f8633(0x1bd)]);const _0x58ad6b=await this[_0x2f8633(0x1a4)][_0x2f8633(0x1cc)](_0x3ef0ce,_0x386c3a);this['scanedSceneStrMap'][_0x386c3a]=_0x58ad6b['id'];}async['loginBySceneStr'](_0x53cefc,_0x251f46){const _0xbb8b51=_0xbbc3ee;if(!this[_0xbb8b51(0x1f4)][_0x251f46])return;const _0x2bf08a=this[_0xbb8b51(0x1ee)][_0x251f46];if(!_0x2bf08a)return'';const _0x432bd1=await this[_0xbb8b51(0x1a4)][_0xbb8b51(0x193)](_0x2bf08a);return delete this[_0xbb8b51(0x1ee)][_0x251f46],this['authService'][_0xbb8b51(0x1e9)](_0x432bd1,_0x53cefc);}async[_0xbbc3ee(0x1b5)](_0x410312,_0x43ba77){const _0x5440c0=_0xbbc3ee;if(!this[_0x5440c0(0x1f4)][_0x43ba77])throw new common_1['HttpException'](_0x5440c0(0x194),common_1['HttpStatus'][_0x5440c0(0x1bd)]);const _0x1461f1=_0x43ba77[_0x5440c0(0x1e2)]('/')[0x1],_0x54bc20=await this[_0x5440c0(0x1a4)]['bindWx'](_0x410312,_0x1461f1);this['scanedSceneStrMap'][_0x43ba77]=_0x54bc20;}async[_0xbbc3ee(0x1f1)](_0x4870c0,_0x294137){const _0x29a5f1=_0xbbc3ee;if(!this['sceneStrMap'][_0x294137])throw new common_1[(_0x29a5f1(0x1b6))](_0x29a5f1(0x194),common_1[_0x29a5f1(0x1e4)][_0x29a5f1(0x1bd)]);const {id:_0x4c09b3}=_0x4870c0[_0x29a5f1(0x1e1)],_0x329933=this[_0x29a5f1(0x1ee)][_0x294137];if(!_0x329933)return'';return delete this[_0x29a5f1(0x1ee)][_0x294137],_0x329933;}async['verify'](_0xd378f9,_0x2b9127,_0x100861){const _0x282d72=_0xbbc3ee,_0x3c305c=await this['globalConfigService']['getConfigs']([_0x282d72(0x1ed)])||_0x282d72(0x198);return await this['sha1']([_0x3c305c,_0x2b9127,_0x100861][_0x282d72(0x1ba)]()[_0x282d72(0x1d5)](''))==_0xd378f9;}[_0xbbc3ee(0x1dd)](_0x62d33b){const _0x296783=_0xbbc3ee;return crypto[_0x296783(0x1cf)]('sha1')[_0x296783(0x1d8)](_0x62d33b)[_0x296783(0x1b3)]('hex');}async[_0xbbc3ee(0x1c4)](_0x10a967,_0x115a6b){const _0x13fe83=_0xbbc3ee,_0x56b6d6=await this[_0x13fe83(0x1bf)][_0x13fe83(0x1c8)]([_0x115a6b]);return this[_0x13fe83(0x1ca)](_0x10a967,_0x56b6d6);}async[_0xbbc3ee(0x1ca)](_0x137585,_0x201e0a){const _0xf81058=_0xbbc3ee;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x137585[_0xf81058(0x1b0)][0x0]+']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA['+_0x137585[_0xf81058(0x199)][0x0]+_0xf81058(0x1c2)+new Date()[_0xf81058(0x195)]()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x201e0a+_0xf81058(0x1da);}async[_0xbbc3ee(0x1c6)](_0x2788f5){const _0xeb6d63=_0xbbc3ee,_0x18cf2a=new Promise((_0x13e26a,_0x1a57fc)=>{setTimeout(()=>{_0x1a57fc(new Error('请求超时'));},0x12c0);});let _0x3c0cb9='';try{console[_0xeb6d63(0x1e6)](_0xeb6d63(0x1a1),_0x2788f5);const _0x4b5569=await Promise[_0xeb6d63(0x1c0)]([this[_0xeb6d63(0x1a5)][_0xeb6d63(0x1b8)](_0x2788f5),_0x18cf2a]);_0x3c0cb9=_0x4b5569||await this['autoreplyService'][_0xeb6d63(0x1d9)](_0x2788f5);}catch(_0x4cd020){console[_0xeb6d63(0x1e6)]('来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整'),_0x3c0cb9=await this[_0xeb6d63(0x1bf)]['getConfigs'](['officialAutoReplyText'])||_0xeb6d63(0x1a2);}return _0x3c0cb9;}};OfficialService=__decorate([(0x0,common_1[_0xbbc3ee(0x1ac)])(),__metadata(_0xbbc3ee(0x1c1),[autoreply_service_1[_0xbbc3ee(0x1d3)],user_service_1[_0xbbc3ee(0x1af)],auth_service_1[_0xbbc3ee(0x1b9)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1[_0xbbc3ee(0x1f0)]])],OfficialService),exports[_0xbbc3ee(0x1a7)]=OfficialService;