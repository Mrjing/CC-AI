import{d as D,o as p,c as g,a as o,u as ie,g as le,b as ce,r as n,e as W,f as de,w as O,h as V,i as ue,n as M,F as pe,j as he,k as v,l as h,T as ve,t as fe,m as R,p as j,q as i,_ as B,N as z,s as P,v as _e,x as me,y as ge,z as we,A as xe}from"./index-58669c41.js";import{t as ye}from"./throttle-5584dbda.js";import{c as ke}from"./index-c94da121.js";const be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$e=o("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Le=[$e],Ce=D({name:"FlashOutline",render:function(f,w){return p(),g("svg",be,Le)}}),Ie={class:"min-h-full overflow-hidden flex flex-col"},Me={class:"flex-1 min-h-full p-4 relative"},Pe=["id"],We=["id","src","onLoad","onError","onClick"],Ne={class:"menu p-2 text-[#cbd5e1]"},Re={class:"prompt"},je={class:"flex justify-end items-end space-x-2"},Be=["onClick"],ze={class:"text-sm dark:text-slate-400"},De=o("span",null,"画同款",-1),Ee=["onClick"],He={class:"text-sm dark:text-slate-400"},Se=o("span",null,"使用当前画同款",-1),Ae=["onClick"],Te={class:"text-sm dark:text-slate-400"},Ue=o("span",null,"复制提示词",-1),Fe=o("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1),Oe=D({__name:"index",props:{dataList:{},scaleWidth:{},isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5}},emits:["loadMore","usePropmptDraw"],setup(N,{emit:f}){var S;const w=ie(),a=N,_=f,x=(S=le())==null?void 0:S.appContext.config.globalProperties.$viewerApi,$=ce(),y=n({}),L=n(0),l=n(160),c=n(0),k=n([]),d=n(null),u=n(0),b=W(()=>w.isLogin),E=W(()=>a.scaleWidth?Number(a.scaleWidth)*2+a.gap+150:150),q=de();function G(){K(),Q();const e=c.value,s=l.value,t=[];a.dataList.forEach((m,r)=>{const A=m.drawRatio.split("x"),oe=parseInt(A[0],10),ne=parseInt(A[1],10),ae=s/oe,T=ne*ae+a.gap+L.value,I=y.value[m.id];if(t.length<e)I.style.top="0px",I.style.left=`${(s+a.gap)*r}px`,t.push(T);else{const U=Math.min.apply(null,t),F=t.findIndex(re=>re===U);I.style.top=`${U+0}px`,I.style.left=`${F*(l.value+a.gap)}px`,t[F]+=T}}),u.value=Math.max(...t)+100}function J(e,s){e&&s&&(y.value[s.id]=e)}function K(){const{showName:e=0,showOther:s=0}={};L.value=[e,s].filter(t=>t).length*15}O(()=>a.scaleWidth,e=>{C()}),O(()=>a.dataList,e=>{e&&_e(()=>{C()})},{immediate:!0});function Q(){if(!d.value)return;const e=d.value.clientWidth;c.value=Math.floor(e/E.value);const s=e-c.value*E.value,t=(c.value-1)*a.gap;s-t<0&&(c.value-=1),l.value=Math.floor((e-t)/c.value)}function X(e,s){k.value.push(s.id)}function Y(e,s){console.error("Image failed to load:",s),k.value.push(s.id)}function Z(e){if(!b.value)return w.setLoginDialog(!0);const{prompt:s}=e;ke({text:s}),$.success("复制prompt成功")}function ee(e){q.push(`/midjourney?mjId=${e.id}`)}function te(e){const{fullPrompt:s}=e;_("usePropmptDraw",s)}function se(e){const{drawUrl:s}=e;x({options:{},images:[s]})}const H=W(()=>e=>{const s=e.drawRatio.split("x"),t=Number(s[0]);return Number(s[1])/(t/l.value)}),C=ye(function(){G()},200);return V(async()=>{window.addEventListener("resize",C);const e=document.getElementById("footer");new IntersectionObserver((t,m)=>{t.forEach(r=>{r.isIntersecting&&_("loadMore")})}).observe(e)}),ue(()=>{window.removeEventListener("resize",C)}),(e,s)=>(p(),g("div",Ie,[o("div",Me,[o("div",{id:"wapper",ref_key:"wapperRef",ref:d,class:"wapper",style:M({height:`${u.value}px`})},[(p(!0),g(pe,null,he(e.dataList,(t,m)=>(p(),g("div",{id:t.id.toString(),key:m,ref_for:!0,ref:r=>J(r,t),class:"wapper-item",style:M({width:`${l.value}px`})},[v(ve,{name:"img",css:!0},{default:h(()=>[o("img",{id:t.id.toString(),class:"item-file rounded-sm",style:M({width:`${l.value}px`,height:`${H.value(t)}px`}),src:t.drawUrl,loading:"lazy",onLoad:r=>X(r,t),onError:r=>Y(r,t),onClick:r=>se(t)},null,44,We)]),_:2},1024),o("div",Ne,[o("div",Re,fe(t.fullPrompt),1),o("div",je,[e.isDrawLike?(p(),R(i(z),{key:0,trigger:"hover"},{trigger:h(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(r=>ee(t),["stop"])},[o("span",ze,[v(i(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Be)]),default:h(()=>[De]),_:2},1024)):P("",!0),e.usePropmpt?(p(),R(i(z),{key:1,trigger:"hover"},{trigger:h(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(r=>te(t),["stop"])},[o("span",He,[v(i(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Ee)]),default:h(()=>[Se]),_:2},1024)):P("",!0),e.copyPropmpt?(p(),R(i(z),{key:2,trigger:"hover"},{trigger:h(()=>[o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:j(r=>Z(t),["stop"])},[o("span",Te,[v(i(B),{icon:"tabler:copy",class:"text-sm"})])],8,Ae)]),default:h(()=>[Ue]),_:2},1024)):P("",!0)])]),k.value.includes(t.id)?P("",!0):(p(),g("div",{key:0,class:"item-loading",style:M({width:`${l.value}px`,height:`${H.value(t)}px`})},null,4))],12,Pe))),128)),Fe],4)])]))}});const Ve={class:"bg-[#fff] h-[100vh] overflow-hidden p-4 pr-0 dark:bg-[#18181c] flex flex-col"},qe={class:"p-4 flex pr-6 justify-between items-center"},Ge=o("div",{class:"font-bold text-xl"},"AI绘画广场",-1),Je={class:"w-[200px] sm:w-[300px] flex justify-between"},Ke=o("span",{class:"hidden sm:block"},"尺寸调整",-1),Qe={class:"flex-1 ml-5"},Xe={class:"px-4 mb-1 pr-5"},Ye={class:"market overflow-y-scroll flex-1 min-h-screen p-4 dark:bg-[#18181c] relative"},ot=D({__name:"index",setup(N){const f=n([]),w=n(null),a=n(50),_=n(""),x=n(1),$=n(20),y=n(!1),L=n(!0),l=W(()=>_.value?f.value.filter(d=>{const{prompt:u}=d;return u.includes(_.value)}):f.value);async function c(){y.value=!0;const d=await me({page:x.value,size:$.value,rec:1});y.value=!1,L.value=$.value===d.data.rows.length,f.value=[...f.value,...d.data.rows]}V(async()=>{await c()});function k(){x.value=x.value+1,c()}return(d,u)=>(p(),g("div",Ve,[o("div",qe,[Ge,o("div",Je,[Ke,o("div",Qe,[v(i(ge),{value:a.value,"onUpdate:value":u[0]||(u[0]=b=>a.value=b),step:10},null,8,["value"])])])]),o("div",Xe,[v(i(xe),{value:_.value,"onUpdate:value":u[1]||(u[1]=b=>_.value=b),placeholder:"prompt关键词搜索"},{prefix:h(()=>[v(i(we),{component:i(Ce)},null,8,["component"])]),_:1},8,["value"])]),o("div",Ye,[o("div",{id:"wapper",ref_key:"wapperRef",ref:w,class:"wapper"},[v(Oe,{onLoadMore:k,copyPropmpt:"",isDrawLike:"",dataList:l.value,scaleWidth:a.value},null,8,["dataList","scaleWidth"])],512)])]))}});export{ot as default};
